/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import { LandingPageConfig, LandingPageItemConfig } from '../../models/tc-general-landing-page-config';
import { TcGeneralLandingPageConfigService } from '../../services/tc-general-landing-page-config.service';
import { MatSnackBar, MatDialog } from '@angular/material';
import { TibcoCloudNewElementComponent } from '../tibco-cloud-new-element/tibco-cloud-new-element.component';
/**
 * Configuration page home
 *
 * \@example <tc-tibco-cloud-setting-landing></tc-tibco-cloud-setting-landing>
 */
export class TibcoCloudSettingLandingComponent {
    /**
     * @param {?} route
     * @param {?} generalLandingPageConfigService
     * @param {?} snackBar
     * @param {?} dialog
     */
    constructor(route, generalLandingPageConfigService, snackBar, dialog) {
        this.route = route;
        this.generalLandingPageConfigService = generalLandingPageConfigService;
        this.snackBar = snackBar;
        this.dialog = dialog;
        /**
         * New Configuration
         */
        this.runNewConfiguration = (/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const dialogRef = this.dialog.open(TibcoCloudNewElementComponent, {
                width: '50%',
                height: '30%',
                maxWidth: '100vw',
                maxHeight: '100vh',
                panelClass: 'tcs-style-dialog',
                data: { resourceType: 'Landing Page' }
            });
            dialogRef.afterClosed().subscribe((/**
             * @param {?} result
             * @return {?}
             */
            result => {
                if (result) {
                    /** @type {?} */
                    const newElement = new LandingPageConfig().deserialize({
                        key: result.id,
                        description: result.name,
                        highlights: [new LandingPageItemConfig(), new LandingPageItemConfig(), new LandingPageItemConfig()]
                    });
                    this.landingPages.push(newElement);
                    this.selectedWelcomePage = newElement;
                }
            }));
        });
        /**
         * Helper to Compare Objects
         */
        this.compareObjects = (/**
         * @param {?} o1
         * @param {?} o2
         * @return {?}
         */
        (o1, o2) => {
            return o1 === o2;
        });
    }
    /**
     * @ignore
     * @return {?}
     */
    ngOnInit() {
        this.landingPagesConfig = this.route.snapshot.data.landingPagesConfigHolder;
        this.landingPages = this.landingPagesConfig.landingPage;
        this.allRoles = this.route.snapshot.data.allRolesHolder.roles.filter((/**
         * @param {?} element
         * @return {?}
         */
        element => !element.configuration));
        this.sandboxId = this.route.snapshot.data.claims.primaryProductionSandbox.id;
        this.uiAppId = this.route.snapshot.data.landingPagesConfigHolder.uiAppId;
        // If there is only one landing page selects it automatically
        if (this.landingPages.length == 1) {
            this.selectedWelcomePage = this.landingPages[0];
        }
    }
    /**
     * Save Configuration
     * @return {?}
     */
    runSaveFunction() {
        this.generalLandingPageConfigService.updateGeneralLandingPageConfig(this.sandboxId, this.uiAppId, this.landingPagesConfig, this.landingPagesConfig.id).subscribe((/**
         * @param {?} result
         * @return {?}
         */
        result => {
            this.snackBar.open('Landing Pages configuration saved', 'OK', {
                duration: 3000
            });
        }), (/**
         * @param {?} err
         * @return {?}
         */
        err => {
            this.snackBar.open('Error saving Landing Pages configuration', 'OK', {
                duration: 3000
            });
        }));
    }
    /**
     * Delete Configuration
     * @return {?}
     */
    runDeleteConfiguration() {
        /** @type {?} */
        const pages = this.landingPages;
        pages.forEach((/**
         * @param {?} element
         * @return {?}
         */
        element => {
            if (element == this.selectedWelcomePage) {
                /** @type {?} */
                const index = pages.indexOf(element, 0);
                pages.splice(index, 1);
                this.selectedWelcomePage = undefined;
            }
        }));
    }
}
TibcoCloudSettingLandingComponent.decorators = [
    { type: Component, args: [{
                selector: 'tc-tibco-cloud-setting-landing',
                template: "<div fxLayout=\"column\" fxFill>\n    <tc-tibco-cloud-widget-header style=\"height: 40px;\" [icon]=\"'tcs-capabilities'\"\n        [headerText]=\"'Landing Page Configuration'\"></tc-tibco-cloud-widget-header>\n    <div fxFlex style=\"padding: 20px; overflow: hidden\" fxLayout=\"column\">\n        <div style=\"overflow: auto;\">\n            <div fxLayout=\"column\" fxFlex>\n                <p>You can manage the configuration for the landing pages here.</p>\n                <br>\n                <mat-form-field>\n                    <mat-label>Welcome Page Configuration</mat-label>\n                    <mat-select [(value)]=\"selectedWelcomePage\">\n                        <mat-option *ngFor=\"let landingPage of landingPages\" [value]=\"landingPage\">\n                            {{landingPage.key}}-{{landingPage.description}}\n                        </mat-option>\n                    </mat-select>\n                </mat-form-field>\n\n                <div *ngIf=\"selectedWelcomePage\">\n                    <div fxLayoutGap=\"10px\">\n                        <mat-form-field fxFlex=\"50\">\n                            <input matInput placeholder=\"Title\" [(ngModel)]=\"selectedWelcomePage.title\">\n                        </mat-form-field>\n                        <mat-form-field fxFlex=\"50\">\n                            <input matInput placeholder=\"Subtitle\" [(ngModel)]=\"selectedWelcomePage.subtitle\">\n                        </mat-form-field>\n                    </div>\n                    <div fxLayoutGap=\"10px\">\n                        <mat-form-field fxFlex=\"50\">\n                            <input matInput placeholder=\"Background URL\" [(ngModel)]=\"selectedWelcomePage.backgroundURL\">\n                        </mat-form-field>\n                        <mat-form-field fxFlex=\"50\">\n                            <input matInput placeholder=\"Home route\" [(ngModel)]=\"selectedWelcomePage.homeRoute\">\n                        </mat-form-field>\n                    </div>\n                    <div fxLayoutGap=\"10px\">\n                        <mat-form-field fxFlex=\"80\">\n                            <mat-label>Used in roles</mat-label>\n                            <mat-select [(ngModel)]=\"selectedWelcomePage.roles\" [compareWith]=\"compareObjects\" multiple>\n                                <mat-option *ngFor=\"let role of allRoles\" [value]=\"role.id\">{{role.display}}</mat-option>\n                            </mat-select>\n                        </mat-form-field>\n                    </div>\n                    <div>Hightlights</div>\n                    <div *ngFor=\"let highlight of selectedWelcomePage.highlights\" fxLayoutGap=\"10px\">\n                        <mat-form-field fxFlex=\"15\">\n                            <input matInput placeholder=\"Icon URL\" [(ngModel)]=\"highlight.iconURL\">\n                        </mat-form-field>\n                        <mat-form-field fxFlex=\"30\">\n                            <input matInput placeholder=\"Title\" [(ngModel)]=\"highlight.title\">\n                        </mat-form-field>\n                        <mat-form-field fxFlex=\"55\">\n                            <textarea matInput placeholder=\"Subtitle\" [(ngModel)]=\"highlight.content\" cdkAutosizeMinRows=\"3\" cdkAutosizeMaxRows=\"3\"></textarea>\n                        </mat-form-field>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div fxFlex class=\"tcs-filler-panel\"></div>\n        <div fxLayout=\"row\" fxLayoutGap=\"10px\" fxLayoutAlign=\"end end\" style=\"min-height: 50px\">\n            <button mat-raised-button color=\"secundary\" (click)=\"runDeleteConfiguration()\">Delete</button>\n            <button mat-raised-button color=\"secundary\" (click)=\"runNewConfiguration()\">New</button>\n            <button mat-raised-button color=\"primary\" (click)=\"runSaveFunction()\">Save</button>\n        </div>\n    </div>\n</div>",
                styles: [""]
            }] }
];
/** @nocollapse */
TibcoCloudSettingLandingComponent.ctorParameters = () => [
    { type: ActivatedRoute },
    { type: TcGeneralLandingPageConfigService },
    { type: MatSnackBar },
    { type: MatDialog }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    TibcoCloudSettingLandingComponent.prototype.claims;
    /**
     * @type {?}
     * @private
     */
    TibcoCloudSettingLandingComponent.prototype.landingPagesConfig;
    /**
     * @type {?}
     * @private
     */
    TibcoCloudSettingLandingComponent.prototype.sandboxId;
    /**
     * @type {?}
     * @private
     */
    TibcoCloudSettingLandingComponent.prototype.uiAppId;
    /** @type {?} */
    TibcoCloudSettingLandingComponent.prototype.landingPages;
    /** @type {?} */
    TibcoCloudSettingLandingComponent.prototype.selectedWelcomePage;
    /** @type {?} */
    TibcoCloudSettingLandingComponent.prototype.allRoles;
    /** @type {?} */
    TibcoCloudSettingLandingComponent.prototype.selectedRole;
    /**
     * New Configuration
     * @type {?}
     */
    TibcoCloudSettingLandingComponent.prototype.runNewConfiguration;
    /**
     * Helper to Compare Objects
     * @type {?}
     */
    TibcoCloudSettingLandingComponent.prototype.compareObjects;
    /**
     * @type {?}
     * @private
     */
    TibcoCloudSettingLandingComponent.prototype.route;
    /**
     * @type {?}
     * @private
     */
    TibcoCloudSettingLandingComponent.prototype.generalLandingPageConfigService;
    /**
     * @type {?}
     * @private
     */
    TibcoCloudSettingLandingComponent.prototype.snackBar;
    /**
     * @type {?}
     * @private
     */
    TibcoCloudSettingLandingComponent.prototype.dialog;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGliY28tY2xvdWQtc2V0dGluZy1sYW5kaW5nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0aWJjby10Y3N0ay90Yy1jb3JlLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RpYmNvLWNsb3VkLXNldHRpbmctbGFuZGluZy90aWJjby1jbG91ZC1zZXR0aW5nLWxhbmRpbmcuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBQ2xELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNqRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUscUJBQXFCLEVBQTRCLE1BQU0sNkNBQTZDLENBQUM7QUFDakksT0FBTyxFQUFFLGlDQUFpQyxFQUFFLE1BQU0sdURBQXVELENBQUM7QUFFMUcsT0FBTyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSw4REFBOEQsQ0FBQzs7Ozs7O0FBYTdHLE1BQU0sT0FBTyxpQ0FBaUM7Ozs7Ozs7SUFZMUMsWUFDWSxLQUFxQixFQUNyQiwrQkFBa0UsRUFDbEUsUUFBcUIsRUFDckIsTUFBaUI7UUFIakIsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFDckIsb0NBQStCLEdBQS9CLCtCQUErQixDQUFtQztRQUNsRSxhQUFRLEdBQVIsUUFBUSxDQUFhO1FBQ3JCLFdBQU0sR0FBTixNQUFNLENBQVc7Ozs7UUF1RDdCLHdCQUFtQjs7O1FBQUcsR0FBUSxFQUFFOztrQkFFdEIsU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLDZCQUE2QixFQUFFO2dCQUM5RCxLQUFLLEVBQUUsS0FBSztnQkFDWixNQUFNLEVBQUUsS0FBSztnQkFDYixRQUFRLEVBQUUsT0FBTztnQkFDakIsU0FBUyxFQUFFLE9BQU87Z0JBQ2xCLFVBQVUsRUFBRSxrQkFBa0I7Z0JBQzlCLElBQUksRUFBRSxFQUFFLFlBQVksRUFBRSxjQUFjLEVBQUU7YUFDekMsQ0FBQztZQUVGLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxTQUFTOzs7O1lBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQ3ZDLElBQUksTUFBTSxFQUFFOzswQkFDRixVQUFVLEdBQUcsSUFBSSxpQkFBaUIsRUFBRSxDQUFDLFdBQVcsQ0FBQzt3QkFDbkQsR0FBRyxFQUFFLE1BQU0sQ0FBQyxFQUFFO3dCQUNkLFdBQVcsRUFBRSxNQUFNLENBQUMsSUFBSTt3QkFDeEIsVUFBVSxFQUFFLENBQUMsSUFBSSxxQkFBcUIsRUFBRSxFQUFFLElBQUkscUJBQXFCLEVBQUUsRUFBRSxJQUFJLHFCQUFxQixFQUFFLENBQUM7cUJBQ3RHLENBQUM7b0JBRUYsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7b0JBQ25DLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxVQUFVLENBQUM7aUJBQ3pDO1lBQ0wsQ0FBQyxFQUFDLENBQUM7UUFDUCxDQUFDLEVBQUE7Ozs7UUFLRCxtQkFBYzs7Ozs7UUFBRyxDQUFDLEVBQVUsRUFBRSxFQUFVLEVBQVcsRUFBRTtZQUNqRCxPQUFPLEVBQUUsS0FBSyxFQUFFLENBQUM7UUFDckIsQ0FBQyxFQUFBO0lBcEZHLENBQUM7Ozs7O0lBS0wsUUFBUTtRQUNKLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUM7UUFDNUUsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDO1FBQ3hELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsTUFBTTs7OztRQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFDLENBQUM7UUFFeEcsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLHdCQUF3QixDQUFDLEVBQUUsQ0FBQztRQUM3RSxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxPQUFPLENBQUM7UUFFekUsNkRBQTZEO1FBQzdELElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUFFO1lBQy9CLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ25EO0lBQ0wsQ0FBQzs7Ozs7SUFLRCxlQUFlO1FBQ1gsSUFBSSxDQUFDLCtCQUErQixDQUFDLDhCQUE4QixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVM7Ozs7UUFDNUosTUFBTSxDQUFDLEVBQUU7WUFDTCxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxtQ0FBbUMsRUFBRSxJQUFJLEVBQUU7Z0JBQzFELFFBQVEsRUFBRSxJQUFJO2FBQ2pCLENBQUMsQ0FBQztRQUNQLENBQUM7Ozs7UUFDRCxHQUFHLENBQUMsRUFBRTtZQUNGLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLDBDQUEwQyxFQUFFLElBQUksRUFBRTtnQkFDakUsUUFBUSxFQUFFLElBQUk7YUFDakIsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxFQUNKLENBQUM7SUFDTixDQUFDOzs7OztJQUtELHNCQUFzQjs7Y0FDWixLQUFLLEdBQUcsSUFBSSxDQUFDLFlBQVk7UUFDL0IsS0FBSyxDQUFDLE9BQU87Ozs7UUFBQyxPQUFPLENBQUMsRUFBRTtZQUNwQixJQUFJLE9BQU8sSUFBSSxJQUFJLENBQUMsbUJBQW1CLEVBQUM7O3NCQUM5QixLQUFLLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO2dCQUN2QyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDdkIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLFNBQVMsQ0FBQzthQUN4QztRQUNMLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQzs7O1lBdkVKLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsZ0NBQWdDO2dCQUMxQyw0NUhBQTJEOzthQUU1RDs7OztZQWpCUSxjQUFjO1lBRWQsaUNBQWlDO1lBRWpDLFdBQVc7WUFBRSxTQUFTOzs7Ozs7O0lBZ0IzQixtREFBc0I7Ozs7O0lBQ3RCLCtEQUFxRDs7Ozs7SUFDckQsc0RBQTBCOzs7OztJQUMxQixvREFBd0I7O0lBRXhCLHlEQUF5Qzs7SUFDekMsZ0VBQThDOztJQUM5QyxxREFBaUM7O0lBQ2pDLHlEQUFxQzs7Ozs7SUE2RHJDLGdFQXVCQzs7Ozs7SUFLRCwyREFFQzs7Ozs7SUF4Rkcsa0RBQTZCOzs7OztJQUM3Qiw0RUFBMEU7Ozs7O0lBQzFFLHFEQUE2Qjs7Ozs7SUFDN0IsbURBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IExhbmRpbmdQYWdlQ29uZmlnLCBMYW5kaW5nUGFnZUl0ZW1Db25maWcsIEdlbmVyYWxMYW5kaW5nUGFnZUNvbmZpZyB9IGZyb20gJy4uLy4uL21vZGVscy90Yy1nZW5lcmFsLWxhbmRpbmctcGFnZS1jb25maWcnO1xuaW1wb3J0IHsgVGNHZW5lcmFsTGFuZGluZ1BhZ2VDb25maWdTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvdGMtZ2VuZXJhbC1sYW5kaW5nLXBhZ2UtY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ2xhaW0gfSBmcm9tICcuLi8uLi9tb2RlbHMvdGMtbG9naW4nO1xuaW1wb3J0IHsgTWF0U25hY2tCYXIsIE1hdERpYWxvZyB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsJztcbmltcG9ydCB7IFRpYmNvQ2xvdWROZXdFbGVtZW50Q29tcG9uZW50IH0gZnJvbSAnLi4vdGliY28tY2xvdWQtbmV3LWVsZW1lbnQvdGliY28tY2xvdWQtbmV3LWVsZW1lbnQuY29tcG9uZW50JztcbmltcG9ydCB7IFJvbGVBdHRyaWJ1dGUgfSBmcm9tICcuLi8uLi9tb2RlbHMvdGMtZ2VuZXJhbC1jb25maWcnO1xuXG4vKipcbiAqIENvbmZpZ3VyYXRpb24gcGFnZSBob21lXG4gKlxuICpAZXhhbXBsZSA8dGMtdGliY28tY2xvdWQtc2V0dGluZy1sYW5kaW5nPjwvdGMtdGliY28tY2xvdWQtc2V0dGluZy1sYW5kaW5nPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0Yy10aWJjby1jbG91ZC1zZXR0aW5nLWxhbmRpbmcnLFxuICB0ZW1wbGF0ZVVybDogJy4vdGliY28tY2xvdWQtc2V0dGluZy1sYW5kaW5nLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vdGliY28tY2xvdWQtc2V0dGluZy1sYW5kaW5nLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBUaWJjb0Nsb3VkU2V0dGluZ0xhbmRpbmdDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gICAgcHJpdmF0ZSBjbGFpbXM6IENsYWltO1xuICAgIHByaXZhdGUgbGFuZGluZ1BhZ2VzQ29uZmlnOiBHZW5lcmFsTGFuZGluZ1BhZ2VDb25maWc7XG4gICAgcHJpdmF0ZSBzYW5kYm94SWQ6IG51bWJlcjtcbiAgICBwcml2YXRlIHVpQXBwSWQ6IHN0cmluZztcblxuICAgIHB1YmxpYyBsYW5kaW5nUGFnZXM6IExhbmRpbmdQYWdlQ29uZmlnW107XG4gICAgcHVibGljIHNlbGVjdGVkV2VsY29tZVBhZ2U6IExhbmRpbmdQYWdlQ29uZmlnO1xuICAgIHB1YmxpYyBhbGxSb2xlczogUm9sZUF0dHJpYnV0ZVtdO1xuICAgIHB1YmxpYyBzZWxlY3RlZFJvbGU6IFJvbGVBdHRyaWJ1dGVbXTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSxcbiAgICAgICAgcHJpdmF0ZSBnZW5lcmFsTGFuZGluZ1BhZ2VDb25maWdTZXJ2aWNlOiBUY0dlbmVyYWxMYW5kaW5nUGFnZUNvbmZpZ1NlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgc25hY2tCYXI6IE1hdFNuYWNrQmFyLFxuICAgICAgICBwcml2YXRlIGRpYWxvZzogTWF0RGlhbG9nXG4gICAgKSB7IH1cblxuICAgIC8qKlxuICAgICogQGlnbm9yZVxuICAgICovXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMubGFuZGluZ1BhZ2VzQ29uZmlnID0gdGhpcy5yb3V0ZS5zbmFwc2hvdC5kYXRhLmxhbmRpbmdQYWdlc0NvbmZpZ0hvbGRlcjtcbiAgICAgICAgdGhpcy5sYW5kaW5nUGFnZXMgPSB0aGlzLmxhbmRpbmdQYWdlc0NvbmZpZy5sYW5kaW5nUGFnZTtcbiAgICAgICAgdGhpcy5hbGxSb2xlcyA9IHRoaXMucm91dGUuc25hcHNob3QuZGF0YS5hbGxSb2xlc0hvbGRlci5yb2xlcy5maWx0ZXIoZWxlbWVudCA9PiAhZWxlbWVudC5jb25maWd1cmF0aW9uKTtcblxuICAgICAgICB0aGlzLnNhbmRib3hJZCA9IHRoaXMucm91dGUuc25hcHNob3QuZGF0YS5jbGFpbXMucHJpbWFyeVByb2R1Y3Rpb25TYW5kYm94LmlkO1xuICAgICAgICB0aGlzLnVpQXBwSWQgPSB0aGlzLnJvdXRlLnNuYXBzaG90LmRhdGEubGFuZGluZ1BhZ2VzQ29uZmlnSG9sZGVyLnVpQXBwSWQ7XG5cbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgb25seSBvbmUgbGFuZGluZyBwYWdlIHNlbGVjdHMgaXQgYXV0b21hdGljYWxseVxuICAgICAgICBpZiAodGhpcy5sYW5kaW5nUGFnZXMubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRXZWxjb21lUGFnZSA9IHRoaXMubGFuZGluZ1BhZ2VzWzBdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2F2ZSBDb25maWd1cmF0aW9uXG4gICAgICovXG4gICAgcnVuU2F2ZUZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuZ2VuZXJhbExhbmRpbmdQYWdlQ29uZmlnU2VydmljZS51cGRhdGVHZW5lcmFsTGFuZGluZ1BhZ2VDb25maWcodGhpcy5zYW5kYm94SWQsIHRoaXMudWlBcHBJZCwgdGhpcy5sYW5kaW5nUGFnZXNDb25maWcsIHRoaXMubGFuZGluZ1BhZ2VzQ29uZmlnLmlkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICByZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc25hY2tCYXIub3BlbignTGFuZGluZyBQYWdlcyBjb25maWd1cmF0aW9uIHNhdmVkJywgJ09LJywge1xuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMzAwMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVyciA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zbmFja0Jhci5vcGVuKCdFcnJvciBzYXZpbmcgTGFuZGluZyBQYWdlcyBjb25maWd1cmF0aW9uJywgJ09LJywge1xuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMzAwMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlbGV0ZSBDb25maWd1cmF0aW9uXG4gICAgICovXG4gICAgcnVuRGVsZXRlQ29uZmlndXJhdGlvbigpe1xuICAgICAgICBjb25zdCBwYWdlcyA9IHRoaXMubGFuZGluZ1BhZ2VzO1xuICAgICAgICBwYWdlcy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAgICAgaWYgKGVsZW1lbnQgPT0gdGhpcy5zZWxlY3RlZFdlbGNvbWVQYWdlKXtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHBhZ2VzLmluZGV4T2YoZWxlbWVudCwgMCk7XG4gICAgICAgICAgICAgICAgcGFnZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkV2VsY29tZVBhZ2UgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE5ldyBDb25maWd1cmF0aW9uXG4gICAgICovXG4gICAgcnVuTmV3Q29uZmlndXJhdGlvbiA9ICgpOnZvaWQgPT4ge1xuXG4gICAgICAgIGNvbnN0IGRpYWxvZ1JlZiA9IHRoaXMuZGlhbG9nLm9wZW4oVGliY29DbG91ZE5ld0VsZW1lbnRDb21wb25lbnQsIHtcbiAgICAgICAgICAgIHdpZHRoOiAnNTAlJyxcbiAgICAgICAgICAgIGhlaWdodDogJzMwJScsXG4gICAgICAgICAgICBtYXhXaWR0aDogJzEwMHZ3JyxcbiAgICAgICAgICAgIG1heEhlaWdodDogJzEwMHZoJyxcbiAgICAgICAgICAgIHBhbmVsQ2xhc3M6ICd0Y3Mtc3R5bGUtZGlhbG9nJyxcbiAgICAgICAgICAgIGRhdGE6IHsgcmVzb3VyY2VUeXBlOiAnTGFuZGluZyBQYWdlJyB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRpYWxvZ1JlZi5hZnRlckNsb3NlZCgpLnN1YnNjcmliZShyZXN1bHQgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0VsZW1lbnQgPSBuZXcgTGFuZGluZ1BhZ2VDb25maWcoKS5kZXNlcmlhbGl6ZSh7XG4gICAgICAgICAgICAgICAgICAgIGtleTogcmVzdWx0LmlkLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogcmVzdWx0Lm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodHM6IFtuZXcgTGFuZGluZ1BhZ2VJdGVtQ29uZmlnKCksIG5ldyBMYW5kaW5nUGFnZUl0ZW1Db25maWcoKSwgbmV3IExhbmRpbmdQYWdlSXRlbUNvbmZpZygpXVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5sYW5kaW5nUGFnZXMucHVzaChuZXdFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkV2VsY29tZVBhZ2UgPSBuZXdFbGVtZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIZWxwZXIgdG8gQ29tcGFyZSBPYmplY3RzXG4gICAgICovXG4gICAgY29tcGFyZU9iamVjdHMgPSAobzE6IHN0cmluZywgbzI6IHN0cmluZyk6IGJvb2xlYW4gPT4ge1xuICAgICAgICByZXR1cm4gbzEgPT09IG8yO1xuICAgIH1cblxufVxuIl19