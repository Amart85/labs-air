/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/* Used to resolve contents of landing page config file */
/* This resolver will try and read the config from shared state
 * If a shared state entry does NOT exist it will use the defaults from a config file
 * Then update shared state with those contents
 */
import { Injectable } from '@angular/core';
import { of } from 'rxjs';
import { UiAppIdConfig } from '../models/tc-app-config';
import { flatMap, map, mergeMap, switchMap } from 'rxjs/operators';
import { TcSharedStateService } from '../services/tc-shared-state.service';
import { HttpClient } from '@angular/common/http';
import { Location } from '@angular/common';
import { TcCoreCommonFunctions } from '../common/tc-core-common-functions';
import { TcGeneralLandingPageConfigService } from '../services/tc-general-landing-page-config.service';
import { GeneralLandingPageConfig } from '../models/tc-general-landing-page-config';
var GeneralLandingPageConfigResolver = /** @class */ (function () {
    function GeneralLandingPageConfigResolver(tcSharedState, generalLandingPageConfigService, http, location) {
        var _this = this;
        this.tcSharedState = tcSharedState;
        this.generalLandingPageConfigService = generalLandingPageConfigService;
        this.http = http;
        this.location = location;
        this.DEFAULT_CONFIG_URL = 'assets/config/landingPages.json';
        this.APP_ID_URL = TcCoreCommonFunctions.prepareUrlForStaticResource(this.location, 'assets/config/uiAppId.json');
        // note appConfigResolver will need sandboxId to create app config state record.
        // So we expect this to have been set by caller (done by tc-liveapps-lib/laConfigResolver).
        this.setSandbox = (/**
         * @param {?} sandboxId
         * @return {?}
         */
        function (sandboxId) {
            _this.sandboxId = sandboxId;
        });
        // can be used to load defaultAppConfig from a JSON config
        this.getDefaultAppConfig = (/**
         * @return {?}
         */
        function () {
            return _this.http.get(TcCoreCommonFunctions.prepareUrlForStaticResource(_this.location, _this.DEFAULT_CONFIG_URL));
        });
        // loads uiAppId from json file in assets (appId.json)
        this.getAppId = (/**
         * @return {?}
         */
        function () {
            return _this.http.get(_this.APP_ID_URL).pipe(map((/**
             * @param {?} uiAppId
             * @return {?}
             */
            function (uiAppId) {
                /** @type {?} */
                var uiAppIdConfig = new UiAppIdConfig().deserialize(uiAppId);
                _this.uiAppId = uiAppIdConfig.uiAppId;
                return uiAppIdConfig;
            })));
        });
    }
    /**
     * @return {?}
     */
    GeneralLandingPageConfigResolver.prototype.resolve = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var appConfig = this.getAppId().pipe(switchMap((/**
         * @param {?} uiAppId
         * @return {?}
         */
        function (uiAppId) { return _this.generalLandingPageConfigService.getGeneralLandingPageConfig(uiAppId.uiAppId, true, false)
            .pipe(mergeMap((/**
         * @param {?} generalConfig
         * @return {?}
         */
        function (generalConfig) {
            if (generalConfig === undefined) {
                return _this.getDefaultAppConfig().pipe(flatMap((/**
                 * @param {?} config
                 * @return {?}
                 */
                function (config) {
                    _this.defaultLandingPageConfig = new GeneralLandingPageConfig().deserialize(config);
                    _this.defaultLandingPageConfig.uiAppId = _this.uiAppId;
                    return _this.generalLandingPageConfigService.createGeneralLandingPageConfig(_this.sandboxId, _this.uiAppId, _this.defaultLandingPageConfig)
                        .pipe(flatMap((/**
                     * @param {?} result
                     * @return {?}
                     */
                    function (result) {
                        /** @type {?} */
                        var newAppConfig = _this.defaultLandingPageConfig;
                        newAppConfig.id = result;
                        return _this.generalLandingPageConfigService.updateGeneralLandingPageConfig(_this.sandboxId, _this.uiAppId, newAppConfig, result).pipe(flatMap((
                        // trigger a read to flush the cache since we changed it
                        // trigger a read to flush the cache since we changed it
                        /**
                         * @param {?} updatedConf
                         * @return {?}
                         */
                        function (updatedConf) {
                            return _this.generalLandingPageConfigService.getGeneralLandingPageConfig(_this.uiAppId, true, true).pipe(map((/**
                             * @param {?} cachedConfig
                             * @return {?}
                             */
                            function (cachedConfig) {
                                return cachedConfig;
                            })));
                        })));
                        // return newAppConfig;
                    })));
                })));
            }
            else {
                return of(generalConfig);
            }
        }))); })));
        return appConfig;
    };
    GeneralLandingPageConfigResolver.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    GeneralLandingPageConfigResolver.ctorParameters = function () { return [
        { type: TcSharedStateService },
        { type: TcGeneralLandingPageConfigService },
        { type: HttpClient },
        { type: Location }
    ]; };
    return GeneralLandingPageConfigResolver;
}());
export { GeneralLandingPageConfigResolver };
if (false) {
    /** @type {?} */
    GeneralLandingPageConfigResolver.prototype.DEFAULT_CONFIG_URL;
    /** @type {?} */
    GeneralLandingPageConfigResolver.prototype.APP_ID_URL;
    /**
     * @type {?}
     * @private
     */
    GeneralLandingPageConfigResolver.prototype.sandboxId;
    /** @type {?} */
    GeneralLandingPageConfigResolver.prototype.defaultLandingPageConfig;
    /**
     * @type {?}
     * @private
     */
    GeneralLandingPageConfigResolver.prototype.uiAppId;
    /** @type {?} */
    GeneralLandingPageConfigResolver.prototype.setSandbox;
    /**
     * @type {?}
     * @private
     */
    GeneralLandingPageConfigResolver.prototype.getDefaultAppConfig;
    /**
     * @type {?}
     * @private
     */
    GeneralLandingPageConfigResolver.prototype.getAppId;
    /**
     * @type {?}
     * @private
     */
    GeneralLandingPageConfigResolver.prototype.tcSharedState;
    /**
     * @type {?}
     * @private
     */
    GeneralLandingPageConfigResolver.prototype.generalLandingPageConfigService;
    /**
     * @type {?}
     * @private
     */
    GeneralLandingPageConfigResolver.prototype.http;
    /**
     * @type {?}
     * @private
     */
    GeneralLandingPageConfigResolver.prototype.location;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhbC1sYW5kaW5nLXBhZ2UtY29uZmlnLnJlc29sdmVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRpYmNvLXRjc3RrL3RjLWNvcmUtbGliLyIsInNvdXJjZXMiOlsibGliL3Jlc29sdmVycy9nZW5lcmFsLWxhbmRpbmctcGFnZS1jb25maWcucmVzb2x2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBT0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzQyxPQUFPLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDbkUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDM0UsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRWxELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUMzRSxPQUFPLEVBQUUsaUNBQWlDLEVBQUUsTUFBTSxvREFBb0QsQ0FBQztBQUN2RyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUVwRjtJQVVJLDBDQUNZLGFBQW1DLEVBQ25DLCtCQUFrRSxFQUNsRSxJQUFnQixFQUNoQixRQUFrQjtRQUo5QixpQkFJbUM7UUFIdkIsa0JBQWEsR0FBYixhQUFhLENBQXNCO1FBQ25DLG9DQUErQixHQUEvQiwrQkFBK0IsQ0FBbUM7UUFDbEUsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUNoQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBWDlCLHVCQUFrQixHQUFHLGlDQUFpQyxDQUFDO1FBQ3ZELGVBQVUsR0FB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aEIsRUFDSixDQUNKO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDckIsQ0FBQzs7Z0JBNUZKLFVBQVU7Ozs7Z0JBUkYsb0JBQW9CO2dCQUtwQixpQ0FBaUM7Z0JBSmpDLFVBQVU7Z0JBRVYsUUFBUTs7SUFtR2pCLHVDQUFDO0NBQUEsQUE5RkQsSUE4RkM7U0E3RlksZ0NBQWdDOzs7SUFFekMsOERBQXVEOztJQUN2RCxzREFBNEc7Ozs7O0lBRTVHLHFEQUEwQjs7SUFDMUIsb0VBQTBEOzs7OztJQUMxRCxtREFBd0I7O0lBVXhCLHNEQUVDOzs7OztJQUdELCtEQUVDOzs7OztJQUdELG9EQVNDOzs7OztJQTFCRyx5REFBMkM7Ozs7O0lBQzNDLDJFQUEwRTs7Ozs7SUFDMUUsZ0RBQXdCOzs7OztJQUN4QixvREFBMEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBVc2VkIHRvIHJlc29sdmUgY29udGVudHMgb2YgbGFuZGluZyBwYWdlIGNvbmZpZyBmaWxlICovXG5cbi8qIFRoaXMgcmVzb2x2ZXIgd2lsbCB0cnkgYW5kIHJlYWQgdGhlIGNvbmZpZyBmcm9tIHNoYXJlZCBzdGF0ZVxuICogSWYgYSBzaGFyZWQgc3RhdGUgZW50cnkgZG9lcyBOT1QgZXhpc3QgaXQgd2lsbCB1c2UgdGhlIGRlZmF1bHRzIGZyb20gYSBjb25maWcgZmlsZVxuICogVGhlbiB1cGRhdGUgc2hhcmVkIHN0YXRlIHdpdGggdGhvc2UgY29udGVudHNcbiAqL1xuXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSZXNvbHZlIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBVaUFwcElkQ29uZmlnIH0gZnJvbSAnLi4vbW9kZWxzL3RjLWFwcC1jb25maWcnO1xuaW1wb3J0IHsgZmxhdE1hcCwgbWFwLCBtZXJnZU1hcCwgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgVGNTaGFyZWRTdGF0ZVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy90Yy1zaGFyZWQtc3RhdGUuc2VydmljZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgR2VuZXJhbENvbmZpZyB9IGZyb20gJy4uL21vZGVscy90Yy1nZW5lcmFsLWNvbmZpZyc7XG5pbXBvcnQgeyBMb2NhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBUY0NvcmVDb21tb25GdW5jdGlvbnMgfSBmcm9tICcuLi9jb21tb24vdGMtY29yZS1jb21tb24tZnVuY3Rpb25zJztcbmltcG9ydCB7IFRjR2VuZXJhbExhbmRpbmdQYWdlQ29uZmlnU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3RjLWdlbmVyYWwtbGFuZGluZy1wYWdlLWNvbmZpZy5zZXJ2aWNlJztcbmltcG9ydCB7IEdlbmVyYWxMYW5kaW5nUGFnZUNvbmZpZyB9IGZyb20gJy4uL21vZGVscy90Yy1nZW5lcmFsLWxhbmRpbmctcGFnZS1jb25maWcnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgR2VuZXJhbExhbmRpbmdQYWdlQ29uZmlnUmVzb2x2ZXIgaW1wbGVtZW50cyBSZXNvbHZlPE9ic2VydmFibGU8R2VuZXJhbExhbmRpbmdQYWdlQ29uZmlnPj4ge1xuXG4gICAgREVGQVVMVF9DT05GSUdfVVJMID0gJ2Fzc2V0cy9jb25maWcvbGFuZGluZ1BhZ2VzLmpzb24nO1xuICAgIEFQUF9JRF9VUkwgPSBUY0NvcmVDb21tb25GdW5jdGlvbnMucHJlcGFyZVVybEZvclN0YXRpY1Jlc291cmNlKHRoaXMubG9jYXRpb24sICdhc3NldHMvY29uZmlnL3VpQXBwSWQuanNvbicpO1xuXG4gICAgcHJpdmF0ZSBzYW5kYm94SWQ6IG51bWJlcjtcbiAgICBwdWJsaWMgZGVmYXVsdExhbmRpbmdQYWdlQ29uZmlnOiBHZW5lcmFsTGFuZGluZ1BhZ2VDb25maWc7XG4gICAgcHJpdmF0ZSB1aUFwcElkOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSB0Y1NoYXJlZFN0YXRlOiBUY1NoYXJlZFN0YXRlU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBnZW5lcmFsTGFuZGluZ1BhZ2VDb25maWdTZXJ2aWNlOiBUY0dlbmVyYWxMYW5kaW5nUGFnZUNvbmZpZ1NlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCxcbiAgICAgICAgcHJpdmF0ZSBsb2NhdGlvbjogTG9jYXRpb24pIHsgfVxuICAgIC8vIG5vdGUgYXBwQ29uZmlnUmVzb2x2ZXIgd2lsbCBuZWVkIHNhbmRib3hJZCB0byBjcmVhdGUgYXBwIGNvbmZpZyBzdGF0ZSByZWNvcmQuXG4gICAgLy8gU28gd2UgZXhwZWN0IHRoaXMgdG8gaGF2ZSBiZWVuIHNldCBieSBjYWxsZXIgKGRvbmUgYnkgdGMtbGl2ZWFwcHMtbGliL2xhQ29uZmlnUmVzb2x2ZXIpLlxuXG4gICAgcHVibGljIHNldFNhbmRib3ggPSAoc2FuZGJveElkOiBudW1iZXIpID0+IHtcbiAgICAgICAgdGhpcy5zYW5kYm94SWQgPSBzYW5kYm94SWQ7XG4gICAgfVxuXG4gICAgLy8gY2FuIGJlIHVzZWQgdG8gbG9hZCBkZWZhdWx0QXBwQ29uZmlnIGZyb20gYSBKU09OIGNvbmZpZ1xuICAgIHByaXZhdGUgZ2V0RGVmYXVsdEFwcENvbmZpZyA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoVGNDb3JlQ29tbW9uRnVuY3Rpb25zLnByZXBhcmVVcmxGb3JTdGF0aWNSZXNvdXJjZSh0aGlzLmxvY2F0aW9uLCB0aGlzLkRFRkFVTFRfQ09ORklHX1VSTCkpO1xuICAgIH1cblxuICAgIC8vIGxvYWRzIHVpQXBwSWQgZnJvbSBqc29uIGZpbGUgaW4gYXNzZXRzIChhcHBJZC5qc29uKVxuICAgIHByaXZhdGUgZ2V0QXBwSWQgPSAoKTogT2JzZXJ2YWJsZTxVaUFwcElkQ29uZmlnPiA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHRoaXMuQVBQX0lEX1VSTCkucGlwZShcbiAgICAgICAgICAgIG1hcCh1aUFwcElkID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB1aUFwcElkQ29uZmlnID0gbmV3IFVpQXBwSWRDb25maWcoKS5kZXNlcmlhbGl6ZSh1aUFwcElkKTtcbiAgICAgICAgICAgICAgICB0aGlzLnVpQXBwSWQgPSB1aUFwcElkQ29uZmlnLnVpQXBwSWQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVpQXBwSWRDb25maWc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcmVzb2x2ZSgpOiBPYnNlcnZhYmxlPEdlbmVyYWxMYW5kaW5nUGFnZUNvbmZpZz4ge1xuICAgICAgICBjb25zdCBhcHBDb25maWcgPSB0aGlzLmdldEFwcElkKCkucGlwZShcbiAgICAgICAgICAgIHN3aXRjaE1hcCh1aUFwcElkID0+IHRoaXMuZ2VuZXJhbExhbmRpbmdQYWdlQ29uZmlnU2VydmljZS5nZXRHZW5lcmFsTGFuZGluZ1BhZ2VDb25maWcodWlBcHBJZC51aUFwcElkLCB0cnVlLCBmYWxzZSlcbiAgICAgICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICAgICAgbWVyZ2VNYXAoXG4gICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmFsQ29uZmlnID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2VuZXJhbENvbmZpZyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldERlZmF1bHRBcHBDb25maWcoKS5waXBlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhdE1hcChjb25maWcgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVmYXVsdExhbmRpbmdQYWdlQ29uZmlnID0gbmV3IEdlbmVyYWxMYW5kaW5nUGFnZUNvbmZpZygpLmRlc2VyaWFsaXplKGNvbmZpZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0TGFuZGluZ1BhZ2VDb25maWcudWlBcHBJZCA9IHRoaXMudWlBcHBJZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmFsTGFuZGluZ1BhZ2VDb25maWdTZXJ2aWNlLmNyZWF0ZUdlbmVyYWxMYW5kaW5nUGFnZUNvbmZpZyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYW5kYm94SWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudWlBcHBJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0TGFuZGluZ1BhZ2VDb25maWcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhdE1hcChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdBcHBDb25maWcgPSB0aGlzLmRlZmF1bHRMYW5kaW5nUGFnZUNvbmZpZztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3QXBwQ29uZmlnLmlkID0gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmFsTGFuZGluZ1BhZ2VDb25maWdTZXJ2aWNlLnVwZGF0ZUdlbmVyYWxMYW5kaW5nUGFnZUNvbmZpZyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FuZGJveElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51aUFwcElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3QXBwQ29uZmlnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0KS5waXBlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYXRNYXAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRyaWdnZXIgYSByZWFkIHRvIGZsdXNoIHRoZSBjYWNoZSBzaW5jZSB3ZSBjaGFuZ2VkIGl0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRDb25mID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYWxMYW5kaW5nUGFnZUNvbmZpZ1NlcnZpY2UuZ2V0R2VuZXJhbExhbmRpbmdQYWdlQ29uZmlnKHRoaXMudWlBcHBJZCwgdHJ1ZSwgdHJ1ZSkucGlwZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlZENvbmZpZyA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FjaGVkQ29uZmlnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIG5ld0FwcENvbmZpZztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2YoZ2VuZXJhbENvbmZpZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICApXG4gICAgICAgIHJldHVybiBhcHBDb25maWc7XG4gICAgfVxuXG59XG4iXX0=