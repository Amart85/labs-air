/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, ElementRef, Input } from '@angular/core';
import { Location } from '@angular/common';
import { TcCoreCommonFunctions } from '../../common/tc-core-common-functions';
import { MessageTopicService } from '../../common/tc-core-topic-comm';
/**
 * TIBCO Cloud Navigation Bar
 *
 * ![alt-text](../tibco-cloud-navbar.png "Image")
 *
 * \@example <tc-tibco-cloud-navbar appName=""></tc-tibco-cloud-navbar>
 */
var TibcoCloudNavbarComponent = /** @class */ (function () {
    /**
     * single empty Constructor of TIBCO Cloud Navigation Bar
     */
    function TibcoCloudNavbarComponent(location, messageService) {
        this.location = location;
        this.messageService = messageService;
        this.ms = messageService;
    }
    /**
     * @ignore
     */
    /**
     * @ignore
     * @return {?}
     */
    TibcoCloudNavbarComponent.prototype.ngOnInit = /**
     * @ignore
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.docUrl && (this.docUrl.slice(0, 4).toLowerCase() !== 'http')) {
            //      this.docUrl = this.location.prepareExternalUrl(this.docUrl);        // This will work with non hash routing
            this.docUrl = TcCoreCommonFunctions.prepareUrlForStaticResource(this.location, this.docUrl); // This will work with hash routing
        }
        this.navbar = new GlobalNavbar({
            container: '#navbar',
            textAfterLogo: this.appName ? this.appName : undefined,
            iconMenus: {
                search: {
                    visible: false // for versions 0.1.X the propertie is "disabled" instead of "visible".
                },
                download: {
                    visible: false
                },
                help: {
                    visible: true
                },
                notifications: {
                    visible: false
                },
                products: {
                    visible: false
                }
            },
            customProfilePanel: {
                account: {
                    visible: false
                },
                subscriptions: {
                    visible: false
                },
                organization: {
                    visible: false
                },
                tenants: {
                    visible: false
                }
            },
            customizedComponents: [
                {
                    name: 'help',
                    template: '#help-template'
                }
            ]
        });
        if (this.logoUrl || this.logoClickTargetUrl || this.rebrandConfig) {
            /** @type {?} */
            var style = {};
            if (this.logoUrl || this.logoClickTargetUrl) {
                style.logo = {
                    'src': this.logoUrl,
                    'url': this.logoClickTargetUrl // If the url is not set then the logo will redirect to TSC.
                };
            }
            if (this.rebrandConfig) {
                if (this.rebrandConfig.backgroundColor) {
                    style.backgroundColor = this.rebrandConfig.backgroundColor;
                }
                if (this.rebrandConfig.fontColor) {
                    style.fontColor = this.rebrandConfig.fontColor;
                }
                if (this.rebrandConfig.fontFamily) {
                    style.fontFamily = this.rebrandConfig.fontFamily;
                }
                if (this.rebrandConfig.iconColor) {
                    style.iconColor = this.rebrandConfig.iconColor;
                }
            }
            this.navbar.refreshRebrandingStyle(style);
        }
        this.navbar.load();
        // console.log('DOC URL: ' + this.docUrl);
        /** @type {?} */
        var initialHelpURL = this.docUrl + '/help.html';
        this.urlExists(initialHelpURL, (/**
         * @param {?} exists
         * @return {?}
         */
        function (exists) {
            if (exists) {
                _this.navbar.customizePanel('help', '<embed src="' + initialHelpURL + '" style="height: 100%; width: 100%">'); // set HTML string
            }
            else {
                _this.navbar.customizePanel('help', '<b> No Help Page Found</b>'); // set HTML string
            }
        }));
        this.ms.getMessage('help').subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            // console.log('Got message: ' + data.text);
            _this.findHelpFile('assets/help/' + data.text + '/help.html');
        }));
    };
    /**
     * @param {?} helpUrl
     * @return {?}
     */
    TibcoCloudNavbarComponent.prototype.findHelpFile = /**
     * @param {?} helpUrl
     * @return {?}
     */
    function (helpUrl) {
        var _this = this;
        this.urlExists(helpUrl, (/**
         * @param {?} exists
         * @return {?}
         */
        function (exists) {
            // console.log('RESULT: url=' + helpUrl + ', exists=' + exists);
            if (exists) {
                console.log('Setting help page: ' + helpUrl);
                _this.navbar.customizePanel('help', '<embed src="' + helpUrl + '" style="height: 100%; width: 100%">');
            }
            else {
                if (helpUrl.includes('/')) {
                    // Find one step lower
                    // console.log('HelpURL before: |' + helpUrl + '|');
                    helpUrl = helpUrl.substring(0, helpUrl.lastIndexOf('/help.html'));
                    // console.log('HelpURL middle: |' + helpUrl + '|');
                    helpUrl = helpUrl.substring(0, helpUrl.lastIndexOf('/') + 1);
                    // console.log('HelpURL  after: |' + helpUrl + '|');
                    _this.findHelpFile(helpUrl + 'help.html');
                }
                else {
                    console.log('No valid help file found...');
                    _this.navbar.customizePanel('help', '<b> No Help Page Found</b>'); // set HTML string
                }
            }
        }));
    };
    // The "callback" argument is called with either true or false
    // depending on whether the "url" exists or not.
    // The "callback" argument is called with either true or false
    // depending on whether the "url" exists or not.
    /**
     * @param {?} url
     * @param {?} callback
     * @return {?}
     */
    TibcoCloudNavbarComponent.prototype.urlExists = 
    // The "callback" argument is called with either true or false
    // depending on whether the "url" exists or not.
    /**
     * @param {?} url
     * @param {?} callback
     * @return {?}
     */
    function (url, callback) {
        /** @type {?} */
        var http = new XMLHttpRequest();
        http.open('GET', url, true);
        http.onload = (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (http.readyState === 4) {
                if (http.status === 200) {
                    callback(true);
                }
                else {
                    callback(false);
                }
            }
        });
        http.send();
    };
    TibcoCloudNavbarComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tc-tibco-cloud-navbar',
                    template: "<div class=\"tai-navbar\">\n<div id=\"navbar\" class=\"tai-navbar\" #navbar></div>\n</div>\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    TibcoCloudNavbarComponent.ctorParameters = function () { return [
        { type: Location },
        { type: MessageTopicService }
    ]; };
    TibcoCloudNavbarComponent.propDecorators = {
        navbarRef: [{ type: ViewChild, args: ['navbar', { static: true },] }],
        appName: [{ type: Input }],
        docUrl: [{ type: Input }],
        logoUrl: [{ type: Input }],
        rebrandConfig: [{ type: Input }],
        logoClickTargetUrl: [{ type: Input }]
    };
    return TibcoCloudNavbarComponent;
}());
export { TibcoCloudNavbarComponent };
if (false) {
    /**
     * Reference Element
     * @type {?}
     * @private
     */
    TibcoCloudNavbarComponent.prototype.navbarRef;
    /**
     * diaplayed Application Name
     * @type {?}
     */
    TibcoCloudNavbarComponent.prototype.appName;
    /**
     * Documentation URL
     * @type {?}
     */
    TibcoCloudNavbarComponent.prototype.docUrl;
    /**
     * Custom Logo URL
     * @type {?}
     */
    TibcoCloudNavbarComponent.prototype.logoUrl;
    /**
     * rebrand config - example: { "backgroundColor": "#cfcfcf", "fontColor": "#682782", "fontFamily": "Oswald", "iconColor": "red" }
     * @type {?}
     */
    TibcoCloudNavbarComponent.prototype.rebrandConfig;
    /**
     * Where to redirect on click of logo
     * @type {?}
     */
    TibcoCloudNavbarComponent.prototype.logoClickTargetUrl;
    /**
     * @type {?}
     * @private
     */
    TibcoCloudNavbarComponent.prototype.navbar;
    /**
     * @type {?}
     * @private
     */
    TibcoCloudNavbarComponent.prototype.ms;
    /**
     * @type {?}
     * @private
     */
    TibcoCloudNavbarComponent.prototype.location;
    /**
     * @type {?}
     * @private
     */
    TibcoCloudNavbarComponent.prototype.messageService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGliY28tY2xvdWQtbmF2YmFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0aWJjby10Y3N0ay90Yy1jb3JlLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RpYmNvLWNsb3VkLW5hdmJhci90aWJjby1jbG91ZC1uYXZiYXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFVLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUF5QixNQUFNLGVBQWUsQ0FBQztBQUN0RyxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDekMsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDOUUsT0FBTyxFQUFDLG1CQUFtQixFQUFDLE1BQU0saUNBQWlDLENBQUM7Ozs7Ozs7O0FBWXBFO0lBMENFOztPQUVHO0lBRUgsbUNBQW9CLFFBQWtCLEVBQVUsY0FBbUM7UUFBL0QsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFVLG1CQUFjLEdBQWQsY0FBYyxDQUFxQjtRQUNqRixJQUFJLENBQUMsRUFBRSxHQUFHLGNBQWMsQ0FBQztJQUMzQixDQUFDO0lBRUQ7O09BRUc7Ozs7O0lBQ0gsNENBQVE7Ozs7SUFBUjtRQUFBLGlCQTBGQztRQXhGQyxJQUFJLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLEtBQUssTUFBTSxDQUFDLEVBQUU7WUFDM0UsbUhBQW1IO1lBQzdHLElBQUksQ0FBQyxNQUFNLEdBQUcscUJBQXFCLENBQUMsMkJBQTJCLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBUSxtQ0FBbUM7U0FDeEk7UUFFRCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksWUFBWSxDQUFDO1lB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SUFBRSxtREFBMkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIElucHV0LCBTeXN0ZW1Kc05nTW9kdWxlTG9hZGVyfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7TG9jYXRpb259IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBUY0NvcmVDb21tb25GdW5jdGlvbnMgfSBmcm9tICcuLi8uLi9jb21tb24vdGMtY29yZS1jb21tb24tZnVuY3Rpb25zJztcbmltcG9ydCB7TWVzc2FnZVRvcGljU2VydmljZX0gZnJvbSAnLi4vLi4vY29tbW9uL3RjLWNvcmUtdG9waWMtY29tbSc7XG5cbmRlY2xhcmUgdmFyIEdsb2JhbE5hdmJhcjogYW55O1xuXG5cbi8qKlxuICogVElCQ08gQ2xvdWQgTmF2aWdhdGlvbiBCYXJcbiAqXG4gKiAhW2FsdC10ZXh0XSguLi90aWJjby1jbG91ZC1uYXZiYXIucG5nIFwiSW1hZ2VcIilcbiAqXG4gKiBAZXhhbXBsZSA8dGMtdGliY28tY2xvdWQtbmF2YmFyIGFwcE5hbWU9XCJcIj48L3RjLXRpYmNvLWNsb3VkLW5hdmJhcj5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGMtdGliY28tY2xvdWQtbmF2YmFyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RpYmNvLWNsb3VkLW5hdmJhci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3RpYmNvLWNsb3VkLW5hdmJhci5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgVGliY29DbG91ZE5hdmJhckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIC8qKlxuICAgKiBSZWZlcmVuY2UgRWxlbWVudFxuICAgKi9cbiAgQFZpZXdDaGlsZCgnbmF2YmFyJywgeyBzdGF0aWM6IHRydWUgfSkgcHJpdmF0ZSBuYXZiYXJSZWY6IEVsZW1lbnRSZWY7XG4gIC8qKlxuICAgKiBkaWFwbGF5ZWQgQXBwbGljYXRpb24gTmFtZVxuICAgKi9cbiAgQElucHV0KCkgYXBwTmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogRG9jdW1lbnRhdGlvbiBVUkxcbiAgICovXG4gIEBJbnB1dCgpIGRvY1VybDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBDdXN0b20gTG9nbyBVUkxcbiAgICovXG5cbiAgQElucHV0KCkgbG9nb1VybDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiByZWJyYW5kIGNvbmZpZyAtIGV4YW1wbGU6IHsgXCJiYWNrZ3JvdW5kQ29sb3JcIjogXCIjY2ZjZmNmXCIsIFwiZm9udENvbG9yXCI6IFwiIzY4Mjc4MlwiLCBcImZvbnRGYW1pbHlcIjogXCJPc3dhbGRcIiwgXCJpY29uQ29sb3JcIjogXCJyZWRcIiB9XG4gICAqL1xuXG4gIEBJbnB1dCgpIHJlYnJhbmRDb25maWc6IGFueTtcblxuICAvKipcbiAgICogV2hlcmUgdG8gcmVkaXJlY3Qgb24gY2xpY2sgb2YgbG9nb1xuICAgKi9cblxuICBASW5wdXQoKSBsb2dvQ2xpY2tUYXJnZXRVcmw6IHN0cmluZztcblxuXG4gIHByaXZhdGUgbmF2YmFyO1xuXG4gIHByaXZhdGUgbXM6IE1lc3NhZ2VUb3BpY1NlcnZpY2U7XG5cbiAgLyoqXG4gICAqIHNpbmdsZSBlbXB0eSBDb25zdHJ1Y3RvciBvZiBUSUJDTyBDbG91ZCBOYXZpZ2F0aW9uIEJhclxuICAgKi9cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxvY2F0aW9uOiBMb2NhdGlvbiwgcHJpdmF0ZSBtZXNzYWdlU2VydmljZTogTWVzc2FnZVRvcGljU2VydmljZSkge1xuICAgIHRoaXMubXMgPSBtZXNzYWdlU2VydmljZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBuZ09uSW5pdCgpIHtcblxuICAgIGlmICh0aGlzLmRvY1VybCAmJiAodGhpcy5kb2NVcmwuc2xpY2UoMCwgNCkudG9Mb3dlckNhc2UoKSAhPT0gJ2h0dHAnKSkge1xuLy8gICAgICB0aGlzLmRvY1VybCA9IHRoaXMubG9jYXRpb24ucHJlcGFyZUV4dGVybmFsVXJsKHRoaXMuZG9jVXJsKTsgICAgICAgIC8vIFRoaXMgd2lsbCB3b3JrIHdpdGggbm9uIGhhc2ggcm91dGluZ1xuICAgICAgdGhpcy5kb2NVcmwgPSBUY0NvcmVDb21tb25GdW5jdGlvbnMucHJlcGFyZVVybEZvclN0YXRpY1Jlc291cmNlKHRoaXMubG9jYXRpb24sIHRoaXMuZG9jVXJsKTsgICAgICAgIC8vIFRoaXMgd2lsbCB3b3JrIHdpdGggaGFzaCByb3V0aW5nXG4gICAgfVxuXG4gICAgdGhpcy5uYXZiYXIgPSBuZXcgR2xvYmFsTmF2YmFyKHtcbiAgICAgIGNvbnRhaW5lcjogJyNuYXZiYXInLFxuICAgICAgdGV4dEFmdGVyTG9nbzogdGhpcy5hcHBOYW1lID8gdGhpcy5hcHBOYW1lIDogdW5kZWZpbmVkLFxuICAgICAgaWNvbk1lbnVzOiB7XG4gICAgICAgIHNlYXJjaDoge1xuICAgICAgICAgIHZpc2libGU6IGZhbHNlICAvLyBmb3IgdmVyc2lvbnMgMC4xLlggdGhlIHByb3BlcnRpZSBpcyBcImRpc2FibGVkXCIgaW5zdGVhZCBvZiBcInZpc2libGVcIi5cbiAgICAgICAgfSxcbiAgICAgICAgZG93bmxvYWQ6IHtcbiAgICAgICAgICB2aXNpYmxlOiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICBoZWxwOiB7XG4gICAgICAgICAgdmlzaWJsZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBub3RpZmljYXRpb25zOiB7XG4gICAgICAgICAgdmlzaWJsZTogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAgcHJvZHVjdHM6IHtcbiAgICAgICAgICB2aXNpYmxlOiBmYWxzZVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgY3VzdG9tUHJvZmlsZVBhbmVsOiB7XG4gICAgICAgIGFjY291bnQ6IHtcbiAgICAgICAgICB2aXNpYmxlOiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICBzdWJzY3JpcHRpb25zOiB7XG4gICAgICAgICAgdmlzaWJsZTogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAgb3JnYW5pemF0aW9uOiB7XG4gICAgICAgICAgdmlzaWJsZTogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAgdGVuYW50czoge1xuICAgICAgICAgIHZpc2libGU6IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBjdXN0b21pemVkQ29tcG9uZW50czogW1xuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ2hlbHAnLFxuICAgICAgICAgIHRlbXBsYXRlOiAnI2hlbHAtdGVtcGxhdGUnXG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9KTtcbiAgICBpZiAodGhpcy5sb2dvVXJsIHx8IHRoaXMubG9nb0NsaWNrVGFyZ2V0VXJsIHx8IHRoaXMucmVicmFuZENvbmZpZykge1xuICAgICAgY29uc3Qgc3R5bGU6IGFueSA9IHt9O1xuICAgICAgaWYgKHRoaXMubG9nb1VybCB8fCB0aGlzLmxvZ29DbGlja1RhcmdldFVybCkge1xuICAgICAgICBzdHlsZS5sb2dvID0ge1xuICAgICAgICAgICdzcmMnOiB0aGlzLmxvZ29VcmwsXG4gICAgICAgICAgJ3VybCc6IHRoaXMubG9nb0NsaWNrVGFyZ2V0VXJsIC8vIElmIHRoZSB1cmwgaXMgbm90IHNldCB0aGVuIHRoZSBsb2dvIHdpbGwgcmVkaXJlY3QgdG8gVFNDLlxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMucmVicmFuZENvbmZpZykge1xuICAgICAgICBpZiAodGhpcy5yZWJyYW5kQ29uZmlnLmJhY2tncm91bmRDb2xvcikge1xuICAgICAgICAgIHN0eWxlLmJhY2tncm91bmRDb2xvciA9IHRoaXMucmVicmFuZENvbmZpZy5iYWNrZ3JvdW5kQ29sb3I7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucmVicmFuZENvbmZpZy5mb250Q29sb3IpIHtcbiAgICAgICAgICBzdHlsZS5mb250Q29sb3IgPSB0aGlzLnJlYnJhbmRDb25maWcuZm9udENvbG9yO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnJlYnJhbmRDb25maWcuZm9udEZhbWlseSkge1xuICAgICAgICAgIHN0eWxlLmZvbnRGYW1pbHkgPSB0aGlzLnJlYnJhbmRDb25maWcuZm9udEZhbWlseTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5yZWJyYW5kQ29uZmlnLmljb25Db2xvcikge1xuICAgICAgICAgIHN0eWxlLmljb25Db2xvciA9IHRoaXMucmVicmFuZENvbmZpZy5pY29uQ29sb3I7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMubmF2YmFyLnJlZnJlc2hSZWJyYW5kaW5nU3R5bGUoc3R5bGUpO1xuICAgIH1cbiAgICB0aGlzLm5hdmJhci5sb2FkKCk7XG4gICAgLy8gY29uc29sZS5sb2coJ0RPQyBVUkw6ICcgKyB0aGlzLmRvY1VybCk7XG4gICAgY29uc3QgaW5pdGlhbEhlbHBVUkwgPSB0aGlzLmRvY1VybCArICcvaGVscC5odG1sJztcblxuICAgIHRoaXMudXJsRXhpc3RzKGluaXRpYWxIZWxwVVJMLCBleGlzdHMgPT4ge1xuICAgICAgaWYgKGV4aXN0cykge1xuICAgICAgICB0aGlzLm5hdmJhci5jdXN0b21pemVQYW5lbCgnaGVscCcsICc8ZW1iZWQgc3JjPVwiJyArIGluaXRpYWxIZWxwVVJMICsgJ1wiIHN0eWxlPVwiaGVpZ2h0OiAxMDAlOyB3aWR0aDogMTAwJVwiPicpOyAgLy8gc2V0IEhUTUwgc3RyaW5nXG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubmF2YmFyLmN1c3RvbWl6ZVBhbmVsKCdoZWxwJywgJzxiPiBObyBIZWxwIFBhZ2UgRm91bmQ8L2I+Jyk7ICAvLyBzZXQgSFRNTCBzdHJpbmdcblxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5tcy5nZXRNZXNzYWdlKCdoZWxwJykuc3Vic2NyaWJlKGRhdGEgPT4ge1xuICAgICAgLy8gY29uc29sZS5sb2coJ0dvdCBtZXNzYWdlOiAnICsgZGF0YS50ZXh0KTtcbiAgICAgIHRoaXMuZmluZEhlbHBGaWxlKCdhc3NldHMvaGVscC8nICsgZGF0YS50ZXh0ICsgJy9oZWxwLmh0bWwnKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZpbmRIZWxwRmlsZShoZWxwVXJsKSB7XG4gICAgdGhpcy51cmxFeGlzdHMoaGVscFVybCwgZXhpc3RzID0+IHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCdSRVNVTFQ6IHVybD0nICsgaGVscFVybCArICcsIGV4aXN0cz0nICsgZXhpc3RzKTtcbiAgICAgIGlmIChleGlzdHMpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1NldHRpbmcgaGVscCBwYWdlOiAnICsgaGVscFVybCk7XG4gICAgICAgIHRoaXMubmF2YmFyLmN1c3RvbWl6ZVBhbmVsKCdoZWxwJywgJzxlbWJlZCBzcmM9XCInICsgaGVscFVybCArICdcIiBzdHlsZT1cImhlaWdodDogMTAwJTsgd2lkdGg6IDEwMCVcIj4nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChoZWxwVXJsLmluY2x1ZGVzKCcvJykpIHtcbiAgICAgICAgICAvLyBGaW5kIG9uZSBzdGVwIGxvd2VyXG4gICAgICAgICAgLy8gY29uc29sZS5sb2coJ0hlbHBVUkwgYmVmb3JlOiB8JyArIGhlbHBVcmwgKyAnfCcpO1xuICAgICAgICAgIGhlbHBVcmwgPSBoZWxwVXJsLnN1YnN0cmluZygwLCBoZWxwVXJsLmxhc3RJbmRleE9mKCcvaGVscC5odG1sJykpO1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdIZWxwVVJMIG1pZGRsZTogfCcgKyBoZWxwVXJsICsgJ3wnKTtcbiAgICAgICAgICBoZWxwVXJsID0gaGVscFVybC5zdWJzdHJpbmcoMCwgaGVscFVybC5sYXN0SW5kZXhPZignLycpICsgMSk7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coJ0hlbHBVUkwgIGFmdGVyOiB8JyArIGhlbHBVcmwgKyAnfCcpO1xuICAgICAgICAgIHRoaXMuZmluZEhlbHBGaWxlKGhlbHBVcmwgKyAnaGVscC5odG1sJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ05vIHZhbGlkIGhlbHAgZmlsZSBmb3VuZC4uLicpO1xuICAgICAgICAgIHRoaXMubmF2YmFyLmN1c3RvbWl6ZVBhbmVsKCdoZWxwJywgJzxiPiBObyBIZWxwIFBhZ2UgRm91bmQ8L2I+Jyk7ICAvLyBzZXQgSFRNTCBzdHJpbmdcblxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBUaGUgXCJjYWxsYmFja1wiIGFyZ3VtZW50IGlzIGNhbGxlZCB3aXRoIGVpdGhlciB0cnVlIG9yIGZhbHNlXG4vLyBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgXCJ1cmxcIiBleGlzdHMgb3Igbm90LlxuICB1cmxFeGlzdHModXJsLCBjYWxsYmFjaykge1xuICAgIGNvbnN0IGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICBodHRwLm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7XG4gICAgaHR0cC5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGh0dHAucmVhZHlTdGF0ZSA9PT0gNCkge1xuICAgICAgICBpZiAoaHR0cC5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgIGNhbGxiYWNrKHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNhbGxiYWNrKGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgaHR0cC5zZW5kKCk7XG4gIH1cbn1cbiJdfQ==