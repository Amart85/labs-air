/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @ngdoc component
 * @name mockingInterceptor
 *
 * @description
 * This interceptor attempts to use local json files from the assets directory to mock Tibco Cloud API calls
 *
 * Each mock file can contain either a single response or a "mockedResponses" object that contains specific URLs and responses
 *
 * @usage
 *
 *
 *
 */
import { Injectable } from '@angular/core';
import { HttpRequest, HttpResponse, HttpClient } from '@angular/common/http';
import { throwError } from 'rxjs';
import { map, catchError, delay } from 'rxjs/operators';
var MockingInterceptor = /** @class */ (function () {
    function MockingInterceptor(http) {
        this.http = http;
        this.MOCK_BASE_PATH = '/assets/mocks';
        this.sendRequest = (/**
         * @param {?} req
         * @param {?} next
         * @return {?}
         */
        function (req, next) {
            return next.handle(req);
        });
    }
    /**
     * @param {?} url
     * @return {?}
     */
    MockingInterceptor.prototype.readMockJSON = /**
     * @param {?} url
     * @return {?}
     */
    function (url) {
        return this.http.get(url);
    };
    /**
     * @param {?} req
     * @param {?} next
     * @return {?}
     */
    MockingInterceptor.prototype.intercept = /**
     * @param {?} req
     * @param {?} next
     * @return {?}
     */
    function (req, next) {
        var _this = this;
        // save original request
        /** @type {?} */
        var originalReq = req.clone();
        // dont mock anything from assets folder
        /** @type {?} */
        var urlparts = req.url.split('.');
        /** @type {?} */
        var pathparts = urlparts[0].split('/');
        if (pathparts[1] === 'assets') {
            return this.sendRequest(originalReq, next);
        }
        // try and find a mock response
        /** @type {?} */
        var resource = originalReq.url.split('?')[0];
        /** @type {?} */
        var segments = resource.split('/');
        /** @type {?} */
        var seg2 = resource.split('/');
        /** @type {?} */
        var path = this.MOCK_BASE_PATH;
        // ignore the http/url parts if present
        /** @type {?} */
        var responseType = 'json';
        if (segments[0] === 'http:' || segments[0] === 'https:') {
            segments.splice(0, 3);
            // we are getting a webresource (will only work for text based resources like svg)
            if (segments[0] === 'webresource') {
                responseType = 'text';
            }
        }
        else {
            // just remove the blank part
            segments.splice(0, 1);
        }
        segments.splice(0, segments.length).forEach((/**
         * @param {?} seg
         * @return {?}
         */
        function (seg) {
            path = path + '/' + seg;
        }));
        if (responseType !== 'text') {
            path = path + '.json';
        }
        else {
            path = path + '.txt';
        }
        /** @type {?} */
        var options = {};
        if (responseType === 'text') {
            options = { responseType: 'text' };
        }
        /** @type {?} */
        var httpRequest = new HttpRequest((/** @type {?} */ ('GET')), path, options);
        req = Object.assign(req, httpRequest);
        req = req.clone();
        return next.handle(req).pipe(delay(100), map((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            /** @type {?} */
            var d = (/** @type {?} */ (data));
            if (d.status === 200) {
                // return the body of the cached response loaded from file
                console.log(originalReq.url);
                /** @type {?} */
                var mockedResponse = void 0;
                if (data['body']['mockedResponses']) {
                    // multi mocked response file
                    if (data['body']['mockedResponses'][originalReq.url]) {
                        data['body'] = data['body']['mockedResponses'][originalReq.url];
                        d = (/** @type {?} */ (data));
                        mockedResponse = new HttpResponse(d);
                    }
                    else {
                        // no mock for this URL
                        // todo: there is a bug here that this does not trigger the real call
                        throwError('no mock for this url - no response sent');
                    }
                }
                else {
                    // single mocked response file
                    mockedResponse = new HttpResponse(d);
                }
                return mockedResponse;
            }
            else {
                return data;
            }
        })), catchError((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            // no mock file so make real request
            return _this.sendRequest(originalReq, next);
        })));
    };
    MockingInterceptor.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    MockingInterceptor.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    return MockingInterceptor;
}());
export { MockingInterceptor };
if (false) {
    /** @type {?} */
    MockingInterceptor.prototype.MOCK_BASE_PATH;
    /** @type {?} */
    MockingInterceptor.prototype.sendRequest;
    /**
     * @type {?}
     * @private
     */
    MockingInterceptor.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9ja2luZy1pbnRlcmNlcHRvci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0aWJjby10Y3N0ay90Yy1jb3JlLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9pbnRlcmNlcHRvcnMvbW9ja2luZy1pbnRlcmNlcHRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFlQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3pDLE9BQU8sRUFBWSxXQUFXLEVBQUUsWUFBWSxFQUFnQyxVQUFVLEVBQWMsTUFBTSxzQkFBc0IsQ0FBQztBQUNqSSxPQUFPLEVBQW9DLFVBQVUsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUNuRSxPQUFPLEVBQUMsR0FBRyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUV0RDtJQUlFLDRCQUFvQixJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBRnBDLG1CQUFjLEdBQUcsZUFBZSxDQUFDO1FBbUdqQyxnQkFBVzs7Ozs7UUFBRyxVQUNaLEdBQXFCLEVBQ3JCLElBQWlCO1lBQ2pCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMxQixDQUFDLEVBQUE7SUFwR0QsQ0FBQzs7Ozs7SUFFTSx5Q0FBWTs7OztJQUFuQixVQUFvQixHQUFHO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDNUIsQ0FBQzs7Ozs7O0lBRUQsc0NBQVM7Ozs7O0lBQVQsVUFBVSxHQUFxQixFQUFFLElBQWlCO1FBQWxELGlCQXdGQzs7O1lBckZPLFdBQVcsR0FBRyxHQUFHLENBQUMsS0FBSyxFQUFFOzs7WUFHekIsUUFBUSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQzs7WUFDN0IsU0FBUyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMs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QUNMLHVCQUF1Qjt3QkFDdkIscUVBQXFFO3dCQUNyRSxVQUFVLENBQUMseUNBQXlDLENBQUMsQ0FBQztxQkFDdkQ7aUJBQ0Y7cUJBQU07b0JBQ0wsOEJBQThCO29CQUM5QixjQUFjLEdBQUcsSUFBSSxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ3RDO2dCQUNELE9BQU8sY0FBYyxDQUFDO2FBQ3ZCO2lCQUFNO2dCQUNMLE9BQU8sSUFBSSxDQUFDO2FBQ2I7UUFDSCxDQUFDLEVBQ0YsRUFDRCxVQUFVOzs7O1FBQ1IsVUFBQSxLQUFLO1lBQ0gsb0NBQW9DO1lBQ3BDLE9BQU8sS0FBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDN0MsQ0FBQyxFQUNGLENBQ0YsQ0FBQztJQUNKLENBQUM7O2dCQW5HRixVQUFVOzs7O2dCQUppRSxVQUFVOztJQThHdEYseUJBQUM7Q0FBQSxBQTFHRCxJQTBHQztTQXpHWSxrQkFBa0I7OztJQUM3Qiw0Q0FBaUM7O0lBbUdqQyx5Q0FJQzs7Ozs7SUFyR1csa0NBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbmdkb2MgY29tcG9uZW50XG4gKiBAbmFtZSBtb2NraW5nSW50ZXJjZXB0b3JcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFRoaXMgaW50ZXJjZXB0b3IgYXR0ZW1wdHMgdG8gdXNlIGxvY2FsIGpzb24gZmlsZXMgZnJvbSB0aGUgYXNzZXRzIGRpcmVjdG9yeSB0byBtb2NrIFRpYmNvIENsb3VkIEFQSSBjYWxsc1xuICpcbiAqIEVhY2ggbW9jayBmaWxlIGNhbiBjb250YWluIGVpdGhlciBhIHNpbmdsZSByZXNwb25zZSBvciBhIFwibW9ja2VkUmVzcG9uc2VzXCIgb2JqZWN0IHRoYXQgY29udGFpbnMgc3BlY2lmaWMgVVJMcyBhbmQgcmVzcG9uc2VzXG4gKlxuICogQHVzYWdlXG4gKlxuICpcbiAqXG4gKi9cblxuaW1wb3J0IHtJbmplY3RhYmxlfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7SHR0cEV2ZW50LCBIdHRwUmVxdWVzdCwgSHR0cFJlc3BvbnNlLCBIdHRwSW50ZXJjZXB0b3IsIEh0dHBIYW5kbGVyLCBIdHRwQ2xpZW50LCBIdHRwSGVhZGVyc30gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHtPYnNlcnZhYmxlLCBvZiwgb25FcnJvclJlc3VtZU5leHQsIHRocm93RXJyb3J9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHttYXAsIGNhdGNoRXJyb3IsIGRlbGF5fSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBNb2NraW5nSW50ZXJjZXB0b3IgaW1wbGVtZW50cyBIdHRwSW50ZXJjZXB0b3Ige1xuICBNT0NLX0JBU0VfUEFUSCA9ICcvYXNzZXRzL21vY2tzJztcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHtcbiAgfVxuXG4gIHB1YmxpYyByZWFkTW9ja0pTT04odXJsKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpO1xuICB9XG5cbiAgaW50ZXJjZXB0KHJlcTogSHR0cFJlcXVlc3Q8YW55PiwgbmV4dDogSHR0cEhhbmRsZXIpIHtcblxuICAgIC8vIHNhdmUgb3JpZ2luYWwgcmVxdWVzdFxuICAgIGNvbnN0IG9yaWdpbmFsUmVxID0gcmVxLmNsb25lKCk7XG5cbiAgICAvLyBkb250IG1vY2sgYW55dGhpbmcgZnJvbSBhc3NldHMgZm9sZGVyXG4gICAgY29uc3QgdXJscGFydHMgPSByZXEudXJsLnNwbGl0KCcuJyk7XG4gICAgY29uc3QgcGF0aHBhcnRzID0gdXJscGFydHNbMF0uc3BsaXQoJy8nKTtcblxuICAgIGlmIChwYXRocGFydHNbMV0gPT09ICdhc3NldHMnKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZW5kUmVxdWVzdChvcmlnaW5hbFJlcSwgbmV4dCk7XG4gICAgfVxuXG5cbiAgICAvLyB0cnkgYW5kIGZpbmQgYSBtb2NrIHJlc3BvbnNlXG4gICAgY29uc3QgcmVzb3VyY2UgPSBvcmlnaW5hbFJlcS51cmwuc3BsaXQoJz8nKVswXTtcbiAgICBjb25zdCBzZWdtZW50czogc3RyaW5nW10gPSByZXNvdXJjZS5zcGxpdCgnLycpO1xuICAgIGNvbnN0IHNlZzI6IHN0cmluZ1tdID0gcmVzb3VyY2Uuc3BsaXQoJy8nKTtcbiAgICBsZXQgcGF0aCA9IHRoaXMuTU9DS19CQVNFX1BBVEg7XG4gICAgLy8gaWdub3JlIHRoZSBodHRwL3VybCBwYXJ0cyBpZiBwcmVzZW50XG4gICAgbGV0IHJlc3BvbnNlVHlwZSA9ICdqc29uJztcbiAgICBpZiAoc2VnbWVudHNbMF0gPT09ICdodHRwOicgfHwgc2VnbWVudHNbMF0gPT09ICdodHRwczonKSB7XG4gICAgICBzZWdtZW50cy5zcGxpY2UoMCwgMyk7XG4gICAgICAvLyB3ZSBhcmUgZ2V0dGluZyBhIHdlYnJlc291cmNlICh3aWxsIG9ubHkgd29yayBmb3IgdGV4dCBiYXNlZCByZXNvdXJjZXMgbGlrZSBzdmcpXG4gICAgICBpZiAoc2VnbWVudHNbMF0gPT09ICd3ZWJyZXNvdXJjZScpIHtcbiAgICAgICAgcmVzcG9uc2VUeXBlID0gJ3RleHQnO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBqdXN0IHJlbW92ZSB0aGUgYmxhbmsgcGFydFxuICAgICAgc2VnbWVudHMuc3BsaWNlKDAsIDEpO1xuICAgIH1cbiAgICBzZWdtZW50cy5zcGxpY2UoMCwgc2VnbWVudHMubGVuZ3RoKS5mb3JFYWNoKChzZWcpID0+IHtcbiAgICAgIHBhdGggPSBwYXRoICsgJy8nICsgc2VnO1xuICAgIH0pO1xuICAgIGlmIChyZXNwb25zZVR5cGUgIT09ICd0ZXh0Jykge1xuICAgICAgcGF0aCA9IHBhdGggKyAnLmpzb24nO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXRoID0gcGF0aCArICcudHh0JztcbiAgICB9XG5cbiAgICBsZXQgb3B0aW9ucyA9IHt9O1xuICAgIGlmIChyZXNwb25zZVR5cGUgPT09ICd0ZXh0Jykge1xuICAgICAgb3B0aW9ucyA9IHsgcmVzcG9uc2VUeXBlOiAndGV4dCcgfTtcbiAgICB9XG4gICAgY29uc3QgaHR0cFJlcXVlc3QgPSBuZXcgSHR0cFJlcXVlc3QoXG4gICAgICA8YW55PidHRVQnLFxuICAgICAgcGF0aCxcbiAgICAgIG9wdGlvbnNcbiAgICApO1xuICAgIHJlcSA9IE9iamVjdC5hc3NpZ24ocmVxLCBodHRwUmVxdWVzdCk7XG4gICAgcmVxID0gcmVxLmNsb25lKCk7XG4gICAgcmV0dXJuIG5leHQuaGFuZGxlKHJlcSkucGlwZShcbiAgICAgIGRlbGF5KDEwMCksXG4gICAgICBtYXAoXG4gICAgICAgIGRhdGEgPT4ge1xuICAgICAgICAgIGxldCBkID0gPEh0dHBSZXNwb25zZTxhbnk+PiBkYXRhO1xuICAgICAgICAgIGlmIChkLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAvLyByZXR1cm4gdGhlIGJvZHkgb2YgdGhlIGNhY2hlZCByZXNwb25zZSBsb2FkZWQgZnJvbSBmaWxlXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhvcmlnaW5hbFJlcS51cmwpO1xuICAgICAgICAgICAgbGV0IG1vY2tlZFJlc3BvbnNlOiBIdHRwUmVzcG9uc2U8YW55PjtcbiAgICAgICAgICAgIGlmIChkYXRhWydib2R5J11bJ21vY2tlZFJlc3BvbnNlcyddKSB7XG4gICAgICAgICAgICAgIC8vIG11bHRpIG1vY2tlZCByZXNwb25zZSBmaWxlXG4gICAgICAgICAgICAgIGlmIChkYXRhWydib2R5J11bJ21vY2tlZFJlc3BvbnNlcyddW29yaWdpbmFsUmVxLnVybF0pIHtcbiAgICAgICAgICAgICAgICBkYXRhWydib2R5J10gPSBkYXRhWydib2R5J11bJ21vY2tlZFJlc3BvbnNlcyddW29yaWdpbmFsUmVxLnVybF07XG4gICAgICAgICAgICAgICAgZCA9IDxIdHRwUmVzcG9uc2U8YW55Pj4gZGF0YTtcbiAgICAgICAgICAgICAgICBtb2NrZWRSZXNwb25zZSA9IG5ldyBIdHRwUmVzcG9uc2UoZCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gbm8gbW9jayBmb3IgdGhpcyBVUkxcbiAgICAgICAgICAgICAgICAvLyB0b2RvOiB0aGVyZSBpcyBhIGJ1ZyBoZXJlIHRoYXQgdGhpcyBkb2VzIG5vdCB0cmlnZ2VyIHRoZSByZWFsIGNhbGxcbiAgICAgICAgICAgICAgICB0aHJvd0Vycm9yKCdubyBtb2NrIGZvciB0aGlzIHVybCAtIG5vIHJlc3BvbnNlIHNlbnQnKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gc2luZ2xlIG1vY2tlZCByZXNwb25zZSBmaWxlXG4gICAgICAgICAgICAgIG1vY2tlZFJlc3BvbnNlID0gbmV3IEh0dHBSZXNwb25zZShkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBtb2NrZWRSZXNwb25zZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApLFxuICAgICAgY2F0Y2hFcnJvcihcbiAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgIC8vIG5vIG1vY2sgZmlsZSBzbyBtYWtlIHJlYWwgcmVxdWVzdFxuICAgICAgICAgIHJldHVybiB0aGlzLnNlbmRSZXF1ZXN0KG9yaWdpbmFsUmVxLCBuZXh0KTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICk7XG4gIH1cblxuICBzZW5kUmVxdWVzdCA9IChcbiAgICByZXE6IEh0dHBSZXF1ZXN0PGFueT4sXG4gICAgbmV4dDogSHR0cEhhbmRsZXIpOiBPYnNlcnZhYmxlPEh0dHBFdmVudDxhbnk+PiA9PiB7XG4gICAgcmV0dXJuIG5leHQuaGFuZGxlKHJlcSk7XG4gIH1cbn1cbiJdfQ==