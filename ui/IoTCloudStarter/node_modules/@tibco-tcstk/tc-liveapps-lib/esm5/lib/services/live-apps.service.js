/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { HttpHeaders } from '@angular/common/http';
import { HttpClient } from '@angular/common/http';
import { CaseInfo, CaseInfoList, CaseTypesList, CaseTypeStatesList, CaseList, UserInfo, NotesList, Note, ThreadList, NoteThread, NotificationList, CaseSearchResults, CaseTypeStatesListList } from '../models/liveappsdata';
import { SharedStateContent, TcSharedStateService, TcCoreCommonFunctions, Claim, SandboxList } from '@tibco-tcstk/tc-core-lib';
import { Groups } from '../models/tc-groups-data';
import { debounceTime, distinctUntilChanged, map, shareReplay, switchMap, tap } from 'rxjs/operators';
import { Location } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@angular/common";
import * as i3 from "@tibco-tcstk/tc-core-lib";
var LiveAppsService = /** @class */ (function () {
    function LiveAppsService(http, location, sharedStateService) {
        this.http = http;
        this.location = location;
        this.sharedStateService = sharedStateService;
        // these are 'per session' caches. They won't time out unless explicitly cleared or browser is refreshed
        this.claimsCacheMap = new Map();
        this.userInfoCacheMap = new Map();
        this.caseTypesCacheMap = new Map();
        this.iconSVGTextCacheMap = new Map();
    }
    /**
     * @return {?}
     */
    LiveAppsService.prototype.getSandboxes = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var url = '/organisation/v1/sandboxes';
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} sandboxList
         * @return {?}
         */
        function (sandboxList) { return new SandboxList().deserialize(sandboxList); })));
    };
    /**
     * @param {?} sandboxId
     * @param {?} appIds
     * @param {?} top
     * @param {?} useCache
     * @return {?}
     */
    LiveAppsService.prototype.getApplications = /**
     * @param {?} sandboxId
     * @param {?} appIds
     * @param {?} top
     * @param {?} useCache
     * @return {?}
     */
    function (sandboxId, appIds, top, useCache) {
        /** @type {?} */
        var select = 'b';
        /** @type {?} */
        var url = '/case/v1/types?$sandbox=' + sandboxId + '&$select=' + select + '&$top=' + top;
        if (appIds && appIds.length > 0) {
            url = url + '&$filter=applicationId in(' + appIds.toString() + ') and isCase eq TRUE';
        }
        // note: since this is cached it will require a reload to see new apps
        /** @type {?} */
        var headers;
        if (useCache) {
            headers = new HttpHeaders().set('cacheResponse', 'true');
        }
        else {
            headers = new HttpHeaders();
        }
        return this.http.get(url, { headers: headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} casetypes
         * @return {?}
         */
        function (casetypes) {
            if (appIds && appIds.length > 0) {
                // This is to workaround a bug where non case type types are returned when > 1 appId
                /** @type {?} */
                var tmpCaseTypes = new CaseTypesList().deserialize(casetypes);
                /** @type {?} */
                var filteredCaseTypes_1 = new CaseTypesList().deserialize({ casetypes: [] });
                tmpCaseTypes.casetypes.forEach((/**
                 * @param {?} ctype
                 * @return {?}
                 */
                function (ctype) {
                    if (ctype.id === '1') {
                        filteredCaseTypes_1.casetypes.push(ctype);
                    }
                }));
                return filteredCaseTypes_1;
            }
            else {
                return new CaseTypesList().deserialize(casetypes);
            }
        })));
    };
    /**
     * @return {?}
     */
    LiveAppsService.prototype.getClaims = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var url = '/organisation/v1/claims';
        /** @type {?} */
        var headers = new HttpHeaders().set('cacheResponse', 'true');
        return this.http.get(url, { headers: headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} claim
         * @return {?}
         */
        function (claim) { return new Claim().deserialize(claim); })));
    };
    /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} skip
     * @param {?} top
     * @return {?}
     */
    LiveAppsService.prototype.getCases = /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} skip
     * @param {?} top
     * @return {?}
     */
    function (sandboxId, appId, typeId, skip, top) {
        /** @type {?} */
        var url = '/case/v1/cases' + '?$sandbox=' + sandboxId + '&$filter=applicationId eq '
            + appId + ' and typeId eq ' + typeId + '&$skip=' + skip + '&$top=' + top;
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} caseinfos
         * @return {?}
         */
        function (caseinfos) { return new CaseInfoList().deserialize(caseinfos); })));
    };
    /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @return {?}
     */
    LiveAppsService.prototype.getCasesCount = /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @return {?}
     */
    function (sandboxId, appId, typeId) {
        /** @type {?} */
        var url = '/case/v1/cases' + '?$sandbox=' + sandboxId + '&$filter=applicationId eq '
            + appId + ' and typeId eq ' + typeId + '&$count=true';
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} casecount
         * @return {?}
         */
        function (casecount) { return casecount.toString(); })));
    };
    /**
     * @param {?} sandboxId
     * @param {?} caseRef
     * @return {?}
     */
    LiveAppsService.prototype.getCaseByRef = /**
     * @param {?} sandboxId
     * @param {?} caseRef
     * @return {?}
     */
    function (sandboxId, caseRef) {
        /** @type {?} */
        var url = '/case/v1/cases/' + caseRef
            + '?$sandbox=' + sandboxId;
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} caseinfo
         * @return {?}
         */
        function (caseinfo) { return new CaseInfo().deserialize(caseinfo); })));
    };
    /**
     * @param {?} caseRef
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @return {?}
     */
    LiveAppsService.prototype.getCase = /**
     * @param {?} caseRef
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @return {?}
     */
    function (caseRef, sandboxId, appId, typeId) {
        /** @type {?} */
        var url = '/case/v1/cases/' + caseRef + '/' + '?$sandbox=' + sandboxId + '&$filter=applicationId eq '
            + appId + ' and typeId eq ' + typeId + '&$select=uc, m';
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} caseinfo
         * @return {?}
         */
        function (caseinfo) { return new CaseInfo().deserialize(caseinfo); })));
    };
    /**
     * @param {?} terms
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} skip
     * @param {?} top
     * @param {?} stateId
     * @return {?}
     */
    LiveAppsService.prototype.caseSearch = /**
     * @param {?} terms
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} skip
     * @param {?} top
     * @param {?} stateId
     * @return {?}
     */
    function (terms, sandboxId, appId, typeId, skip, top, stateId) {
        var _this = this;
        return terms
            .pipe(debounceTime(500), distinctUntilChanged(), switchMap((/**
         * @param {?} term
         * @return {?}
         */
        function (term) { return _this.caseSearchEntries(term, sandboxId, appId, typeId, false, skip, top, stateId); })));
    };
    /**
     * @param {?} term
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} force
     * @param {?} skip
     * @param {?} top
     * @param {?} stateId
     * @return {?}
     */
    LiveAppsService.prototype.caseSearchEntries = /**
     * @param {?} term
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} force
     * @param {?} skip
     * @param {?} top
     * @param {?} stateId
     * @return {?}
     */
    function (term, sandboxId, appId, typeId, force, skip, top, stateId) {
        /** @type {?} */
        var url = '/case/v1/cases' + '?$sandbox=' + sandboxId + '&$filter=applicationId eq '
            + appId + ' and typeId eq ' + typeId;
        if (stateId) {
            url = url + ' and stateId eq ' + stateId;
        }
        url = url + '&$skip=' + skip + '&$top=' + top
            + '&$select=cr';
        if (term || (!term && !force)) {
            url = url + '&$search=' + term;
        }
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} caseinfos
         * @return {?}
         */
        function (caseinfos) {
            /** @type {?} */
            var caserefs = [];
            /** @type {?} */
            var caseinfolist = new CaseInfoList().deserialize(caseinfos);
            caseinfolist.caseinfos.forEach((/**
             * @param {?} caseinfo
             * @return {?}
             */
            function (caseinfo) {
                caserefs.push(caseinfo.caseReference);
            }));
            return new CaseSearchResults().deserialize({ caserefs: caserefs, searchString: term });
        })));
    };
    /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} top
     * @return {?}
     */
    LiveAppsService.prototype.getCaseTypes = /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} top
     * @return {?}
     */
    function (sandboxId, appId, top) {
        /** @type {?} */
        var select = 'b,s,sa,a';
        /** @type {?} */
        var url = '/case/v1/types?$sandbox=' + sandboxId + '&$select=' + select + '&$top=' + top;
        if (appId != null) {
            url = url + '&$filter=applicationId eq ' + appId;
        }
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} casetypes
         * @return {?}
         */
        function (casetypes) { return new CaseTypesList().deserialize(casetypes); })));
    };
    /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} top
     * @return {?}
     */
    LiveAppsService.prototype.getCaseTypeSchema = /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} top
     * @return {?}
     */
    function (sandboxId, appId, top) {
        // https://eu.liveapps.cloud.tibco.com/case/v1/types?$sandbox=25&&$filter=applicationName eq 'Customer Complaint'&$select=b,js,c,ac
        /** @type {?} */
        var select = 'b,js,c,ac,a';
        /** @type {?} */
        var url = '/case/v1/types?$sandbox=' + sandboxId + '&$select=' + select + '&$top=' + top;
        if (appId != null) {
            url = url + '&$filter=applicationId eq ' + appId;
        }
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} casetypes
         * @return {?}
         */
        function (casetypes) { return new CaseTypesList().deserialize(casetypes); })));
    };
    /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} top
     * @return {?}
     */
    LiveAppsService.prototype.getCaseTypeStates = /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} top
     * @return {?}
     */
    function (sandboxId, appId, top) {
        /** @type {?} */
        var select = 's';
        /** @type {?} */
        var url = '/case/v1/types?$sandbox=' + sandboxId + '&$select=' + select + '&$top=' + top;
        if (appId != null) {
            url = url + '&$filter=applicationId eq ' + appId;
        }
        /** @type {?} */
        var headers = new HttpHeaders().set('cacheResponse', 'true');
        return this.http.get(url, { headers: headers })
            // return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} casetypestates
         * @return {?}
         */
        function (casetypestates) {
            // const x = new CaseTypeStatesList().deserialize(casetypestates[0].states);
            // return x;
            // const x = new CaseTypeStatesList().deserialize(casetypestates[0].states);
            // return x;
            /** @type {?} */
            var casetypelist = new CaseTypeStatesListList().deserialize(casetypestates);
            /** @type {?} */
            var states;
            casetypelist.casetypes.forEach((/**
             * @param {?} casetype
             * @return {?}
             */
            function (casetype) {
                if (casetype.states !== undefined) {
                    states = new CaseTypeStatesList().deserialize(casetype.states);
                }
            }));
            return states;
        })));
    };
    /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} top
     * @return {?}
     */
    LiveAppsService.prototype.getCaseTypeBasicInfo = /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} top
     * @return {?}
     */
    function (sandboxId, appId, typeId, top) {
        /** @type {?} */
        var select = 'b';
        /** @type {?} */
        var url = '/case/v1/types?$sandbox=' + sandboxId + '&$select=' + select + '&$top=' + top;
        if (appId != null) {
            url = url + '&$filter=applicationId eq ' + appId;
        }
        if (!this.caseTypesCacheMap.get(url)) {
            /** @type {?} */
            var cacheEntry$ = this.getCaseTypeBasicInfoCached(url, typeId)
                .pipe(shareReplay(1));
            this.caseTypesCacheMap.set(url, cacheEntry$);
        }
        return this.caseTypesCacheMap.get(url);
    };
    /**
     * @private
     * @param {?} url
     * @param {?} typeId
     * @return {?}
     */
    LiveAppsService.prototype.getCaseTypeBasicInfoCached = /**
     * @private
     * @param {?} url
     * @param {?} typeId
     * @return {?}
     */
    function (url, typeId) {
        /** @type {?} */
        var headers = new HttpHeaders().set('cacheResponse', 'true');
        return this.http.get(url, { headers: headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} casetypes
         * @return {?}
         */
        function (casetypes) {
            /** @type {?} */
            var caseTypesList = new CaseTypesList().deserialize(casetypes);
            /** @type {?} */
            var requestedType;
            caseTypesList.casetypes.forEach((/**
             * @param {?} casetype
             * @return {?}
             */
            function (casetype) {
                if (casetype.id === typeId) {
                    requestedType = casetype;
                }
            }));
            return requestedType;
        })));
    };
    /**
     * @param {?} url
     * @return {?}
     */
    LiveAppsService.prototype.clearFromIconSVGTextCache = /**
     * @param {?} url
     * @return {?}
     */
    function (url) {
        if (this.iconSVGTextCacheMap.get(url)) {
            this.iconSVGTextCacheMap.delete(url);
        }
    };
    /**
     * @param {?} url
     * @return {?}
     */
    LiveAppsService.prototype.getIconSVGText = /**
     * @param {?} url
     * @return {?}
     */
    function (url) {
        // todo: revisit the base href issue
        if (url.substr(0, 2) === '//') {
            url = url.substr(1, url.length - 1);
        }
        if (!this.iconSVGTextCacheMap.get(url)) {
            // const fixedUrl = window.location.protocol + '//' + window.location.host  + url;
            /** @type {?} */
            var cacheEntry$ = this.getIconSVGTextCache(url)
                .pipe(shareReplay(1));
            this.iconSVGTextCacheMap.set(url, cacheEntry$);
        }
        return this.iconSVGTextCacheMap.get(url);
    };
    /**
     * @private
     * @param {?} url
     * @return {?}
     */
    LiveAppsService.prototype.getIconSVGTextCache = /**
     * @private
     * @param {?} url
     * @return {?}
     */
    function (url) {
        /** @type {?} */
        var headers = new HttpHeaders().set('cacheResponse', 'true');
        return this.http.get(url, { responseType: 'text', headers: headers })
            .pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            /** @type {?} */
            var svgContents = val.toString();
            return svgContents;
        })));
    };
    /**
     * @private
     * @param {?} casesContent
     * @param {?} caseRef
     * @param {?} toggle
     * @return {?}
     */
    LiveAppsService.prototype.updateCasesRecord = /**
     * @private
     * @param {?} casesContent
     * @param {?} caseRef
     * @param {?} toggle
     * @return {?}
     */
    function (casesContent, caseRef, toggle) {
        /** @type {?} */
        var sharedStateContent = new SharedStateContent().deserialize(casesContent);
        /** @type {?} */
        var casesRec = JSON.parse(sharedStateContent.json);
        /** @type {?} */
        var existing = false;
        // check if already exists
        if (caseRef === '-1') {
            // clear list
            casesRec.caseRefs.length = 0;
        }
        else {
            if (casesRec.caseRefs.indexOf(caseRef) !== -1) {
                // remove it if it is already in the array
                casesRec.caseRefs.splice(casesRec.caseRefs.indexOf(caseRef), 1);
                existing = true;
            }
            if (!toggle || existing === false) {
                // only add it if we are not in toggle mode (favorites) or if the caseRef didnt already exist in the list
                // now add case to front of array
                casesRec.caseRefs.unshift(caseRef);
                // check if we are > max size
                if (casesRec.maxSize !== -1 && casesRec.caseRefs.length > casesRec.maxSize) {
                    // remove oldest entry
                    casesRec.caseRefs.pop();
                }
            }
        }
        sharedStateContent.json = TcCoreCommonFunctions.escapeString(JSON.stringify(casesRec));
        return sharedStateContent;
    };
    /**
     * @private
     * @param {?} caseRef
     * @param {?} maxSize
     * @return {?}
     */
    LiveAppsService.prototype.newCasesRecord = /**
     * @private
     * @param {?} caseRef
     * @param {?} maxSize
     * @return {?}
     */
    function (caseRef, maxSize) {
        /** @type {?} */
        var casesRec = new CaseList();
        casesRec.maxSize = maxSize;
        if (caseRef === '-1') {
            casesRec.caseRefs = [];
        }
        else {
            casesRec.caseRefs = [caseRef];
        }
        casesRec.uniqueKey = 'caseReference';
        /** @type {?} */
        var sharedStateContent = new SharedStateContent();
        sharedStateContent.json = TcCoreCommonFunctions.escapeString(JSON.stringify(casesRec));
        return sharedStateContent;
    };
    /**
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    LiveAppsService.prototype.getRecentCases = /**
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    function (uiAppId, sandboxId) {
        /** @type {?} */
        var ssName = uiAppId + '.recentcases.tibcolabs.client.context.PRIVATE';
        return this.getSSCasesList(ssName, sandboxId);
    };
    /**
     * @private
     * @param {?} ssName
     * @param {?} sandboxId
     * @return {?}
     */
    LiveAppsService.prototype.getSSCasesList = /**
     * @private
     * @param {?} ssName
     * @param {?} sandboxId
     * @return {?}
     */
    function (ssName, sandboxId) {
        return this.sharedStateService.getSharedState(ssName, 'PRIVATE', false, false)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} sharedStateList
         * @return {?}
         */
        function (sharedStateList) {
            if (sharedStateList.sharedStateEntries.length > 0) {
                return new CaseList().deserialize(JSON.parse(sharedStateList.sharedStateEntries[0].content.json));
            }
            else {
                return new CaseList();
            }
        })));
    };
    /**
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    LiveAppsService.prototype.unsetRecentCase = /**
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    function (caseRef, uiAppId, sandboxId) {
        // NOTE: Use '-1' as caseRef to clear recent cases list
        /** @type {?} */
        var ssName = uiAppId + '.recentcases.tibcolabs.client.context.PRIVATE';
        this.setCasesRecord(ssName, caseRef, uiAppId, sandboxId, 10, true);
    };
    /**
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    LiveAppsService.prototype.setRecentCase = /**
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    function (caseRef, uiAppId, sandboxId) {
        // NOTE: Use '-1' as caseRef to clear recent cases list
        /** @type {?} */
        var ssName = uiAppId + '.recentcases.tibcolabs.client.context.PRIVATE';
        this.setCasesRecord(ssName, caseRef, uiAppId, sandboxId, 10, false);
    };
    /**
     * @private
     * @param {?} ssName
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @param {?} maxSize
     * @param {?} toggle
     * @return {?}
     */
    LiveAppsService.prototype.setCasesRecord = /**
     * @private
     * @param {?} ssName
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @param {?} maxSize
     * @param {?} toggle
     * @return {?}
     */
    function (ssName, caseRef, uiAppId, sandboxId, maxSize, toggle) {
        var _this = this;
        // get cases list from shared state if any
        // update cases data removing oldest if > maxsize
        // set shared state
        /** @type {?} */
        var casesEntry;
        this.sharedStateService.getSharedState(ssName, 'PRIVATE', false, false)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} sharedStateList
         * @return {?}
         */
        function (sharedStateList) {
            casesEntry = sharedStateList.sharedStateEntries[0] || undefined;
            /** @type {?} */
            var content;
            if (casesEntry) {
                content = _this.updateCasesRecord(casesEntry.content, caseRef, toggle);
                casesEntry.content = content;
                sharedStateList.sharedStateEntries[0] = casesEntry;
                _this.sharedStateService.updateSharedState(sharedStateList.sharedStateEntries).subscribe();
            }
            else {
                content = _this.newCasesRecord(caseRef, maxSize);
                _this.sharedStateService.createSharedState(ssName, 'PRIVATE', '', sandboxId, undefined, undefined, undefined, content).subscribe();
            }
            return casesEntry;
        }))).subscribe(null, (/**
         * @param {?} error
         * @return {?}
         */
        function (error) { return console.log('Unable to set recent cases: ' + error); }));
    };
    /**
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    LiveAppsService.prototype.getFavoriteCases = /**
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    function (uiAppId, sandboxId) {
        /** @type {?} */
        var ssName = uiAppId + '.favoritecases.tibcolabs.client.context.PRIVATE';
        return this.sharedStateService.getSharedState(ssName, 'PRIVATE', false, false)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} sharedStateList
         * @return {?}
         */
        function (sharedStateList) {
            if (sharedStateList.sharedStateEntries.length > 0) {
                return new CaseList().deserialize(JSON.parse(sharedStateList.sharedStateEntries[0].content.json));
            }
            else {
                return new CaseList();
            }
        })));
    };
    /**
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    LiveAppsService.prototype.setFavoriteCase = /**
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    function (caseRef, uiAppId, sandboxId) {
        // NOTE: Use '-1' as caseRef to clear recent cases list
        /** @type {?} */
        var ssName = uiAppId + '.favoritecases.tibcolabs.client.context.PRIVATE';
        this.setCasesRecord(ssName, caseRef, uiAppId, sandboxId, -1, true);
    };
    /**
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    LiveAppsService.prototype.isFavoriteCase = /**
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    function (caseRef, uiAppId, sandboxId) {
        /** @type {?} */
        var ssName = uiAppId + '.favoritecases.tibcolabs.client.context.PRIVATE';
        return this.getSSCasesList(ssName, sandboxId)
            .pipe(map((/**
         * @param {?} caselist
         * @return {?}
         */
        function (caselist) {
            return caselist.caseRefs ? (caselist.caseRefs.indexOf(caseRef) !== -1) : false;
        })));
    };
    /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} processId
     * @param {?} caseReference
     * @param {?} data
     * @return {?}
     */
    LiveAppsService.prototype.runProcess = /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} processId
     * @param {?} caseReference
     * @param {?} data
     * @return {?}
     */
    function (sandboxId, appId, processId, caseReference, data) {
        /** @type {?} */
        var url = '/process/v1/processes';
        // convert data to an escaped JSON string
        /** @type {?} */
        var dataJson;
        if (data) {
            dataJson = TcCoreCommonFunctions.escapeString(JSON.stringify(data));
        }
        else {
            dataJson = TcCoreCommonFunctions.escapeString(JSON.stringify({}));
        }
        /** @type {?} */
        var body = {
            'id': processId,
            'sandboxId': sandboxId,
            'applicationId': appId,
            'data': dataJson
        };
        if (caseReference) {
            body['caseReference'] = caseReference;
        }
        /** @type {?} */
        var bodyStr = JSON.stringify(body);
        /** @type {?} */
        var headers = new HttpHeaders()
            .set('Content-Type', 'application/json');
        return this.http.post(url, bodyStr, { headers: headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} response
         * @return {?}
         */
        function (response) { return response; })));
    };
    // Since we call get userinfo a lot - and the data doesn't tend to change - I will cache it for the session
    // Since we call get userinfo a lot - and the data doesn't tend to change - I will cache it for the session
    /**
     * @param {?} userId
     * @return {?}
     */
    LiveAppsService.prototype.getUserInfo = 
    // Since we call get userinfo a lot - and the data doesn't tend to change - I will cache it for the session
    /**
     * @param {?} userId
     * @return {?}
     */
    function (userId) {
        /** @type {?} */
        var url = '/organisation/v1/users/' + userId;
        if (!this.userInfoCacheMap.get(userId)) {
            /** @type {?} */
            var cacheEntry$ = this.getUserCached(url)
                .pipe(shareReplay(1));
            this.userInfoCacheMap.set(userId, cacheEntry$);
        }
        return this.userInfoCacheMap.get(userId);
    };
    /**
     * @private
     * @param {?} url
     * @return {?}
     */
    LiveAppsService.prototype.getUserCached = /**
     * @private
     * @param {?} url
     * @return {?}
     */
    function (url) {
        /** @type {?} */
        var headers = new HttpHeaders().set('cacheResponse', 'true');
        return this.http.get(url, { headers: headers })
            .pipe(map((/**
         * @param {?} userinfo
         * @return {?}
         */
        function (userinfo) { return new UserInfo().deserialize(userinfo); })));
    };
    /* notes service */
    /* notes service */
    /**
     * @param {?} relatedItemType
     * @param {?} itemTypeId
     * @param {?} skip
     * @param {?} top
     * @return {?}
     */
    LiveAppsService.prototype.getThreads = /* notes service */
    /**
     * @param {?} relatedItemType
     * @param {?} itemTypeId
     * @param {?} skip
     * @param {?} top
     * @return {?}
     */
    function (relatedItemType, itemTypeId, skip, top) {
        // https://liveapps.tenant-integration.tcie.pro/collaboration/notes?$relatedItemCollection=CASE_APP_15441&$orderby=createdDate%20ASC
        /** @type {?} */
        var url = '/collaboration/v1/notes?$relatedItemCollection=' + relatedItemType + '_' + itemTypeId
            + '&$orderby=createdDate desc'
            + '&$top=' + top + '&$skip=' + skip;
        return this.http.get(url)
            .pipe(map((/**
         * @param {?} notes
         * @return {?}
         */
        function (notes) {
            /** @type {?} */
            var returnedNotes = new NotesList().deserialize(notes);
            /** @type {?} */
            var threadList = new ThreadList();
            threadList.threads = [];
            // create threads
            returnedNotes.notes.forEach((/**
             * @param {?} note
             * @return {?}
             */
            function (note) {
                if (note.level === 1) {
                    /** @type {?} */
                    var noteThread_1 = new NoteThread(note.thread.id, false, false, false, undefined, [], note);
                    // get other threads for this id
                    returnedNotes.notes.forEach((/**
                     * @param {?} threadNote
                     * @return {?}
                     */
                    function (threadNote) {
                        if (threadNote.level > 1 && threadNote.threadId === note.thread.id) {
                            // add to the thread
                            noteThread_1.thread.push(threadNote);
                        }
                    }));
                    threadList.threads.push(noteThread_1);
                }
            }));
            return threadList;
        })));
    };
    /**
     * @param {?} collectionIds
     * @return {?}
     */
    LiveAppsService.prototype.getNotesForCollections = /**
     * @param {?} collectionIds
     * @return {?}
     */
    function (collectionIds) {
        if (collectionIds) {
            /** @type {?} */
            var url = '/collaboration/v1/notes?$relatedItemCollection=' + collectionIds +
                '&$orderby=createdDate ASC';
            return this.http.get(url)
                .pipe(map((/**
             * @param {?} notes
             * @return {?}
             */
            function (notes) { return new NotesList().deserialize(notes); })));
        }
    };
    /**
     * @return {?}
     */
    LiveAppsService.prototype.deleteAllNotes = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} note
     * @param {?} noteId
     * @return {?}
     */
    LiveAppsService.prototype.updateNote = /**
     * @param {?} note
     * @param {?} noteId
     * @return {?}
     */
    function (note, noteId) {
        /** @type {?} */
        var url = '/collaboration/v1/notes/' + noteId;
        /** @type {?} */
        var body = note;
        /** @type {?} */
        var bodyStr = JSON.stringify(body);
        /** @type {?} */
        var headers = new HttpHeaders()
            .set('Content-Type', 'application/json');
        return this.http.put(url, bodyStr, { headers: headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} result
         * @return {?}
         */
        function (result) { return new Note().deserialize(result); })));
    };
    /**
     * @param {?} relatedItemType
     * @param {?} uiAppSource
     * @param {?} relatedItemId
     * @param {?} notificationLabel
     * @param {?} notificationUrl
     * @param {?} title
     * @param {?} noteText
     * @return {?}
     */
    LiveAppsService.prototype.createNote = /**
     * @param {?} relatedItemType
     * @param {?} uiAppSource
     * @param {?} relatedItemId
     * @param {?} notificationLabel
     * @param {?} notificationUrl
     * @param {?} title
     * @param {?} noteText
     * @return {?}
     */
    function (relatedItemType, uiAppSource, relatedItemId, notificationLabel, notificationUrl, title, noteText) {
        /** @type {?} */
        var url = '/collaboration/v1/notes';
        /** @type {?} */
        var note = new Note().deserialize({
            attributes: [],
            notificationLabel: notificationLabel,
            notificationUrl: notificationUrl,
            text: noteText,
            title: title
        });
        /** @type {?} */
        var body = {
            note: note,
            relatedItemCollection: [
                (relatedItemType + '_' + relatedItemId)
            ],
            relatedItemId: relatedItemId,
            relatedItemType: uiAppSource,
            roles: undefined
        };
        /** @type {?} */
        var bodyStr = JSON.stringify(body);
        /** @type {?} */
        var headers = new HttpHeaders()
            .set('Content-Type', 'application/json');
        return this.http.post(url, bodyStr, { headers: headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} result
         * @return {?}
         */
        function (result) { return Number(result); })));
    };
    /**
     * @param {?} noteId
     * @return {?}
     */
    LiveAppsService.prototype.getNote = /**
     * @param {?} noteId
     * @return {?}
     */
    function (noteId) {
        /** @type {?} */
        var url = '/collaboration/v1/notes/' + noteId;
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} note
         * @return {?}
         */
        function (note) { return new Note().deserialize(note); })));
    };
    /**
     * @param {?} relatedItemType
     * @param {?} relatedItemId
     * @param {?} threadId
     * @return {?}
     */
    LiveAppsService.prototype.getThread = /**
     * @param {?} relatedItemType
     * @param {?} relatedItemId
     * @param {?} threadId
     * @return {?}
     */
    function (relatedItemType, relatedItemId, threadId) {
        /** @type {?} */
        var url = '/collaboration/v1/notes/?$relatedItemType=' + relatedItemType
            + '&relatedItemId=' + relatedItemId
            + '&filter=threadId=' + threadId
            + '&orderby=createdDate ASC';
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} notes
         * @return {?}
         */
        function (notes) { return new NotesList().deserialize(notes); })));
    };
    /**
     * @param {?} originalNote
     * @param {?} reply
     * @param {?} noteId
     * @return {?}
     */
    LiveAppsService.prototype.createReplyNote = /**
     * @param {?} originalNote
     * @param {?} reply
     * @param {?} noteId
     * @return {?}
     */
    function (originalNote, reply, noteId) {
        /** @type {?} */
        var url = '/collaboration/v1/notes/' + noteId;
        /** @type {?} */
        var body = {
            notificationLabel: originalNote.notificationLabel,
            notificationUrl: originalNote.notificationUrl,
            text: reply
        };
        /** @type {?} */
        var bodyStr = JSON.stringify(body);
        /** @type {?} */
        var headers = new HttpHeaders()
            .set('Content-Type', 'application/json');
        return this.http.post(url, bodyStr, { headers: headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} value
         * @return {?}
         */
        function (value) { return Number(value); })));
    };
    /**
     * @param {?} relatedItemType
     * @param {?} relatedTypeId
     * @return {?}
     */
    LiveAppsService.prototype.subscribeToNotes = /**
     * @param {?} relatedItemType
     * @param {?} relatedTypeId
     * @return {?}
     */
    function (relatedItemType, relatedTypeId) {
        /** @type {?} */
        var url = '/collaboration/v1/notifications';
        /** @type {?} */
        var body = {
            topicId: undefined,
            threadId: undefined,
            notifyCollection: {
                collectionName: relatedItemType + '_' + relatedTypeId,
                lifecycledWithType: 'RT_CASE',
                lifecycledWithId: true
            }
        };
        /** @type {?} */
        var bodyStr = JSON.stringify(body);
        /** @type {?} */
        var headers = new HttpHeaders()
            .set('Content-Type', 'application/json');
        return this.http.post(url, bodyStr, { headers: headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })));
    };
    /**
     * @param {?} relatedItemType
     * @param {?} relatedTypeId
     * @param {?} userId
     * @return {?}
     */
    LiveAppsService.prototype.unsubscribeToNotes = /**
     * @param {?} relatedItemType
     * @param {?} relatedTypeId
     * @param {?} userId
     * @return {?}
     */
    function (relatedItemType, relatedTypeId, userId) {
        /** @type {?} */
        var url = '/collaboration/v1/notifications?$filter=collectionName=';
        url = url + '\'' + relatedItemType + '_' + relatedTypeId + '\' and entityId=' + userId;
        return this.http.delete(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })));
    };
    /**
     * @param {?} relatedItemType
     * @param {?} relatedTypeId
     * @param {?} userId
     * @return {?}
     */
    LiveAppsService.prototype.getNotifications = /**
     * @param {?} relatedItemType
     * @param {?} relatedTypeId
     * @param {?} userId
     * @return {?}
     */
    function (relatedItemType, relatedTypeId, userId) {
        /** @type {?} */
        var url = '/collaboration/v1/notifications?$filter=collectionName=\'' + relatedItemType + '_' + relatedTypeId
            + '\' and entityId=' + userId;
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} value
         * @return {?}
         */
        function (value) { return new NotificationList().deserialize(value); })));
    };
    /**
     * @param {?} noteId
     * @return {?}
     */
    LiveAppsService.prototype.deleteNote = /**
     * @param {?} noteId
     * @return {?}
     */
    function (noteId) {
        /** @type {?} */
        var url = '/collaboration/v1/notes/' + noteId;
        return this.http.delete(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })));
    };
    /* end notes service */
    /* end notes service */
    /**
     * @param {?} sandboxId
     * @param {?} top
     * @param {?} useCache
     * @return {?}
     */
    LiveAppsService.prototype.getGroups = /* end notes service */
    /**
     * @param {?} sandboxId
     * @param {?} top
     * @param {?} useCache
     * @return {?}
     */
    function (sandboxId, top, useCache) {
        /** @type {?} */
        var url = '/organisation/v1/groups?$sandbox=' + sandboxId + '&$top=' + top;
        /** @type {?} */
        var headers;
        if (useCache) {
            headers = new HttpHeaders().set('cacheResponse', 'true');
        }
        else {
            headers = new HttpHeaders();
        }
        return this.http.get(url, { headers: headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} groups
         * @return {?}
         */
        function (groups) { return new Groups().deserialize({ groups: groups }); })));
    };
    /**
     * @param {?} sandboxId
     * @param {?} userId
     * @param {?} top
     * @param {?} useCache
     * @return {?}
     */
    LiveAppsService.prototype.getGroupMemberships = /**
     * @param {?} sandboxId
     * @param {?} userId
     * @param {?} top
     * @param {?} useCache
     * @return {?}
     */
    function (sandboxId, userId, top, useCache) {
        /** @type {?} */
        var url = '/organisation/v1/users/' + userId + '/groups' + '?$sandbox=' + sandboxId + '&$top=' + top;
        /** @type {?} */
        var headers;
        if (useCache) {
            headers = new HttpHeaders().set('cacheResponse', 'true');
        }
        else {
            headers = new HttpHeaders();
        }
        return this.http.get(url, { headers: headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} groups
         * @return {?}
         */
        function (groups) { return new Groups().deserialize({ groups: groups }); })));
    };
    LiveAppsService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    LiveAppsService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: Location },
        { type: TcSharedStateService }
    ]; };
    /** @nocollapse */ LiveAppsService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function LiveAppsService_Factory() { return new LiveAppsService(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Location), i0.ɵɵinject(i3.TcSharedStateService)); }, token: LiveAppsService, providedIn: "root" });
    return LiveAppsService;
}());
export { LiveAppsService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    LiveAppsService.prototype.claimsCacheMap;
    /**
     * @type {?}
     * @private
     */
    LiveAppsService.prototype.userInfoCacheMap;
    /**
     * @type {?}
     * @private
     */
    LiveAppsService.prototype.caseTypesCacheMap;
    /**
     * @type {?}
     * @private
     */
    LiveAppsService.prototype.iconSVGTextCacheMap;
    /**
     * @type {?}
     * @private
     */
    LiveAppsService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    LiveAppsService.prototype.location;
    /**
     * @type {?}
     * @private
     */
    LiveAppsService.prototype.sharedStateService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdGliY28tdGNzdGsvdGMtbGl2ZWFwcHMtbGliLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2xpdmUtYXBwcy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFXLE1BQU0sZUFBZSxDQUFDO0FBRXBELE9BQU8sRUFBdUMsV0FBVyxFQUFjLE1BQU0sc0JBQXNCLENBQUM7QUFDcEcsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFDTCxRQUFRLEVBQ1IsWUFBWSxFQUNaLGFBQWEsRUFDYixrQkFBa0IsRUFFbEIsUUFBUSxFQUNSLFFBQVEsRUFFUixTQUFTLEVBQ1QsSUFBSSxFQUNKLFVBQVUsRUFFVixVQUFVLEVBQ1YsZ0JBQWdCLEVBS2hCLGlCQUFpQixFQUNqQixzQkFBc0IsRUFDdkIsTUFBTSx3QkFBd0IsQ0FBQztBQUVoQyxPQUFPLEVBS0wsa0JBQWtCLEVBQ2xCLG9CQUFvQixFQUVwQixxQkFBcUIsRUFFckIsS0FBSyxFQUVMLFdBQVcsRUFDWixNQUFNLDBCQUEwQixDQUFDO0FBQ2xDLE9BQU8sRUFBQyxNQUFNLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUNoRCxPQUFPLEVBRUwsWUFBWSxFQUNaLG9CQUFvQixFQUNwQixHQUFHLEVBR0gsV0FBVyxFQUNYLFNBQVMsRUFHVCxHQUFHLEVBQ0osTUFBTSxnQkFBZ0IsQ0FBQztBQUd4QixPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0saUJBQWlCLENBQUM7Ozs7O0FBRXpDO0lBV0UseUJBQ1UsSUFBZ0IsRUFBVSxRQUFrQixFQUFVLGtCQUF3QztRQUE5RixTQUFJLEdBQUosSUFBSSxDQUFZO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFVLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBc0I7O1FBTmhHLG1CQUFjLEdBQUcsSUFBSSxH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O0lBR3RDLCtCQUF3Qjs7Ozs7SUFBRSxtQ0FBMEI7Ozs7O0lBQUUsNkNBQWdEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTmdNb2R1bGV9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtmb3JrSm9pbiwgT2JzZXJ2YWJsZSwgb2YsIHRocm93RXJyb3J9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgSHR0cENsaWVudE1vZHVsZSwgSHR0cEVycm9yUmVzcG9uc2UsIEh0dHBIZWFkZXJzLCBIdHRwUGFyYW1zIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7XG4gIENhc2VJbmZvLFxuICBDYXNlSW5mb0xpc3QsXG4gIENhc2VUeXBlc0xpc3QsXG4gIENhc2VUeXBlU3RhdGVzTGlzdCxcbiAgQ2FzZUFjdGlvbnNMaXN0LFxuICBDYXNlTGlzdCxcbiAgVXNlckluZm8sXG4gIEFwaVJlc3BvbnNlVGV4dCxcbiAgTm90ZXNMaXN0LFxuICBOb3RlLFxuICBUaHJlYWRMaXN0LFxuICBUaHJlYWQsXG4gIE5vdGVUaHJlYWQsXG4gIE5vdGlmaWNhdGlvbkxpc3QsXG4gIENhc2VUeXBlLFxuICBDYXJkQ29uZmlnLFxuICBJY29uTWFwLFxuICBNZXRhZGF0YSxcbiAgQ2FzZVNlYXJjaFJlc3VsdHMsXG4gIENhc2VUeXBlU3RhdGVzTGlzdExpc3Rcbn0gZnJvbSAnLi4vbW9kZWxzL2xpdmVhcHBzZGF0YSc7XG5pbXBvcnQgeyAgRG9jdW1lbnRMaXN0LCBEb2N1bWVudH0gZnJvbSAnLi4vbW9kZWxzL3RjLWRvY3VtZW50JztcbmltcG9ydCB7XG4gIEFjY2Vzc1Rva2VuLFxuICBBdXRoSW5mbyxcbiAgU2hhcmVkU3RhdGVMaXN0LFxuICBTaGFyZWRTdGF0ZUVudHJ5LFxuICBTaGFyZWRTdGF0ZUNvbnRlbnQsXG4gIFRjU2hhcmVkU3RhdGVTZXJ2aWNlLFxuICBVaUFwcENvbmZpZyxcbiAgVGNDb3JlQ29tbW9uRnVuY3Rpb25zLFxuICBHcm91cCxcbiAgQ2xhaW0sXG4gIFNhbmRib3gsXG4gIFNhbmRib3hMaXN0XG59IGZyb20gJ0B0aWJjby10Y3N0ay90Yy1jb3JlLWxpYic7XG5pbXBvcnQge0dyb3Vwc30gZnJvbSAnLi4vbW9kZWxzL3RjLWdyb3Vwcy1kYXRhJztcbmltcG9ydCB7XG4gIGNhdGNoRXJyb3IsXG4gIGRlYm91bmNlVGltZSxcbiAgZGlzdGluY3RVbnRpbENoYW5nZWQsXG4gIG1hcCxcbiAgbWVyZ2VNYXAsXG4gIHNoYXJlLFxuICBzaGFyZVJlcGxheSxcbiAgc3dpdGNoTWFwLFxuICB0YWtlLFxuICB0YWtlVW50aWwsXG4gIHRhcFxufSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBEZXNlcmlhbGl6YWJsZX0gZnJvbSAnQHRpYmNvLXRjc3RrL3RjLWNvcmUtbGliJztcbmltcG9ydCB7c3BsaXR9IGZyb20gJ3RzLW5vZGUnO1xuaW1wb3J0IHtMb2NhdGlvbn0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5cbmV4cG9ydCBjbGFzcyBMaXZlQXBwc1NlcnZpY2Uge1xuICAvLyB0aGVzZSBhcmUgJ3BlciBzZXNzaW9uJyBjYWNoZXMuIFRoZXkgd29uJ3QgdGltZSBvdXQgdW5sZXNzIGV4cGxpY2l0bHkgY2xlYXJlZCBvciBicm93c2VyIGlzIHJlZnJlc2hlZFxuICBwcml2YXRlIGNsYWltc0NhY2hlTWFwID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHVzZXJJbmZvQ2FjaGVNYXAgPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgY2FzZVR5cGVzQ2FjaGVNYXAgPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgaWNvblNWR1RleHRDYWNoZU1hcCA9IG5ldyBNYXAoKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsIHByaXZhdGUgbG9jYXRpb246IExvY2F0aW9uLCBwcml2YXRlIHNoYXJlZFN0YXRlU2VydmljZTogVGNTaGFyZWRTdGF0ZVNlcnZpY2UpIHsgfVxuXG4gIHB1YmxpYyBnZXRTYW5kYm94ZXMoKTogT2JzZXJ2YWJsZTxTYW5kYm94TGlzdD4ge1xuICAgIGNvbnN0IHVybCA9ICcvb3JnYW5pc2F0aW9uL3YxL3NhbmRib3hlcyc7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAgKCBzYW5kYm94TGlzdCA9PiBuZXcgU2FuZGJveExpc3QoKS5kZXNlcmlhbGl6ZShzYW5kYm94TGlzdCkpKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRBcHBsaWNhdGlvbnMoc2FuZGJveElkOiBudW1iZXIsIGFwcElkczogc3RyaW5nW10sIHRvcDogbnVtYmVyLCB1c2VDYWNoZTogYm9vbGVhbik6IE9ic2VydmFibGU8Q2FzZVR5cGVzTGlzdD4ge1xuICAgIGNvbnN0IHNlbGVjdCA9ICdiJztcbiAgICBsZXQgdXJsID0gJy9jYXNlL3YxL3R5cGVzPyRzYW5kYm94PScgKyBzYW5kYm94SWQgKyAnJiRzZWxlY3Q9JyArIHNlbGVjdCArICcmJHRvcD0nICsgdG9wO1xuXG4gICAgaWYgKGFwcElkcyAmJiBhcHBJZHMubGVuZ3RoID4gMCkge1xuICAgICAgdXJsID0gdXJsICsgJyYkZmlsdGVyPWFwcGxpY2F0aW9uSWQgaW4oJyArIGFwcElkcy50b1N0cmluZygpICsgJykgYW5kIGlzQ2FzZSBlcSBUUlVFJztcbiAgICB9XG4gICAgLy8gbm90ZTogc2luY2UgdGhpcyBpcyBjYWNoZWQgaXQgd2lsbCByZXF1aXJlIGEgcmVsb2FkIHRvIHNlZSBuZXcgYXBwc1xuICAgIGxldCBoZWFkZXJzO1xuICAgIGlmICh1c2VDYWNoZSkge1xuICAgICAgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpLnNldCgnY2FjaGVSZXNwb25zZScsICd0cnVlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGhlYWRlcnMgPSBuZXcgSHR0cEhlYWRlcnMoKTtcbiAgICB9XG5cblxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCwgeyBoZWFkZXJzIH0pXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcChjYXNldHlwZXMgPT4ge1xuICAgICAgICAgIGlmIChhcHBJZHMgJiYgYXBwSWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIC8vIFRoaXMgaXMgdG8gd29ya2Fyb3VuZCBhIGJ1ZyB3aGVyZSBub24gY2FzZSB0eXBlIHR5cGVzIGFyZSByZXR1cm5lZCB3aGVuID4gMSBhcHBJZFxuICAgICAgICAgICAgY29uc3QgdG1wQ2FzZVR5cGVzID0gbmV3IENhc2VUeXBlc0xpc3QoKS5kZXNlcmlhbGl6ZShjYXNldHlwZXMpO1xuICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRDYXNlVHlwZXMgPSBuZXcgQ2FzZVR5cGVzTGlzdCgpLmRlc2VyaWFsaXplKCB7IGNhc2V0eXBlczogW10gfSk7XG5cbiAgICAgICAgICAgIHRtcENhc2VUeXBlcy5jYXNldHlwZXMuZm9yRWFjaChjdHlwZSA9PiB7XG4gICAgICAgICAgICAgIGlmIChjdHlwZS5pZCA9PT0gJzEnKSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWRDYXNlVHlwZXMuY2FzZXR5cGVzLnB1c2goY3R5cGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBmaWx0ZXJlZENhc2VUeXBlcztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBDYXNlVHlwZXNMaXN0KCkuZGVzZXJpYWxpemUoY2FzZXR5cGVzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRDbGFpbXMoKTogT2JzZXJ2YWJsZTxDbGFpbT4ge1xuICAgIGNvbnN0IHVybCA9ICcvb3JnYW5pc2F0aW9uL3YxL2NsYWltcyc7XG4gICAgY29uc3QgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpLnNldCgnY2FjaGVSZXNwb25zZScsICd0cnVlJyk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsLCB7IGhlYWRlcnM6IGhlYWRlcnMgfSApXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcCAoIGNsYWltID0+IG5ldyBDbGFpbSgpLmRlc2VyaWFsaXplKGNsYWltKSkpO1xuICB9XG5cbiAgcHVibGljIGdldENhc2VzKHNhbmRib3hJZDogbnVtYmVyLCBhcHBJZDogc3RyaW5nLCB0eXBlSWQ6IHN0cmluZywgc2tpcDogbnVtYmVyLCB0b3A6IG51bWJlcik6IE9ic2VydmFibGU8Q2FzZUluZm9MaXN0PiB7XG4gICAgY29uc3QgdXJsID0gJy9jYXNlL3YxL2Nhc2VzJyArICc/JHNhbmRib3g9JyArIHNhbmRib3hJZCArICcmJGZpbHRlcj1hcHBsaWNhdGlvbklkIGVxICdcbiAgICAgICsgYXBwSWQgKyAnIGFuZCB0eXBlSWQgZXEgJyArIHR5cGVJZCArICcmJHNraXA9JyArIHNraXAgKyAnJiR0b3A9JyArIHRvcDtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcChjYXNlaW5mb3MgPT4gbmV3IENhc2VJbmZvTGlzdCgpLmRlc2VyaWFsaXplKGNhc2VpbmZvcykpKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRDYXNlc0NvdW50KHNhbmRib3hJZDogbnVtYmVyLCBhcHBJZDogc3RyaW5nLCB0eXBlSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgY29uc3QgdXJsID0gJy9jYXNlL3YxL2Nhc2VzJyArICc/JHNhbmRib3g9JyArIHNhbmRib3hJZCArICcmJGZpbHRlcj1hcHBsaWNhdGlvbklkIGVxICdcbiAgICAgICsgYXBwSWQgKyAnIGFuZCB0eXBlSWQgZXEgJyArIHR5cGVJZCArICcmJGNvdW50PXRydWUnO1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAoY2FzZWNvdW50ID0+IGNhc2Vjb3VudC50b1N0cmluZygpKSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0Q2FzZUJ5UmVmKHNhbmRib3hJZCwgY2FzZVJlZjogc3RyaW5nKTogT2JzZXJ2YWJsZTxDYXNlSW5mbz4ge1xuICAgIGNvbnN0IHVybCA9ICcvY2FzZS92MS9jYXNlcy8nICsgY2FzZVJlZlxuICAgICAgKyAnPyRzYW5kYm94PScgKyBzYW5kYm94SWQ7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAoY2FzZWluZm8gPT4gbmV3IENhc2VJbmZvKCkuZGVzZXJpYWxpemUoY2FzZWluZm8pKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRDYXNlKGNhc2VSZWY6IHN0cmluZywgc2FuZGJveElkOiBudW1iZXIsIGFwcElkOiBzdHJpbmcsIHR5cGVJZDogc3RyaW5nICk6IE9ic2VydmFibGU8Q2FzZUluZm8+IHtcbiAgICBjb25zdCB1cmwgPSAnL2Nhc2UvdjEvY2FzZXMvJyArIGNhc2VSZWYgKyAnLycgKyAnPyRzYW5kYm94PScgKyBzYW5kYm94SWQgKyAnJiRmaWx0ZXI9YXBwbGljYXRpb25JZCBlcSAnXG4gICAgICArIGFwcElkICsgJyBhbmQgdHlwZUlkIGVxICcgKyB0eXBlSWQgKyAnJiRzZWxlY3Q9dWMsIG0nO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgbWFwKGNhc2VpbmZvID0+IG5ldyBDYXNlSW5mbygpLmRlc2VyaWFsaXplKGNhc2VpbmZvKSkpO1xuICB9XG5cbiAgcHVibGljIGNhc2VTZWFyY2godGVybXM6IE9ic2VydmFibGU8c3RyaW5nPiwgc2FuZGJveElkOiBudW1iZXIsIGFwcElkOiBzdHJpbmcsIHR5cGVJZDogc3RyaW5nLCBza2lwOiBudW1iZXIsIHRvcDogbnVtYmVyLCBzdGF0ZUlkOiBudW1iZXIpOiBPYnNlcnZhYmxlPENhc2VTZWFyY2hSZXN1bHRzPiB7XG4gICAgcmV0dXJuIHRlcm1zXG4gICAgICAucGlwZShcbiAgICAgICAgZGVib3VuY2VUaW1lKDUwMCksXG4gICAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXG4gICAgICAgIHN3aXRjaE1hcCh0ZXJtID0+IHRoaXMuY2FzZVNlYXJjaEVudHJpZXModGVybSwgc2FuZGJveElkLCBhcHBJZCwgdHlwZUlkLCBmYWxzZSwgc2tpcCwgdG9wLCBzdGF0ZUlkKSlcbiAgICAgICk7XG4gIH1cblxuICBwdWJsaWMgY2FzZVNlYXJjaEVudHJpZXModGVybTogc3RyaW5nLCBzYW5kYm94SWQ6IG51bWJlciwgYXBwSWQ6IHN0cmluZywgdHlwZUlkOiBzdHJpbmcsIGZvcmNlOiBib29sZWFuLCBza2lwOiBudW1iZXIsIHRvcDogbnVtYmVyLCBzdGF0ZUlkOiBudW1iZXIpOiBPYnNlcnZhYmxlPENhc2VTZWFyY2hSZXN1bHRzPiB7XG4gICAgICBsZXQgdXJsID0gJy9jYXNlL3YxL2Nhc2VzJyArICc/JHNhbmRib3g9JyArIHNhbmRib3hJZCArICcmJGZpbHRlcj1hcHBsaWNhdGlvbklkIGVxICdcbiAgICAgICAgKyBhcHBJZCArICcgYW5kIHR5cGVJZCBlcSAnICsgdHlwZUlkO1xuICAgICAgaWYgKHN0YXRlSWQpIHtcbiAgICAgICAgdXJsID0gdXJsICsgJyBhbmQgc3RhdGVJZCBlcSAnICsgc3RhdGVJZDtcbiAgICAgIH1cbiAgICAgIHVybCA9IHVybCArICcmJHNraXA9JyArIHNraXAgKyAnJiR0b3A9JyArIHRvcFxuICAgICAgICArICcmJHNlbGVjdD1jcic7XG4gICAgICBpZiAodGVybSB8fCAoIXRlcm0gJiYgIWZvcmNlKSkge1xuICAgICAgICB1cmwgPSB1cmwgKyAnJiRzZWFyY2g9JyArIHRlcm07XG4gICAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcChjYXNlaW5mb3MgPT4ge1xuICAgICAgICAgIGNvbnN0IGNhc2VyZWZzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICAgICAgY29uc3QgY2FzZWluZm9saXN0ID0gbmV3IENhc2VJbmZvTGlzdCgpLmRlc2VyaWFsaXplKGNhc2VpbmZvcyk7XG4gICAgICAgICAgICBjYXNlaW5mb2xpc3QuY2FzZWluZm9zLmZvckVhY2goY2FzZWluZm8gPT4ge1xuICAgICAgICAgICAgICBjYXNlcmVmcy5wdXNoKGNhc2VpbmZvLmNhc2VSZWZlcmVuY2UpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ2FzZVNlYXJjaFJlc3VsdHMoKS5kZXNlcmlhbGl6ZSh7IGNhc2VyZWZzOiBjYXNlcmVmcywgc2VhcmNoU3RyaW5nOiB0ZXJtIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRDYXNlVHlwZXMoc2FuZGJveElkOiBudW1iZXIsIGFwcElkOiBzdHJpbmcsIHRvcDogbnVtYmVyKTogT2JzZXJ2YWJsZTxDYXNlVHlwZXNMaXN0PiB7XG4gICAgY29uc3Qgc2VsZWN0ID0gJ2IscyxzYSxhJztcbiAgICBsZXQgdXJsID0gJy9jYXNlL3YxL3R5cGVzPyRzYW5kYm94PScgKyBzYW5kYm94SWQgKyAnJiRzZWxlY3Q9JyArIHNlbGVjdCArICcmJHRvcD0nICsgdG9wO1xuICAgIGlmIChhcHBJZCAhPSBudWxsKSB7XG4gICAgICB1cmwgPSB1cmwgKyAnJiRmaWx0ZXI9YXBwbGljYXRpb25JZCBlcSAnICsgYXBwSWQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAoY2FzZXR5cGVzID0+IG5ldyBDYXNlVHlwZXNMaXN0KCkuZGVzZXJpYWxpemUoY2FzZXR5cGVzKSkpO1xuICB9XG5cbiAgcHVibGljIGdldENhc2VUeXBlU2NoZW1hKHNhbmRib3hJZDogbnVtYmVyLCBhcHBJZDogc3RyaW5nLCB0b3A6IG51bWJlcik6IE9ic2VydmFibGU8Q2FzZVR5cGVzTGlzdD4ge1xuICAgIC8vIGh0dHBzOi8vZXUubGl2ZWFwcHMuY2xvdWQudGliY28uY29tL2Nhc2UvdjEvdHlwZXM/JHNhbmRib3g9MjUmJiRmaWx0ZXI9YXBwbGljYXRpb25OYW1lIGVxICdDdXN0b21lciBDb21wbGFpbnQnJiRzZWxlY3Q9YixqcyxjLGFjXG4gICAgY29uc3Qgc2VsZWN0ID0gJ2IsanMsYyxhYyxhJztcbiAgICBsZXQgdXJsID0gJy9jYXNlL3YxL3R5cGVzPyRzYW5kYm94PScgKyBzYW5kYm94SWQgKyAnJiRzZWxlY3Q9JyArIHNlbGVjdCArICcmJHRvcD0nICsgdG9wO1xuICAgIGlmIChhcHBJZCAhPSBudWxsKSB7XG4gICAgICB1cmwgPSB1cmwgKyAnJiRmaWx0ZXI9YXBwbGljYXRpb25JZCBlcSAnICsgYXBwSWQ7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgbWFwKGNhc2V0eXBlcyA9PiBuZXcgQ2FzZVR5cGVzTGlzdCgpLmRlc2VyaWFsaXplKGNhc2V0eXBlcykpKTtcbiAgfVxuXG4gICAgcHVibGljIGdldENhc2VUeXBlU3RhdGVzKHNhbmRib3hJZDogbnVtYmVyLCBhcHBJZDogc3RyaW5nLCB0b3A6IG51bWJlcik6IE9ic2VydmFibGU8Q2FzZVR5cGVTdGF0ZXNMaXN0PiB7XG4gICAgICAgIGNvbnN0IHNlbGVjdCA9ICdzJztcbiAgICAgICAgbGV0IHVybCA9ICcvY2FzZS92MS90eXBlcz8kc2FuZGJveD0nICsgc2FuZGJveElkICsgJyYkc2VsZWN0PScgKyBzZWxlY3QgICsgJyYkdG9wPScgKyB0b3A7XG4gICAgICAgIGlmIChhcHBJZCAhPSBudWxsKSB7XG4gICAgICAgICAgICB1cmwgPSB1cmwgKyAnJiRmaWx0ZXI9YXBwbGljYXRpb25JZCBlcSAnICsgYXBwSWQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpLnNldCgnY2FjaGVSZXNwb25zZScsICd0cnVlJyk7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCwgeyBoZWFkZXJzOiBoZWFkZXJzIH0gKVxuICAgICAgICAvLyByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgICAgICAgICBtYXAoY2FzZXR5cGVzdGF0ZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgLy8gY29uc3QgeCA9IG5ldyBDYXNlVHlwZVN0YXRlc0xpc3QoKS5kZXNlcmlhbGl6ZShjYXNldHlwZXN0YXRlc1swXS5zdGF0ZXMpO1xuICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIHg7XG5cbiAgICAgICAgICAgICAgICAgIGNvbnN0IGNhc2V0eXBlbGlzdCA9IG5ldyBDYXNlVHlwZVN0YXRlc0xpc3RMaXN0KCkuZGVzZXJpYWxpemUoY2FzZXR5cGVzdGF0ZXMpO1xuICAgICAgICAgICAgICAgICAgbGV0IHN0YXRlczogQ2FzZVR5cGVTdGF0ZXNMaXN0O1xuICAgICAgICAgICAgICAgICAgY2FzZXR5cGVsaXN0LmNhc2V0eXBlcy5mb3JFYWNoKChjYXNldHlwZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2FzZXR5cGUuc3RhdGVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICBzdGF0ZXMgPSBuZXcgQ2FzZVR5cGVTdGF0ZXNMaXN0KCkuZGVzZXJpYWxpemUoY2FzZXR5cGUuc3RhdGVzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGVzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0Q2FzZVR5cGVCYXNpY0luZm8oc2FuZGJveElkOiBudW1iZXIsIGFwcElkOiBzdHJpbmcsIHR5cGVJZDogc3RyaW5nLCB0b3A6IG51bWJlcik6IE9ic2VydmFibGU8Q2FzZVR5cGU+IHtcbiAgICAgICAgY29uc3Qgc2VsZWN0ID0gJ2InO1xuICAgICAgbGV0IHVybCA9ICcvY2FzZS92MS90eXBlcz8kc2FuZGJveD0nICsgc2FuZGJveElkICsgJyYkc2VsZWN0PScgKyBzZWxlY3QgKyAnJiR0b3A9JyArIHRvcDtcbiAgICAgIGlmIChhcHBJZCAhPSBudWxsKSB7XG4gICAgICAgIHVybCA9IHVybCArICcmJGZpbHRlcj1hcHBsaWNhdGlvbklkIGVxICcgKyBhcHBJZDtcbiAgICAgIH1cblxuICAgICAgaWYgKCF0aGlzLmNhc2VUeXBlc0NhY2hlTWFwLmdldCh1cmwpKSB7XG4gICAgICAgIGNvbnN0IGNhY2hlRW50cnkkID0gdGhpcy5nZXRDYXNlVHlwZUJhc2ljSW5mb0NhY2hlZCh1cmwsIHR5cGVJZClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIHNoYXJlUmVwbGF5KDEpXG4gICAgICAgICAgKTtcbiAgICAgICAgdGhpcy5jYXNlVHlwZXNDYWNoZU1hcC5zZXQodXJsLCBjYWNoZUVudHJ5JCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5jYXNlVHlwZXNDYWNoZU1hcC5nZXQodXJsKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldENhc2VUeXBlQmFzaWNJbmZvQ2FjaGVkKHVybCwgdHlwZUlkKSB7XG4gICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCkuc2V0KCdjYWNoZVJlc3BvbnNlJywgJ3RydWUnKTtcbiAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCwgeyBoZWFkZXJzOiBoZWFkZXJzIH0gKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgICBtYXAoY2FzZXR5cGVzID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNhc2VUeXBlc0xpc3Q6IENhc2VUeXBlc0xpc3QgPSBuZXcgQ2FzZVR5cGVzTGlzdCgpLmRlc2VyaWFsaXplKGNhc2V0eXBlcyk7XG4gICAgICAgICAgICBsZXQgcmVxdWVzdGVkVHlwZTogQ2FzZVR5cGU7XG4gICAgICAgICAgICBjYXNlVHlwZXNMaXN0LmNhc2V0eXBlcy5mb3JFYWNoKChjYXNldHlwZSkgPT4ge1xuICAgICAgICAgICAgICBpZiAoY2FzZXR5cGUuaWQgPT09IHR5cGVJZCkge1xuICAgICAgICAgICAgICAgIHJlcXVlc3RlZFR5cGUgPSBjYXNldHlwZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdGVkVHlwZTtcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBjbGVhckZyb21JY29uU1ZHVGV4dENhY2hlKHVybCkge1xuICAgICAgaWYgKHRoaXMuaWNvblNWR1RleHRDYWNoZU1hcC5nZXQodXJsKSkge1xuICAgICAgICB0aGlzLmljb25TVkdUZXh0Q2FjaGVNYXAuZGVsZXRlKHVybCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldEljb25TVkdUZXh0KHVybDogc3RyaW5nKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICAgIC8vIHRvZG86IHJldmlzaXQgdGhlIGJhc2UgaHJlZiBpc3N1ZVxuICAgICAgaWYgKHVybC5zdWJzdHIoMCwgMikgPT09ICcvLycpIHtcbiAgICAgICAgdXJsID0gdXJsLnN1YnN0cigxLCB1cmwubGVuZ3RoIC0gMSk7XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMuaWNvblNWR1RleHRDYWNoZU1hcC5nZXQodXJsKSkge1xuICAgICAgICAvLyBjb25zdCBmaXhlZFVybCA9IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdCAgKyB1cmw7XG4gICAgICAgIGNvbnN0IGNhY2hlRW50cnkkID0gdGhpcy5nZXRJY29uU1ZHVGV4dENhY2hlKHVybClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIHNoYXJlUmVwbGF5KDEpXG4gICAgICAgICAgKTtcbiAgICAgICAgdGhpcy5pY29uU1ZHVGV4dENhY2hlTWFwLnNldCh1cmwsIGNhY2hlRW50cnkkKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmljb25TVkdUZXh0Q2FjaGVNYXAuZ2V0KHVybCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRJY29uU1ZHVGV4dENhY2hlKHVybCkge1xuICAgICAgY29uc3QgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpLnNldCgnY2FjaGVSZXNwb25zZScsICd0cnVlJyk7XG4gICAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwsIHtyZXNwb25zZVR5cGU6ICd0ZXh0JywgaGVhZGVyczogaGVhZGVycyB9IClcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgbWFwKHZhbCA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHN2Z0NvbnRlbnRzID0gdmFsLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgIHJldHVybiBzdmdDb250ZW50cztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxuXG4gIHByaXZhdGUgdXBkYXRlQ2FzZXNSZWNvcmQoY2FzZXNDb250ZW50OiBTaGFyZWRTdGF0ZUNvbnRlbnQsIGNhc2VSZWY6IHN0cmluZywgdG9nZ2xlOiBCb29sZWFuKTogU2hhcmVkU3RhdGVDb250ZW50IHtcbiAgICBjb25zdCBzaGFyZWRTdGF0ZUNvbnRlbnQ6IFNoYXJlZFN0YXRlQ29udGVudCA9IG5ldyBTaGFyZWRTdGF0ZUNvbnRlbnQoKS5kZXNlcmlhbGl6ZShjYXNlc0NvbnRlbnQpO1xuICAgIGNvbnN0IGNhc2VzUmVjOiBDYXNlTGlzdCA9IEpTT04ucGFyc2Uoc2hhcmVkU3RhdGVDb250ZW50Lmpzb24pO1xuICAgIGxldCBleGlzdGluZyA9IGZhbHNlO1xuICAgICAgLy8gY2hlY2sgaWYgYWxyZWFkeSBleGlzdHNcblxuICAgIGlmIChjYXNlUmVmID09PSAnLTEnKSB7XG4gICAgICAvLyBjbGVhciBsaXN0XG4gICAgICAgIGNhc2VzUmVjLmNhc2VSZWZzLmxlbmd0aCA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChjYXNlc1JlYy5jYXNlUmVmcy5pbmRleE9mKGNhc2VSZWYpICE9PSAtMSkge1xuICAgICAgICAvLyByZW1vdmUgaXQgaWYgaXQgaXMgYWxyZWFkeSBpbiB0aGUgYXJyYXlcbiAgICAgICAgY2FzZXNSZWMuY2FzZVJlZnMuc3BsaWNlKGNhc2VzUmVjLmNhc2VSZWZzLmluZGV4T2YoY2FzZVJlZiksIDEpO1xuICAgICAgICBleGlzdGluZyA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoIXRvZ2dsZSB8fCBleGlzdGluZyA9PT0gZmFsc2UpIHtcbiAgICAgICAgLy8gb25seSBhZGQgaXQgaWYgd2UgYXJlIG5vdCBpbiB0b2dnbGUgbW9kZSAoZmF2b3JpdGVzKSBvciBpZiB0aGUgY2FzZVJlZiBkaWRudCBhbHJlYWR5IGV4aXN0IGluIHRoZSBsaXN0XG4gICAgICAgIC8vIG5vdyBhZGQgY2FzZSB0byBmcm9udCBvZiBhcnJheVxuICAgICAgICBjYXNlc1JlYy5jYXNlUmVmcy51bnNoaWZ0KGNhc2VSZWYpO1xuICAgICAgICAvLyBjaGVjayBpZiB3ZSBhcmUgPiBtYXggc2l6ZVxuICAgICAgICBpZiAoY2FzZXNSZWMubWF4U2l6ZSAhPT0gLTEgJiYgY2FzZXNSZWMuY2FzZVJlZnMubGVuZ3RoID4gY2FzZXNSZWMubWF4U2l6ZSkge1xuICAgICAgICAgIC8vIHJlbW92ZSBvbGRlc3QgZW50cnlcbiAgICAgICAgICBjYXNlc1JlYy5jYXNlUmVmcy5wb3AoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBzaGFyZWRTdGF0ZUNvbnRlbnQuanNvbiA9IFRjQ29yZUNvbW1vbkZ1bmN0aW9ucy5lc2NhcGVTdHJpbmcoSlNPTi5zdHJpbmdpZnkoY2FzZXNSZWMpKTtcbiAgICByZXR1cm4gc2hhcmVkU3RhdGVDb250ZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBuZXdDYXNlc1JlY29yZChjYXNlUmVmOiBzdHJpbmcsIG1heFNpemU6IG51bWJlcik6IFNoYXJlZFN0YXRlQ29udGVudCB7XG4gICAgY29uc3QgY2FzZXNSZWM6IENhc2VMaXN0ID0gbmV3IENhc2VMaXN0KCk7XG4gICAgY2FzZXNSZWMubWF4U2l6ZSA9IG1heFNpemU7XG4gICAgaWYgKGNhc2VSZWYgPT09ICctMScpIHtcbiAgICAgIGNhc2VzUmVjLmNhc2VSZWZzID0gWyBdO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYXNlc1JlYy5jYXNlUmVmcyA9IFtjYXNlUmVmXTtcbiAgICB9XG4gICAgY2FzZXNSZWMudW5pcXVlS2V5ID0gJ2Nhc2VSZWZlcmVuY2UnO1xuICAgIGNvbnN0IHNoYXJlZFN0YXRlQ29udGVudDogU2hhcmVkU3RhdGVDb250ZW50ID0gbmV3IFNoYXJlZFN0YXRlQ29udGVudCgpO1xuICAgIHNoYXJlZFN0YXRlQ29udGVudC5qc29uID0gVGNDb3JlQ29tbW9uRnVuY3Rpb25zLmVzY2FwZVN0cmluZyhKU09OLnN0cmluZ2lmeShjYXNlc1JlYykpO1xuICAgIHJldHVybiBzaGFyZWRTdGF0ZUNvbnRlbnQ7XG4gIH1cblxuICBwdWJsaWMgZ2V0UmVjZW50Q2FzZXModWlBcHBJZDogc3RyaW5nLCBzYW5kYm94SWQ6IG51bWJlcik6IE9ic2VydmFibGU8Q2FzZUxpc3Q+IHtcbiAgICBjb25zdCBzc05hbWUgPSB1aUFwcElkICsgJy5yZWNlbnRjYXNlcy50aWJjb2xhYnMuY2xpZW50LmNvbnRleHQuUFJJVkFURSc7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U1NDYXNlc0xpc3Qoc3NOYW1lLCBzYW5kYm94SWQpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTU0Nhc2VzTGlzdChzc05hbWU6IHN0cmluZywgc2FuZGJveElkOiBudW1iZXIpOiBPYnNlcnZhYmxlPENhc2VMaXN0PiB7XG4gICAgcmV0dXJuIHRoaXMuc2hhcmVkU3RhdGVTZXJ2aWNlLmdldFNoYXJlZFN0YXRlKHNzTmFtZSwgJ1BSSVZBVEUnLCBmYWxzZSwgZmFsc2UpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcChzaGFyZWRTdGF0ZUxpc3QgPT4ge1xuICAgICAgICAgIGlmIChzaGFyZWRTdGF0ZUxpc3Quc2hhcmVkU3RhdGVFbnRyaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ2FzZUxpc3QoKS5kZXNlcmlhbGl6ZShKU09OLnBhcnNlKHNoYXJlZFN0YXRlTGlzdC5zaGFyZWRTdGF0ZUVudHJpZXNbMF0uY29udGVudC5qc29uKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ2FzZUxpc3QoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyB1bnNldFJlY2VudENhc2UoY2FzZVJlZjogc3RyaW5nLCB1aUFwcElkOiBzdHJpbmcsIHNhbmRib3hJZDogbnVtYmVyKSB7XG4gICAgLy8gTk9URTogVXNlICctMScgYXMgY2FzZVJlZiB0byBjbGVhciByZWNlbnQgY2FzZXMgbGlzdFxuICAgIGNvbnN0IHNzTmFtZSA9IHVpQXBwSWQgKyAnLnJlY2VudGNhc2VzLnRpYmNvbGFicy5jbGllbnQuY29udGV4dC5QUklWQVRFJztcbiAgICB0aGlzLnNldENhc2VzUmVjb3JkKHNzTmFtZSwgY2FzZVJlZiwgdWlBcHBJZCwgc2FuZGJveElkLCAxMCwgdHJ1ZSk7XG4gIH1cblxuICBwdWJsaWMgc2V0UmVjZW50Q2FzZShjYXNlUmVmOiBzdHJpbmcsIHVpQXBwSWQ6IHN0cmluZywgc2FuZGJveElkOiBudW1iZXIpIHtcbiAgICAvLyBOT1RFOiBVc2UgJy0xJyBhcyBjYXNlUmVmIHRvIGNsZWFyIHJlY2VudCBjYXNlcyBsaXN0XG4gICAgY29uc3Qgc3NOYW1lID0gdWlBcHBJZCArICcucmVjZW50Y2FzZXMudGliY29sYWJzLmNsaWVudC5jb250ZXh0LlBSSVZBVEUnO1xuICAgIHRoaXMuc2V0Q2FzZXNSZWNvcmQoc3NOYW1lLCBjYXNlUmVmLCB1aUFwcElkLCBzYW5kYm94SWQsIDEwLCBmYWxzZSk7XG4gIH1cblxuICBwcml2YXRlIHNldENhc2VzUmVjb3JkKHNzTmFtZTogc3RyaW5nLCBjYXNlUmVmOiBzdHJpbmcsIHVpQXBwSWQ6IHN0cmluZywgc2FuZGJveElkOiBudW1iZXIsIG1heFNpemU6IG51bWJlciwgdG9nZ2xlOiBib29sZWFuKSB7XG4gICAgLy8gZ2V0IGNhc2VzIGxpc3QgZnJvbSBzaGFyZWQgc3RhdGUgaWYgYW55XG4gICAgLy8gdXBkYXRlIGNhc2VzIGRhdGEgcmVtb3Zpbmcgb2xkZXN0IGlmID4gbWF4c2l6ZVxuICAgIC8vIHNldCBzaGFyZWQgc3RhdGVcbiAgICBsZXQgY2FzZXNFbnRyeTogU2hhcmVkU3RhdGVFbnRyeTtcbiAgICB0aGlzLnNoYXJlZFN0YXRlU2VydmljZS5nZXRTaGFyZWRTdGF0ZShzc05hbWUsICdQUklWQVRFJywgZmFsc2UsIGZhbHNlKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAoc2hhcmVkU3RhdGVMaXN0ID0+IHtcbiAgICAgICAgICAgIGNhc2VzRW50cnkgPSBzaGFyZWRTdGF0ZUxpc3Quc2hhcmVkU3RhdGVFbnRyaWVzWzBdIHx8IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGxldCBjb250ZW50OiBTaGFyZWRTdGF0ZUNvbnRlbnQ7XG4gICAgICAgICAgICBpZiAoY2FzZXNFbnRyeSkge1xuICAgICAgICAgICAgICBjb250ZW50ID0gdGhpcy51cGRhdGVDYXNlc1JlY29yZChjYXNlc0VudHJ5LmNvbnRlbnQsIGNhc2VSZWYsIHRvZ2dsZSk7XG4gICAgICAgICAgICAgIGNhc2VzRW50cnkuY29udGVudCA9IGNvbnRlbnQ7XG4gICAgICAgICAgICAgIHNoYXJlZFN0YXRlTGlzdC5zaGFyZWRTdGF0ZUVudHJpZXNbMF0gPSBjYXNlc0VudHJ5O1xuICAgICAgICAgICAgICB0aGlzLnNoYXJlZFN0YXRlU2VydmljZS51cGRhdGVTaGFyZWRTdGF0ZShzaGFyZWRTdGF0ZUxpc3Quc2hhcmVkU3RhdGVFbnRyaWVzKS5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnRlbnQgPSB0aGlzLm5ld0Nhc2VzUmVjb3JkKGNhc2VSZWYsIG1heFNpemUpO1xuICAgICAgICAgICAgICB0aGlzLnNoYXJlZFN0YXRlU2VydmljZS5jcmVhdGVTaGFyZWRTdGF0ZShzc05hbWUsICdQUklWQVRFJywgJycsIHNhbmRib3hJZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgY29udGVudCkuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjYXNlc0VudHJ5O1xuICAgICAgICAgIH1cblxuICAgICAgICApXG4gICAgICApLnN1YnNjcmliZShudWxsLCBlcnJvciA9PiBjb25zb2xlLmxvZygnVW5hYmxlIHRvIHNldCByZWNlbnQgY2FzZXM6ICcgKyBlcnJvcikpO1xuICB9XG5cbiAgcHVibGljIGdldEZhdm9yaXRlQ2FzZXModWlBcHBJZDogc3RyaW5nLCBzYW5kYm94SWQ6IG51bWJlcik6IE9ic2VydmFibGU8Q2FzZUxpc3Q+IHtcbiAgICBjb25zdCBzc05hbWUgPSB1aUFwcElkICsgJy5mYXZvcml0ZWNhc2VzLnRpYmNvbGFicy5jbGllbnQuY29udGV4dC5QUklWQVRFJztcbiAgICByZXR1cm4gdGhpcy5zaGFyZWRTdGF0ZVNlcnZpY2UuZ2V0U2hhcmVkU3RhdGUoc3NOYW1lLCAnUFJJVkFURScsIGZhbHNlLCBmYWxzZSlcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgbWFwKHNoYXJlZFN0YXRlTGlzdCA9PiB7XG4gICAgICAgICAgaWYgKHNoYXJlZFN0YXRlTGlzdC5zaGFyZWRTdGF0ZUVudHJpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBDYXNlTGlzdCgpLmRlc2VyaWFsaXplKEpTT04ucGFyc2Uoc2hhcmVkU3RhdGVMaXN0LnNoYXJlZFN0YXRlRW50cmllc1swXS5jb250ZW50Lmpzb24pKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBDYXNlTGlzdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICApXG4gICAgICApO1xuICB9XG5cbiAgcHVibGljIHNldEZhdm9yaXRlQ2FzZShjYXNlUmVmOiBzdHJpbmcsIHVpQXBwSWQ6IHN0cmluZywgc2FuZGJveElkOiBudW1iZXIpIHtcbiAgICAvLyBOT1RFOiBVc2UgJy0xJyBhcyBjYXNlUmVmIHRvIGNsZWFyIHJlY2VudCBjYXNlcyBsaXN0XG4gICAgY29uc3Qgc3NOYW1lID0gdWlBcHBJZCArICcuZmF2b3JpdGVjYXNlcy50aWJjb2xhYnMuY2xpZW50LmNvbnRleHQuUFJJVkFURSc7XG4gICAgdGhpcy5zZXRDYXNlc1JlY29yZChzc05hbWUsIGNhc2VSZWYsIHVpQXBwSWQsIHNhbmRib3hJZCwgLTEsIHRydWUpO1xuICB9XG5cbiAgcHVibGljIGlzRmF2b3JpdGVDYXNlKGNhc2VSZWY6IHN0cmluZywgdWlBcHBJZDogc3RyaW5nLCBzYW5kYm94SWQ6IG51bWJlcik6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHNzTmFtZSA9IHVpQXBwSWQgKyAnLmZhdm9yaXRlY2FzZXMudGliY29sYWJzLmNsaWVudC5jb250ZXh0LlBSSVZBVEUnO1xuICAgIHJldHVybiB0aGlzLmdldFNTQ2FzZXNMaXN0KHNzTmFtZSwgc2FuZGJveElkKVxuICAgICAgLnBpcGUoXG4gICAgICAgIG1hcChjYXNlbGlzdCA9PiB7XG4gICAgICAgICAgcmV0dXJuIGNhc2VsaXN0LmNhc2VSZWZzID8gKGNhc2VsaXN0LmNhc2VSZWZzLmluZGV4T2YoY2FzZVJlZikgIT09IC0xKSA6IGZhbHNlO1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBydW5Qcm9jZXNzKHNhbmRib3hJZDogbnVtYmVyLCBhcHBJZDogc3RyaW5nLCBwcm9jZXNzSWQ6IHN0cmluZywgY2FzZVJlZmVyZW5jZTogc3RyaW5nLCBkYXRhOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGNvbnN0IHVybCA9ICcvcHJvY2Vzcy92MS9wcm9jZXNzZXMnO1xuICAgIC8vIGNvbnZlcnQgZGF0YSB0byBhbiBlc2NhcGVkIEpTT04gc3RyaW5nXG4gICAgbGV0IGRhdGFKc29uO1xuICAgIGlmIChkYXRhKSB7XG4gICAgICBkYXRhSnNvbiA9IFRjQ29yZUNvbW1vbkZ1bmN0aW9ucy5lc2NhcGVTdHJpbmcoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkYXRhSnNvbiA9IFRjQ29yZUNvbW1vbkZ1bmN0aW9ucy5lc2NhcGVTdHJpbmcoSlNPTi5zdHJpbmdpZnkoe30pKTtcbiAgICB9XG4gICAgY29uc3QgYm9keSA9IHtcbiAgICAgICdpZCc6IHByb2Nlc3NJZCxcbiAgICAgICdzYW5kYm94SWQnOiBzYW5kYm94SWQsXG4gICAgICAnYXBwbGljYXRpb25JZCc6IGFwcElkLFxuICAgICAgJ2RhdGEnOiBkYXRhSnNvblxuICAgIH07XG5cbiAgICBpZiAoY2FzZVJlZmVyZW5jZSkge1xuICAgICAgYm9keVsnY2FzZVJlZmVyZW5jZSddID0gY2FzZVJlZmVyZW5jZTtcbiAgICB9XG5cblxuICAgIGNvbnN0IGJvZHlTdHIgPSBKU09OLnN0cmluZ2lmeShib2R5KTtcbiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKClcbiAgICAgIC5zZXQoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KHVybCwgYm9keVN0ciwgeyBoZWFkZXJzIH0pXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcChyZXNwb25zZSA9PiByZXNwb25zZSlcbiAgICAgICk7XG4gIH1cblxuICAvLyBTaW5jZSB3ZSBjYWxsIGdldCB1c2VyaW5mbyBhIGxvdCAtIGFuZCB0aGUgZGF0YSBkb2Vzbid0IHRlbmQgdG8gY2hhbmdlIC0gSSB3aWxsIGNhY2hlIGl0IGZvciB0aGUgc2Vzc2lvblxuICBwdWJsaWMgZ2V0VXNlckluZm8odXNlcklkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFVzZXJJbmZvPiB7XG4gICAgY29uc3QgdXJsID0gICcvb3JnYW5pc2F0aW9uL3YxL3VzZXJzLycgKyB1c2VySWQ7XG4gICAgaWYgKCF0aGlzLnVzZXJJbmZvQ2FjaGVNYXAuZ2V0KHVzZXJJZCkpIHtcbiAgICAgIGNvbnN0IGNhY2hlRW50cnkkID0gdGhpcy5nZXRVc2VyQ2FjaGVkKHVybClcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgc2hhcmVSZXBsYXkoMSlcbiAgICAgICAgKTtcbiAgICAgIHRoaXMudXNlckluZm9DYWNoZU1hcC5zZXQodXNlcklkLCBjYWNoZUVudHJ5JCk7XG4gICAgfVxuICAgICAgcmV0dXJuIHRoaXMudXNlckluZm9DYWNoZU1hcC5nZXQodXNlcklkKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VXNlckNhY2hlZCh1cmwpIHtcbiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCkuc2V0KCdjYWNoZVJlc3BvbnNlJywgJ3RydWUnKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwsIHsgaGVhZGVyczogaGVhZGVycyB9IClcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAodXNlcmluZm8gPT4gbmV3IFVzZXJJbmZvKCkuZGVzZXJpYWxpemUodXNlcmluZm8pKVxuICAgICAgKTtcbiAgfVxuXG4gIC8qIG5vdGVzIHNlcnZpY2UgKi9cblxuICBwdWJsaWMgZ2V0VGhyZWFkcyhyZWxhdGVkSXRlbVR5cGU6IHN0cmluZywgaXRlbVR5cGVJZDogc3RyaW5nLCBza2lwOiBudW1iZXIsIHRvcDogbnVtYmVyKTogT2JzZXJ2YWJsZTxUaHJlYWRMaXN0PiB7XG4gICAgLy8gaHR0cHM6Ly9saXZlYXBwcy50ZW5hbnQtaW50ZWdyYXRpb24udGNpZS5wcm8vY29sbGFib3JhdGlvbi9ub3Rlcz8kcmVsYXRlZEl0ZW1Db2xsZWN0aW9uPUNBU0VfQVBQXzE1NDQxJiRvcmRlcmJ5PWNyZWF0ZWREYXRlJTIwQVNDXG4gICAgY29uc3QgdXJsID0gICcvY29sbGFib3JhdGlvbi92MS9ub3Rlcz8kcmVsYXRlZEl0ZW1Db2xsZWN0aW9uPScgKyByZWxhdGVkSXRlbVR5cGUgKyAnXycgKyBpdGVtVHlwZUlkXG4gICAgICArICcmJG9yZGVyYnk9Y3JlYXRlZERhdGUgZGVzYydcbiAgICAgICsgJyYkdG9wPScgKyB0b3AgKyAnJiRza2lwPScgKyBza2lwO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybClcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAobm90ZXMgPT4ge1xuICAgICAgICAgIGNvbnN0IHJldHVybmVkTm90ZXMgPSBuZXcgTm90ZXNMaXN0KCkuZGVzZXJpYWxpemUobm90ZXMpO1xuICAgICAgICAgIGNvbnN0IHRocmVhZExpc3Q6IFRocmVhZExpc3QgPSBuZXcgVGhyZWFkTGlzdCgpO1xuICAgICAgICAgIHRocmVhZExpc3QudGhyZWFkcyA9IFtdO1xuICAgICAgICAgIC8vIGNyZWF0ZSB0aHJlYWRzXG4gICAgICAgICAgcmV0dXJuZWROb3Rlcy5ub3Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vdGUpIHtcbiAgICAgICAgICAgICAgaWYgKG5vdGUubGV2ZWwgPT09IDEpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBub3RlVGhyZWFkID0gbmV3IE5vdGVUaHJlYWQobm90ZS50aHJlYWQuaWQsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIHVuZGVmaW5lZCwgW10sIG5vdGUpO1xuICAgICAgICAgICAgICAgIC8vIGdldCBvdGhlciB0aHJlYWRzIGZvciB0aGlzIGlkXG4gICAgICAgICAgICAgICAgcmV0dXJuZWROb3Rlcy5ub3Rlcy5mb3JFYWNoKGZ1bmN0aW9uICh0aHJlYWROb3RlKSB7XG4gICAgICAgICAgICAgICAgICBpZiAodGhyZWFkTm90ZS5sZXZlbCA+IDEgJiYgdGhyZWFkTm90ZS50aHJlYWRJZCA9PT0gbm90ZS50aHJlYWQuaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHRvIHRoZSB0aHJlYWRcbiAgICAgICAgICAgICAgICAgICAgbm90ZVRocmVhZC50aHJlYWQucHVzaCh0aHJlYWROb3RlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aHJlYWRMaXN0LnRocmVhZHMucHVzaChub3RlVGhyZWFkKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHRocmVhZExpc3Q7XG4gICAgICAgIH0pXG4gICAgICApO1xuICB9XG5cbiAgcHVibGljIGdldE5vdGVzRm9yQ29sbGVjdGlvbnMoY29sbGVjdGlvbklkcyk6IE9ic2VydmFibGU8Tm90ZXNMaXN0PiB7XG4gICAgaWYgKGNvbGxlY3Rpb25JZHMpIHtcbiAgICAgIGNvbnN0IHVybCA9ICcvY29sbGFib3JhdGlvbi92MS9ub3Rlcz8kcmVsYXRlZEl0ZW1Db2xsZWN0aW9uPScgKyBjb2xsZWN0aW9uSWRzICtcbiAgICAgICAgJyYkb3JkZXJieT1jcmVhdGVkRGF0ZSBBU0MnO1xuICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBtYXAobm90ZXMgPT4gbmV3IE5vdGVzTGlzdCgpLmRlc2VyaWFsaXplKG5vdGVzKSlcbiAgICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZGVsZXRlQWxsTm90ZXMoKSB7XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlTm90ZShub3RlOiBOb3RlLCBub3RlSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8Tm90ZT4ge1xuICAgIGNvbnN0IHVybCA9ICcvY29sbGFib3JhdGlvbi92MS9ub3Rlcy8nICsgbm90ZUlkO1xuICAgIGNvbnN0IGJvZHkgPSBub3RlO1xuICAgIGNvbnN0IGJvZHlTdHIgPSBKU09OLnN0cmluZ2lmeShib2R5KTtcbiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKClcbiAgICAgIC5zZXQoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wdXQodXJsLCBib2R5U3RyLCB7IGhlYWRlcnMgfSlcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgbWFwKCByZXN1bHQgPT4gbmV3IE5vdGUoKS5kZXNlcmlhbGl6ZShyZXN1bHQpKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGVOb3RlKHJlbGF0ZWRJdGVtVHlwZTogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICB1aUFwcFNvdXJjZTogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICByZWxhdGVkSXRlbUlkOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbkxhYmVsOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblVybDogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICBub3RlVGV4dDogc3RyaW5nKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcbiAgICBjb25zdCB1cmwgPSAnL2NvbGxhYm9yYXRpb24vdjEvbm90ZXMnO1xuICAgIGNvbnN0IG5vdGUgPSBuZXcgTm90ZSgpLmRlc2VyaWFsaXplKFxuICAgICAge1xuICAgICAgICBhdHRyaWJ1dGVzOiBbXSxcbiAgICAgICAgbm90aWZpY2F0aW9uTGFiZWw6IG5vdGlmaWNhdGlvbkxhYmVsLFxuICAgICAgICBub3RpZmljYXRpb25Vcmw6IG5vdGlmaWNhdGlvblVybCxcbiAgICAgICAgdGV4dDogbm90ZVRleHQsXG4gICAgICAgIHRpdGxlOiB0aXRsZVxuICAgICAgfVxuICAgICk7XG4gICAgY29uc3QgYm9keSA9IHtcbiAgICAgIG5vdGU6IG5vdGUsXG4gICAgICByZWxhdGVkSXRlbUNvbGxlY3Rpb246IFtcbiAgICAgICAgKHJlbGF0ZWRJdGVtVHlwZSArICdfJyArIHJlbGF0ZWRJdGVtSWQpXG4gICAgICBdLFxuICAgICAgcmVsYXRlZEl0ZW1JZDogcmVsYXRlZEl0ZW1JZCxcbiAgICAgIHJlbGF0ZWRJdGVtVHlwZTogdWlBcHBTb3VyY2UsXG4gICAgICByb2xlczogdW5kZWZpbmVkXG4gICAgfTtcbiAgICBjb25zdCBib2R5U3RyID0gSlNPTi5zdHJpbmdpZnkoYm9keSk7XG4gICAgY29uc3QgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpXG4gICAgICAuc2V0KCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdCh1cmwsIGJvZHlTdHIsIHsgaGVhZGVycyB9KVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAocmVzdWx0ID0+IE51bWJlcihyZXN1bHQpKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXROb3RlKG5vdGVJZDogbnVtYmVyKTogT2JzZXJ2YWJsZTxOb3RlPiB7XG4gICAgY29uc3QgdXJsID0gJy9jb2xsYWJvcmF0aW9uL3YxL25vdGVzLycgKyBub3RlSWQ7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAobm90ZSA9PiBuZXcgTm90ZSgpLmRlc2VyaWFsaXplKG5vdGUpXG4gICAgICAgIClcbiAgICAgICk7XG4gIH1cblxuICBwdWJsaWMgZ2V0VGhyZWFkKHJlbGF0ZWRJdGVtVHlwZTogc3RyaW5nLCByZWxhdGVkSXRlbUlkOiBzdHJpbmcsIHRocmVhZElkOiBudW1iZXIpIHtcbiAgICBjb25zdCB1cmwgPSAnL2NvbGxhYm9yYXRpb24vdjEvbm90ZXMvPyRyZWxhdGVkSXRlbVR5cGU9JyArIHJlbGF0ZWRJdGVtVHlwZVxuICAgICAgKyAnJnJlbGF0ZWRJdGVtSWQ9JyArIHJlbGF0ZWRJdGVtSWRcbiAgICAgICsgJyZmaWx0ZXI9dGhyZWFkSWQ9JyArIHRocmVhZElkXG4gICAgICArICcmb3JkZXJieT1jcmVhdGVkRGF0ZSBBU0MnO1xuICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgICBtYXAobm90ZXMgPT4gbmV3IE5vdGVzTGlzdCgpLmRlc2VyaWFsaXplKG5vdGVzKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGVSZXBseU5vdGUob3JpZ2luYWxOb3RlOiBOb3RlLCByZXBseTogc3RyaW5nLCBub3RlSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8bnVtYmVyPiB7XG4gICAgY29uc3QgdXJsID0gJy9jb2xsYWJvcmF0aW9uL3YxL25vdGVzLycgKyBub3RlSWQ7XG4gICAgY29uc3QgYm9keSA9IHtcbiAgICAgIG5vdGlmaWNhdGlvbkxhYmVsOiBvcmlnaW5hbE5vdGUubm90aWZpY2F0aW9uTGFiZWwsXG4gICAgICBub3RpZmljYXRpb25Vcmw6IG9yaWdpbmFsTm90ZS5ub3RpZmljYXRpb25VcmwsXG4gICAgICB0ZXh0OiByZXBseVxuICAgIH07XG4gICAgY29uc3QgYm9keVN0ciA9IEpTT04uc3RyaW5naWZ5KGJvZHkpO1xuICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSHR0cEhlYWRlcnMoKVxuICAgICAgLnNldCgnQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QodXJsLCBib2R5U3RyLCB7IGhlYWRlcnMgfSlcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgbWFwKHZhbHVlID0+IE51bWJlcih2YWx1ZSkpXG4gICAgICApO1xuICB9XG5cbiAgcHVibGljIHN1YnNjcmliZVRvTm90ZXMocmVsYXRlZEl0ZW1UeXBlLCByZWxhdGVkVHlwZUlkKSB7XG4gICAgY29uc3QgdXJsID0gJy9jb2xsYWJvcmF0aW9uL3YxL25vdGlmaWNhdGlvbnMnO1xuICAgIGNvbnN0IGJvZHkgPSB7XG4gICAgICB0b3BpY0lkOiB1bmRlZmluZWQsXG4gICAgICB0aHJlYWRJZDogdW5kZWZpbmVkLFxuICAgICAgbm90aWZ5Q29sbGVjdGlvbjoge1xuICAgICAgICBjb2xsZWN0aW9uTmFtZTogcmVsYXRlZEl0ZW1UeXBlICsgJ18nICsgcmVsYXRlZFR5cGVJZCxcbiAgICAgICAgbGlmZWN5Y2xlZFdpdGhUeXBlOiAnUlRfQ0FTRScsXG4gICAgICAgIGxpZmVjeWNsZWRXaXRoSWQ6IHRydWVcbiAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGJvZHlTdHIgPSBKU09OLnN0cmluZ2lmeShib2R5KTtcbiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKClcbiAgICAgIC5zZXQoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KHVybCwgYm9keVN0ciwgeyBoZWFkZXJzIH0pXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSlcbiAgICAgICk7XG4gIH1cblxuICBwdWJsaWMgdW5zdWJzY3JpYmVUb05vdGVzKHJlbGF0ZWRJdGVtVHlwZSwgcmVsYXRlZFR5cGVJZCwgdXNlcklkKSB7XG4gICAgbGV0IHVybCA9ICcvY29sbGFib3JhdGlvbi92MS9ub3RpZmljYXRpb25zPyRmaWx0ZXI9Y29sbGVjdGlvbk5hbWU9JztcbiAgICB1cmwgPSB1cmwgKyAnXFwnJyArIHJlbGF0ZWRJdGVtVHlwZSArICdfJyArIHJlbGF0ZWRUeXBlSWQgKyAnXFwnIGFuZCBlbnRpdHlJZD0nICsgdXNlcklkO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZGVsZXRlKHVybClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXROb3RpZmljYXRpb25zKHJlbGF0ZWRJdGVtVHlwZSwgcmVsYXRlZFR5cGVJZCwgdXNlcklkKTogT2JzZXJ2YWJsZTxOb3RpZmljYXRpb25MaXN0PiB7XG4gICAgY29uc3QgdXJsID0gJy9jb2xsYWJvcmF0aW9uL3YxL25vdGlmaWNhdGlvbnM/JGZpbHRlcj1jb2xsZWN0aW9uTmFtZT1cXCcnICsgcmVsYXRlZEl0ZW1UeXBlICsgJ18nICsgcmVsYXRlZFR5cGVJZFxuICAgICAgICAgICAgKyAnXFwnIGFuZCBlbnRpdHlJZD0nICsgdXNlcklkO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgbWFwKHZhbHVlID0+IG5ldyBOb3RpZmljYXRpb25MaXN0KCkuZGVzZXJpYWxpemUodmFsdWUpKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBkZWxldGVOb3RlKG5vdGVJZDogbnVtYmVyKSB7XG4gICAgY29uc3QgdXJsID0gJy9jb2xsYWJvcmF0aW9uL3YxL25vdGVzLycgKyBub3RlSWQ7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5kZWxldGUodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpXG4gICAgICApO1xuICB9XG5cbiAgLyogZW5kIG5vdGVzIHNlcnZpY2UgKi9cblxuICBwdWJsaWMgZ2V0R3JvdXBzKHNhbmRib3hJZDogbnVtYmVyLCB0b3A6IG51bWJlciwgdXNlQ2FjaGU6IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEdyb3Vwcz4ge1xuICAgIGNvbnN0IHVybCA9ICcvb3JnYW5pc2F0aW9uL3YxL2dyb3Vwcz8kc2FuZGJveD0nICsgc2FuZGJveElkICsgJyYkdG9wPScgKyB0b3A7XG4gICAgbGV0IGhlYWRlcnM7XG4gICAgaWYgKHVzZUNhY2hlKSB7XG4gICAgICBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCkuc2V0KCdjYWNoZVJlc3BvbnNlJywgJ3RydWUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCwgeyBoZWFkZXJzIH0pXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcCggZ3JvdXBzID0+IG5ldyBHcm91cHMoKS5kZXNlcmlhbGl6ZSh7IGdyb3VwczogZ3JvdXBzIH0pKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRHcm91cE1lbWJlcnNoaXBzKHNhbmRib3hJZDogbnVtYmVyLCB1c2VySWQ6IHN0cmluZywgdG9wOiBudW1iZXIsIHVzZUNhY2hlOiBib29sZWFuKTogT2JzZXJ2YWJsZTxHcm91cHM+IHtcbiAgICBjb25zdCB1cmwgPSAnL29yZ2FuaXNhdGlvbi92MS91c2Vycy8nICsgdXNlcklkICsgJy9ncm91cHMnICsgJz8kc2FuZGJveD0nICsgc2FuZGJveElkICsgJyYkdG9wPScgKyB0b3A7XG4gICAgbGV0IGhlYWRlcnM7XG4gICAgaWYgKHVzZUNhY2hlKSB7XG4gICAgICBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCkuc2V0KCdjYWNoZVJlc3BvbnNlJywgJ3RydWUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCwgeyBoZWFkZXJzIH0pXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcCggZ3JvdXBzID0+IG5ldyBHcm91cHMoKS5kZXNlcmlhbGl6ZSh7IGdyb3VwczogZ3JvdXBzIH0pKVxuICAgICAgKTtcbiAgfVxuXG5cbn1cbiJdfQ==