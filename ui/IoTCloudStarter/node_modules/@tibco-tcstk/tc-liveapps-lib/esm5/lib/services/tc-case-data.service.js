/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { zip } from 'rxjs';
import { CaseInfo } from '../models/liveappsdata';
import { LiveAppsService } from './live-apps.service';
import { HttpClient } from '@angular/common/http';
import { CaseInfoWithSchema, PurgeResult } from '../models/tc-case-data';
import { map, tap } from 'rxjs/operators';
import { TcCaseCardConfigService } from './tc-case-card-config.service';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "./live-apps.service";
import * as i3 from "./tc-case-card-config.service";
var TcCaseDataService = /** @class */ (function () {
    function TcCaseDataService(http, liveAppsService, caseCardConfigService) {
        this.http = http;
        this.liveAppsService = liveAppsService;
        this.caseCardConfigService = caseCardConfigService;
    }
    /**
     * @param {?} caseRef
     * @param {?} sandboxId
     * @return {?}
     */
    TcCaseDataService.prototype.getCaseState = /**
     * @param {?} caseRef
     * @param {?} sandboxId
     * @return {?}
     */
    function (caseRef, sandboxId) {
        /** @type {?} */
        var url = '/case/v1/cases/' + caseRef + '/' + '?$sandbox=' + sandboxId + '&$select=s';
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} caseinfo
         * @return {?}
         */
        function (caseinfo) {
            /** @type {?} */
            var caseinf = new CaseInfo().deserialize(caseinfo);
            /** @type {?} */
            var state = caseinf.summaryObj.state;
            return state;
        })));
    };
    /**
     * @param {?} applicationId
     * @param {?} typeId
     * @param {?} sandboxId
     * @return {?}
     */
    TcCaseDataService.prototype.purgeAllCases = /**
     * @param {?} applicationId
     * @param {?} typeId
     * @param {?} sandboxId
     * @return {?}
     */
    function (applicationId, typeId, sandboxId) {
        /** @type {?} */
        var url = '/case/v1/cases/?$sandbox=1930&$filter=applicationId eq 2550 and typeId eq 1 and purgeable eq TRUE';
        return this.http.delete(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            return new PurgeResult().deserialize(result);
        })));
    };
    /**
     * @param {?} caseRef
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} uiAppId
     * @return {?}
     */
    TcCaseDataService.prototype.getCaseWithSchema = /**
     * @param {?} caseRef
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} uiAppId
     * @return {?}
     */
    function (caseRef, sandboxId, appId, typeId, uiAppId) {
        var _this = this;
        /** @type {?} */
        var url = '/case/v1/cases/' + caseRef + '/' + '?$sandbox=' + sandboxId + '&$select=uc, m, s';
        // Make the two required API calls
        /** @type {?} */
        var caseSchema = this.liveAppsService.getCaseTypeSchema(sandboxId, appId, 100).pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} typesList
         * @return {?}
         */
        function (typesList) {
            // get schema for case type
            /** @type {?} */
            var requestedType;
            typesList.casetypes.forEach((/**
             * @param {?} cType
             * @return {?}
             */
            function (cType) {
                if (cType.id === typeId) {
                    requestedType = cType;
                }
            }));
            return requestedType;
        })));
        /** @type {?} */
        var caseData = this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        function (val) { return sessionStorage.setItem('tcsTimestamp', Date.now().toString()); })), map((/**
         * @param {?} caseinfo
         * @return {?}
         */
        function (caseinfo) {
            /** @type {?} */
            var caseinf = new CaseInfo().deserialize(caseinfo);
            _this.caseCardConfigService.parseCaseInfo(caseinf, sandboxId, caseinf.metadata.applicationId, caseinf.metadata.typeId, uiAppId);
            return caseinf;
        })));
        // Combine the results of both calls into a single response
        /** @type {?} */
        var test1 = zip(caseSchema, caseData).pipe(map((/**
         * @param {?} caseInfoArray
         * @return {?}
         */
        function (caseInfoArray) {
            return new CaseInfoWithSchema().deserialize({ caseInfo: caseInfoArray[1], caseSchema: caseInfoArray[0].jsonSchema, applicationName: caseInfoArray[0].applicationName, applicationInternalName: caseInfoArray[0].applicationInternalName });
        })));
        return test1;
    };
    TcCaseDataService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    TcCaseDataService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: LiveAppsService },
        { type: TcCaseCardConfigService }
    ]; };
    /** @nocollapse */ TcCaseDataService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function TcCaseDataService_Factory() { return new TcCaseDataService(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.LiveAppsService), i0.ɵɵinject(i3.TcCaseCardConfigService)); }, token: TcCaseDataService, providedIn: "root" });
    return TcCaseDataService;
}());
export { TcCaseDataService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    TcCaseDataService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    TcCaseDataService.prototype.liveAppsService;
    /**
     * @type {?}
     * @private
     */
    TcCaseDataService.prototype.caseCardConfigService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGMtY2FzZS1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdGliY28tdGNzdGsvdGMtbGl2ZWFwcHMtbGliLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL3RjLWNhc2UtZGF0YS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBMkIsR0FBRyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ25ELE9BQU8sRUFBQyxRQUFRLEVBQXVCLE1BQU0sd0JBQXdCLENBQUM7QUFDdEUsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBQ3BELE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxzQkFBc0IsQ0FBQztBQUNoRCxPQUFPLEVBQUMsa0JBQWtCLEVBQUUsV0FBVyxFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFDdkUsT0FBTyxFQUFDLEdBQUcsRUFBWSxHQUFHLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNsRCxPQUFPLEVBQUMsdUJBQXVCLEVBQUMsTUFBTSwrQkFBK0IsQ0FBQzs7Ozs7QUFFdEU7SUFLRSwyQkFBb0IsSUFBZ0IsRUFBVSxlQUFnQyxFQUFVLHFCQUE4QztRQUFsSCxTQUFJLEdBQUosSUFBSSxDQUFZO1FBQVUsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQVUsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUF5QjtJQUFJLENBQUM7Ozs7OztJQUVwSSx3Q0FBWTs7Ozs7SUFBbkIsVUFBb0IsT0FBZSxFQUFFLFNBQWlCOztZQUM5QyxHQUFHLEdBQUcsaUJBQWlCLEdBQUcsT0FBTyxHQUFHLEdBQUcsR0FBRyxZQUFZLEdBQUcsU0FBUyxHQUFHLFlBQVk7UUFDdkYsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUM7YUFDdEIsSUFBSSxDQUNILEdBQUc7Ozs7UUFBRSxVQUFBLEdBQUcsSUFB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LENBQzFDLEdBQUc7Ozs7UUFBQyxVQUFBLGFBQWE7WUFDZixPQUFPLElBQUksa0JBQWtCLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxRQUFRLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUFFLFVBQVUsRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxFQUFFLGVBQWUsRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsZUFBZSxFQUFFLHVCQUF1QixFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyx1QkFBdUIsRUFBRSxDQUFDLENBQUM7UUFDN08sQ0FBQyxFQUFDLENBQ0g7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7O2dCQTlFRixVQUFVLFNBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25COzs7O2dCQVBPLFVBQVU7Z0JBRFYsZUFBZTtnQkFJZix1QkFBdUI7Ozs0QkFQL0I7Q0F3RkMsQUEvRUQsSUErRUM7U0E1RVksaUJBQWlCOzs7Ozs7SUFFaEIsaUNBQXdCOzs7OztJQUFFLDRDQUF3Qzs7Ozs7SUFBRSxrREFBc0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge2ZvcmtKb2luLCBPYnNlcnZhYmxlLCBvZiwgemlwfSBmcm9tICdyeGpzJztcbmltcG9ydCB7Q2FzZUluZm8sIENhc2VUeXBlLCBKc29uU2NoZW1hfSBmcm9tICcuLi9tb2RlbHMvbGl2ZWFwcHNkYXRhJztcbmltcG9ydCB7TGl2ZUFwcHNTZXJ2aWNlfSBmcm9tICcuL2xpdmUtYXBwcy5zZXJ2aWNlJztcbmltcG9ydCB7SHR0cENsaWVudH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHtDYXNlSW5mb1dpdGhTY2hlbWEsIFB1cmdlUmVzdWx0fSBmcm9tICcuLi9tb2RlbHMvdGMtY2FzZS1kYXRhJztcbmltcG9ydCB7bWFwLCBtZXJnZU1hcCwgdGFwfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge1RjQ2FzZUNhcmRDb25maWdTZXJ2aWNlfSBmcm9tICcuL3RjLWNhc2UtY2FyZC1jb25maWcuc2VydmljZSc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFRjQ2FzZURhdGFTZXJ2aWNlIHtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsIHByaXZhdGUgbGl2ZUFwcHNTZXJ2aWNlOiBMaXZlQXBwc1NlcnZpY2UsIHByaXZhdGUgY2FzZUNhcmRDb25maWdTZXJ2aWNlOiBUY0Nhc2VDYXJkQ29uZmlnU2VydmljZSkgeyB9XG5cbiAgcHVibGljIGdldENhc2VTdGF0ZShjYXNlUmVmOiBzdHJpbmcsIHNhbmRib3hJZDogbnVtYmVyKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICBjb25zdCB1cmwgPSAnL2Nhc2UvdjEvY2FzZXMvJyArIGNhc2VSZWYgKyAnLycgKyAnPyRzYW5kYm94PScgKyBzYW5kYm94SWQgKyAnJiRzZWxlY3Q9cyc7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAoY2FzZWluZm8gPT4ge1xuICAgICAgICAgIGNvbnN0IGNhc2VpbmYgPSBuZXcgQ2FzZUluZm8oKS5kZXNlcmlhbGl6ZShjYXNlaW5mbyk7XG4gICAgICAgICAgY29uc3Qgc3RhdGU6IHN0cmluZyA9IGNhc2VpbmYuc3VtbWFyeU9iai5zdGF0ZTtcbiAgICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICAgIH0pXG4gICAgICApO1xuICB9XG5cblxuICBwdWJsaWMgcHVyZ2VBbGxDYXNlcyhhcHBsaWNhdGlvbklkOiBzdHJpbmcsIHR5cGVJZDogc3RyaW5nLCBzYW5kYm94SWQ6IG51bWJlcik6IE9ic2VydmFibGU8UHVyZ2VSZXN1bHQ+IHtcbiAgICBjb25zdCB1cmwgPSAnL2Nhc2UvdjEvY2FzZXMvPyRzYW5kYm94PTE5MzAmJGZpbHRlcj1hcHBsaWNhdGlvbklkIGVxIDI1NTAgYW5kIHR5cGVJZCBlcSAxIGFuZCBwdXJnZWFibGUgZXEgVFJVRSc7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5kZWxldGUodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAocmVzdWx0ID0+IHtcbiAgICAgICAgICByZXR1cm4gbmV3IFB1cmdlUmVzdWx0KCkuZGVzZXJpYWxpemUocmVzdWx0KTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cblxuXG5cblxuICBwdWJsaWMgZ2V0Q2FzZVdpdGhTY2hlbWEoXG4gICAgY2FzZVJlZjogc3RyaW5nLCBzYW5kYm94SWQ6IG51bWJlciwgYXBwSWQ6IHN0cmluZywgdHlwZUlkOiBzdHJpbmcsIHVpQXBwSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8Q2FzZUluZm9XaXRoU2NoZW1hPiB7XG4gICAgY29uc3QgdXJsID0gJy9jYXNlL3YxL2Nhc2VzLycgKyBjYXNlUmVmICsgJy8nICsgJz8kc2FuZGJveD0nICsgc2FuZGJveElkICsgJyYkc2VsZWN0PXVjLCBtLCBzJztcblxuICAgIC8vIE1ha2UgdGhlIHR3byByZXF1aXJlZCBBUEkgY2FsbHNcblxuICAgIGNvbnN0IGNhc2VTY2hlbWEgPSB0aGlzLmxpdmVBcHBzU2VydmljZS5nZXRDYXNlVHlwZVNjaGVtYShzYW5kYm94SWQsIGFwcElkLCAxMDApLnBpcGUoXG4gICAgICB0YXAodmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgbWFwKHR5cGVzTGlzdCA9PiB7XG4gICAgICAgIC8vIGdldCBzY2hlbWEgZm9yIGNhc2UgdHlwZVxuICAgICAgICBsZXQgcmVxdWVzdGVkVHlwZTogQ2FzZVR5cGU7XG4gICAgICAgIHR5cGVzTGlzdC5jYXNldHlwZXMuZm9yRWFjaCgoY1R5cGUpID0+IHtcbiAgICAgICAgICBpZiAoY1R5cGUuaWQgPT09IHR5cGVJZCkge1xuICAgICAgICAgICAgcmVxdWVzdGVkVHlwZSA9IGNUeXBlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXF1ZXN0ZWRUeXBlO1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgY29uc3QgY2FzZURhdGEgPSB0aGlzLmh0dHAuZ2V0KHVybClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAodmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAoY2FzZWluZm8gPT4ge1xuICAgICAgICAgIGNvbnN0IGNhc2VpbmYgPSBuZXcgQ2FzZUluZm8oKS5kZXNlcmlhbGl6ZShjYXNlaW5mbyk7XG4gICAgICAgICAgdGhpcy5jYXNlQ2FyZENvbmZpZ1NlcnZpY2UucGFyc2VDYXNlSW5mbyhcbiAgICAgICAgICAgIGNhc2VpbmYsXG4gICAgICAgICAgICBzYW5kYm94SWQsXG4gICAgICAgICAgICBjYXNlaW5mLm1ldGFkYXRhLmFwcGxpY2F0aW9uSWQsXG4gICAgICAgICAgICBjYXNlaW5mLm1ldGFkYXRhLnR5cGVJZCxcbiAgICAgICAgICAgIHVpQXBwSWRcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBjYXNlaW5mO1xuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgIC8vIENvbWJpbmUgdGhlIHJlc3VsdHMgb2YgYm90aCBjYWxscyBpbnRvIGEgc2luZ2xlIHJlc3BvbnNlXG4gICAgY29uc3QgdGVzdDEgPSB6aXAoY2FzZVNjaGVtYSwgY2FzZURhdGEpLnBpcGUoXG4gICAgICBtYXAoY2FzZUluZm9BcnJheSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgQ2FzZUluZm9XaXRoU2NoZW1hKCkuZGVzZXJpYWxpemUoeyBjYXNlSW5mbzogY2FzZUluZm9BcnJheVsxXSwgY2FzZVNjaGVtYTogY2FzZUluZm9BcnJheVswXS5qc29uU2NoZW1hLCBhcHBsaWNhdGlvbk5hbWU6IGNhc2VJbmZvQXJyYXlbMF0uYXBwbGljYXRpb25OYW1lLCBhcHBsaWNhdGlvbkludGVybmFsTmFtZTogY2FzZUluZm9BcnJheVswXS5hcHBsaWNhdGlvbkludGVybmFsTmFtZSB9KTtcbiAgICAgIH0pXG4gICAgKTtcbiAgICByZXR1cm4gdGVzdDE7XG4gIH1cbn1cbiJdfQ==