/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { RouteAccessControlConfig } from '../models/tc-groups-data';
import { TcCoreCommonFunctions, TcSharedStateService, SharedStateContent, SharedStateEntry, SharedStateList } from '@tibco-tcstk/tc-core-lib';
import { HttpClient } from '@angular/common/http';
import { map } from 'rxjs/operators';
import { Location } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@angular/common";
import * as i3 from "@tibco-tcstk/tc-core-lib";
var TcAccessControlService = /** @class */ (function () {
    function TcAccessControlService(http, location, sharedStateService) {
        this.http = http;
        this.location = location;
        this.sharedStateService = sharedStateService;
    }
    /**
     * @param {?} sandboxId
     * @param {?} uiAppId
     * @param {?} accessControlConfig
     * @return {?}
     */
    TcAccessControlService.prototype.createLAccessControlConfig = /**
     * @param {?} sandboxId
     * @param {?} uiAppId
     * @param {?} accessControlConfig
     * @return {?}
     */
    function (sandboxId, uiAppId, accessControlConfig) {
        /** @type {?} */
        var ssName = uiAppId + '.accesscontrol.config.tibcolabs.client.context.PUBLIC';
        /** @type {?} */
        var content = new SharedStateContent();
        content.json = TcCoreCommonFunctions.escapeString(JSON.stringify(accessControlConfig));
        return this.sharedStateService.createSharedState(ssName, 'PUBLIC', '', sandboxId, undefined, undefined, undefined, content)
            .pipe(map((/**
         * @param {?} value
         * @return {?}
         */
        function (value) { return value; })));
    };
    /**
     * @param {?} uiAppId
     * @param {?} useCache
     * @param {?} flushCache
     * @return {?}
     */
    TcAccessControlService.prototype.getAccessControlConfig = /**
     * @param {?} uiAppId
     * @param {?} useCache
     * @param {?} flushCache
     * @return {?}
     */
    function (uiAppId, useCache, flushCache) {
        // if useCache is false this will trigger the service to update the cached version with latest
        /** @type {?} */
        var ssName = uiAppId + '.accesscontrol.config.tibcolabs.client.context.PUBLIC';
        return this.sharedStateService.getSharedState(ssName, 'PUBLIC', useCache, flushCache)
            .pipe(map((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value.sharedStateEntries.length > 0) {
                /** @type {?} */
                var ssresult = new RouteAccessControlConfig().deserialize(JSON.parse(value.sharedStateEntries[0].content.json));
                ssresult.id = value.sharedStateEntries[0].id;
                return ssresult;
            }
            else {
                return undefined;
            }
        })));
    };
    /**
     * @param {?} sandboxId
     * @param {?} uiAppId
     * @param {?} accessControlConfig
     * @param {?} id
     * @return {?}
     */
    TcAccessControlService.prototype.updateAccessControlConfig = /**
     * @param {?} sandboxId
     * @param {?} uiAppId
     * @param {?} accessControlConfig
     * @param {?} id
     * @return {?}
     */
    function (sandboxId, uiAppId, accessControlConfig, id) {
        var _this = this;
        /** @type {?} */
        var ssName = uiAppId + '.accesscontrol.config.tibcolabs.client.context.PUBLIC';
        /** @type {?} */
        var content = new SharedStateContent();
        content.json = TcCoreCommonFunctions.escapeString(JSON.stringify(accessControlConfig));
        /** @type {?} */
        var entry = new SharedStateEntry();
        entry.content = content;
        entry.sandboxId = sandboxId;
        entry.name = ssName;
        entry.type = 'PUBLIC';
        entry.id = id;
        /** @type {?} */
        var ssList = new SharedStateList();
        ssList.sharedStateEntries = [];
        ssList.sharedStateEntries.push(entry);
        return this.sharedStateService.updateSharedState(ssList.sharedStateEntries)
            .pipe(map((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            // flush the cache
            _this.getAccessControlConfig(uiAppId, true, true).subscribe();
            return new RouteAccessControlConfig().deserialize((JSON.parse(value.sharedStateEntries[0].content.json)));
        })));
    };
    TcAccessControlService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    TcAccessControlService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: Location },
        { type: TcSharedStateService }
    ]; };
    /** @nocollapse */ TcAccessControlService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function TcAccessControlService_Factory() { return new TcAccessControlService(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Location), i0.ɵɵinject(i3.TcSharedStateService)); }, token: TcAccessControlService, providedIn: "root" });
    return TcAccessControlService;
}());
export { TcAccessControlService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    TcAccessControlService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    TcAccessControlService.prototype.location;
    /**
     * @type {?}
     * @private
     */
    TcAccessControlService.prototype.sharedStateService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGMtYWNjZXNzLWNvbnRyb2wuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0aWJjby10Y3N0ay90Yy1saXZlYXBwcy1saWIvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvdGMtYWNjZXNzLWNvbnRyb2wuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNwRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsb0JBQW9CLEVBQUUsa0JBQWtCLEVBQUUsZ0JBQWdCLEVBQUUsZUFBZSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDOUksT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRWxELE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7Ozs7O0FBRTNDO0lBS0ksZ0NBQ1ksSUFBZ0IsRUFDaEIsUUFBa0IsRUFDbEIsa0JBQXdDO1FBRnhDLFNBQUksR0FBSixJQUFJLENBQVk7UUFDaEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQix1QkFBa0IsR0FBbEIsa0JBQWtCLENBQXNCO0lBQ2hELENBQUM7Ozs7Ozs7SUFFRSwyREFBMEI7Ozs7OztJQUFqQyxVQUFrQyxTQUFpQixFQUFFLE9BQWUsRUFBRSxtQkFBNkM7O1lBQ3pHLE1BQU0sR0FBRyxPQUFPLEdBQUcsdURBQXVEOztZQUMxRSxPQUFPLEdBQXVCLElBQUksa0JBQWtCLEVBQUU7UUFDNUQsT0FBTyxDQUFDLElBQUksR0FBRyxxQkFBcUIsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUM7UUFFdkYsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsaUJBQWlCLENB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QyxBQWhFRCxJQWdFQztTQTdEWSxzQkFBc0I7Ozs7OztJQUczQixzQ0FBd0I7Ozs7O0lBQ3hCLDBDQUEwQjs7Ozs7SUFDMUIsb0RBQWdEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUm91dGVBY2Nlc3NDb250cm9sQ29uZmlnIH0gZnJvbSAnLi4vbW9kZWxzL3RjLWdyb3Vwcy1kYXRhJztcbmltcG9ydCB7IFRjQ29yZUNvbW1vbkZ1bmN0aW9ucywgVGNTaGFyZWRTdGF0ZVNlcnZpY2UsIFNoYXJlZFN0YXRlQ29udGVudCwgU2hhcmVkU3RhdGVFbnRyeSwgU2hhcmVkU3RhdGVMaXN0IH0gZnJvbSAnQHRpYmNvLXRjc3RrL3RjLWNvcmUtbGliJztcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBMb2NhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgVGNBY2Nlc3NDb250cm9sU2VydmljZSB7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxuICAgICAgICBwcml2YXRlIGxvY2F0aW9uOiBMb2NhdGlvbixcbiAgICAgICAgcHJpdmF0ZSBzaGFyZWRTdGF0ZVNlcnZpY2U6IFRjU2hhcmVkU3RhdGVTZXJ2aWNlXG4gICAgKSB7IH1cblxuICAgIHB1YmxpYyBjcmVhdGVMQWNjZXNzQ29udHJvbENvbmZpZyhzYW5kYm94SWQ6IG51bWJlciwgdWlBcHBJZDogc3RyaW5nLCBhY2Nlc3NDb250cm9sQ29uZmlnOiBSb3V0ZUFjY2Vzc0NvbnRyb2xDb25maWcpIHtcbiAgICAgICAgY29uc3Qgc3NOYW1lID0gdWlBcHBJZCArICcuYWNjZXNzY29udHJvbC5jb25maWcudGliY29sYWJzLmNsaWVudC5jb250ZXh0LlBVQkxJQyc7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQ6IFNoYXJlZFN0YXRlQ29udGVudCA9IG5ldyBTaGFyZWRTdGF0ZUNvbnRlbnQoKTtcbiAgICAgICAgY29udGVudC5qc29uID0gVGNDb3JlQ29tbW9uRnVuY3Rpb25zLmVzY2FwZVN0cmluZyhKU09OLnN0cmluZ2lmeShhY2Nlc3NDb250cm9sQ29uZmlnKSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuc2hhcmVkU3RhdGVTZXJ2aWNlLmNyZWF0ZVNoYXJlZFN0YXRlKHNzTmFtZSwgJ1BVQkxJQycsICcnLCBzYW5kYm94SWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGNvbnRlbnQpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAodmFsdWUgPT4gdmFsdWUpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRBY2Nlc3NDb250cm9sQ29uZmlnKHVpQXBwSWQ6IHN0cmluZywgdXNlQ2FjaGU6IGJvb2xlYW4sIGZsdXNoQ2FjaGU6IGJvb2xlYW4pOiBPYnNlcnZhYmxlPFJvdXRlQWNjZXNzQ29udHJvbENvbmZpZz4ge1xuICAgICAgICAvLyBpZiB1c2VDYWNoZSBpcyBmYWxzZSB0aGlzIHdpbGwgdHJpZ2dlciB0aGUgc2VydmljZSB0byB1cGRhdGUgdGhlIGNhY2hlZCB2ZXJzaW9uIHdpdGggbGF0ZXN0XG4gICAgICAgIGNvbnN0IHNzTmFtZSA9IHVpQXBwSWQgKyAnLmFjY2Vzc2NvbnRyb2wuY29uZmlnLnRpYmNvbGFicy5jbGllbnQuY29udGV4dC5QVUJMSUMnO1xuXG4gICAgICAgIHJldHVybiB0aGlzLnNoYXJlZFN0YXRlU2VydmljZS5nZXRTaGFyZWRTdGF0ZShzc05hbWUsICdQVUJMSUMnLCB1c2VDYWNoZSwgZmx1c2hDYWNoZSlcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCh2YWx1ZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5zaGFyZWRTdGF0ZUVudHJpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3NyZXN1bHQgPSBuZXcgUm91dGVBY2Nlc3NDb250cm9sQ29uZmlnKCkuZGVzZXJpYWxpemUoSlNPTi5wYXJzZSh2YWx1ZS5zaGFyZWRTdGF0ZUVudHJpZXNbMF0uY29udGVudC5qc29uKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzc3Jlc3VsdC5pZCA9IHZhbHVlLnNoYXJlZFN0YXRlRW50cmllc1swXS5pZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzc3Jlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdXBkYXRlQWNjZXNzQ29udHJvbENvbmZpZyhzYW5kYm94SWQ6IG51bWJlciwgdWlBcHBJZDogc3RyaW5nLCBhY2Nlc3NDb250cm9sQ29uZmlnOiBSb3V0ZUFjY2Vzc0NvbnRyb2xDb25maWcsIGlkOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3Qgc3NOYW1lID0gdWlBcHBJZCArICcuYWNjZXNzY29udHJvbC5jb25maWcudGliY29sYWJzLmNsaWVudC5jb250ZXh0LlBVQkxJQyc7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQ6IFNoYXJlZFN0YXRlQ29udGVudCA9IG5ldyBTaGFyZWRTdGF0ZUNvbnRlbnQoKTtcbiAgICAgICAgY29udGVudC5qc29uID0gVGNDb3JlQ29tbW9uRnVuY3Rpb25zLmVzY2FwZVN0cmluZyhKU09OLnN0cmluZ2lmeShhY2Nlc3NDb250cm9sQ29uZmlnKSk7XG4gICAgICAgIGNvbnN0IGVudHJ5OiBTaGFyZWRTdGF0ZUVudHJ5ID0gbmV3IFNoYXJlZFN0YXRlRW50cnkoKTtcbiAgICAgICAgZW50cnkuY29udGVudCA9IGNvbnRlbnQ7XG4gICAgICAgIGVudHJ5LnNhbmRib3hJZCA9IHNhbmRib3hJZDtcbiAgICAgICAgZW50cnkubmFtZSA9IHNzTmFtZTtcbiAgICAgICAgZW50cnkudHlwZSA9ICdQVUJMSUMnO1xuICAgICAgICBlbnRyeS5pZCA9IGlkO1xuICAgICAgICBjb25zdCBzc0xpc3Q6IFNoYXJlZFN0YXRlTGlzdCA9IG5ldyBTaGFyZWRTdGF0ZUxpc3QoKTtcbiAgICAgICAgc3NMaXN0LnNoYXJlZFN0YXRlRW50cmllcyA9IFtdO1xuICAgICAgICBzc0xpc3Quc2hhcmVkU3RhdGVFbnRyaWVzLnB1c2goZW50cnkpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLnNoYXJlZFN0YXRlU2VydmljZS51cGRhdGVTaGFyZWRTdGF0ZShzc0xpc3Quc2hhcmVkU3RhdGVFbnRyaWVzKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKHZhbHVlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZmx1c2ggdGhlIGNhY2hlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0QWNjZXNzQ29udHJvbENvbmZpZyh1aUFwcElkLCB0cnVlLCB0cnVlKS5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSb3V0ZUFjY2Vzc0NvbnRyb2xDb25maWcoKS5kZXNlcmlhbGl6ZSgoSlNPTi5wYXJzZSh2YWx1ZS5zaGFyZWRTdGF0ZUVudHJpZXNbMF0uY29udGVudC5qc29uKSkpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgIH1cbn1cblxuIl19