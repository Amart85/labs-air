/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { Router } from '@angular/router';
import { LiveAppsService } from '../services/live-apps.service';
import { GeneralConfigResolver, TcGeneralConfigService, TcSharedStateService } from '@tibco-tcstk/tc-core-lib';
import { map, switchMap } from 'rxjs/operators';
import { Roles } from '../models/tc-groups-data';
import { HttpClient } from '@angular/common/http';
import { Location } from '@angular/common';
var AllRolesResolver = /** @class */ (function () {
    function AllRolesResolver(sharedStateService, generalConfigService, http, liveapps, location, router) {
        this.sharedStateService = sharedStateService;
        this.generalConfigService = generalConfigService;
        this.http = http;
        this.liveapps = liveapps;
        this.location = location;
        this.router = router;
    }
    /**
     * @param {?} routeSnapshot
     * @return {?}
     */
    AllRolesResolver.prototype.resolve = /**
     * @param {?} routeSnapshot
     * @return {?}
     */
    function (routeSnapshot) {
        /** @type {?} */
        var claims$ = this.liveapps.getClaims()
            .pipe(map((/**
         * @param {?} claim
         * @return {?}
         */
        function (claim) {
            claim.sandboxes.forEach((/**
             * @param {?} sandbox
             * @return {?}
             */
            function (sandbox) {
                if (sandbox.type === 'Production') {
                    claim.primaryProductionSandbox = sandbox;
                }
            }));
            return claim;
        })));
        /** @type {?} */
        var generalConfigResolver = new GeneralConfigResolver(this.sharedStateService, this.generalConfigService, this.http, this.location, this.router);
        return claims$.pipe(switchMap((/**
         * @param {?} claiminfo
         * @return {?}
         */
        function (claiminfo) {
            generalConfigResolver.setSandbox(Number(claiminfo.primaryProductionSandbox.id));
            /** @type {?} */
            var generalConfig$ = generalConfigResolver.resolve().pipe(map((/**
             * @param {?} generalConfig
             * @return {?}
             */
            function (generalConfig) {
                return new Roles().deserialize({ roles: generalConfig.roles });
            })));
            return generalConfig$;
        })));
    };
    AllRolesResolver.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    AllRolesResolver.ctorParameters = function () { return [
        { type: TcSharedStateService },
        { type: TcGeneralConfigService },
        { type: HttpClient },
        { type: LiveAppsService },
        { type: Location },
        { type: Router }
    ]; };
    return AllRolesResolver;
}());
export { AllRolesResolver };
if (false) {
    /**
     * @type {?}
     * @private
     */
    AllRolesResolver.prototype.sharedStateService;
    /**
     * @type {?}
     * @private
     */
    AllRolesResolver.prototype.generalConfigService;
    /**
     * @type {?}
     * @private
     */
    AllRolesResolver.prototype.http;
    /**
     * @type {?}
     * @private
     */
    AllRolesResolver.prototype.liveapps;
    /**
     * @type {?}
     * @private
     */
    AllRolesResolver.prototype.location;
    /**
     * @type {?}
     * @private
     */
    AllRolesResolver.prototype.router;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWxsLXJvbGVzLnJlc29sdmVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRpYmNvLXRjc3RrL3RjLWxpdmVhcHBzLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9yZXNvbHZlcnMvYWxsLXJvbGVzLnJlc29sdmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBa0MsTUFBTSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFFeEUsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLCtCQUErQixDQUFDO0FBQzlELE9BQU8sRUFBUSxxQkFBcUIsRUFBaUIsc0JBQXNCLEVBQUUsb0JBQW9CLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUNuSSxPQUFPLEVBQVUsR0FBRyxFQUFZLFNBQVMsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQ2pFLE9BQU8sRUFBZ0IsS0FBSyxFQUFDLE1BQU0sMEJBQTBCLENBQUM7QUFDOUQsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBRWhELE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUl6QztJQUdFLDBCQUFvQixrQkFBd0MsRUFBVSxvQkFBNEMsRUFBVSxJQUFnQixFQUFVLFFBQXlCLEVBQVUsUUFBa0IsRUFBVSxNQUFjO1FBQS9NLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBc0I7UUFBVSx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXdCO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUFVLGFBQVEsR0FBUixRQUFRLENBQWlCO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7SUFDbk8sQ0FBQzs7Ozs7SUFFRCxrQ0FBTzs7OztJQUFQLFVBQVEsYUFBcUM7O1lBRXJDLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRTthQUN0QyxJQUFJLENBQ0gsR0FBRzs7OztRQUFDLFVBQUEsS0FBSztZQUNQLEtBQUssQ0FBQyxTQUFTLENBQUMsT0FBTzs7OztZQUFDLFVBQUEsT0FBTztnQkFDN0IsSUFBSSxPQUFPLENBQUMsSUFBSSxLQUFLLFlBQVksRUFBRTtvQkFDakMsS0FBSyxDQUFDLHdCQUF3QixHQUFHLE9BQU8sQ0FBQztpQkFDMUM7WUFDSCxDQUFDLEVBQUMsQ0FBQztZQUNILE9BQU8sS0FBSyxDQUFDO1FBQ2YsQ0FBQyxFQUFDLENBQ0g7O1lBRUcscUJBQXFCLEdBQUcsSUFBSSxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLG9CQUFvQixFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDO1FBRWxKLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FDakIsU0FBUzs7OztRQUFDLFVBQUEsU0FBUztZQUNmLHFCQUFxQixDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLHdCQUF3QixDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7O2dCQUMxRSxjQUFjLEdBQUcscUJBQXFCLENBQUMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUN6RCxHQUFHOzs7O1lBQUMsVUFBQSxhQUFhO2dCQUNmLE9BQU8sSUFBSSxLQUFLLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxLQUFLLEVBQUUsYUFBYSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDakUsQ0FBQyxFQUFDLENBQ0g7WUFDRCxPQUFPLGNBQWMsQ0FBQztRQUN4QixDQUFDLEVBQ0YsQ0FDRixDQUFDO0lBRUosQ0FBQzs7Z0JBbkNGLFVBQVU7Ozs7Z0JBVGtFLG9CQUFvQjtnQkFBNUMsc0JBQXNCO2dCQUduRSxVQUFVO2dCQUpWLGVBQWU7Z0JBTWYsUUFBUTtnQkFSeUIsTUFBTTs7SUFpRC9DLHVCQUFDO0NBQUEsQUFyQ0QsSUFxQ0M7U0FwQ1ksZ0JBQWdCOzs7Ozs7SUFFZiw4Q0FBZ0Q7Ozs7O0lBQUUsZ0RBQW9EOzs7OztJQUFFLGdDQUF3Qjs7Ozs7SUFBRSxvQ0FBaUM7Ozs7O0lBQUUsb0NBQTBCOzs7OztJQUFFLGtDQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7QWN0aXZhdGVkUm91dGVTbmFwc2hvdCwgUmVzb2x2ZSwgUm91dGVyfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHtmb3JrSm9pbiwgT2JzZXJ2YWJsZSwgb2Z9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtMaXZlQXBwc1NlcnZpY2V9IGZyb20gJy4uL3NlcnZpY2VzL2xpdmUtYXBwcy5zZXJ2aWNlJztcbmltcG9ydCB7Q2xhaW0sIEdlbmVyYWxDb25maWdSZXNvbHZlciwgUm9sZUF0dHJpYnV0ZSwgVGNHZW5lcmFsQ29uZmlnU2VydmljZSwgVGNTaGFyZWRTdGF0ZVNlcnZpY2V9IGZyb20gJ0B0aWJjby10Y3N0ay90Yy1jb3JlLWxpYic7XG5pbXBvcnQge2ZsYXRNYXAsIG1hcCwgbWVyZ2VNYXAsIHN3aXRjaE1hcH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtHcm91cCwgR3JvdXBzLCBSb2xlc30gZnJvbSAnLi4vbW9kZWxzL3RjLWdyb3Vwcy1kYXRhJztcbmltcG9ydCB7SHR0cENsaWVudH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHtUY0Nhc2VDYXJkQ29uZmlnU2VydmljZX0gZnJvbSAnLi4vc2VydmljZXMvdGMtY2FzZS1jYXJkLWNvbmZpZy5zZXJ2aWNlJztcbmltcG9ydCB7TG9jYXRpb259IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQge0NsYWltc1Jlc29sdmVyfSBmcm9tICcuL2NsYWltcy5yZXNvbHZlcic7XG5pbXBvcnQge2dyb3VwfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEFsbFJvbGVzUmVzb2x2ZXIgaW1wbGVtZW50cyBSZXNvbHZlPE9ic2VydmFibGU8Um9sZXM+PiB7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzaGFyZWRTdGF0ZVNlcnZpY2U6IFRjU2hhcmVkU3RhdGVTZXJ2aWNlLCBwcml2YXRlIGdlbmVyYWxDb25maWdTZXJ2aWNlOiBUY0dlbmVyYWxDb25maWdTZXJ2aWNlLCBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsIHByaXZhdGUgbGl2ZWFwcHM6IExpdmVBcHBzU2VydmljZSwgcHJpdmF0ZSBsb2NhdGlvbjogTG9jYXRpb24sIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIpIHtcbiAgfVxuXG4gIHJlc29sdmUocm91dGVTbmFwc2hvdDogQWN0aXZhdGVkUm91dGVTbmFwc2hvdCk6IE9ic2VydmFibGU8Um9sZXM+IHtcblxuICAgIGNvbnN0IGNsYWltcyQgPSB0aGlzLmxpdmVhcHBzLmdldENsYWltcygpXG4gICAgICAucGlwZShcbiAgICAgICAgbWFwKGNsYWltID0+IHtcbiAgICAgICAgICBjbGFpbS5zYW5kYm94ZXMuZm9yRWFjaChzYW5kYm94ID0+IHtcbiAgICAgICAgICAgIGlmIChzYW5kYm94LnR5cGUgPT09ICdQcm9kdWN0aW9uJykge1xuICAgICAgICAgICAgICBjbGFpbS5wcmltYXJ5UHJvZHVjdGlvblNhbmRib3ggPSBzYW5kYm94O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBjbGFpbTtcbiAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBjb25zdCBnZW5lcmFsQ29uZmlnUmVzb2x2ZXIgPSBuZXcgR2VuZXJhbENvbmZpZ1Jlc29sdmVyKHRoaXMuc2hhcmVkU3RhdGVTZXJ2aWNlLCB0aGlzLmdlbmVyYWxDb25maWdTZXJ2aWNlLCB0aGlzLmh0dHAsIHRoaXMubG9jYXRpb24sIHRoaXMucm91dGVyKTtcblxuICAgIHJldHVybiBjbGFpbXMkLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoY2xhaW1pbmZvID0+IHtcbiAgICAgICAgICBnZW5lcmFsQ29uZmlnUmVzb2x2ZXIuc2V0U2FuZGJveChOdW1iZXIoY2xhaW1pbmZvLnByaW1hcnlQcm9kdWN0aW9uU2FuZGJveC5pZCkpO1xuICAgICAgICAgIGNvbnN0IGdlbmVyYWxDb25maWckID0gZ2VuZXJhbENvbmZpZ1Jlc29sdmVyLnJlc29sdmUoKS5waXBlKFxuICAgICAgICAgICAgbWFwKGdlbmVyYWxDb25maWcgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gbmV3IFJvbGVzKCkuZGVzZXJpYWxpemUoeyByb2xlczogZ2VuZXJhbENvbmZpZy5yb2xlcyB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gZ2VuZXJhbENvbmZpZyQ7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICApO1xuXG4gIH1cblxufVxuIl19