/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { LiveAppsService } from '../../services/live-apps.service';
import { take, takeUntil, tap } from 'rxjs/operators';
import { LiveAppsComponent } from '../live-apps-component/live-apps-component.component';
import { TcCaseProcessesService } from '../../services/tc-case-processes.service';
/**
 * Renders case action buttons
 *
 * ![alt-text](../live-apps-case-actions.png "Image")
 *
 * \@example <tcla-live-apps-case-actions></tcla-live-apps-case-actions>
 */
var LiveAppsCaseActionsComponent = /** @class */ (function (_super) {
    tslib_1.__extends(LiveAppsCaseActionsComponent, _super);
    function LiveAppsCaseActionsComponent(liveapps, caseProcessesService) {
        var _this = _super.call(this) || this;
        _this.liveapps = liveapps;
        _this.caseProcessesService = caseProcessesService;
        /**
         * Max Actions that can be run simultaneously
         */
        _this.maxActions = 1;
        /**
         * ~event actionClicked : Case Action selected
         * ~payload LaProcessSelection : LaProcessSelection object output when an action is clicked (ie. message to parent to run action component)
         */
        _this.actionClicked = new EventEmitter();
        _this.disabled = false;
        _this.refresh = (/**
         * @return {?}
         */
        function () {
            _this.caseProcessesService.getCaseActionsForCaseRef(_this.caseRef, _this.sandboxId, _this.appId, _this.typeId)
                .pipe(take(1), takeUntil(_this._destroyed$)).subscribe((/**
             * @param {?} caseactions
             * @return {?}
             */
            function (caseactions) {
                if (_this.actionFilter) {
                    caseactions.actions = caseactions.actions.filter((/**
                     * @param {?} act
                     * @return {?}
                     */
                    function (act) {
                        // check if it matches any of the actionFilters
                        /** @type {?} */
                        var test = true;
                        _this.actionFilter.forEach((/**
                         * @param {?} actfilter
                         * @return {?}
                         */
                        function (actfilter) {
                            if (test && act.label.substr(0, actfilter.length) === actfilter) {
                                test = false;
                            }
                        }));
                        return test;
                    }));
                }
                _this.caseactions = caseactions.actions;
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { _this.errorMessage = 'Error retrieving case actions: ' + error.error.errorMsg; }));
        });
        _this.toggleEnable = (/**
         * @return {?}
         */
        function () {
            _this.disabled = !_this.disabled;
        });
        return _this;
    }
    /**
     * @param {?} action
     * @return {?}
     */
    LiveAppsCaseActionsComponent.prototype.selectAction = /**
     * @param {?} action
     * @return {?}
     */
    function (action) {
        var _this = this;
        this.caseProcessesService.getProcessDetails(this.caseRef, this.appId, this.typeId, this.sandboxId, action, null, 100).pipe(take(1), takeUntil(this._destroyed$), tap((/**
         * @param {?} processDetails
         * @return {?}
         */
        function (processDetails) {
            if (!processDetails || !processDetails.process || (processDetails.process.jsonSchema.$schema === 'NOSCHEMA')) {
                // This will be triggered when no form schema is available
                // Typically happens when:
                // 1) The form has elements that are not supported by the Live Apps API for form schemas such as participant selectors
                // 2) The Live Apps application is legacy and has no form schema at all, redeploying the live apps application would fix this.
                console.error('No schema available for this case type: The form may not be supported or you may need to update/re-deploy the live apps application');
            }
        })))
            .subscribe((/**
         * @param {?} processSchema
         * @return {?}
         */
        function (processSchema) {
            _this.actionClicked.emit(processSchema);
            return processSchema;
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) { _this.errorMessage = 'Error retrieving case actions: ' + error.error.errorMsg; }));
    };
    /**
     * @return {?}
     */
    LiveAppsCaseActionsComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.refresh();
    };
    LiveAppsCaseActionsComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tcla-live-apps-case-actions',
                    template: "<div fxLayout=\"row\">\n  <button [disabled]=\"disabled\" [ngClass]=\"disabled ? 'disabled' : ''\" mat-button class=\"tcs-case-action-button\" *ngFor=\"let action of caseactions| slice:0:maxActions\"\n          matTooltip=\"{{action.label}}\" matTooltipShowDelay=\"1000\" matTooltipPosition=\"above\"\n          (click)=\"selectAction(action)\">\n    {{action.label | ellipsis: 30 }}\n  </button>\n  <div fxLayout=\"row\" fxLayoutAlign=\"center center\" style=\"width: 75px\" *ngIf=\"caseactions && caseactions.length > maxActions\">\n    <mat-select class=\"tcs-case-action-option\" [disableOptionCentering]=\"true\" placeholder=\"More\" matTooltip=\"\" matTooltipShowDelay=\"1000\" matTooltipPosition=\"below\">\n      <mat-option *ngFor=\"let action of caseactions | slice:maxActions:caseactions.length\" [value]=\"\" (click)=\"selectAction(action)\">\n        <span>{{action.label}}</span>\n      </mat-option>\n    </mat-select>\n  </div>\n</div>\n",
                    styles: [".tcs-case-action-button{height:40px;border-radius:3px;background-color:#fff;color:#0081cb;font-family:Source Sans Pro;font-size:16px;font-weight:400;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:.2px;margin:5px;border:1px solid #0081cb}.tcs-case-action-button.disabled{border:none}.tcs-case-action-option{padding-top:9px;padding-left:10px;padding-right:10px;height:40px;border-radius:3px;background-color:#fff;color:#0081cb;border:1px solid #0081cb}"]
                }] }
    ];
    /** @nocollapse */
    LiveAppsCaseActionsComponent.ctorParameters = function () { return [
        { type: LiveAppsService },
        { type: TcCaseProcessesService }
    ]; };
    LiveAppsCaseActionsComponent.propDecorators = {
        caseRef: [{ type: Input }],
        appId: [{ type: Input }],
        typeId: [{ type: Input }],
        sandboxId: [{ type: Input }],
        maxActions: [{ type: Input }],
        actionFilter: [{ type: Input }],
        actionClicked: [{ type: Output }]
    };
    return LiveAppsCaseActionsComponent;
}(LiveAppsComponent));
export { LiveAppsCaseActionsComponent };
if (false) {
    /**
     * The case reference
     * @type {?}
     */
    LiveAppsCaseActionsComponent.prototype.caseRef;
    /**
     * The LA Application Id
     * @type {?}
     */
    LiveAppsCaseActionsComponent.prototype.appId;
    /**
     * The LA Application Type Id (generally 1)
     * @type {?}
     */
    LiveAppsCaseActionsComponent.prototype.typeId;
    /**
     * sandboxId - this comes from claims resolver
     * @type {?}
     */
    LiveAppsCaseActionsComponent.prototype.sandboxId;
    /**
     * Max Actions that can be run simultaneously
     * @type {?}
     */
    LiveAppsCaseActionsComponent.prototype.maxActions;
    /**
     * Dont show buttons for any actions that start with this string.
     * eg: '$' will remove the action $Update
     * @type {?}
     */
    LiveAppsCaseActionsComponent.prototype.actionFilter;
    /**
     * ~event actionClicked : Case Action selected
     * ~payload LaProcessSelection : LaProcessSelection object output when an action is clicked (ie. message to parent to run action component)
     * @type {?}
     */
    LiveAppsCaseActionsComponent.prototype.actionClicked;
    /** @type {?} */
    LiveAppsCaseActionsComponent.prototype.caseactions;
    /** @type {?} */
    LiveAppsCaseActionsComponent.prototype.errorMessage;
    /** @type {?} */
    LiveAppsCaseActionsComponent.prototype.disabled;
    /** @type {?} */
    LiveAppsCaseActionsComponent.prototype.appSchema;
    /** @type {?} */
    LiveAppsCaseActionsComponent.prototype.caseType;
    /** @type {?} */
    LiveAppsCaseActionsComponent.prototype.caseActionList;
    /** @type {?} */
    LiveAppsCaseActionsComponent.prototype.refresh;
    /** @type {?} */
    LiveAppsCaseActionsComponent.prototype.toggleEnable;
    /**
     * @type {?}
     * @protected
     */
    LiveAppsCaseActionsComponent.prototype.liveapps;
    /**
     * @type {?}
     * @protected
     */
    LiveAppsCaseActionsComponent.prototype.caseProcessesService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLWNhc2UtYWN0aW9ucy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdGliY28tdGNzdGsvdGMtbGl2ZWFwcHMtbGliLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvbGl2ZS1hcHBzLWNhc2UtYWN0aW9ucy9saXZlLWFwcHMtY2FzZS1hY3Rpb25zLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLE9BQU8sRUFBQyxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFZLE1BQU0sZUFBZSxDQUFDO0FBRW5HLE9BQU8sRUFBQyxlQUFlLEVBQUMsTUFBTSxrQ0FBa0MsQ0FBQztBQUNqRSxPQUFPLEVBQU0sSUFBSSxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUd6RCxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxzREFBc0QsQ0FBQztBQUN2RixPQUFPLEVBQUMsc0JBQXNCLEVBQUMsTUFBTSwwQ0FBMEMsQ0FBQzs7Ozs7Ozs7QUFXaEY7SUFLa0Qsd0RBQWlCO0lBK0NqRSxzQ0FBc0IsUUFBeUIsRUFBWSxvQkFBNEM7UUFBdkcsWUFDRSxpQkFBTyxTQUNSO1FBRnFCLGNBQVEsR0FBUixRQUFRLENBQWlCO1FBQVksMEJBQW9CLEdBQXBCLG9CQUFvQixDQUF3Qjs7OztRQXZCOUYsZ0JBQVUsR0FBRyxDQUFDLENBQUM7Ozs7O1FBYWQsbUJBQWEsR0FBcUMsSUFBSSxZQUFZLEVBQXNCLENBQUM7UUFJNUYsY0FBUSxHQUFHLEtBQUssQ0FBQztRQVVqQixhQUFPOzs7UUFBRztZQUNmLEtBQUksQ0FBQyxvQkFBb0IsQ0FBQyx3QkFBd0IsQ0FBQyxLQUFJLENBQUMsT0FBTyxFQUFFLEtBQUksQ0FBQyxTQUFTLEVBQUUsS0FBSSxDQUFDLEtBQUssRUFBRSxLQUFJLENBQUMsTUFBTSxDQUFDO2lCQUN0RyxJQUFJLENBQ0gsSUFBSSxDQUFDLENBQUMsQ0FB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QUt6Qiw2Q0FBdUI7Ozs7O0lBS3ZCLDhDQUF3Qjs7Ozs7SUFLeEIsaURBQTJCOzs7OztJQUszQixrREFBd0I7Ozs7OztJQU94QixvREFBZ0M7Ozs7OztJQU1oQyxxREFBbUc7O0lBRW5HLG1EQUFpQzs7SUFDakMsb0RBQTRCOztJQUM1QixnREFBd0I7O0lBRXhCLGlEQUF5Qjs7SUFDekIsZ0RBQW1COztJQUNuQixzREFBMEI7O0lBTTFCLCtDQXFCQzs7SUFFRCxvREFFQzs7Ozs7SUE3QlcsZ0RBQW1DOzs7OztJQUFFLDREQUFzRCIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IHtDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uRGVzdHJveSwgT25Jbml0LCBPdXRwdXQsIFZpZXdDaGlsZH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1N1YmplY3R9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtMaXZlQXBwc1NlcnZpY2V9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2xpdmUtYXBwcy5zZXJ2aWNlJztcbmltcG9ydCB7bWFwLCB0YWtlLCB0YWtlVW50aWwsIHRhcH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtDYXNlQWN0aW9uLCBDYXNlVHlwZSwgQ2FzZVR5cGVzTGlzdCwgUHJvY2Vzc30gZnJvbSAnLi4vLi4vbW9kZWxzL2xpdmVhcHBzZGF0YSc7XG5pbXBvcnQge0xhUHJvY2Vzc1NlbGVjdGlvbn0gZnJvbSAnLi4vLi4vbW9kZWxzL3RjLWNhc2UtcHJvY2Vzc2VzJztcbmltcG9ydCB7TGl2ZUFwcHNDb21wb25lbnR9IGZyb20gJy4uL2xpdmUtYXBwcy1jb21wb25lbnQvbGl2ZS1hcHBzLWNvbXBvbmVudC5jb21wb25lbnQnO1xuaW1wb3J0IHtUY0Nhc2VQcm9jZXNzZXNTZXJ2aWNlfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy90Yy1jYXNlLXByb2Nlc3Nlcy5zZXJ2aWNlJztcbmltcG9ydCB7Q3VzdG9tRm9ybURlZnN9IGZyb20gJ0B0aWJjby10Y3N0ay90Yy1mb3Jtcy1saWInO1xuXG5cbi8qKlxuICogUmVuZGVycyBjYXNlIGFjdGlvbiBidXR0b25zXG4gKlxuICogIVthbHQtdGV4dF0oLi4vbGl2ZS1hcHBzLWNhc2UtYWN0aW9ucy5wbmcgXCJJbWFnZVwiKVxuICpcbiAqQGV4YW1wbGUgPHRjbGEtbGl2ZS1hcHBzLWNhc2UtYWN0aW9ucz48L3RjbGEtbGl2ZS1hcHBzLWNhc2UtYWN0aW9ucz5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGNsYS1saXZlLWFwcHMtY2FzZS1hY3Rpb25zJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2xpdmUtYXBwcy1jYXNlLWFjdGlvbnMuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9saXZlLWFwcHMtY2FzZS1hY3Rpb25zLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBMaXZlQXBwc0Nhc2VBY3Rpb25zQ29tcG9uZW50IGV4dGVuZHMgTGl2ZUFwcHNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAvKipcbiAgICogVGhlIGNhc2UgcmVmZXJlbmNlXG4gICAqL1xuICBASW5wdXQoKSBjYXNlUmVmOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBMQSBBcHBsaWNhdGlvbiBJZFxuICAgKi9cbiAgQElucHV0KCkgYXBwSWQ6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIExBIEFwcGxpY2F0aW9uIFR5cGUgSWQgKGdlbmVyYWxseSAxKVxuICAgKi9cbiAgQElucHV0KCkgdHlwZUlkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIHNhbmRib3hJZCAtIHRoaXMgY29tZXMgZnJvbSBjbGFpbXMgcmVzb2x2ZXJcbiAgICovXG4gIEBJbnB1dCgpIHNhbmRib3hJZDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBNYXggQWN0aW9ucyB0aGF0IGNhbiBiZSBydW4gc2ltdWx0YW5lb3VzbHlcbiAgICovXG4gIEBJbnB1dCgpIG1heEFjdGlvbnMgPSAxO1xuXG5cbiAgLyoqXG4gICAqIERvbnQgc2hvdyBidXR0b25zIGZvciBhbnkgYWN0aW9ucyB0aGF0IHN0YXJ0IHdpdGggdGhpcyBzdHJpbmcuXG4gICAqIGVnOiAnJCcgd2lsbCByZW1vdmUgdGhlIGFjdGlvbiAkVXBkYXRlXG4gICAqL1xuICBASW5wdXQoKSBhY3Rpb25GaWx0ZXI6IHN0cmluZ1tdO1xuXG4gIC8qKlxuICAgKiB+ZXZlbnQgYWN0aW9uQ2xpY2tlZCA6IENhc2UgQWN0aW9uIHNlbGVjdGVkXG4gICAqIH5wYXlsb2FkIExhUHJvY2Vzc1NlbGVjdGlvbiA6IExhUHJvY2Vzc1NlbGVjdGlvbiBvYmplY3Qgb3V0cHV0IHdoZW4gYW4gYWN0aW9uIGlzIGNsaWNrZWQgKGllLiBtZXNzYWdlIHRvIHBhcmVudCB0byBydW4gYWN0aW9uIGNvbXBvbmVudClcbiAgICovXG4gIEBPdXRwdXQoKSBhY3Rpb25DbGlja2VkOiBFdmVudEVtaXR0ZXI8TGFQcm9jZXNzU2VsZWN0aW9uPiA9IG5ldyBFdmVudEVtaXR0ZXI8TGFQcm9jZXNzU2VsZWN0aW9uPigpO1xuXG4gIHB1YmxpYyBjYXNlYWN0aW9uczogQ2FzZUFjdGlvbltdO1xuICBwdWJsaWMgZXJyb3JNZXNzYWdlOiBzdHJpbmc7XG4gIHB1YmxpYyBkaXNhYmxlZCA9IGZhbHNlO1xuXG4gIGFwcFNjaGVtYTogQ2FzZVR5cGVzTGlzdDtcbiAgY2FzZVR5cGU6IENhc2VUeXBlO1xuICBjYXNlQWN0aW9uTGlzdDogUHJvY2Vzc1tdO1xuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBsaXZlYXBwczogTGl2ZUFwcHNTZXJ2aWNlLCBwcm90ZWN0ZWQgY2FzZVByb2Nlc3Nlc1NlcnZpY2U6IFRjQ2FzZVByb2Nlc3Nlc1NlcnZpY2UpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgcHVibGljIHJlZnJlc2ggPSAoKSA9PiB7XG4gICAgdGhpcy5jYXNlUHJvY2Vzc2VzU2VydmljZS5nZXRDYXNlQWN0aW9uc0ZvckNhc2VSZWYodGhpcy5jYXNlUmVmLCB0aGlzLnNhbmRib3hJZCwgdGhpcy5hcHBJZCwgdGhpcy50eXBlSWQpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCQpXG4gICAgICApLnN1YnNjcmliZShcbiAgICAgIGNhc2VhY3Rpb25zID0+IHtcbiAgICAgICAgaWYgKHRoaXMuYWN0aW9uRmlsdGVyKSB7XG4gICAgICAgICAgY2FzZWFjdGlvbnMuYWN0aW9ucyA9IGNhc2VhY3Rpb25zLmFjdGlvbnMuZmlsdGVyKGFjdCA9PiB7XG4gICAgICAgICAgICAvLyBjaGVjayBpZiBpdCBtYXRjaGVzIGFueSBvZiB0aGUgYWN0aW9uRmlsdGVyc1xuICAgICAgICAgICAgbGV0IHRlc3QgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5hY3Rpb25GaWx0ZXIuZm9yRWFjaChhY3RmaWx0ZXIgPT4ge1xuICAgICAgICAgICAgICBpZiAodGVzdCAmJiBhY3QubGFiZWwuc3Vic3RyKDAsIGFjdGZpbHRlci5sZW5ndGgpID09PSBhY3RmaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICB0ZXN0ID0gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRlc3Q7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYXNlYWN0aW9ucyA9IGNhc2VhY3Rpb25zLmFjdGlvbnM7XG4gICAgICB9LCBlcnJvciA9PiB7IHRoaXMuZXJyb3JNZXNzYWdlID0gJ0Vycm9yIHJldHJpZXZpbmcgY2FzZSBhY3Rpb25zOiAnICsgZXJyb3IuZXJyb3IuZXJyb3JNc2c7IH0pO1xuICB9XG5cbiAgcHVibGljIHRvZ2dsZUVuYWJsZSA9ICgpID0+IHtcbiAgICB0aGlzLmRpc2FibGVkID0gIXRoaXMuZGlzYWJsZWQ7XG4gIH1cblxuICBwdWJsaWMgc2VsZWN0QWN0aW9uKGFjdGlvbjogQ2FzZUFjdGlvbikge1xuXG4gICAgdGhpcy5jYXNlUHJvY2Vzc2VzU2VydmljZS5nZXRQcm9jZXNzRGV0YWlscyh0aGlzLmNhc2VSZWYsIHRoaXMuYXBwSWQsIHRoaXMudHlwZUlkLCB0aGlzLnNhbmRib3hJZCwgYWN0aW9uLCBudWxsLCAxMDApLnBpcGUoXG4gICAgICB0YWtlKDEpLFxuICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCQpLFxuICAgICAgdGFwKHByb2Nlc3NEZXRhaWxzID0+IHtcbiAgICAgICAgaWYgKCFwcm9jZXNzRGV0YWlscyB8fCAhcHJvY2Vzc0RldGFpbHMucHJvY2VzcyB8fCAocHJvY2Vzc0RldGFpbHMucHJvY2Vzcy5qc29uU2NoZW1hLiRzY2hlbWEgPT09ICdOT1NDSEVNQScpKSB7XG4gICAgICAgICAgLy8gVGhpcyB3aWxsIGJlIHRyaWdnZXJlZCB3aGVuIG5vIGZvcm0gc2NoZW1hIGlzIGF2YWlsYWJsZVxuICAgICAgICAgIC8vIFR5cGljYWxseSBoYXBwZW5zIHdoZW46XG4gICAgICAgICAgLy8gMSkgVGhlIGZvcm0gaGFzIGVsZW1lbnRzIHRoYXQgYXJlIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIExpdmUgQXBwcyBBUEkgZm9yIGZvcm0gc2NoZW1hcyBzdWNoIGFzIHBhcnRpY2lwYW50IHNlbGVjdG9yc1xuICAgICAgICAgIC8vIDIpIFRoZSBMaXZlIEFwcHMgYXBwbGljYXRpb24gaXMgbGVnYWN5IGFuZCBoYXMgbm8gZm9ybSBzY2hlbWEgYXQgYWxsLCByZWRlcGxveWluZyB0aGUgbGl2ZSBhcHBzIGFwcGxpY2F0aW9uIHdvdWxkIGZpeCB0aGlzLlxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignTm8gc2NoZW1hIGF2YWlsYWJsZSBmb3IgdGhpcyBjYXNlIHR5cGU6IFRoZSBmb3JtIG1heSBub3QgYmUgc3VwcG9ydGVkIG9yIHlvdSBtYXkgbmVlZCB0byB1cGRhdGUvcmUtZGVwbG95IHRoZSBsaXZlIGFwcHMgYXBwbGljYXRpb24nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIClcbiAgICApXG4gICAgLnN1YnNjcmliZShwcm9jZXNzU2NoZW1hID0+IHtcbiAgICAgIHRoaXMuYWN0aW9uQ2xpY2tlZC5lbWl0KHByb2Nlc3NTY2hlbWEpO1xuICAgICAgcmV0dXJuIHByb2Nlc3NTY2hlbWE7XG4gICAgfSwgZXJyb3IgPT4geyB0aGlzLmVycm9yTWVzc2FnZSA9ICdFcnJvciByZXRyaWV2aW5nIGNhc2UgYWN0aW9uczogJyArIGVycm9yLmVycm9yLmVycm9yTXNnOyB9KTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMucmVmcmVzaCgpO1xuICB9XG5cbn1cbiJdfQ==