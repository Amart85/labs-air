/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { LiveAppsService } from '../../services/live-apps.service';
import { take, takeUntil } from 'rxjs/operators';
import { LiveAppsComponent } from '../live-apps-component/live-apps-component.component';
import { TcButtonsHelperService } from '@tibco-tcstk/tc-core-lib';
/**
 * This Component allows to list, and add Notes to a Case-Instance or other Context e.g. a whole Application.
 * Any Note can have Sub-Notes to allow real collaboration.
 *
 * Note that since this component uses a virtual scroll the parent container must have height set or the notes won't appear
 *
 * ![alt-text](../live-apps-notes.png "Notes Component Image")
 *
 * \@example <tcla-live-apps-notes></tcla-live-apps-notes>
 */
var LiveAppsNotesComponent = /** @class */ (function (_super) {
    tslib_1.__extends(LiveAppsNotesComponent, _super);
    function LiveAppsNotesComponent(liveapps, buttonsHelper) {
        var _this = _super.call(this) || this;
        _this.liveapps = liveapps;
        _this.buttonsHelper = buttonsHelper;
        /**
         * Whether to show the header bar in the widget - eg. favorites on home page (contains icon etc) - if off icons still appear without bar
         */
        _this.showHeader = _this.showHeader ? _this.showHeader : true;
        _this.newNote = {};
        _this.skip = 0;
        _this.top = 20;
        _this.end = false;
        _this.toolbarButtons = [];
        _this.refresh = (/**
         * @return {?}
         */
        function () {
            _this.skip = 0;
            _this.top = 20;
            _this.end = false;
            if (_this.threads && _this.threads.threads) {
                _this.threads.threads.length = 0;
            }
            _this.getBatch();
            _this.getNotifications();
        });
        _this.getBatch = (/**
         * @return {?}
         */
        function () {
            if (!_this.end) {
                _this.liveapps.getThreads(_this.relatedItemType, _this.relatedItemId, _this.skip, _this.top)
                    .pipe(take(1), takeUntil(_this._destroyed$)).subscribe((/**
                 * @param {?} threadList
                 * @return {?}
                 */
                function (threadList) {
                    if (!_this.threads) {
                        _this.threads = threadList;
                    }
                    else {
                        // this will strip any duplicates that may have been retrieved due to fast scrolling
                        /** @type {?} */
                        var filteredEvents = threadList.threads.filter((/**
                         * @param {?} x
                         * @return {?}
                         */
                        function (x) { return _this.threads.threads.every((/**
                         * @param {?} y
                         * @return {?}
                         */
                        function (y) { return y.note.id !== x.note.id; })); }));
                        _this.threads.threads = _this.threads.threads.concat(filteredEvents);
                    }
                    if (threadList.threads.length < _this.top) {
                        _this.end = true;
                    }
                    else {
                        _this.skip = _this.skip + threadList.threads.length - 1;
                    }
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    _this.errorMessage = 'Error retrieving notes: ' + error.error.errorMsg;
                }));
            }
        });
        _this.toggleReplies = (/**
         * @param {?} thread
         * @return {?}
         */
        function (thread) {
            thread.showReplies = !thread.showReplies;
        });
        _this.toggleNewReply = (/**
         * @param {?} thread
         * @return {?}
         */
        function (thread) {
            if (!thread.newReply) {
                thread.newReply = {};
            }
            if (thread.showReplies && !thread.showNewReply) {
                thread.newReply = {};
                thread.showNewReply = true;
            }
            else {
                thread.showNewReply = !thread.showNewReply;
                thread.showReplies = !thread.showReplies;
            }
        });
        _this.createReply = (/**
         * @param {?} thread
         * @param {?} replyText
         * @return {?}
         */
        function (thread, replyText) {
            _this.liveapps.createReplyNote(thread.note, replyText, thread.note.id)
                .pipe(take(1), takeUntil(_this._destroyed$))
                .subscribe((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                _this.newNoteId = result;
                thread.newReply.text = undefined;
                _this.refresh();
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return _this.errorMessage = 'Error creating new note: ' + error.error.errorMessage; }));
        });
        _this.createThread = (/**
         * @param {?} noteText
         * @return {?}
         */
        function (noteText) {
            if (noteText !== undefined) {
                _this.liveapps.createNote(_this.relatedItemType, 'RT_CASE', _this.relatedItemId, 'comments update', '', '', noteText)
                    .pipe(take(1), takeUntil(_this._destroyed$))
                    .subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                function (result) {
                    _this.newNoteId = result;
                    _this.newNote.text = undefined;
                    _this.refresh();
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) { return _this.errorMessage = 'Error creating new note: ' + error.error.errorMessage; }));
            }
        });
        _this.createToolbarButtons = (/**
         * @param {?} subscribed
         * @return {?}
         */
        function (subscribed) {
            /** @type {?} */
            var subscribeButton = _this.buttonsHelper.createButton('subscribe', 'tcs-collaboration-unsubscribed', true, 'Enable Notifications', !subscribed, !subscribed);
            /** @type {?} */
            var unSubscribeButton = _this.buttonsHelper.createButton('unsubscribe', 'tcs-collaboration-subscribed', true, 'Disable Notifications', subscribed, subscribed);
            /** @type {?} */
            var buttons = [subscribeButton, unSubscribeButton];
            return buttons;
        });
        _this.setupNotificationButtons = (/**
         * @param {?} subscribed
         * @return {?}
         */
        function (subscribed) {
            /** @type {?} */
            var buttons = _this.createToolbarButtons(subscribed);
            _this.buttonsHelper.updateButtons(buttons, _this.toolbarButtons);
        });
        _this.updateButtonDef = (/**
         * @param {?} updatedToolbarButtons
         * @return {?}
         */
        function (updatedToolbarButtons) {
            updatedToolbarButtons.forEach((/**
             * @param {?} updatedButton
             * @return {?}
             */
            function (updatedButton) {
                /** @type {?} */
                var idx = _this.toolbarButtons.findIndex((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item.id === updatedButton.id; }));
                _this.toolbarButtons[idx] = updatedButton;
            }));
        });
        _this.handleToolbarButtonEvent = (/**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            if (id === 'subscribe') {
                _this.subscribe();
            }
            else if (id === 'unsubscribe') {
                _this.unsubscribe();
            }
        });
        _this.recreateButtonsForNotifications = (/**
         * @param {?} subscribed
         * @return {?}
         */
        function (subscribed) {
            /** @type {?} */
            var buttons = _this.createToolbarButtons(subscribed);
            _this.buttonsHelper.updateButtons(buttons, _this.toolbarButtons);
        });
        _this.getNotifications = (/**
         * @return {?}
         */
        function () {
            _this.liveapps.getNotifications(_this.relatedItemType, _this.relatedItemId, _this.userId)
                .pipe(take(1), takeUntil(_this._destroyed$))
                .subscribe((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                /** @type {?} */
                var notificationList = result;
                if (notificationList.notifications.length > 0) {
                    _this.subscribed = true;
                    _this.setupNotificationButtons(true);
                }
                else {
                    _this.subscribed = false;
                    _this.setupNotificationButtons(false);
                }
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return _this.errorMessage = 'Error creating new note: ' + error.error.errorMessage; }));
        });
        _this.subscribe = (/**
         * @return {?}
         */
        function () {
            _this.liveapps.subscribeToNotes(_this.relatedItemType, _this.relatedItemId)
                .pipe(take(1), takeUntil(_this._destroyed$))
                .subscribe((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                if (result) {
                    _this.subscribed = true;
                    _this.recreateButtonsForNotifications(true);
                }
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return _this.errorMessage = 'Error creating new note: ' + error.error.errorMessage; }));
        });
        _this.unsubscribe = (/**
         * @return {?}
         */
        function () {
            _this.liveapps.unsubscribeToNotes(_this.relatedItemType, _this.relatedItemId, _this.userId)
                .pipe(take(1), takeUntil(_this._destroyed$))
                .subscribe((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                _this.subscribed = false;
                _this.recreateButtonsForNotifications(false);
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return _this.errorMessage = 'Error creating new note: ' + error.error.errorMessage; }));
        });
        _this.editNote = (/**
         * @param {?} thread
         * @return {?}
         */
        function (thread) {
            thread.editMode = !thread.editMode;
        });
        _this.updateNote = (/**
         * @param {?} note
         * @param {?} updatedText
         * @return {?}
         */
        function (note, updatedText) {
            console.log('Updating note');
            note.text = updatedText;
            _this.liveapps.updateNote(note, note.id)
                .pipe(take(1), takeUntil(_this._destroyed$))
                .subscribe((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                console.log('Note updated');
                _this.refresh();
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return _this.errorMessage = 'Error updating note: ' + error.error.errorMessage; }));
        });
        _this.deleteNote = (/**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            console.log('Deleting note');
            _this.liveapps.deleteNote(id)
                .pipe(take(1), takeUntil(_this._destroyed$))
                .subscribe((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                console.log('Note deleted: ' + result);
                _this.refresh();
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return _this.errorMessage = 'Error creating new note: ' + error.error.errorMessage; }));
        });
        return _this;
    }
    /**
     * @return {?}
     */
    LiveAppsNotesComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        // this.refresh();
        this.newNote.text = '';
    };
    LiveAppsNotesComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tcla-live-apps-notes',
                    template: "<div class=\"tcs-notes-pane\" fxLayout=\"column\" fxFill style=\"overflow: hidden;\">\n  <tc-tibco-cloud-widget-header fxFlex=\"nogrow\" [headerText]=\"'Notes'\" [icon]=\"'tcs-collaboration-feed'\"\n                                [toolbarButtons]=\"toolbarButtons\" [showHeader]=\"showHeader\"\n                                (toolbarButtonEvent)=\"handleToolbarButtonEvent($event)\"></tc-tibco-cloud-widget-header>\n  <div class=\"tcs-collaboration-pane\" fxLayout=\"column\" fxFlex=\"grow\" style=\"\">\n    <div class=\"tcs-collaboration-existing-threads\" fxLayout=\"column\" fxFlex>\n      <!--div *ngIf=\"threads && threads.threads.length > 0\"-->\n      <div style=\"height: 100%;\">\n        <cdk-virtual-scroll-viewport style=\"height: 100%\" itemSize=\"50\" (scrolledIndexChange)=\"getBatch()\">\n\n          <!--div class=\"tcs-collaboration-detail-box tcs-collaboration-thread\" [ngClass]=\"{ editing: thread.editMode }\" *ngFor=\"let thread of threads.threads | reverse\" fxLayout=\"column\"-->\n          <div *ngIf=\"threads && threads.threads\">\n            <div class=\"tcs-collaboration-detail-box tcs-collaboration-thread\" [ngClass]=\"{ editing: thread.editMode }\"\n                 *cdkVirtualFor=\"let thread of threads.threads\" fxLayout=\"column\">\n              <div class=\"tcs-thread-box\">\n                <!-- collaboration threads -->\n                <div class=\"tcs-collaboration-entry\">\n                  <div *ngIf=\"!thread.editMode\">\n                    <div fxLayout=\"row\" fxLayoutAlign=\"space-between start\">\n                      <span class=\"tcs-collaboration-thread-author\">{{thread.note.createdByName}}</span>\n                      <div fxLayoutAlign=\"row\">\n                      <span *ngIf=\"thread.note.modifiedDate > thread.note.createdDate\" class=\"tcs-collaboration-edited\">Edited\n                      </span>\n                        <span class=\"tcs-collaboration-thread-date\">{{thread.note.modifiedDate | durationSince}}</span>\n                      </div>\n                    </div>\n                    <span class=\"tcs-collaboration-thread-text\" matTooltip=\"{{thread.note.text}}\"\n                          matTooltipShowDelay=\"1000\"\n                          matTooltipPosition=\"below\">{{thread.note.text | ellipsis: 70}}</span>\n                  </div>\n                  <tcla-live-apps-notes-editor *ngIf=\"thread.editMode\" [noteText]=\"thread.note.text\"\n                                               (noteSubmitted)=\"updateNote(thread.note, $event)\"></tcla-live-apps-notes-editor>\n                </div>\n                <div class=\"tcs-icon-row\" fxLayout=\"row\" fxLayoutAlign=\"space-between center\">\n                  <div class=\"tcs-collaboration-thread-icon-left\">\n                    <mat-icon (click)=\"deleteNote(thread.note.id)\"\n                              class=\"tcs-icon tcs-icon-active tcs-collaboration-edit-buttons tcs-collaboration-delete-icon\"\n                              svgIcon=\"tcs-collaboration-delete\"></mat-icon>\n                    <mat-icon (click)=\"editNote(thread)\"\n                              class=\"tcs-icon tcs-icon-active tcs-collaboration-edit-buttons tcs-collaboration-edit-icon\"\n                              svgIcon=\"tcs-collaboration-edit\"></mat-icon>\n                  </div>\n                  <div class=\"tcs-collaboration-thread-icon-right\" fxLayoutAlign=\"end center\" fxLayoutGap=\"8px\">\n                    <span *ngIf=\"thread.note.thread.totalCount > 1\" class=\"tcs-collaboration-thread-replies\"\n                          (click)=\"toggleReplies(thread)\">{{thread.note.thread.totalCount - 1}} replies</span>\n                    <mat-icon (click)=\"toggleNewReply(thread)\" class=\"tcs-icon tcs-collaboration-reply-icon\"\n                              svgIcon=\"tcs-collaboration-reply\"></mat-icon>\n                  </div>\n                </div>\n              </div>\n              <div class=\"tcs-collaboration-line\"></div>\n              <!-- replies -->\n              <div class=\"tcs-collaboration-reply-box\" *ngIf=\"thread.showReplies\">\n                <div fxLayout=\"column\">\n                  <tcla-live-apps-notes-editor class=\"tcs-collaboration-new-reply-component\" *ngIf=\"thread.showNewReply\"\n                                               [isReply]=\"true\" [noteText]=\"thread.newReply.text\"\n                                               (noteSubmitted)=\"createReply(thread, $event)\"></tcla-live-apps-notes-editor>\n                  <div class=\"tcs-collaboration-line\"></div>\n                </div>\n                <div class=\"tcs-collaboration-detail-box tcs-collaboration-reply\"\n                     [ngClass]=\"{ editing: reply.editMode }\" *ngFor=\"let reply of thread.thread | reverse\"\n                     fxLayout=\"column\">\n                  <div class=\"tcs-thread-box\" fxLayout=\"row\">\n                    <mat-icon class=\"tcs-icon tcs-collaboration-reply-item-icon\"\n                              svgIcon=\"tcs-collaboration-reply\"></mat-icon>\n                    <div fxLayout=\"column\" class=\"tcs-collaboration-reply-details\">\n                      <div class=\"tcs-collaboration-entry\">\n                        <div *ngIf=\"!reply.editMode\">\n                          <div fxLayout=\"row\" fxLayoutAlign=\"space-between start\">\n                            <span class=\"tcs-collaboration-thread-author\">{{reply.createdByName}}</span>\n                            <span class=\"tcs-collaboration-thread-date\">{{reply.modifiedDate | durationSince}}</span>\n                          </div>\n                          <span class=\"tcs-collaboration-thread-text\" matTooltip=\"{{reply.text}}\"\n                                matTooltipShowDelay=\"1000\"\n                                matTooltipPosition=\"below\">{{reply.text | ellipsis: 60}}</span>\n                        </div>\n                        <tcla-live-apps-notes-editor *ngIf=\"reply.editMode\" [noteText]=\"reply.text\"\n                                                     (noteSubmitted)=\"updateNote(reply, $event)\"></tcla-live-apps-notes-editor>\n                      </div>\n                      <div class=\"tcs-icon-row\" fxLayout=\"row\" fxLayoutAlign=\"space-between center\">\n                        <div class=\"tcs-collaboration-thread-icon-left\">\n                          <mat-icon (click)=\"deleteNote(reply.id)\"\n                                    class=\"tcs-icon tcs-icon-active tcs-collaboration-edit-buttons tcs-collaboration-delete-icon\"\n                                    svgIcon=\"tcs-collaboration-delete\"></mat-icon>\n                          <mat-icon (click)=\"editNote(reply)\"\n                                    class=\"tcs-icon tcs-icon-active tcs-collaboration-edit-buttons tcs-collaboration-edit-icon\"\n                                    svgIcon=\"tcs-collaboration-edit\"></mat-icon>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  <div class=\"tcs-collaboration-reply-line\"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div *ngIf=\"!(threads?.threads?.length > 0)\" fxLayout=\"row\" fxLayoutAlign=\"center start\" fxLayoutGap=\"10px\"\n               style=\"margin-top: 20px;\">\n            <mat-icon [svgIcon]=\"'ic-no-notes-icon'\" style=\"height: 48px; width: 48px;\"></mat-icon>\n            <div style=\"height: 100%\" fxLayout=\"row\" fxLayoutAlign=\"start center\">\n              <span class=\"tcs-no-item-text\">No notes found</span>\n            </div>\n          </div>\n        </cdk-virtual-scroll-viewport>\n      </div>\n    </div>\n    <tcla-live-apps-notes-editor class=\"tcs-collaboration-new-note-component\" [noteText]=\"newNote.text\"\n                                 (noteSubmitted)=\"createThread($event)\"></tcla-live-apps-notes-editor>\n  </div>\n</div>\n",
                    styles: [".tcs-notes-pane{border-radius:3px;box-shadow:0 2px 4px 0 rgba(0,0,0,.33);background-color:#fff}.tcs-collaboration-pane{padding-top:10px}.tcs-collaboration-header{min-height:40px;height:40px;border-radius:3px 3px 0 0;box-shadow:0 1px 2px 0 #dedede;padding-left:20px;padding-right:20px}.tcs-collaboration-header-text{margin-left:10px;font-family:Source Sans Pro;font-size:18px;font-weight:600;font-style:normal;font-stretch:normal;line-height:1.5;letter-spacing:.3px}.tcs-collaboration-thread-icon-left{height:24px;width:50px}.tcs-collaboration-existing-threads{overflow-y:auto}.tcs-collaboration-detail-box{min-height:85px;flex-shrink:0}.tcs-collaboration-detail-box.editing{min-height:109px}.tcs-collaboration-detail-box.editing>.tcs-thread-box{height:110px;background-color:#eef0f7}.tcs-collaboration-new-reply-box{-webkit-transition:background-color .5s;transition:background-color .5s;background-color:#eef0f7;margin-left:20px;padding-right:20px}.tcs-collaboration-detail-box.tcs-collaboration-reply.editing{min-height:100px}.tcs-collaboration-reply{padding-left:20px}.tcs-thread-box{height:86px}.tcs-thread-box:hover{background-color:#eef0f7;-webkit-transition:background-color .5s;transition:background-color .5s}.tcs-thread-box:hover .tcs-icon.tcs-icon-active{display:inline-block}.tcs-thread-box .tcs-icon.tcs-icon-active{display:none}.tcs-collaboration-entry{padding:10px 20px}.tcs-icon-row{padding-left:20px;padding-right:20px;padding-bottom:5px}.tcs-collaboration-thread-author{font-size:14px;font-weight:600;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px}.tcs-collaboration-thread-text{font-size:11px;font-weight:400;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px}.tcs-collaboration-thread-date{font-size:10px;font-weight:600;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px;color:#b6b6b6}.tcs-collaboration-edited{font-size:10px;font-weight:600;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px;color:#ef5350;padding-right:4px}.tcs-collaboration-reply-icon{-webkit-transform:scale(-1,1);transform:scale(-1,1)}.tcs-collaboration-reply-item-icon{-webkit-transform:scale(1,-1);transform:scale(1,-1);margin-top:10px}.tcs-collaboration-reply-details{width:100%}.tcs-collaboration-thread-replies{font-size:12px;font-weight:600;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px;color:#0081cb}.tcs-icon{height:20px;width:20px}:host ::ng-deep .tcs-icon.tcs-collaboration-edit-buttons:hover path.svg-content{fill:#0081cb;cursor:pointer}:host ::ng-deep .tcs-icon.tcs-collaboration-edit-buttons:hover g.svg-content{fill:#0081cb;cursor:pointer}.tcs-icon.tcs-collaboration-edit-icon{margin-left:5px}.tcs-icon.tcs-collaboration-send-icon{height:24px;width:24px;margin-left:12px}:host ::ng-deep .tcs-icon.tcs-collaboration-send-icon:hover path.svg-content{fill:#0081cb}.tcs-collaboration-line{padding:0;margin:0 20px;border-bottom:1.1px solid #f4f4f4}.tcs-collaboration-reply-line{padding:0;margin-top:0;margin-right:20px;margin-bottom:0;border-bottom:1.1px solid #f4f4f4}.tcs-collaboration-new-thread{margin-left:20px;margin-right:20px;max-height:85px;height:85px;min-height:85px}.tcs-collaboration-edit-thread{margin-top:10px}.tcs-collaboration-new-reply{margin:10px 20px}.tcs-collaboration-input{height:55px;max-width:100%;border-color:#d5e6ff;font-size:11px;font-weight:400;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px;color:#b6b6b6;resize:none;border-radius:3px}.tcs-collaboration-reply-textbox{height:55px;max-width:100%;border-color:#d5e6ff;font-size:11px;font-weight:400;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px;color:#b6b6b6;resize:none;border-radius:3px;margin-top:20px;margin-bottom:20px}.tcs-collaboration-edit{height:55px;max-width:100%;border-color:#d5e6ff;font-size:11px;font-weight:400;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px;color:#b6b6b6;resize:none;border-radius:3px}.tcs-collaboration-new-thread-form{max-width:90%;max-height:100%}.tcs-collaboration-new-note-component,.tcs-collaboration-new-reply-component{height:85px;min-height:85px;max-height:85px;margin-left:20px;margin-right:20px}.tcs-no-item-text{font-family:Source Sans Pro;font-size:16px;font-weight:400;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:normal;color:#b6b6b6}"]
                }] }
    ];
    /** @nocollapse */
    LiveAppsNotesComponent.ctorParameters = function () { return [
        { type: LiveAppsService },
        { type: TcButtonsHelperService }
    ]; };
    LiveAppsNotesComponent.propDecorators = {
        relatedItemType: [{ type: Input }],
        relatedItemId: [{ type: Input }],
        userId: [{ type: Input }],
        showHeader: [{ type: Input }]
    };
    return LiveAppsNotesComponent;
}(LiveAppsComponent));
export { LiveAppsNotesComponent };
if (false) {
    /**
     * itemType for notes collection
     * @type {?}
     */
    LiveAppsNotesComponent.prototype.relatedItemType;
    /**
     * itemId for notes collection
     * @type {?}
     */
    LiveAppsNotesComponent.prototype.relatedItemId;
    /**
     * The ID of the logged user
     * @type {?}
     */
    LiveAppsNotesComponent.prototype.userId;
    /**
     * Whether to show the header bar in the widget - eg. favorites on home page (contains icon etc) - if off icons still appear without bar
     * @type {?}
     */
    LiveAppsNotesComponent.prototype.showHeader;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.notes;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.errorMessage;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.newNote;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.newNoteId;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.delNoteId;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.threads;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.subscribed;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.skip;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.top;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.end;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.toolbarButtons;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.refresh;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.getBatch;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.toggleReplies;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.toggleNewReply;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.createReply;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.createThread;
    /**
     * @type {?}
     * @protected
     */
    LiveAppsNotesComponent.prototype.createToolbarButtons;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.setupNotificationButtons;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.updateButtonDef;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.handleToolbarButtonEvent;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.recreateButtonsForNotifications;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.getNotifications;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.subscribe;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.unsubscribe;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.editNote;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.updateNote;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.deleteNote;
    /**
     * @type {?}
     * @protected
     */
    LiveAppsNotesComponent.prototype.liveapps;
    /**
     * @type {?}
     * @protected
     */
    LiveAppsNotesComponent.prototype.buttonsHelper;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLW5vdGVzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0aWJjby10Y3N0ay90Yy1saXZlYXBwcy1saWIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9saXZlLWFwcHMtbm90ZXMvbGl2ZS1hcHBzLW5vdGVzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsS0FBSyxFQUFvQixNQUFNLGVBQWUsQ0FBQztBQUVsRSxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sa0NBQWtDLENBQUM7QUFDakUsT0FBTyxFQUFNLElBQUksRUFBRSxTQUFTLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUVwRCxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxzREFBc0QsQ0FBQztBQUV2RixPQUFPLEVBQUMsc0JBQXNCLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQzs7Ozs7Ozs7Ozs7QUFhaEU7SUFNNEMsa0RBQWlCO0lBaUMzRCxnQ0FBc0IsUUFBeUIsRUFBWSxhQUFxQztRQUFoRyxZQUNFLGlCQUFPLFNBQ1I7UUFGcUIsY0FBUSxHQUFSLFFBQVEsQ0FBaUI7UUFBWSxtQkFBYSxHQUFiLGFBQWEsQ0FBd0I7Ozs7UUFkdkYsZ0JBQVUsR0FBWSxLQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxLQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFJakUsYUFBTyxHQUFRLEVBQUUsQ0FBQztRQUtsQixVQUFJLEdBQUcsQ0FBQyxDQUFDO1FBQ1QsU0FBRyxHQUFHLEVBQUUsQ0FBQztRQUNULFNBQUcsR0FBRyxLQUFLLENBQUM7UUFDWixvQkFBYyxHQUFvQixFQUFFLENBQUM7UUFNckMsYUFBTzs7O1FBQUc7WUFDZixLQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztZQUNkLEtBQUksQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDO1lBQ2QsS0FBSSxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUM7WUFDakIsSUFBSSxLQUFJLENBQUMsT0FBTyxJQUFJLEtBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFO2dCQUN4QyxLQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO2FBQ2pDO1lBQ0QsS0FBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ2hCLEtBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQzFCLENBQUMsRUFBQTtRQUVNLGNBQVE7OztRQUFHO1lBQ2hCLElBQUksQ0FBQyxLQUFJLENBQUMsR0FBRyxFQUFFO2dCQUNiLEtBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEtBQUksQ0FBQyxlQUFlLEVBQUUsS0FBSSxDQUFDLGFBQWEsRUFBRSxLQUFJLENBQUMsSUFBSSxFQUFFLEtBQUksQ0FBQyxHQUFHLENBQUM7cUJBQ3BGLElBQUksQ0FDSCxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQ1AsU0FBUyxDQUFDLEtBQUksQ0FBQyxXQUFXLENBQUMsQ0FDNUIsQ0FBQyxTQUFTOzs7O2dCQUFDLFVBQUEsVUFBVTtvQkFDdEIsSUFBSSxDQUFDLEtBQUksQ0FBQyxPQUFPLEVBQUU7d0JBQ2pCLEtBQUksQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDO3FCQUMzQjt5QkFBTTs7OzRCQUVDLGNBQWMsR0FBRyxVQUFVLENBQUMsT0FBTyxDQUFDLE1BQU07Ozs7d0JBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxLQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLOzs7O3dCQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQXZCLENBQXVCLEVBQUMsRUFBeEQsQ0FBd0QsRUFBQzt3QkFDL0csS0FBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsS0FBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDO3FCQUNwRTtvQkFDRCxJQUFJLFVBQVUsQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLEtBQUksQ0FBQyxHQUFHLEVBQUU7d0JBQ3hDLEtBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDO3FCQUNqQjt5QkFBTTt3QkFDTCxLQUFJLENBQUMsSUFBSSxHQUFHLEtBQUksQ0FBQyxJQUFJLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO3FCQUN2RDtnQkFDSCxDQUFDOzs7O2dCQUFFLFVBQUEsS0FBSztvQkFDTixLQUFJLENBQUMsWUFBWSxHQUFHLDBCQUEwQixHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDO2dCQUN4RSxDQUFDLEVBQUMsQ0FBQzthQUNKO1FBQ0gsQ0FBQyxFQUFBO1FBRU0sbUJBQWE7Ozs7UUFBRyxVQUFDLE1BQU07WUFDNUIsTUFBTSxDQUFDLFdBQVcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUM7UUFDM0MsQ0FBQyxFQUFBO1FBRU0sb0JBQWM7Ozs7UUFBRyxVQUFDLE1BQU07WUFDN0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUU7Z0JBQ3BCLE1BQU0sQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO2FBQ3RCO1lBQ0QsSUFBSSxNQUFNLENBQUMsV0FBVyxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRTtnQkFDOUMsTUFBTSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7Z0JBQ3JCLE1BQU0sQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO2FBQzVCO2lCQUFNO2dCQUNMLE1BQU0sQ0FBQyxZQUFZLEdBQUcsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDO2dCQUMzQyxNQUFNLENBQUMsV0FBVyxHQUFHLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQzthQUMxQztRQUVILENBQUMsRUFBQTtRQUVNLGlCQUFXOzs7OztRQUFHLFVBQUMsTUFBTSxFQUFFLFNBQVM7WUFDckMsS0FBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7aUJBQ2xFLElBQUksQ0FDSCxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQ1AsU0FBUyxDQUFDLEtBQUksQ0FBQyxXQUFXLENBQUMsQ0FDNUI7aUJBQ0EsU0FBUzs7OztZQUFDLFVBQUEsTUFBTTtnQkFDZixLQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQztnQkFDeEIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEdBQUcsU0FBUyxDQUFDO2dCQUNqQyxLQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDakIsQ0FBQzs7OztZQUFFLFVBQUEsS0FBSyxJQUFJLE9BQUEsS0FBSSxDQUFDLFlBQVksR0FBRywyQkFBMkIsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBMUUsQ0FBMEUsRUFBQyxDQUFDO1FBQzVGLENBQUMsRUFBQTtRQUVNLGtCQUFZOzs7O1FBQUcsVUFBQyxRQUFRO1lBQzdCLElBQUksUUFBUSxLQUFLLFNBQVMsRUFBRTtnQkFDMUIsS0FBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsS0FBSSxDQUFDLGVBQWUsRUFBRSxTQUFTLEVBQUUsS0FBSSxDQUFDLGFBQWEsRUFBRSxpQkFBaUIsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLFFBQVEsQ0FBQztxQkFDL0csSUFBSSxDQUNILElBQUksQ0FBQyxDQUFDLENBQUMsRUFDUCxTQUFTLENBQUMsS0FBSSxDQUFDLFdBQVcsQ0FBQyxDQUM1QjtxQkFDQSxTQUFTOzs7O2dCQUFDLFVBQUEsTUFBTTtvQkFDZixLQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQztvQkFDeEIsS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsU0FBUyxDQUFDO29CQUM5QixLQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ2pCLENBQUM7Ozs7Z0JBQUUsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFJLENBQUMsWUFBWSxHQUFHLDJCQUEyQixHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUExRSxDQUEwRSxFQUFDLENBQUM7YUFDM0Y7UUFDSCxDQUFDLEVBQUE7UUFHUywwQkFBb0I7Ozs7UUFBRyxVQUFDLFVBQVU7O2dCQUNwQyxlQUFlLEdBQWtCLEtBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUNwRSxXQUFXLEVBQUUsZ0NBQWdDLEVBQUUsSUFBSSxFQUFFLHNCQUFzQixFQUFFLENBQUMsVUFBVSxFQUFFLENBQUMsVUFBVSxDQUFDOztnQkFDbEcsaUJBQWlCLEdBQWtCLEtBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUN0RSxhQUFhLEVBQUUsOEJBQThCLEVBQUUsSUFBSSxFQUFFLHVCQUF1QixFQUFFLFVBQVUsRUFBRSxVQUFVLENBQUM7O2dCQUNqRyxPQUFPLEdBQUcsQ0FBRSxlQUFlLEVBQUUsaUJBQWlCLENBQUU7WUFDdEQsT0FBTyxPQUFPLENBQUM7UUFDakIsQ0FBQyxFQUFBO1FBRU0sOEJBQXdCOzs7O1FBQUcsVUFBQyxVQUFtQjs7Z0JBQzlDLE9BQU8sR0FBb0IsS0FBSSxDQUFDLG9CQUFvQixDQUFDLFVBQVUsQ0FBQztZQUN0RSxLQUFJLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEVBQUUsS0FBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ2pFLENBQUMsRUFBQTtRQUVNLHFCQUFlOzs7O1FBQUcsVUFBQyxxQkFBc0M7WUFDOUQscUJBQXFCLENBQUMsT0FBTzs7OztZQUFFLFVBQUEsYUFBYTs7b0JBQ3BDLEdBQUcsR0FBRyxLQUFJLENBQUMsY0FBYyxDQUFDLFNBQVM7Ozs7Z0JBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLENBQUMsRUFBRSxLQUFLLGFBQWEsQ0FBQyxFQUFFLEVBQTVCLENBQTRCLEVBQUM7Z0JBQy9FLEtBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEdBQUcsYUFBYSxDQUFDO1lBQzNDLENBQUMsRUFBQyxDQUFDO1FBQ0wsQ0FBQyxFQUFBO1FBRU0sOEJBQXdCOzs7O1FBQUcsVUFBQyxFQUFFO1lBQ25DLElBQUksRUFBRSxLQUFLLFdBQVcsRUFBRTtnQkFDdEIsS0FBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO2FBQ2xCO2lCQUFNLElBQUksRUFBRSxLQUFLLGFBQWEsRUFBRTtnQkFDL0IsS0FBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO2FBQ3BCO1FBQ0gsQ0FBQyxFQUFBO1FBRU0scUNBQStCOzs7O1FBQUcsVUFBQyxVQUFVOztnQkFDMUMsT0FBTyxHQUFvQixLQUFJLENBQUMsb0JBQW9CLENBQUMsVUFBVSxDQUFDO1lBQ3RFLEtBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxLQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDbkUsQ0FBQyxFQUFBO1FBRU0sc0JBQWdCOzs7UUFBRztZQUN4QixLQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLEtBQUksQ0FBQyxlQUFlLEVBQUUsS0FBSSxDQUFDLGFBQWEsRUFBRSxLQUFJLENBQUMsTUFBTSxDQUFDO2lCQUNsRixJQUFJLENBQ0gsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNQLFNBQVMsQ0FBQyxLQUFJLENBQUMsV0FBVyxDQUFDLENBQzVCO2lCQUNBLFNBQVM7Ozs7WUFBQyxVQUFBLE1BQU07O29CQUNULGdCQUFnQixHQUFxQixNQUFNO2dCQUNqRCxJQUFJLGdCQUFnQixDQUFDLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO29CQUM3QyxLQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztvQkFDdkIsS0FBSSxDQUFDLHdCQUF3QixDQUFDLElBQUksQ0FBQyxDQUFDO2lCQUNyQztxQkFBTTtvQkFDTCxLQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztvQkFDeEIsS0FBSSxDQUFDLHdCQUF3QixDQUFDLEtBQUssQ0FBQyxDQUFDO2lCQUN0QztZQUNILENBQUM7Ozs7WUFBRSxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUksQ0FBQyxZQUFZLEdBQUcsMkJBQTJCLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQTFFLENBQTBFLEVBQUMsQ0FBQztRQUM1RixDQUFDLEVBQUE7UUFFTSxlQUFTOzs7UUFBRztZQUNqQixLQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLEtBQUksQ0FBQyxlQUFlLEVBQUUsS0FBSSxDQUFDLGFBQWEsQ0FBQztpQkFDckUsSUFBSSxDQUNILElBQUksQ0FBQyxDQUFDLENBQUMsRUFDUCxTQUFTLENBQUMsS0FBSSxDQUFDLFdBQVcsQ0FBQyxDQUM1QjtpQkFDQSxTQUFTOzs7O1lBQUMsVUFBQSxNQUFNO2dCQUNmLElBQUksTUFBTSxFQUFFO29CQUNWLEtBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO29CQUN2QixLQUFJLENBQUMsK0JBQStCLENBQUMsSUFBSSxDQUFDLENBQUM7aUJBQzVDO1lBQ0gsQ0FBQzs7OztZQUFFLFVBQUEsS0FBSyxJQUFJLE9BQUEsS0FBSSxDQUFDLFlBQVksR0FBRywyQkFBMkIsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBMUUsQ0FBMEUsRUFBQyxDQUFDO1FBQzVGLENBQUMsRUFBQTtRQUVNLGlCQUFXOzs7UUFBRztZQUNuQixLQUFJLENBQUMsUUFBUSxDQUFDLGtCQUFrQixDQUFDLEtBQUksQ0FBQyxlQUFlLEVBQUUsS0FBSSxDQUFDLGFBQWEsRUFBRSxLQUFJLENBQUMsTUFBTSxDQUFDO2lCQUNwRixJQUFJLENBQ0gsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNQLFNBQVMsQ0FBQyxLQUFJLENBQUMsV0FBVyxDQUFDLENBQzVCO2lCQUNBLFNBQVM7Ozs7WUFBQyxVQUFBLE1BQU07Z0JBQ2YsS0FBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7Z0JBQ3hCLEtBQUksQ0FBQywrQkFBK0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM5QyxDQUFDOzs7O1lBQUUsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFJLENBQUMsWUFBWSxHQUFHLDJCQUEyQixHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUExRSxDQUEwRSxFQUFDLENBQUM7UUFDNUYsQ0FBQyxFQUFBO1FBRU0sY0FBUTs7OztRQUFHLFVBQUMsTUFBTTtZQUN2QixNQUFNLENBQUMsUUFBUSxHQUFHLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQztRQUNyQyxDQUFDLEVBQUE7UUFFTSxnQkFBVTs7Ozs7UUFBRyxVQUFDLElBQUksRUFBRSxXQUFXO1lBQ3BDLE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDN0IsSUFBSSxDQUFDLElBQUksR0FBRyxXQUFXLENBQUM7WUFDeEIsS0FBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUM7aUJBQ3BDLElBQUksQ0FDSCxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQ1AsU0FBUyxDQUFDLEtBQUksQ0FBQyxXQUFXLENBQUMsQ0FDNUI7aUJBQ0EsU0FBUzs7OztZQUFDLFVBQUEsTUFBTTtnQkFDZixPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDO2dCQUM1QixLQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDakIsQ0FBQzs7OztZQUFFLFVBQUEsS0FBSyxJQUFJLE9BQUEsS0FBSSxDQUFDLFlBQVksR0FBRyx1QkFBdUIsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBdEUsQ0FBc0UsRUFBQyxDQUFDO1FBQ3hGLENBQUMsRUFBQTtRQUVNLGdCQUFVOzs7O1FBQUcsVUFBQyxFQUFFO1lBQ3JCLE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDN0IsS0FBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDO2lCQUN6QixJQUFJLENBQ0gsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNQLFNBQVMsQ0FBQyxLQUFJLENBQUMsV0FBVyxDQUFDLENBQzVCO2lCQUNBLFNBQVM7Ozs7WUFBQyxVQUFBLE1BQU07Z0JBQ2YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsQ0FBQztnQkFDdkMsS0FBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ2pCLENBQUM7Ozs7WUFBRSxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUksQ0FBQyxZQUFZLEdBQUcsMkJBQTJCLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQTFFLENBQTBFLEVBQUMsQ0FBQztRQUM1RixDQUFDLEVBQUE7O0lBaE1ELENBQUM7Ozs7SUFrTUQseUNBQVE7OztJQUFSO1FBQ0Usa0JBQWtCO1FBQ2xCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUV6QixDQUFDOztnQkEvT0YsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxzQkFBc0I7b0JBQ2hDLDgxUEFBK0M7O2lCQUVoRDs7OztnQkF0Qk8sZUFBZTtnQkFLZixzQkFBc0I7OztrQ0F1QjNCLEtBQUs7Z0NBS0wsS0FBSzt5QkFLTCxLQUFLOzZCQUtMLEtBQUs7O0lBd05SLDZCQUFDO0NBQUEsQUFqUEQsQ0FNNEMsaUJBQWlCLEdBMk81RDtTQTNPWSxzQkFBc0I7Ozs7OztJQUlqQyxpREFBaUM7Ozs7O0lBS2pDLCtDQUErQjs7Ozs7SUFLL0Isd0NBQXdCOzs7OztJQUt4Qiw0Q0FBd0U7O0lBRXhFLHVDQUFxQjs7SUFDckIsOENBQTRCOztJQUM1Qix5Q0FBeUI7O0lBQ3pCLDJDQUF5Qjs7SUFDekIsMkNBQXlCOztJQUN6Qix5Q0FBMkI7O0lBQzNCLDRDQUEyQjs7SUFDM0Isc0NBQWdCOztJQUNoQixxQ0FBZ0I7O0lBQ2hCLHFDQUFtQjs7SUFDbkIsZ0RBQTRDOztJQU01Qyx5Q0FTQzs7SUFFRCwwQ0F1QkM7O0lBRUQsK0NBRUM7O0lBRUQsZ0RBWUM7O0lBRUQsNkNBV0M7O0lBRUQsOENBYUM7Ozs7O0lBR0Qsc0RBT0M7O0lBRUQsMERBR0M7O0lBRUQsaURBS0M7O0lBRUQsMERBTUM7O0lBRUQsaUVBR0M7O0lBRUQsa0RBZ0JDOztJQUVELDJDQVlDOztJQUVELDZDQVVDOztJQUVELDBDQUVDOztJQUVELDRDQVlDOztJQUVELDRDQVdDOzs7OztJQWxNVywwQ0FBbUM7Ozs7O0lBQUUsK0NBQStDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1N1YmplY3R9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtMaXZlQXBwc1NlcnZpY2V9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2xpdmUtYXBwcy5zZXJ2aWNlJztcbmltcG9ydCB7bWFwLCB0YWtlLCB0YWtlVW50aWx9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7Tm90ZSwgTm90ZVRocmVhZCwgTm90aWZpY2F0aW9uTGlzdCwgVGhyZWFkTGlzdH0gZnJvbSAnLi4vLi4vbW9kZWxzL2xpdmVhcHBzZGF0YSc7XG5pbXBvcnQge0xpdmVBcHBzQ29tcG9uZW50fSBmcm9tICcuLi9saXZlLWFwcHMtY29tcG9uZW50L2xpdmUtYXBwcy1jb21wb25lbnQuY29tcG9uZW50JztcbmltcG9ydCB7VG9vbGJhckJ1dHRvbn0gZnJvbSAnQHRpYmNvLXRjc3RrL3RjLWNvcmUtbGliJztcbmltcG9ydCB7VGNCdXR0b25zSGVscGVyU2VydmljZX0gZnJvbSAnQHRpYmNvLXRjc3RrL3RjLWNvcmUtbGliJztcblxuXG4vKipcbiAqIFRoaXMgQ29tcG9uZW50IGFsbG93cyB0byBsaXN0LCBhbmQgYWRkIE5vdGVzIHRvIGEgQ2FzZS1JbnN0YW5jZSBvciBvdGhlciBDb250ZXh0IGUuZy4gYSB3aG9sZSBBcHBsaWNhdGlvbi5cbiAqIEFueSBOb3RlIGNhbiBoYXZlIFN1Yi1Ob3RlcyB0byBhbGxvdyByZWFsIGNvbGxhYm9yYXRpb24uXG4gKlxuICogTm90ZSB0aGF0IHNpbmNlIHRoaXMgY29tcG9uZW50IHVzZXMgYSB2aXJ0dWFsIHNjcm9sbCB0aGUgcGFyZW50IGNvbnRhaW5lciBtdXN0IGhhdmUgaGVpZ2h0IHNldCBvciB0aGUgbm90ZXMgd29uJ3QgYXBwZWFyXG4gKlxuICogIVthbHQtdGV4dF0oLi4vbGl2ZS1hcHBzLW5vdGVzLnBuZyBcIk5vdGVzIENvbXBvbmVudCBJbWFnZVwiKVxuICpcbiAqQGV4YW1wbGUgPHRjbGEtbGl2ZS1hcHBzLW5vdGVzPjwvdGNsYS1saXZlLWFwcHMtbm90ZXM+XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RjbGEtbGl2ZS1hcHBzLW5vdGVzJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2xpdmUtYXBwcy1ub3Rlcy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2xpdmUtYXBwcy1ub3Rlcy5jb21wb25lbnQuY3NzJ11cbn0pXG5cbmV4cG9ydCBjbGFzcyBMaXZlQXBwc05vdGVzQ29tcG9uZW50IGV4dGVuZHMgTGl2ZUFwcHNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAvKipcbiAgICogaXRlbVR5cGUgZm9yIG5vdGVzIGNvbGxlY3Rpb25cbiAgICovXG4gIEBJbnB1dCgpIHJlbGF0ZWRJdGVtVHlwZTogc3RyaW5nOyAvLyB1c2UgJ0NBU0VfQVBQJyB0byBzaGFyZSBub3RlcyB3aXRoIGNhc2UgbWFuYWdlclxuXG4gIC8qKlxuICAgKiBpdGVtSWQgZm9yIG5vdGVzIGNvbGxlY3Rpb25cbiAgICovXG4gIEBJbnB1dCgpIHJlbGF0ZWRJdGVtSWQ6IHN0cmluZzsgLy8gJ2Nhc2VSZWYnIGZvciBjYXNlIHJlbGF0ZWRcblxuICAvKipcbiAgICogVGhlIElEIG9mIHRoZSBsb2dnZWQgdXNlclxuICAgKi9cbiAgQElucHV0KCkgdXNlcklkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gc2hvdyB0aGUgaGVhZGVyIGJhciBpbiB0aGUgd2lkZ2V0IC0gZWcuIGZhdm9yaXRlcyBvbiBob21lIHBhZ2UgKGNvbnRhaW5zIGljb24gZXRjKSAtIGlmIG9mZiBpY29ucyBzdGlsbCBhcHBlYXIgd2l0aG91dCBiYXJcbiAgICovXG4gIEBJbnB1dCgpIHNob3dIZWFkZXI6IGJvb2xlYW4gPSB0aGlzLnNob3dIZWFkZXIgPyB0aGlzLnNob3dIZWFkZXIgOiB0cnVlO1xuXG4gIHB1YmxpYyBub3RlczogTm90ZVtdO1xuICBwdWJsaWMgZXJyb3JNZXNzYWdlOiBzdHJpbmc7XG4gIHB1YmxpYyBuZXdOb3RlOiBhbnkgPSB7fTtcbiAgcHVibGljIG5ld05vdGVJZDogbnVtYmVyO1xuICBwdWJsaWMgZGVsTm90ZUlkOiBudW1iZXI7XG4gIHB1YmxpYyB0aHJlYWRzOiBUaHJlYWRMaXN0O1xuICBwdWJsaWMgc3Vic2NyaWJlZDogQm9vbGVhbjtcbiAgcHVibGljIHNraXAgPSAwO1xuICBwdWJsaWMgdG9wID0gMjA7XG4gIHB1YmxpYyBlbmQgPSBmYWxzZTtcbiAgcHVibGljIHRvb2xiYXJCdXR0b25zOiBUb29sYmFyQnV0dG9uW10gPSBbXTtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgbGl2ZWFwcHM6IExpdmVBcHBzU2VydmljZSwgcHJvdGVjdGVkIGJ1dHRvbnNIZWxwZXI6IFRjQnV0dG9uc0hlbHBlclNlcnZpY2UpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgcHVibGljIHJlZnJlc2ggPSAoKSA9PiB7XG4gICAgdGhpcy5za2lwID0gMDtcbiAgICB0aGlzLnRvcCA9IDIwO1xuICAgIHRoaXMuZW5kID0gZmFsc2U7XG4gICAgaWYgKHRoaXMudGhyZWFkcyAmJiB0aGlzLnRocmVhZHMudGhyZWFkcykge1xuICAgICAgdGhpcy50aHJlYWRzLnRocmVhZHMubGVuZ3RoID0gMDtcbiAgICB9XG4gICAgdGhpcy5nZXRCYXRjaCgpO1xuICAgIHRoaXMuZ2V0Tm90aWZpY2F0aW9ucygpO1xuICB9XG5cbiAgcHVibGljIGdldEJhdGNoID0gKCkgPT4ge1xuICAgIGlmICghdGhpcy5lbmQpIHtcbiAgICAgIHRoaXMubGl2ZWFwcHMuZ2V0VGhyZWFkcyh0aGlzLnJlbGF0ZWRJdGVtVHlwZSwgdGhpcy5yZWxhdGVkSXRlbUlkLCB0aGlzLnNraXAsIHRoaXMudG9wKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICB0YWtlKDEpLFxuICAgICAgICAgIHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQkKVxuICAgICAgICApLnN1YnNjcmliZSh0aHJlYWRMaXN0ID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLnRocmVhZHMpIHtcbiAgICAgICAgICB0aGlzLnRocmVhZHMgPSB0aHJlYWRMaXN0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIHRoaXMgd2lsbCBzdHJpcCBhbnkgZHVwbGljYXRlcyB0aGF0IG1heSBoYXZlIGJlZW4gcmV0cmlldmVkIGR1ZSB0byBmYXN0IHNjcm9sbGluZ1xuICAgICAgICAgIGNvbnN0IGZpbHRlcmVkRXZlbnRzID0gdGhyZWFkTGlzdC50aHJlYWRzLmZpbHRlcih4ID0+IHRoaXMudGhyZWFkcy50aHJlYWRzLmV2ZXJ5KHkgPT4geS5ub3RlLmlkICE9PSB4Lm5vdGUuaWQpKTtcbiAgICAgICAgICB0aGlzLnRocmVhZHMudGhyZWFkcyA9IHRoaXMudGhyZWFkcy50aHJlYWRzLmNvbmNhdChmaWx0ZXJlZEV2ZW50cyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRocmVhZExpc3QudGhyZWFkcy5sZW5ndGggPCB0aGlzLnRvcCkge1xuICAgICAgICAgIHRoaXMuZW5kID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnNraXAgPSB0aGlzLnNraXAgKyB0aHJlYWRMaXN0LnRocmVhZHMubGVuZ3RoIC0gMTtcbiAgICAgICAgfVxuICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9ICdFcnJvciByZXRyaWV2aW5nIG5vdGVzOiAnICsgZXJyb3IuZXJyb3IuZXJyb3JNc2c7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgdG9nZ2xlUmVwbGllcyA9ICh0aHJlYWQpID0+IHtcbiAgICB0aHJlYWQuc2hvd1JlcGxpZXMgPSAhdGhyZWFkLnNob3dSZXBsaWVzO1xuICB9XG5cbiAgcHVibGljIHRvZ2dsZU5ld1JlcGx5ID0gKHRocmVhZCkgPT4ge1xuICAgIGlmICghdGhyZWFkLm5ld1JlcGx5KSB7XG4gICAgICB0aHJlYWQubmV3UmVwbHkgPSB7fTtcbiAgICB9XG4gICAgaWYgKHRocmVhZC5zaG93UmVwbGllcyAmJiAhdGhyZWFkLnNob3dOZXdSZXBseSkge1xuICAgICAgdGhyZWFkLm5ld1JlcGx5ID0ge307XG4gICAgICB0aHJlYWQuc2hvd05ld1JlcGx5ID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyZWFkLnNob3dOZXdSZXBseSA9ICF0aHJlYWQuc2hvd05ld1JlcGx5O1xuICAgICAgdGhyZWFkLnNob3dSZXBsaWVzID0gIXRocmVhZC5zaG93UmVwbGllcztcbiAgICB9XG5cbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGVSZXBseSA9ICh0aHJlYWQsIHJlcGx5VGV4dCkgPT4ge1xuICAgIHRoaXMubGl2ZWFwcHMuY3JlYXRlUmVwbHlOb3RlKHRocmVhZC5ub3RlLCByZXBseVRleHQsIHRocmVhZC5ub3RlLmlkKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRha2UoMSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQkKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZShyZXN1bHQgPT4ge1xuICAgICAgICB0aGlzLm5ld05vdGVJZCA9IHJlc3VsdDtcbiAgICAgICAgdGhyZWFkLm5ld1JlcGx5LnRleHQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgICAgfSwgZXJyb3IgPT4gdGhpcy5lcnJvck1lc3NhZ2UgPSAnRXJyb3IgY3JlYXRpbmcgbmV3IG5vdGU6ICcgKyBlcnJvci5lcnJvci5lcnJvck1lc3NhZ2UpO1xuICB9XG5cbiAgcHVibGljIGNyZWF0ZVRocmVhZCA9IChub3RlVGV4dCkgPT4ge1xuICAgIGlmIChub3RlVGV4dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLmxpdmVhcHBzLmNyZWF0ZU5vdGUodGhpcy5yZWxhdGVkSXRlbVR5cGUsICdSVF9DQVNFJywgdGhpcy5yZWxhdGVkSXRlbUlkLCAnY29tbWVudHMgdXBkYXRlJywgJycsICcnLCBub3RlVGV4dClcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgICB0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkJClcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKHJlc3VsdCA9PiB7XG4gICAgICAgICAgdGhpcy5uZXdOb3RlSWQgPSByZXN1bHQ7XG4gICAgICAgICAgdGhpcy5uZXdOb3RlLnRleHQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgIH0sIGVycm9yID0+IHRoaXMuZXJyb3JNZXNzYWdlID0gJ0Vycm9yIGNyZWF0aW5nIG5ldyBub3RlOiAnICsgZXJyb3IuZXJyb3IuZXJyb3JNZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuXG4gIHByb3RlY3RlZCBjcmVhdGVUb29sYmFyQnV0dG9ucyA9IChzdWJzY3JpYmVkKTogVG9vbGJhckJ1dHRvbltdID0+IHtcbiAgICBjb25zdCBzdWJzY3JpYmVCdXR0b246IFRvb2xiYXJCdXR0b24gPSB0aGlzLmJ1dHRvbnNIZWxwZXIuY3JlYXRlQnV0dG9uKFxuICAgICAgJ3N1YnNjcmliZScsICd0Y3MtY29sbGFib3JhdGlvbi11bnN1YnNjcmliZWQnLCB0cnVlLCAnRW5hYmxlIE5vdGlmaWNhdGlvbnMnLCAhc3Vic2NyaWJlZCwgIXN1YnNjcmliZWQpO1xuICAgIGNvbnN0IHVuU3Vic2NyaWJlQnV0dG9uOiBUb29sYmFyQnV0dG9uID0gdGhpcy5idXR0b25zSGVscGVyLmNyZWF0ZUJ1dHRvbihcbiAgICAgICd1bnN1YnNjcmliZScsICd0Y3MtY29sbGFib3JhdGlvbi1zdWJzY3JpYmVkJywgdHJ1ZSwgJ0Rpc2FibGUgTm90aWZpY2F0aW9ucycsIHN1YnNjcmliZWQsIHN1YnNjcmliZWQpO1xuICAgIGNvbnN0IGJ1dHRvbnMgPSBbIHN1YnNjcmliZUJ1dHRvbiwgdW5TdWJzY3JpYmVCdXR0b24gXTtcbiAgICByZXR1cm4gYnV0dG9ucztcbiAgfVxuXG4gIHB1YmxpYyBzZXR1cE5vdGlmaWNhdGlvbkJ1dHRvbnMgPSAoc3Vic2NyaWJlZDogYm9vbGVhbikgPT4ge1xuICAgIGNvbnN0IGJ1dHRvbnM6IFRvb2xiYXJCdXR0b25bXSA9IHRoaXMuY3JlYXRlVG9vbGJhckJ1dHRvbnMoc3Vic2NyaWJlZCk7XG4gICAgdGhpcy5idXR0b25zSGVscGVyLnVwZGF0ZUJ1dHRvbnMoYnV0dG9ucywgdGhpcy50b29sYmFyQnV0dG9ucyk7XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlQnV0dG9uRGVmID0gKHVwZGF0ZWRUb29sYmFyQnV0dG9uczogVG9vbGJhckJ1dHRvbltdKSA9PiB7XG4gICAgdXBkYXRlZFRvb2xiYXJCdXR0b25zLmZvckVhY2goIHVwZGF0ZWRCdXR0b24gPT4ge1xuICAgICAgY29uc3QgaWR4ID0gdGhpcy50b29sYmFyQnV0dG9ucy5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmlkID09PSB1cGRhdGVkQnV0dG9uLmlkKTtcbiAgICAgIHRoaXMudG9vbGJhckJ1dHRvbnNbaWR4XSA9IHVwZGF0ZWRCdXR0b247XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgaGFuZGxlVG9vbGJhckJ1dHRvbkV2ZW50ID0gKGlkKSA9PiB7XG4gICAgaWYgKGlkID09PSAnc3Vic2NyaWJlJykge1xuICAgICAgdGhpcy5zdWJzY3JpYmUoKTtcbiAgICB9IGVsc2UgaWYgKGlkID09PSAndW5zdWJzY3JpYmUnKSB7XG4gICAgICB0aGlzLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHJlY3JlYXRlQnV0dG9uc0Zvck5vdGlmaWNhdGlvbnMgPSAoc3Vic2NyaWJlZCkgPT4ge1xuICAgICAgY29uc3QgYnV0dG9uczogVG9vbGJhckJ1dHRvbltdID0gdGhpcy5jcmVhdGVUb29sYmFyQnV0dG9ucyhzdWJzY3JpYmVkKTtcbiAgICAgIHRoaXMuYnV0dG9uc0hlbHBlci51cGRhdGVCdXR0b25zKGJ1dHRvbnMsIHRoaXMudG9vbGJhckJ1dHRvbnMpO1xuICB9XG5cbiAgcHVibGljIGdldE5vdGlmaWNhdGlvbnMgPSAoKSA9PiB7XG4gICAgdGhpcy5saXZlYXBwcy5nZXROb3RpZmljYXRpb25zKHRoaXMucmVsYXRlZEl0ZW1UeXBlLCB0aGlzLnJlbGF0ZWRJdGVtSWQsIHRoaXMudXNlcklkKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRha2UoMSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQkKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZShyZXN1bHQgPT4ge1xuICAgICAgICBjb25zdCBub3RpZmljYXRpb25MaXN0OiBOb3RpZmljYXRpb25MaXN0ID0gcmVzdWx0O1xuICAgICAgICBpZiAobm90aWZpY2F0aW9uTGlzdC5ub3RpZmljYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB0aGlzLnN1YnNjcmliZWQgPSB0cnVlO1xuICAgICAgICAgIHRoaXMuc2V0dXBOb3RpZmljYXRpb25CdXR0b25zKHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuc3Vic2NyaWJlZCA9IGZhbHNlO1xuICAgICAgICAgIHRoaXMuc2V0dXBOb3RpZmljYXRpb25CdXR0b25zKGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgfSwgZXJyb3IgPT4gdGhpcy5lcnJvck1lc3NhZ2UgPSAnRXJyb3IgY3JlYXRpbmcgbmV3IG5vdGU6ICcgKyBlcnJvci5lcnJvci5lcnJvck1lc3NhZ2UpO1xuICB9XG5cbiAgcHVibGljIHN1YnNjcmliZSA9ICgpID0+IHtcbiAgICB0aGlzLmxpdmVhcHBzLnN1YnNjcmliZVRvTm90ZXModGhpcy5yZWxhdGVkSXRlbVR5cGUsIHRoaXMucmVsYXRlZEl0ZW1JZClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YWtlKDEpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkJClcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUocmVzdWx0ID0+IHtcbiAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgIHRoaXMuc3Vic2NyaWJlZCA9IHRydWU7XG4gICAgICAgICAgdGhpcy5yZWNyZWF0ZUJ1dHRvbnNGb3JOb3RpZmljYXRpb25zKHRydWUpO1xuICAgICAgICB9XG4gICAgICB9LCBlcnJvciA9PiB0aGlzLmVycm9yTWVzc2FnZSA9ICdFcnJvciBjcmVhdGluZyBuZXcgbm90ZTogJyArIGVycm9yLmVycm9yLmVycm9yTWVzc2FnZSk7XG4gIH1cblxuICBwdWJsaWMgdW5zdWJzY3JpYmUgPSAoKSA9PiB7XG4gICAgdGhpcy5saXZlYXBwcy51bnN1YnNjcmliZVRvTm90ZXModGhpcy5yZWxhdGVkSXRlbVR5cGUsIHRoaXMucmVsYXRlZEl0ZW1JZCwgdGhpcy51c2VySWQpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCQpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKHJlc3VsdCA9PiB7XG4gICAgICAgIHRoaXMuc3Vic2NyaWJlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlY3JlYXRlQnV0dG9uc0Zvck5vdGlmaWNhdGlvbnMoZmFsc2UpO1xuICAgICAgfSwgZXJyb3IgPT4gdGhpcy5lcnJvck1lc3NhZ2UgPSAnRXJyb3IgY3JlYXRpbmcgbmV3IG5vdGU6ICcgKyBlcnJvci5lcnJvci5lcnJvck1lc3NhZ2UpO1xuICB9XG5cbiAgcHVibGljIGVkaXROb3RlID0gKHRocmVhZCkgPT4ge1xuICAgIHRocmVhZC5lZGl0TW9kZSA9ICF0aHJlYWQuZWRpdE1vZGU7XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlTm90ZSA9IChub3RlLCB1cGRhdGVkVGV4dCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdVcGRhdGluZyBub3RlJyk7XG4gICAgbm90ZS50ZXh0ID0gdXBkYXRlZFRleHQ7XG4gICAgdGhpcy5saXZlYXBwcy51cGRhdGVOb3RlKG5vdGUsIG5vdGUuaWQpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCQpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKHJlc3VsdCA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdOb3RlIHVwZGF0ZWQnKTtcbiAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICB9LCBlcnJvciA9PiB0aGlzLmVycm9yTWVzc2FnZSA9ICdFcnJvciB1cGRhdGluZyBub3RlOiAnICsgZXJyb3IuZXJyb3IuZXJyb3JNZXNzYWdlKTtcbiAgfVxuXG4gIHB1YmxpYyBkZWxldGVOb3RlID0gKGlkKSA9PiB7XG4gICAgY29uc29sZS5sb2coJ0RlbGV0aW5nIG5vdGUnKTtcbiAgICB0aGlzLmxpdmVhcHBzLmRlbGV0ZU5vdGUoaWQpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCQpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKHJlc3VsdCA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdOb3RlIGRlbGV0ZWQ6ICcgKyByZXN1bHQpO1xuICAgICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICAgIH0sIGVycm9yID0+IHRoaXMuZXJyb3JNZXNzYWdlID0gJ0Vycm9yIGNyZWF0aW5nIG5ldyBub3RlOiAnICsgZXJyb3IuZXJyb3IuZXJyb3JNZXNzYWdlKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIC8vIHRoaXMucmVmcmVzaCgpO1xuICAgIHRoaXMubmV3Tm90ZS50ZXh0ID0gJyc7XG5cbiAgfVxuXG59XG4iXX0=