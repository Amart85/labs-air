/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { LiveAppsService } from '../../services/live-apps.service';
import { map, take, takeUntil } from 'rxjs/operators';
import { LiveAppsComponent } from '../live-apps-component/live-apps-component.component';
import { TcButtonsHelperService } from '@tibco-tcstk/tc-core-lib';
/**
 * This Component allows to list, and add Notes to a Case-Instance or other Context e.g. a whole Application.
 * Any Note can have Sub-Notes to allow real collaboration.
 *
 * ![alt-text](../live-apps-notes.png "Notes Component Image")
 *
 * \@example <tcla-live-apps-notes></tcla-live-apps-notes>
 */
var LiveAppsNotesComponent = /** @class */ (function (_super) {
    tslib_1.__extends(LiveAppsNotesComponent, _super);
    function LiveAppsNotesComponent(liveapps, buttonsHelper) {
        var _this = _super.call(this) || this;
        _this.liveapps = liveapps;
        _this.buttonsHelper = buttonsHelper;
        /**
         * Whether to show the header bar in the widget - eg. favorites on home page (contains icon etc) - if off icons still appear without bar
         */
        _this.showHeader = _this.showHeader ? _this.showHeader : true;
        _this.newNote = {};
        _this.skip = 0;
        _this.top = 5;
        _this.end = false;
        _this.toolbarButtons = [];
        _this.refresh = (/**
         * @return {?}
         */
        function () {
            _this.skip = 0;
            _this.top = 5;
            _this.end = false;
            if (_this.threads && _this.threads.threads) {
                _this.threads.threads.length = 0;
            }
            _this.getBatch();
            _this.getNotifications();
        });
        _this.getBatch = (/**
         * @return {?}
         */
        function () {
            if (!_this.end) {
                _this.liveapps.getThreads(_this.relatedItemType, _this.relatedItemId, _this.skip, _this.top)
                    .pipe(take(1), takeUntil(_this._destroyed$), map((/**
                 * @param {?} threadList
                 * @return {?}
                 */
                function (threadList) {
                    if (!_this.threads) {
                        _this.threads = threadList;
                    }
                    else {
                        // this will strip any duplicates that may have been retrieved due to fast scrolling
                        /** @type {?} */
                        var filteredEvents = threadList.threads.filter((/**
                         * @param {?} x
                         * @return {?}
                         */
                        function (x) { return _this.threads.threads.every((/**
                         * @param {?} y
                         * @return {?}
                         */
                        function (y) { return y.note.id !== x.note.id; })); }));
                        _this.threads.threads = _this.threads.threads.concat(filteredEvents);
                    }
                    if (threadList.threads.length < _this.top) {
                        _this.end = true;
                    }
                    else {
                        _this.skip = _this.skip + threadList.threads.length - 1;
                    }
                }))).subscribe(null, (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    _this.errorMessage = 'Error retrieving notes: ' + error.error.errorMsg;
                }));
            }
        });
        _this.toggleReplies = (/**
         * @param {?} thread
         * @return {?}
         */
        function (thread) {
            thread.showReplies = !thread.showReplies;
        });
        _this.toggleNewReply = (/**
         * @param {?} thread
         * @return {?}
         */
        function (thread) {
            if (!thread.newReply) {
                thread.newReply = {};
            }
            if (thread.showReplies && !thread.showNewReply) {
                thread.newReply = {};
                thread.showNewReply = true;
            }
            else {
                thread.showNewReply = !thread.showNewReply;
                thread.showReplies = !thread.showReplies;
            }
        });
        _this.createReply = (/**
         * @param {?} thread
         * @param {?} replyText
         * @return {?}
         */
        function (thread, replyText) {
            _this.liveapps.createReplyNote(thread.note, replyText, thread.note.id)
                .pipe(take(1), takeUntil(_this._destroyed$), map((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                _this.newNoteId = result;
                thread.newReply.text = undefined;
                _this.refresh();
            })))
                .subscribe(null, (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return _this.errorMessage = 'Error creating new note: ' + error.error.errorMessage; }));
        });
        _this.createThread = (/**
         * @param {?} noteText
         * @return {?}
         */
        function (noteText) {
            if (noteText !== undefined) {
                _this.liveapps.createNote(_this.relatedItemType, 'RT_CASE', _this.relatedItemId, 'comments update', '', '', noteText)
                    .pipe(take(1), takeUntil(_this._destroyed$), map((/**
                 * @param {?} result
                 * @return {?}
                 */
                function (result) {
                    _this.newNoteId = result;
                    _this.newNote.text = undefined;
                    _this.refresh();
                })))
                    .subscribe(null, (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) { return _this.errorMessage = 'Error creating new note: ' + error.error.errorMessage; }));
            }
        });
        _this.createToolbarButtons = (/**
         * @param {?} subscribed
         * @return {?}
         */
        function (subscribed) {
            /** @type {?} */
            var subscribeButton = _this.buttonsHelper.createButton('subscribe', 'tcs-collaboration-unsubscribed', true, 'Enable Notifications', !subscribed, !subscribed);
            /** @type {?} */
            var unSubscribeButton = _this.buttonsHelper.createButton('unsubscribe', 'tcs-collaboration-subscribed', true, 'Disable Notifications', subscribed, subscribed);
            /** @type {?} */
            var buttons = [subscribeButton, unSubscribeButton];
            return buttons;
        });
        _this.setupNotificationButtons = (/**
         * @param {?} subscribed
         * @return {?}
         */
        function (subscribed) {
            /** @type {?} */
            var buttons = _this.createToolbarButtons(subscribed);
            _this.buttonsHelper.updateButtons(buttons, _this.toolbarButtons);
        });
        _this.updateButtonDef = (/**
         * @param {?} updatedToolbarButtons
         * @return {?}
         */
        function (updatedToolbarButtons) {
            updatedToolbarButtons.forEach((/**
             * @param {?} updatedButton
             * @return {?}
             */
            function (updatedButton) {
                /** @type {?} */
                var idx = _this.toolbarButtons.findIndex((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item.id === updatedButton.id; }));
                _this.toolbarButtons[idx] = updatedButton;
            }));
        });
        _this.handleToolbarButtonEvent = (/**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            if (id === 'subscribe') {
                _this.subscribe();
            }
            else if (id === 'unsubscribe') {
                _this.unsubscribe();
            }
        });
        _this.recreateButtonsForNotifications = (/**
         * @param {?} subscribed
         * @return {?}
         */
        function (subscribed) {
            /** @type {?} */
            var buttons = _this.createToolbarButtons(subscribed);
            _this.buttonsHelper.updateButtons(buttons, _this.toolbarButtons);
        });
        _this.getNotifications = (/**
         * @return {?}
         */
        function () {
            _this.liveapps.getNotifications(_this.relatedItemType, _this.relatedItemId, _this.userId)
                .pipe(take(1), takeUntil(_this._destroyed$), map((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                /** @type {?} */
                var notificationList = result;
                if (notificationList.notifications.length > 0) {
                    _this.subscribed = true;
                    _this.setupNotificationButtons(true);
                }
                else {
                    _this.subscribed = false;
                    _this.setupNotificationButtons(false);
                }
            })))
                .subscribe(null, (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return _this.errorMessage = 'Error creating new note: ' + error.error.errorMessage; }));
        });
        _this.subscribe = (/**
         * @return {?}
         */
        function () {
            _this.liveapps.subscribeToNotes(_this.relatedItemType, _this.relatedItemId)
                .pipe(take(1), takeUntil(_this._destroyed$), map((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                if (result) {
                    _this.subscribed = true;
                    _this.recreateButtonsForNotifications(true);
                }
            })))
                .subscribe(null, (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return _this.errorMessage = 'Error creating new note: ' + error.error.errorMessage; }));
        });
        _this.unsubscribe = (/**
         * @return {?}
         */
        function () {
            _this.liveapps.unsubscribeToNotes(_this.relatedItemType, _this.relatedItemId, _this.userId)
                .pipe(take(1), takeUntil(_this._destroyed$), map((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                _this.subscribed = false;
                _this.recreateButtonsForNotifications(false);
            })))
                .subscribe(null, (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return _this.errorMessage = 'Error creating new note: ' + error.error.errorMessage; }));
        });
        _this.editNote = (/**
         * @param {?} thread
         * @return {?}
         */
        function (thread) {
            thread.editMode = !thread.editMode;
        });
        _this.updateNote = (/**
         * @param {?} note
         * @param {?} updatedText
         * @return {?}
         */
        function (note, updatedText) {
            console.log('Updating note');
            note.text = updatedText;
            _this.liveapps.updateNote(note, note.id)
                .pipe(take(1), takeUntil(_this._destroyed$), map((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                console.log('Note updated');
                _this.refresh();
            })))
                .subscribe(null, (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return _this.errorMessage = 'Error updating note: ' + error.error.errorMessage; }));
        });
        _this.deleteNote = (/**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            console.log('Deleting note');
            _this.liveapps.deleteNote(id)
                .pipe(take(1), takeUntil(_this._destroyed$), map((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                console.log('Note deleted: ' + result);
                _this.refresh();
            })))
                .subscribe(null, (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { return _this.errorMessage = 'Error creating new note: ' + error.error.errorMessage; }));
        });
        return _this;
    }
    /**
     * @return {?}
     */
    LiveAppsNotesComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.refresh();
        this.newNote.text = '';
    };
    LiveAppsNotesComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tcla-live-apps-notes',
                    template: "<div class=\"tcs-notes-pane\" fxLayout=\"column\" fxFill style=\"overflow: hidden;\">\n  <tc-tibco-cloud-widget-header fxFlex=\"nogrow\" [headerText]=\"'Notes'\" [icon]=\"'tcs-collaboration-feed'\"\n                                [toolbarButtons]=\"toolbarButtons\" [showHeader]=\"showHeader\"\n                                (toolbarButtonEvent)=\"handleToolbarButtonEvent($event)\"></tc-tibco-cloud-widget-header>\n  <div class=\"tcs-collaboration-pane\" fxLayout=\"column\" fxFlex=\"grow\" style=\"\">\n    <div class=\"tcs-collaboration-existing-threads\" fxLayout=\"column\" fxFlex>\n      <!--div *ngIf=\"threads && threads.threads.length > 0\"-->\n      <div style=\"height: 100%;\">\n        <cdk-virtual-scroll-viewport style=\"height: 100%\" itemSize=\"50\" (scrolledIndexChange)=\"getBatch()\">\n\n          <!--div class=\"tcs-collaboration-detail-box tcs-collaboration-thread\" [ngClass]=\"{ editing: thread.editMode }\" *ngFor=\"let thread of threads.threads | reverse\" fxLayout=\"column\"-->\n          <div *ngIf=\"threads && threads.threads\">\n            <div class=\"tcs-collaboration-detail-box tcs-collaboration-thread\" [ngClass]=\"{ editing: thread.editMode }\"\n                 *cdkVirtualFor=\"let thread of threads.threads\" fxLayout=\"column\">\n              <div class=\"tcs-thread-box\">\n                <!-- collaboration threads -->\n                <div class=\"tcs-collaboration-entry\">\n                  <div *ngIf=\"!thread.editMode\">\n                    <div fxLayout=\"row\" fxLayoutAlign=\"space-between start\">\n                      <span class=\"tcs-collaboration-thread-author\">{{thread.note.createdByName}}</span>\n                      <div fxLayoutAlign=\"row\">\n                      <span *ngIf=\"thread.note.modifiedDate > thread.note.createdDate\" class=\"tcs-collaboration-edited\">Edited\n                      </span>\n                        <span class=\"tcs-collaboration-thread-date\">{{thread.note.modifiedDate | durationSince}}</span>\n                      </div>\n                    </div>\n                    <span class=\"tcs-collaboration-thread-text\" matTooltip=\"{{thread.note.text}}\"\n                          matTooltipShowDelay=\"1000\"\n                          matTooltipPosition=\"below\">{{thread.note.text | ellipsis: 70}}</span>\n                  </div>\n                  <tcla-live-apps-notes-editor *ngIf=\"thread.editMode\" [noteText]=\"thread.note.text\"\n                                               (noteSubmitted)=\"updateNote(thread.note, $event)\"></tcla-live-apps-notes-editor>\n                </div>\n                <div class=\"tcs-icon-row\" fxLayout=\"row\" fxLayoutAlign=\"space-between center\">\n                  <div class=\"tcs-collaboration-thread-icon-left\">\n                    <mat-icon (click)=\"deleteNote(thread.note.id)\"\n                              class=\"tcs-icon tcs-icon-active tcs-collaboration-edit-buttons tcs-collaboration-delete-icon\"\n                              svgIcon=\"tcs-collaboration-delete\"></mat-icon>\n                    <mat-icon (click)=\"editNote(thread)\"\n                              class=\"tcs-icon tcs-icon-active tcs-collaboration-edit-buttons tcs-collaboration-edit-icon\"\n                              svgIcon=\"tcs-collaboration-edit\"></mat-icon>\n                  </div>\n                  <div class=\"tcs-collaboration-thread-icon-right\" fxLayoutAlign=\"end center\" fxLayoutGap=\"8px\">\n                    <span *ngIf=\"thread.note.thread.totalCount > 1\" class=\"tcs-collaboration-thread-replies\"\n                          (click)=\"toggleReplies(thread)\">{{thread.note.thread.totalCount - 1}} replies</span>\n                    <mat-icon (click)=\"toggleNewReply(thread)\" class=\"tcs-icon tcs-collaboration-reply-icon\"\n                              svgIcon=\"tcs-collaboration-reply\"></mat-icon>\n                  </div>\n                </div>\n              </div>\n              <div class=\"tcs-collaboration-line\"></div>\n              <!-- replies -->\n              <div class=\"tcs-collaboration-reply-box\" *ngIf=\"thread.showReplies\">\n                <div fxLayout=\"column\">\n                  <tcla-live-apps-notes-editor class=\"tcs-collaboration-new-reply-component\" *ngIf=\"thread.showNewReply\"\n                                               [isReply]=\"true\" [noteText]=\"thread.newReply.text\"\n                                               (noteSubmitted)=\"createReply(thread, $event)\"></tcla-live-apps-notes-editor>\n                  <div class=\"tcs-collaboration-line\"></div>\n                </div>\n                <div class=\"tcs-collaboration-detail-box tcs-collaboration-reply\"\n                     [ngClass]=\"{ editing: reply.editMode }\" *ngFor=\"let reply of thread.thread | reverse\"\n                     fxLayout=\"column\">\n                  <div class=\"tcs-thread-box\" fxLayout=\"row\">\n                    <mat-icon class=\"tcs-icon tcs-collaboration-reply-item-icon\"\n                              svgIcon=\"tcs-collaboration-reply\"></mat-icon>\n                    <div fxLayout=\"column\" class=\"tcs-collaboration-reply-details\">\n                      <div class=\"tcs-collaboration-entry\">\n                        <div *ngIf=\"!reply.editMode\">\n                          <div fxLayout=\"row\" fxLayoutAlign=\"space-between start\">\n                            <span class=\"tcs-collaboration-thread-author\">{{reply.createdByName}}</span>\n                            <span class=\"tcs-collaboration-thread-date\">{{reply.modifiedDate | durationSince}}</span>\n                          </div>\n                          <span class=\"tcs-collaboration-thread-text\" matTooltip=\"{{reply.text}}\"\n                                matTooltipShowDelay=\"1000\"\n                                matTooltipPosition=\"below\">{{reply.text | ellipsis: 60}}</span>\n                        </div>\n                        <tcla-live-apps-notes-editor *ngIf=\"reply.editMode\" [noteText]=\"reply.text\"\n                                                     (noteSubmitted)=\"updateNote(reply, $event)\"></tcla-live-apps-notes-editor>\n                      </div>\n                      <div class=\"tcs-icon-row\" fxLayout=\"row\" fxLayoutAlign=\"space-between center\">\n                        <div class=\"tcs-collaboration-thread-icon-left\">\n                          <mat-icon (click)=\"deleteNote(reply.id)\"\n                                    class=\"tcs-icon tcs-icon-active tcs-collaboration-edit-buttons tcs-collaboration-delete-icon\"\n                                    svgIcon=\"tcs-collaboration-delete\"></mat-icon>\n                          <mat-icon (click)=\"editNote(reply)\"\n                                    class=\"tcs-icon tcs-icon-active tcs-collaboration-edit-buttons tcs-collaboration-edit-icon\"\n                                    svgIcon=\"tcs-collaboration-edit\"></mat-icon>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  <div class=\"tcs-collaboration-reply-line\"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div *ngIf=\"!(threads?.threads?.length > 0)\" fxLayout=\"row\" fxLayoutAlign=\"center start\" fxLayoutGap=\"10px\"\n               style=\"margin-top: 20px;\">\n            <mat-icon [svgIcon]=\"'ic-no-notes-icon'\" style=\"height: 48px; width: 48px;\"></mat-icon>\n            <div style=\"height: 100%\" fxLayout=\"row\" fxLayoutAlign=\"start center\">\n              <span class=\"tcs-no-item-text\">No notes found</span>\n            </div>\n          </div>\n        </cdk-virtual-scroll-viewport>\n      </div>\n    </div>\n    <tcla-live-apps-notes-editor class=\"tcs-collaboration-new-note-component\" [noteText]=\"newNote.text\"\n                                 (noteSubmitted)=\"createThread($event)\"></tcla-live-apps-notes-editor>\n  </div>\n</div>\n",
                    styles: [".tcs-notes-pane{border-radius:3px;box-shadow:0 2px 4px 0 rgba(0,0,0,.33);background-color:#fff}.tcs-collaboration-pane{padding-top:10px}.tcs-collaboration-header{height:40px;border-radius:3px 3px 0 0;box-shadow:0 1px 2px 0 #dedede;padding-left:20px;padding-right:20px}.tcs-collaboration-header-text{margin-left:10px;font-family:Source Sans Pro;font-size:18px;font-weight:600;font-style:normal;font-stretch:normal;line-height:1.5;letter-spacing:.3px}.tcs-collaboration-thread-icon-left{height:24px;width:50px}.tcs-collaboration-existing-threads{overflow-y:auto}.tcs-collaboration-detail-box{min-height:85px;flex-shrink:0}.tcs-collaboration-detail-box.editing{min-height:109px}.tcs-collaboration-detail-box.editing>.tcs-thread-box{height:110px;background-color:#eef0f7}.tcs-collaboration-new-reply-box{-webkit-transition:background-color .5s;transition:background-color .5s;background-color:#eef0f7;margin-left:20px;padding-right:20px}.tcs-collaboration-detail-box.tcs-collaboration-reply.editing{min-height:100px}.tcs-collaboration-reply{padding-left:20px}.tcs-thread-box{height:86px}.tcs-thread-box:hover{background-color:#eef0f7;-webkit-transition:background-color .5s;transition:background-color .5s}.tcs-thread-box:hover .tcs-icon.tcs-icon-active{display:inline-block}.tcs-thread-box .tcs-icon.tcs-icon-active{display:none}.tcs-collaboration-entry{padding:10px 20px}.tcs-icon-row{padding-left:20px;padding-right:20px;padding-bottom:5px}.tcs-collaboration-thread-author{font-size:14px;font-weight:600;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px}.tcs-collaboration-thread-text{font-size:11px;font-weight:400;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px}.tcs-collaboration-thread-date{font-size:10px;font-weight:600;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px;color:#b6b6b6}.tcs-collaboration-edited{font-size:10px;font-weight:600;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px;color:#ef5350;padding-right:4px}.tcs-collaboration-reply-icon{-webkit-transform:scale(-1,1);transform:scale(-1,1)}.tcs-collaboration-reply-item-icon{-webkit-transform:scale(1,-1);transform:scale(1,-1);margin-top:10px}.tcs-collaboration-reply-details{width:100%}.tcs-collaboration-thread-replies{font-size:12px;font-weight:600;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px;color:#0081cb}.tcs-icon{height:20px;width:20px}:host ::ng-deep .tcs-icon.tcs-collaboration-edit-buttons:hover path.svg-content{fill:#0081cb;cursor:pointer}:host ::ng-deep .tcs-icon.tcs-collaboration-edit-buttons:hover g.svg-content{fill:#0081cb;cursor:pointer}.tcs-icon.tcs-collaboration-edit-icon{margin-left:5px}.tcs-icon.tcs-collaboration-send-icon{height:24px;width:24px;margin-left:12px}:host ::ng-deep .tcs-icon.tcs-collaboration-send-icon:hover path.svg-content{fill:#0081cb}.tcs-collaboration-line{padding:0;margin:0 20px;border-bottom:1.1px solid #f4f4f4}.tcs-collaboration-reply-line{padding:0;margin-top:0;margin-right:20px;margin-bottom:0;border-bottom:1.1px solid #f4f4f4}.tcs-collaboration-new-thread{margin-left:20px;margin-right:20px;max-height:85px;height:85px;min-height:85px}.tcs-collaboration-edit-thread{margin-top:10px}.tcs-collaboration-new-reply{margin:10px 20px}.tcs-collaboration-input{height:55px;max-width:100%;border-color:#d5e6ff;font-size:11px;font-weight:400;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px;color:#b6b6b6;resize:none;border-radius:3px}.tcs-collaboration-reply-textbox{height:55px;max-width:100%;border-color:#d5e6ff;font-size:11px;font-weight:400;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px;color:#b6b6b6;resize:none;border-radius:3px;margin-top:20px;margin-bottom:20px}.tcs-collaboration-edit{height:55px;max-width:100%;border-color:#d5e6ff;font-size:11px;font-weight:400;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:-.1px;color:#b6b6b6;resize:none;border-radius:3px}.tcs-collaboration-new-thread-form{max-width:90%;max-height:100%}.tcs-collaboration-new-note-component,.tcs-collaboration-new-reply-component{height:85px;min-height:85px;max-height:85px;margin-left:20px;margin-right:20px}.tcs-no-item-text{font-family:Source Sans Pro;font-size:16px;font-weight:400;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:normal;color:#b6b6b6}"]
                }] }
    ];
    /** @nocollapse */
    LiveAppsNotesComponent.ctorParameters = function () { return [
        { type: LiveAppsService },
        { type: TcButtonsHelperService }
    ]; };
    LiveAppsNotesComponent.propDecorators = {
        relatedItemType: [{ type: Input }],
        relatedItemId: [{ type: Input }],
        userId: [{ type: Input }],
        showHeader: [{ type: Input }]
    };
    return LiveAppsNotesComponent;
}(LiveAppsComponent));
export { LiveAppsNotesComponent };
if (false) {
    /**
     * itemType for notes collection
     * @type {?}
     */
    LiveAppsNotesComponent.prototype.relatedItemType;
    /**
     * itemId for notes collection
     * @type {?}
     */
    LiveAppsNotesComponent.prototype.relatedItemId;
    /**
     * The ID of the logged user
     * @type {?}
     */
    LiveAppsNotesComponent.prototype.userId;
    /**
     * Whether to show the header bar in the widget - eg. favorites on home page (contains icon etc) - if off icons still appear without bar
     * @type {?}
     */
    LiveAppsNotesComponent.prototype.showHeader;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.notes;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.errorMessage;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.newNote;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.newNoteId;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.delNoteId;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.threads;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.subscribed;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.skip;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.top;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.end;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.toolbarButtons;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.refresh;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.getBatch;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.toggleReplies;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.toggleNewReply;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.createReply;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.createThread;
    /**
     * @type {?}
     * @protected
     */
    LiveAppsNotesComponent.prototype.createToolbarButtons;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.setupNotificationButtons;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.updateButtonDef;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.handleToolbarButtonEvent;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.recreateButtonsForNotifications;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.getNotifications;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.subscribe;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.unsubscribe;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.editNote;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.updateNote;
    /** @type {?} */
    LiveAppsNotesComponent.prototype.deleteNote;
    /**
     * @type {?}
     * @private
     */
    LiveAppsNotesComponent.prototype.liveapps;
    /**
     * @type {?}
     * @private
     */
    LiveAppsNotesComponent.prototype.buttonsHelper;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLW5vdGVzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0aWJjby10Y3N0ay90Yy1saXZlYXBwcy1saWIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9saXZlLWFwcHMtbm90ZXMvbGl2ZS1hcHBzLW5vdGVzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsS0FBSyxFQUFvQixNQUFNLGVBQWUsQ0FBQztBQUVsRSxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sa0NBQWtDLENBQUM7QUFDakUsT0FBTyxFQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFFcEQsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sc0RBQXNELENBQUM7QUFFdkYsT0FBTyxFQUFDLHNCQUFzQixFQUFDLE1BQU0sMEJBQTBCLENBQUM7Ozs7Ozs7OztBQVdoRTtJQU00QyxrREFBaUI7SUFpQzNELGdDQUFvQixRQUF5QixFQUFVLGFBQXFDO1FBQTVGLFlBQ0UsaUJBQU8sU0FDUjtRQUZtQixjQUFRLEdBQVIsUUFBUSxDQUFpQjtRQUFVLG1CQUFhLEdBQWIsYUFBYSxDQUF3Qjs7OztRQWRuRixnQkFBVSxHQUFZLEtBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEtBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUlqRSxhQUFPLEdBQVEsRUFBRSxDQUFDO1FBS2xCLFVBQUksR0FBRyxDQUFDLENBQUM7UUFDVCxTQUFHLEdBQUcsQ0FBQyxDQUFDO1FBQ1IsU0FBRyxHQUFHLEtBQUssQ0FBQztRQUNaLG9CQUFjLEdBQW9CLEVBQUUsQ0FBQztRQU1yQyxhQUFPOzs7UUFBRztZQUNmLEtBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO1lBQ2QsS0FBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7WUFDYixLQUFJ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SUFNNUMseUNBU0M7O0lBRUQsMENBd0JDOztJQUVELCtDQUVDOztJQUVELGdEQVlDOztJQUVELDZDQVlDOztJQUVELDhDQWNDOzs7OztJQUdELHNEQU9DOztJQUVELDBEQUdDOztJQUVELGlEQUtDOztJQUVELDBEQU1DOztJQUVELGlFQUdDOztJQUVELGtEQWlCQzs7SUFFRCwyQ0FhQzs7SUFFRCw2Q0FXQzs7SUFFRCwwQ0FFQzs7SUFFRCw0Q0FhQzs7SUFFRCw0Q0FZQzs7Ozs7SUExTVcsMENBQWlDOzs7OztJQUFFLCtDQUE2QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBJbnB1dCwgT25EZXN0cm95LCBPbkluaXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtTdWJqZWN0fSBmcm9tICdyeGpzJztcbmltcG9ydCB7TGl2ZUFwcHNTZXJ2aWNlfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9saXZlLWFwcHMuc2VydmljZSc7XG5pbXBvcnQge21hcCwgdGFrZSwgdGFrZVVudGlsfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge05vdGUsIE5vdGVUaHJlYWQsIE5vdGlmaWNhdGlvbkxpc3QsIFRocmVhZExpc3R9IGZyb20gJy4uLy4uL21vZGVscy9saXZlYXBwc2RhdGEnO1xuaW1wb3J0IHtMaXZlQXBwc0NvbXBvbmVudH0gZnJvbSAnLi4vbGl2ZS1hcHBzLWNvbXBvbmVudC9saXZlLWFwcHMtY29tcG9uZW50LmNvbXBvbmVudCc7XG5pbXBvcnQge1Rvb2xiYXJCdXR0b259IGZyb20gJ0B0aWJjby10Y3N0ay90Yy1jb3JlLWxpYic7XG5pbXBvcnQge1RjQnV0dG9uc0hlbHBlclNlcnZpY2V9IGZyb20gJ0B0aWJjby10Y3N0ay90Yy1jb3JlLWxpYic7XG5cblxuLyoqXG4gKiBUaGlzIENvbXBvbmVudCBhbGxvd3MgdG8gbGlzdCwgYW5kIGFkZCBOb3RlcyB0byBhIENhc2UtSW5zdGFuY2Ugb3Igb3RoZXIgQ29udGV4dCBlLmcuIGEgd2hvbGUgQXBwbGljYXRpb24uXG4gKiBBbnkgTm90ZSBjYW4gaGF2ZSBTdWItTm90ZXMgdG8gYWxsb3cgcmVhbCBjb2xsYWJvcmF0aW9uLlxuICpcbiAqICFbYWx0LXRleHRdKC4uL2xpdmUtYXBwcy1ub3Rlcy5wbmcgXCJOb3RlcyBDb21wb25lbnQgSW1hZ2VcIilcbiAqXG4gKkBleGFtcGxlIDx0Y2xhLWxpdmUtYXBwcy1ub3Rlcz48L3RjbGEtbGl2ZS1hcHBzLW5vdGVzPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0Y2xhLWxpdmUtYXBwcy1ub3RlcycsXG4gIHRlbXBsYXRlVXJsOiAnLi9saXZlLWFwcHMtbm90ZXMuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9saXZlLWFwcHMtbm90ZXMuY29tcG9uZW50LmNzcyddXG59KVxuXG5leHBvcnQgY2xhc3MgTGl2ZUFwcHNOb3Rlc0NvbXBvbmVudCBleHRlbmRzIExpdmVBcHBzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgLyoqXG4gICAqIGl0ZW1UeXBlIGZvciBub3RlcyBjb2xsZWN0aW9uXG4gICAqL1xuICBASW5wdXQoKSByZWxhdGVkSXRlbVR5cGU6IHN0cmluZzsgLy8gdXNlICdDQVNFX0FQUCcgdG8gc2hhcmUgbm90ZXMgd2l0aCBjYXNlIG1hbmFnZXJcblxuICAvKipcbiAgICogaXRlbUlkIGZvciBub3RlcyBjb2xsZWN0aW9uXG4gICAqL1xuICBASW5wdXQoKSByZWxhdGVkSXRlbUlkOiBzdHJpbmc7IC8vICdjYXNlUmVmJyBmb3IgY2FzZSByZWxhdGVkXG5cbiAgLyoqXG4gICAqIFRoZSBJRCBvZiB0aGUgbG9nZ2VkIHVzZXJcbiAgICovXG4gIEBJbnB1dCgpIHVzZXJJZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIHNob3cgdGhlIGhlYWRlciBiYXIgaW4gdGhlIHdpZGdldCAtIGVnLiBmYXZvcml0ZXMgb24gaG9tZSBwYWdlIChjb250YWlucyBpY29uIGV0YykgLSBpZiBvZmYgaWNvbnMgc3RpbGwgYXBwZWFyIHdpdGhvdXQgYmFyXG4gICAqL1xuICBASW5wdXQoKSBzaG93SGVhZGVyOiBib29sZWFuID0gdGhpcy5zaG93SGVhZGVyID8gdGhpcy5zaG93SGVhZGVyIDogdHJ1ZTtcblxuICBwdWJsaWMgbm90ZXM6IE5vdGVbXTtcbiAgcHVibGljIGVycm9yTWVzc2FnZTogc3RyaW5nO1xuICBwdWJsaWMgbmV3Tm90ZTogYW55ID0ge307XG4gIHB1YmxpYyBuZXdOb3RlSWQ6IG51bWJlcjtcbiAgcHVibGljIGRlbE5vdGVJZDogbnVtYmVyO1xuICBwdWJsaWMgdGhyZWFkczogVGhyZWFkTGlzdDtcbiAgcHVibGljIHN1YnNjcmliZWQ6IEJvb2xlYW47XG4gIHB1YmxpYyBza2lwID0gMDtcbiAgcHVibGljIHRvcCA9IDU7XG4gIHB1YmxpYyBlbmQgPSBmYWxzZTtcbiAgcHVibGljIHRvb2xiYXJCdXR0b25zOiBUb29sYmFyQnV0dG9uW10gPSBbXTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxpdmVhcHBzOiBMaXZlQXBwc1NlcnZpY2UsIHByaXZhdGUgYnV0dG9uc0hlbHBlcjogVGNCdXR0b25zSGVscGVyU2VydmljZSkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBwdWJsaWMgcmVmcmVzaCA9ICgpID0+IHtcbiAgICB0aGlzLnNraXAgPSAwO1xuICAgIHRoaXMudG9wID0gNTtcbiAgICB0aGlzLmVuZCA9IGZhbHNlO1xuICAgIGlmICh0aGlzLnRocmVhZHMgJiYgdGhpcy50aHJlYWRzLnRocmVhZHMpIHtcbiAgICAgIHRoaXMudGhyZWFkcy50aHJlYWRzLmxlbmd0aCA9IDA7XG4gICAgfVxuICAgIHRoaXMuZ2V0QmF0Y2goKTtcbiAgICB0aGlzLmdldE5vdGlmaWNhdGlvbnMoKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRCYXRjaCA9ICgpID0+IHtcbiAgICBpZiAoIXRoaXMuZW5kKSB7XG4gICAgICB0aGlzLmxpdmVhcHBzLmdldFRocmVhZHModGhpcy5yZWxhdGVkSXRlbVR5cGUsIHRoaXMucmVsYXRlZEl0ZW1JZCwgdGhpcy5za2lwLCB0aGlzLnRvcClcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgICB0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkJCksXG4gICAgICAgICAgbWFwKHRocmVhZExpc3QgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnRocmVhZHMpIHtcbiAgICAgICAgICAgICAgdGhpcy50aHJlYWRzID0gdGhyZWFkTGlzdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIHRoaXMgd2lsbCBzdHJpcCBhbnkgZHVwbGljYXRlcyB0aGF0IG1heSBoYXZlIGJlZW4gcmV0cmlldmVkIGR1ZSB0byBmYXN0IHNjcm9sbGluZ1xuICAgICAgICAgICAgICBjb25zdCBmaWx0ZXJlZEV2ZW50cyA9IHRocmVhZExpc3QudGhyZWFkcy5maWx0ZXIoeCA9PiB0aGlzLnRocmVhZHMudGhyZWFkcy5ldmVyeSh5ID0+IHkubm90ZS5pZCAhPT0geC5ub3RlLmlkKSk7XG4gICAgICAgICAgICAgIHRoaXMudGhyZWFkcy50aHJlYWRzID0gdGhpcy50aHJlYWRzLnRocmVhZHMuY29uY2F0KGZpbHRlcmVkRXZlbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aHJlYWRMaXN0LnRocmVhZHMubGVuZ3RoIDwgdGhpcy50b3ApIHtcbiAgICAgICAgICAgICAgdGhpcy5lbmQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5za2lwID0gdGhpcy5za2lwICsgdGhyZWFkTGlzdC50aHJlYWRzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgKS5zdWJzY3JpYmUobnVsbCwgZXJyb3IgPT4ge1xuICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9ICdFcnJvciByZXRyaWV2aW5nIG5vdGVzOiAnICsgZXJyb3IuZXJyb3IuZXJyb3JNc2c7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgdG9nZ2xlUmVwbGllcyA9ICh0aHJlYWQpID0+IHtcbiAgICB0aHJlYWQuc2hvd1JlcGxpZXMgPSAhdGhyZWFkLnNob3dSZXBsaWVzO1xuICB9XG5cbiAgcHVibGljIHRvZ2dsZU5ld1JlcGx5ID0gKHRocmVhZCkgPT4ge1xuICAgIGlmICghdGhyZWFkLm5ld1JlcGx5KSB7XG4gICAgICB0aHJlYWQubmV3UmVwbHkgPSB7fTtcbiAgICB9XG4gICAgaWYgKHRocmVhZC5zaG93UmVwbGllcyAmJiAhdGhyZWFkLnNob3dOZXdSZXBseSkge1xuICAgICAgdGhyZWFkLm5ld1JlcGx5ID0ge307XG4gICAgICB0aHJlYWQuc2hvd05ld1JlcGx5ID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyZWFkLnNob3dOZXdSZXBseSA9ICF0aHJlYWQuc2hvd05ld1JlcGx5O1xuICAgICAgdGhyZWFkLnNob3dSZXBsaWVzID0gIXRocmVhZC5zaG93UmVwbGllcztcbiAgICB9XG5cbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGVSZXBseSA9ICh0aHJlYWQsIHJlcGx5VGV4dCkgPT4ge1xuICAgIHRoaXMubGl2ZWFwcHMuY3JlYXRlUmVwbHlOb3RlKHRocmVhZC5ub3RlLCByZXBseVRleHQsIHRocmVhZC5ub3RlLmlkKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRha2UoMSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQkKSxcbiAgICAgICAgbWFwKHJlc3VsdCA9PiB7XG4gICAgICAgICAgdGhpcy5uZXdOb3RlSWQgPSByZXN1bHQ7XG4gICAgICAgICAgdGhyZWFkLm5ld1JlcGx5LnRleHQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKG51bGwsIGVycm9yID0+IHRoaXMuZXJyb3JNZXNzYWdlID0gJ0Vycm9yIGNyZWF0aW5nIG5ldyBub3RlOiAnICsgZXJyb3IuZXJyb3IuZXJyb3JNZXNzYWdlKTtcbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGVUaHJlYWQgPSAobm90ZVRleHQpID0+IHtcbiAgICBpZiAobm90ZVRleHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5saXZlYXBwcy5jcmVhdGVOb3RlKHRoaXMucmVsYXRlZEl0ZW1UeXBlLCAnUlRfQ0FTRScsIHRoaXMucmVsYXRlZEl0ZW1JZCwgJ2NvbW1lbnRzIHVwZGF0ZScsICcnLCAnJywgbm90ZVRleHQpXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIHRha2UoMSksXG4gICAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCQpLFxuICAgICAgICAgIG1hcChyZXN1bHQgPT4ge1xuICAgICAgICAgICAgdGhpcy5uZXdOb3RlSWQgPSByZXN1bHQ7XG4gICAgICAgICAgICB0aGlzLm5ld05vdGUudGV4dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgICAgLnN1YnNjcmliZShudWxsLCBlcnJvciA9PiB0aGlzLmVycm9yTWVzc2FnZSA9ICdFcnJvciBjcmVhdGluZyBuZXcgbm90ZTogJyArIGVycm9yLmVycm9yLmVycm9yTWVzc2FnZSk7XG4gICAgfVxuICB9XG5cblxuICBwcm90ZWN0ZWQgY3JlYXRlVG9vbGJhckJ1dHRvbnMgPSAoc3Vic2NyaWJlZCk6IFRvb2xiYXJCdXR0b25bXSA9PiB7XG4gICAgY29uc3Qgc3Vic2NyaWJlQnV0dG9uOiBUb29sYmFyQnV0dG9uID0gdGhpcy5idXR0b25zSGVscGVyLmNyZWF0ZUJ1dHRvbihcbiAgICAgICdzdWJzY3JpYmUnLCAndGNzLWNvbGxhYm9yYXRpb24tdW5zdWJzY3JpYmVkJywgdHJ1ZSwgJ0VuYWJsZSBOb3RpZmljYXRpb25zJywgIXN1YnNjcmliZWQsICFzdWJzY3JpYmVkKTtcbiAgICBjb25zdCB1blN1YnNjcmliZUJ1dHRvbjogVG9vbGJhckJ1dHRvbiA9IHRoaXMuYnV0dG9uc0hlbHBlci5jcmVhdGVCdXR0b24oXG4gICAgICAndW5zdWJzY3JpYmUnLCAndGNzLWNvbGxhYm9yYXRpb24tc3Vic2NyaWJlZCcsIHRydWUsICdEaXNhYmxlIE5vdGlmaWNhdGlvbnMnLCBzdWJzY3JpYmVkLCBzdWJzY3JpYmVkKTtcbiAgICBjb25zdCBidXR0b25zID0gWyBzdWJzY3JpYmVCdXR0b24sIHVuU3Vic2NyaWJlQnV0dG9uIF07XG4gICAgcmV0dXJuIGJ1dHRvbnM7XG4gIH1cblxuICBwdWJsaWMgc2V0dXBOb3RpZmljYXRpb25CdXR0b25zID0gKHN1YnNjcmliZWQ6IGJvb2xlYW4pID0+IHtcbiAgICBjb25zdCBidXR0b25zOiBUb29sYmFyQnV0dG9uW10gPSB0aGlzLmNyZWF0ZVRvb2xiYXJCdXR0b25zKHN1YnNjcmliZWQpO1xuICAgIHRoaXMuYnV0dG9uc0hlbHBlci51cGRhdGVCdXR0b25zKGJ1dHRvbnMsIHRoaXMudG9vbGJhckJ1dHRvbnMpO1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZUJ1dHRvbkRlZiA9ICh1cGRhdGVkVG9vbGJhckJ1dHRvbnM6IFRvb2xiYXJCdXR0b25bXSkgPT4ge1xuICAgIHVwZGF0ZWRUb29sYmFyQnV0dG9ucy5mb3JFYWNoKCB1cGRhdGVkQnV0dG9uID0+IHtcbiAgICAgIGNvbnN0IGlkeCA9IHRoaXMudG9vbGJhckJ1dHRvbnMuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5pZCA9PT0gdXBkYXRlZEJ1dHRvbi5pZCk7XG4gICAgICB0aGlzLnRvb2xiYXJCdXR0b25zW2lkeF0gPSB1cGRhdGVkQnV0dG9uO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGhhbmRsZVRvb2xiYXJCdXR0b25FdmVudCA9IChpZCkgPT4ge1xuICAgIGlmIChpZCA9PT0gJ3N1YnNjcmliZScpIHtcbiAgICAgIHRoaXMuc3Vic2NyaWJlKCk7XG4gICAgfSBlbHNlIGlmIChpZCA9PT0gJ3Vuc3Vic2NyaWJlJykge1xuICAgICAgdGhpcy51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyByZWNyZWF0ZUJ1dHRvbnNGb3JOb3RpZmljYXRpb25zID0gKHN1YnNjcmliZWQpID0+IHtcbiAgICAgIGNvbnN0IGJ1dHRvbnM6IFRvb2xiYXJCdXR0b25bXSA9IHRoaXMuY3JlYXRlVG9vbGJhckJ1dHRvbnMoc3Vic2NyaWJlZCk7XG4gICAgICB0aGlzLmJ1dHRvbnNIZWxwZXIudXBkYXRlQnV0dG9ucyhidXR0b25zLCB0aGlzLnRvb2xiYXJCdXR0b25zKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXROb3RpZmljYXRpb25zID0gKCkgPT4ge1xuICAgIHRoaXMubGl2ZWFwcHMuZ2V0Tm90aWZpY2F0aW9ucyh0aGlzLnJlbGF0ZWRJdGVtVHlwZSwgdGhpcy5yZWxhdGVkSXRlbUlkLCB0aGlzLnVzZXJJZClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YWtlKDEpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkJCksXG4gICAgICAgIG1hcChyZXN1bHQgPT4ge1xuICAgICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbkxpc3Q6IE5vdGlmaWNhdGlvbkxpc3QgPSByZXN1bHQ7XG4gICAgICAgICAgaWYgKG5vdGlmaWNhdGlvbkxpc3Qubm90aWZpY2F0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmliZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5zZXR1cE5vdGlmaWNhdGlvbkJ1dHRvbnModHJ1ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zZXR1cE5vdGlmaWNhdGlvbkJ1dHRvbnMoZmFsc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUobnVsbCwgZXJyb3IgPT4gdGhpcy5lcnJvck1lc3NhZ2UgPSAnRXJyb3IgY3JlYXRpbmcgbmV3IG5vdGU6ICcgKyBlcnJvci5lcnJvci5lcnJvck1lc3NhZ2UpO1xuICB9XG5cbiAgcHVibGljIHN1YnNjcmliZSA9ICgpID0+IHtcbiAgICB0aGlzLmxpdmVhcHBzLnN1YnNjcmliZVRvTm90ZXModGhpcy5yZWxhdGVkSXRlbVR5cGUsIHRoaXMucmVsYXRlZEl0ZW1JZClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YWtlKDEpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkJCksXG4gICAgICAgIG1hcChyZXN1bHQgPT4ge1xuICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnJlY3JlYXRlQnV0dG9uc0Zvck5vdGlmaWNhdGlvbnModHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZShudWxsLCBlcnJvciA9PiB0aGlzLmVycm9yTWVzc2FnZSA9ICdFcnJvciBjcmVhdGluZyBuZXcgbm90ZTogJyArIGVycm9yLmVycm9yLmVycm9yTWVzc2FnZSk7XG4gIH1cblxuICBwdWJsaWMgdW5zdWJzY3JpYmUgPSAoKSA9PiB7XG4gICAgdGhpcy5saXZlYXBwcy51bnN1YnNjcmliZVRvTm90ZXModGhpcy5yZWxhdGVkSXRlbVR5cGUsIHRoaXMucmVsYXRlZEl0ZW1JZCwgdGhpcy51c2VySWQpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCQpLFxuICAgICAgICBtYXAocmVzdWx0ID0+IHtcbiAgICAgICAgICB0aGlzLnN1YnNjcmliZWQgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLnJlY3JlYXRlQnV0dG9uc0Zvck5vdGlmaWNhdGlvbnMoZmFsc2UpO1xuICAgICAgICB9KVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZShudWxsLCBlcnJvciA9PiB0aGlzLmVycm9yTWVzc2FnZSA9ICdFcnJvciBjcmVhdGluZyBuZXcgbm90ZTogJyArIGVycm9yLmVycm9yLmVycm9yTWVzc2FnZSk7XG4gIH1cblxuICBwdWJsaWMgZWRpdE5vdGUgPSAodGhyZWFkKSA9PiB7XG4gICAgdGhyZWFkLmVkaXRNb2RlID0gIXRocmVhZC5lZGl0TW9kZTtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVOb3RlID0gKG5vdGUsIHVwZGF0ZWRUZXh0KSA9PiB7XG4gICAgY29uc29sZS5sb2coJ1VwZGF0aW5nIG5vdGUnKTtcbiAgICBub3RlLnRleHQgPSB1cGRhdGVkVGV4dDtcbiAgICB0aGlzLmxpdmVhcHBzLnVwZGF0ZU5vdGUobm90ZSwgbm90ZS5pZClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YWtlKDEpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkJCksXG4gICAgICAgIG1hcChyZXN1bHQgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdOb3RlIHVwZGF0ZWQnKTtcbiAgICAgICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICAgICAgfSlcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUobnVsbCwgZXJyb3IgPT4gdGhpcy5lcnJvck1lc3NhZ2UgPSAnRXJyb3IgdXBkYXRpbmcgbm90ZTogJyArIGVycm9yLmVycm9yLmVycm9yTWVzc2FnZSk7XG4gIH1cblxuICBwdWJsaWMgZGVsZXRlTm90ZSA9IChpZCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdEZWxldGluZyBub3RlJyk7XG4gICAgdGhpcy5saXZlYXBwcy5kZWxldGVOb3RlKGlkKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRha2UoMSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQkKSxcbiAgICAgICAgbWFwKHJlc3VsdCA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ05vdGUgZGVsZXRlZDogJyArIHJlc3VsdCk7XG4gICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKG51bGwsIGVycm9yID0+IHRoaXMuZXJyb3JNZXNzYWdlID0gJ0Vycm9yIGNyZWF0aW5nIG5ldyBub3RlOiAnICsgZXJyb3IuZXJyb3IuZXJyb3JNZXNzYWdlKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMucmVmcmVzaCgpO1xuICAgIHRoaXMubmV3Tm90ZS50ZXh0ID0gJyc7XG5cbiAgfVxuXG59XG4iXX0=