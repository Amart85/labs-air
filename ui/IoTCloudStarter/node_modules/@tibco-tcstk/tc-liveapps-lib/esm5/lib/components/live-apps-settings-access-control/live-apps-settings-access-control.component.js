/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import { RouteAccessControlConfigurationElement } from '../../models/tc-groups-data';
import { TcAccessControlService } from '../../services/tc-access-control.service';
import { MatSnackBar } from '@angular/material';
var LiveAppsSettingsAccessControlComponent = /** @class */ (function () {
    function LiveAppsSettingsAccessControlComponent(route, accessControlService, snackBar) {
        var _this = this;
        this.route = route;
        this.accessControlService = accessControlService;
        this.snackBar = snackBar;
        this.displayedColumns = [];
        this.dataSource = [];
        this.generateTables = (/**
         * @return {?}
         */
        function () {
            _this.displayedColumns = ['name'];
            _this.allRoles.roles.forEach((/**
             * @param {?} role
             * @return {?}
             */
            function (role) {
                _this.displayedColumns.push(role.id);
            }));
            // Create in dataSource all rows with the appropriate order
            _this.dataSource.push({ initial: 'Routes', isGroupBy: true });
            _this.accessControlConfiguration.allowedRoutes.forEach((/**
             * @param {?} route
             * @return {?}
             */
            function (route) { return _this.dataSource.push({ name: route, type: 'route' }); }));
            _this.dataSource.push({ initial: 'Buttons', isGroupBy: true });
            _this.accessControlConfiguration.allowedButtonIds.forEach((/**
             * @param {?} buttonId
             * @return {?}
             */
            function (buttonId) { return _this.dataSource.push({ name: buttonId, type: 'button' }); }));
            // Update the dataSource with the previous configuration
            _this.accessControlConfiguration.configuration.forEach((/**
             * @param {?} configElement
             * @return {?}
             */
            function (configElement) {
                // Routes
                configElement.routes.forEach((/**
                 * @param {?} configRoute
                 * @return {?}
                 */
                function (configRoute) {
                    /** @type {?} */
                    var row = _this.dataSource.filter((/**
                     * @param {?} entry
                     * @return {?}
                     */
                    function (entry) { return entry.name === configRoute; }))[0];
                    row[configElement.roleId] = true;
                }));
                // ButtonsIds
                configElement.buttonIds.forEach((/**
                 * @param {?} configRoute
                 * @return {?}
                 */
                function (configRoute) {
                    /** @type {?} */
                    var row = _this.dataSource.filter((/**
                     * @param {?} entry
                     * @return {?}
                     */
                    function (entry) { return entry.name === configRoute; }))[0];
                    row[configElement.roleId] = true;
                }));
            }));
        });
        this.isSelected = (/**
         * @param {?} row
         * @param {?} role
         * @return {?}
         */
        function (row, role) {
            return row[role];
        });
        this.toggle = (/**
         * @param {?} row
         * @param {?} role
         * @return {?}
         */
        function (row, role) {
            /** @type {?} */
            var dsRow = _this.dataSource.filter((/**
             * @param {?} entry
             * @return {?}
             */
            function (entry) { return entry.name === row.name; }))[0];
            if (dsRow[role]) {
                delete dsRow[role];
            }
            else {
                dsRow[role] = true;
            }
        });
    }
    /**
     * @param {?} index
     * @param {?} item
     * @return {?}
     */
    LiveAppsSettingsAccessControlComponent.prototype.isGroup = /**
     * @param {?} index
     * @param {?} item
     * @return {?}
     */
    function (index, item) {
        return item.isGroupBy;
    };
    /**
     * @return {?}
     */
    LiveAppsSettingsAccessControlComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.accessControlConfiguration = this.route.snapshot.data.accessControlConfigHolder;
        this.allRoles = this.route.snapshot.data.allRoles;
        this.generateTables();
    };
    /**
     * @return {?}
     */
    LiveAppsSettingsAccessControlComponent.prototype.runSaveFunction = /**
     * @return {?}
     */
    function () {
        var _this = this;
        var e_1, _a;
        this.accessControlConfiguration.configuration = [];
        var _loop_1 = function (role) {
            /** @type {?} */
            var userConfiguration = this_1.dataSource.filter((/**
             * @param {?} entry
             * @return {?}
             */
            function (entry) { return entry[role.id]; }));
            /** @type {?} */
            var routes = userConfiguration.filter((/**
             * @param {?} row
             * @return {?}
             */
            function (row) { return row.type === 'route'; })).map((/**
             * @param {?} element
             * @return {?}
             */
            function (element) { return element.name; }));
            /** @type {?} */
            var buttonIds = userConfiguration.filter((/**
             * @param {?} row
             * @return {?}
             */
            function (row) { return row.type === 'button'; })).map((/**
             * @param {?} element
             * @return {?}
             */
            function (element) { return element.name; }));
            this_1.accessControlConfiguration.configuration.push(new RouteAccessControlConfigurationElement().deserialize({ 'roleId': role.id, routes: routes, buttonIds: buttonIds }));
        };
        var this_1 = this;
        try {
            for (var _b = tslib_1.__values(this.allRoles.roles), _c = _b.next(); !_c.done; _c = _b.next()) {
                var role = _c.value;
                _loop_1(role);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        this.accessControlService.updateAccessControlConfig(Number(this.route.snapshot.data.claims.primaryProductionSandbox.id).valueOf(), this.accessControlConfiguration.uiAppId, this.accessControlConfiguration, this.accessControlConfiguration.id).subscribe((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            _this.snackBar.open('Access Control configuration saved', 'OK', {
                duration: 3000
            });
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this.snackBar.open('Error saving Access Control configuration saved', 'OK', {
                duration: 3000
            });
        }));
    };
    LiveAppsSettingsAccessControlComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tcla-live-apps-settings-access-control',
                    template: "<div fxLayout=\"column\" fxFill>\n  <tc-tibco-cloud-widget-header style=\"height: 40px;\" [icon]=\"'tcs-capabilities'\"\n                                [headerText]=\"'Access Control Configuration'\">\n  </tc-tibco-cloud-widget-header>\n  <div fxFlex style=\"padding: 20px; overflow: hidden\" fxLayout=\"column\">\n    <div style=\"overflow: auto;\" fxFlex fxLayout=\"column\">\n      <div fxLayout=\"column\">\n        <p>You can configure roles by here:</p>\n        <br>\n        <table fxFlex mat-table [dataSource]=\"dataSource\" class=\"mat-elevation-z8\">\n\n          <!-- Name Column -->\n          <ng-container matColumnDef=\"name\">\n            <th mat-header-cell *matHeaderCellDef></th>\n            <td mat-cell *matCellDef=\"let element\"> {{element.name}} </td>\n          </ng-container>\n\n          <ng-container *ngFor=\"let role of allRoles.roles\" matColumnDef=\"{{role.id}}\">\n            <th mat-header-cell *matHeaderCellDef [ngClass]=\"'centered-cell'\">{{role.id}}</th>\n            <td mat-cell [ngClass]=\"'centered-cell'\" *matCellDef=\"let row\">\n              <!-- (click)=\"$event.stopPropagation()\" (change)=\"$event ? selection.toggle(row) : null\" [checked]=\"selection.isSelected(row)\" -->\n              <mat-checkbox [disabled]=\"(row.type === 'button' && row.name === 'configure') || (row.type === 'route' && row.name === '/starterApp/configuration') \"\n                            (click)=\"$event.stopPropagation()\" [checked]=\"isSelected(row, role.id)\"\n                            (change)=\"$event ? toggle(row, role.id) : null\"\n              ></mat-checkbox>\n            </td>\n          </ng-container>\n\n          <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n          <tr mat-row *matRowDef=\"let row; columns: displayedColumns;\"></tr>\n\n          <!-- Group header -->\n          <ng-container matColumnDef=\"groupHeader\">\n            <td colspan=\"999\" mat-cell *matCellDef=\"let groupBy\"><strong>{{groupBy.initial}}</strong></td>\n          </ng-container>\n\n          <tr mat-row *matRowDef=\"let row; columns: ['groupHeader']; when: isGroup\"></tr>\n\n        </table>\n      </div>\n      <div fxFlex class=\"tcs-filler-panel\"></div>\n      <div fxLayout=\"row\" fxLayoutAlign=\"end end\" fxLayoutGap=\"10px\" style=\"min-height: 50px\">\n        <button mat-raised-button color=\"primary\" (click)=\"runSaveFunction()\">Save</button>\n      </div>\n    </div>\n  </div>\n</div>\n",
                    styles: [".centered-cell{text-align:center}"]
                }] }
    ];
    /** @nocollapse */
    LiveAppsSettingsAccessControlComponent.ctorParameters = function () { return [
        { type: ActivatedRoute },
        { type: TcAccessControlService },
        { type: MatSnackBar }
    ]; };
    return LiveAppsSettingsAccessControlComponent;
}());
export { LiveAppsSettingsAccessControlComponent };
if (false) {
    /** @type {?} */
    LiveAppsSettingsAccessControlComponent.prototype.displayedColumns;
    /** @type {?} */
    LiveAppsSettingsAccessControlComponent.prototype.dataSource;
    /**
     * @type {?}
     * @private
     */
    LiveAppsSettingsAccessControlComponent.prototype.accessControlConfiguration;
    /** @type {?} */
    LiveAppsSettingsAccessControlComponent.prototype.allRoles;
    /**
     * @type {?}
     * @private
     */
    LiveAppsSettingsAccessControlComponent.prototype.generateTables;
    /** @type {?} */
    LiveAppsSettingsAccessControlComponent.prototype.isSelected;
    /** @type {?} */
    LiveAppsSettingsAccessControlComponent.prototype.toggle;
    /**
     * @type {?}
     * @private
     */
    LiveAppsSettingsAccessControlComponent.prototype.route;
    /**
     * @type {?}
     * @private
     */
    LiveAppsSettingsAccessControlComponent.prototype.accessControlService;
    /**
     * @type {?}
     * @private
     */
    LiveAppsSettingsAccessControlComponent.prototype.snackBar;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLXNldHRpbmdzLWFjY2Vzcy1jb250cm9sLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0aWJjby10Y3N0ay90Yy1saXZlYXBwcy1saWIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9saXZlLWFwcHMtc2V0dGluZ3MtYWNjZXNzLWNvbnRyb2wvbGl2ZS1hcHBzLXNldHRpbmdzLWFjY2Vzcy1jb250cm9sLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFDbEQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2pELE9BQU8sRUFBNEIsc0NBQXNDLEVBQVMsTUFBTSw2QkFBNkIsQ0FBQztBQUN0SCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUNsRixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFaEQ7SUFnQkksZ0RBQ1ksS0FBcUIsRUFDckIsb0JBQTRDLEVBQzVDLFFBQXFCO1FBSGpDLGlCQUlLO1FBSE8sVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFDckIseUJBQW9CLEdBQXBCLG9CQUFvQixDQUF3QjtRQUM1QyxhQUFRLEdBQVIsUUFBUSxDQUFhO1FBYmpDLHFCQUFnQixHQUFhLEVBQUUsQ0FBQztRQUNoQyxlQUFVLEdBQUcsRUFBRSxDQUFDO1FBa0RSLG1CQUFjOzs7UUFBRztZQUNyQixLQUFJLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNqQyxLQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxPQUFPOzs7O1lBQUMsVUFBQSxJQUFJO2dCQUM1QixLQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN4QyxDQUFDLEVBQUMsQ0FBQztZQUVILDJEQUEyRDtZQUMz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d0JBQUosSUFBSTthQU9kOzs7Ozs7Ozs7UUFFRCxJQUFJLENBQUMsb0JBQW9CLENBQUMseUJBQXlCLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsd0JBQXdCLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsSUFBSSxDQUFDLDBCQUEwQixDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsMEJBQTBCLEVBQUUsSUFBSSxDQUFDLDBCQUEwQixDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVM7Ozs7UUFDdFAsVUFBQSxNQUFNO1lBQ0YsS0FBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsb0NBQW9DLEVBQUUsSUFBSSxFQUFFO2dCQUMzRCxRQUFRLEVBQUUsSUFBSTthQUNqQixDQUFDLENBQUM7UUFDUCxDQUFDOzs7O1FBQ0QsVUFBQSxLQUFLO1lBQ0QsS0FBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsaURBQWlELEVBQUUsSUFBSSxFQUFFO2dCQUN4RSxRQUFRLEVBQUUsSUFBSTthQUNqQixDQUFDLENBQUM7UUFDUCxDQUFDLEVBQ0osQ0FBQztJQUtOLENBQUM7O2dCQXZESixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLHdDQUF3QztvQkFDbEQsdzdFQUFpRTs7aUJBRXBFOzs7O2dCQVRRLGNBQWM7Z0JBRWQsc0JBQXNCO2dCQUN0QixXQUFXOztJQXNHcEIsNkNBQUM7Q0FBQSxBQXBHRCxJQW9HQztTQS9GWSxzQ0FBc0M7OztJQUMvQyxrRUFBZ0M7O0lBQ2hDLDREQUFnQjs7Ozs7SUFFaEIsNEVBQTZEOztJQUM1RCwwREFBZ0I7Ozs7O0lBK0NqQixnRUE0QkM7O0lBRUQsNERBRUM7O0lBRUQsd0RBUUM7Ozs7O0lBbEZHLHVEQUE2Qjs7Ozs7SUFDN0Isc0VBQW9EOzs7OztJQUNwRCwwREFBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWN0aXZhdGVkUm91dGUgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgUm91dGVBY2Nlc3NDb250cm9sQ29uZmlnLCBSb3V0ZUFjY2Vzc0NvbnRyb2xDb25maWd1cmF0aW9uRWxlbWVudCwgUm9sZXMgfSBmcm9tICcuLi8uLi9tb2RlbHMvdGMtZ3JvdXBzLWRhdGEnO1xuaW1wb3J0IHsgVGNBY2Nlc3NDb250cm9sU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3RjLWFjY2Vzcy1jb250cm9sLnNlcnZpY2UnO1xuaW1wb3J0IHsgTWF0U25hY2tCYXIgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAndGNsYS1saXZlLWFwcHMtc2V0dGluZ3MtYWNjZXNzLWNvbnRyb2wnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9saXZlLWFwcHMtc2V0dGluZ3MtYWNjZXNzLWNvbnRyb2wuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL2xpdmUtYXBwcy1zZXR0aW5ncy1hY2Nlc3MtY29udHJvbC5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgTGl2ZUFwcHNTZXR0aW5nc0FjY2Vzc0NvbnRyb2xDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAgIGRpc3BsYXllZENvbHVtbnM6IHN0cmluZ1tdID0gW107XG4gICAgZGF0YVNvdXJjZSA9IFtdO1xuXG4gICAgcHJpdmF0ZSBhY2Nlc3NDb250cm9sQ29uZmlndXJhdGlvbjogUm91dGVBY2Nlc3NDb250cm9sQ29uZmlnO1xuICAgICBhbGxSb2xlczogUm9sZXM7XG5cbiAgICBpc0dyb3VwKGluZGV4LCBpdGVtKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBpdGVtLmlzR3JvdXBCeTtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSByb3V0ZTogQWN0aXZhdGVkUm91dGUsXG4gICAgICAgIHByaXZhdGUgYWNjZXNzQ29udHJvbFNlcnZpY2U6IFRjQWNjZXNzQ29udHJvbFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgc25hY2tCYXI6IE1hdFNuYWNrQmFyXG4gICAgKSB7IH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLmFjY2Vzc0NvbnRyb2xDb25maWd1cmF0aW9uID0gdGhpcy5yb3V0ZS5zbmFwc2hvdC5kYXRhLmFjY2Vzc0NvbnRyb2xDb25maWdIb2xkZXI7XG4gICAgICAgIHRoaXMuYWxsUm9sZXMgPSB0aGlzLnJvdXRlLnNuYXBzaG90LmRhdGEuYWxsUm9sZXM7XG4gICAgICAgIHRoaXMuZ2VuZXJhdGVUYWJsZXMoKTtcbiAgICB9XG5cbiAgICBydW5TYXZlRnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuYWNjZXNzQ29udHJvbENvbmZpZ3VyYXRpb24uY29uZmlndXJhdGlvbiA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IHJvbGUgb2YgdGhpcy5hbGxSb2xlcy5yb2xlcyl7XG4gICAgICAgICAgICBsZXQgdXNlckNvbmZpZ3VyYXRpb24gPSB0aGlzLmRhdGFTb3VyY2UuZmlsdGVyKGVudHJ5ID0+IGVudHJ5W3JvbGUuaWRdKTtcbiAgICAgICAgICAgIGxldCByb3V0ZXMgPSB1c2VyQ29uZmlndXJhdGlvbi5maWx0ZXIocm93ID0+IHJvdy50eXBlID09PSAncm91dGUnKS5tYXAoZWxlbWVudCA9PiBlbGVtZW50Lm5hbWUpO1xuICAgICAgICAgICAgbGV0IGJ1dHRvbklkcyA9IHVzZXJDb25maWd1cmF0aW9uLmZpbHRlcihyb3cgPT4gcm93LnR5cGUgPT09ICdidXR0b24nKS5tYXAoZWxlbWVudCA9PiBlbGVtZW50Lm5hbWUpO1xuICAgICAgICAgICAgdGhpcy5hY2Nlc3NDb250cm9sQ29uZmlndXJhdGlvbi5jb25maWd1cmF0aW9uLnB1c2goXG4gICAgICAgICAgICAgICAgbmV3IFJvdXRlQWNjZXNzQ29udHJvbENvbmZpZ3VyYXRpb25FbGVtZW50KCkuZGVzZXJpYWxpemUoeydyb2xlSWQnOiByb2xlLmlkLCByb3V0ZXM6IHJvdXRlcywgYnV0dG9uSWRzOiBidXR0b25JZHN9KVxuICAgICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hY2Nlc3NDb250cm9sU2VydmljZS51cGRhdGVBY2Nlc3NDb250cm9sQ29uZmlnKE51bWJlcih0aGlzLnJvdXRlLnNuYXBzaG90LmRhdGEuY2xhaW1zLnByaW1hcnlQcm9kdWN0aW9uU2FuZGJveC5pZCkudmFsdWVPZigpLCB0aGlzLmFjY2Vzc0NvbnRyb2xDb25maWd1cmF0aW9uLnVpQXBwSWQsIHRoaXMuYWNjZXNzQ29udHJvbENvbmZpZ3VyYXRpb24sIHRoaXMuYWNjZXNzQ29udHJvbENvbmZpZ3VyYXRpb24uaWQpLnN1YnNjcmliZShcbiAgICAgICAgICAgIHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zbmFja0Jhci5vcGVuKCdBY2Nlc3MgQ29udHJvbCBjb25maWd1cmF0aW9uIHNhdmVkJywgJ09LJywge1xuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMzAwMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNuYWNrQmFyLm9wZW4oJ0Vycm9yIHNhdmluZyBBY2Nlc3MgQ29udHJvbCBjb25maWd1cmF0aW9uIHNhdmVkJywgJ09LJywge1xuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMzAwMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuXG5cblxuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZW5lcmF0ZVRhYmxlcyA9ICgpOiB2b2lkID0+IHtcbiAgICAgICAgdGhpcy5kaXNwbGF5ZWRDb2x1bW5zID0gWyduYW1lJ107IFxuICAgICAgICB0aGlzLmFsbFJvbGVzLnJvbGVzLmZvckVhY2gocm9sZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRpc3BsYXllZENvbHVtbnMucHVzaChyb2xlLmlkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIGluIGRhdGFTb3VyY2UgYWxsIHJvd3Mgd2l0aCB0aGUgYXBwcm9wcmlhdGUgb3JkZXJcbiAgICAgICAgdGhpcy5kYXRhU291cmNlLnB1c2goeyBpbml0aWFsOiAnUm91dGVzJywgaXNHcm91cEJ5OiB0cnVlIH0pO1xuICAgICAgICB0aGlzLmFjY2Vzc0NvbnRyb2xDb25maWd1cmF0aW9uLmFsbG93ZWRSb3V0ZXMuZm9yRWFjaChyb3V0ZSA9PiB0aGlzLmRhdGFTb3VyY2UucHVzaCh7bmFtZTogcm91dGUsIHR5cGU6ICdyb3V0ZSd9KSk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLmRhdGFTb3VyY2UucHVzaCh7IGluaXRpYWw6ICdCdXR0b25zJywgaXNHcm91cEJ5OiB0cnVlIH0pO1xuICAgICAgICB0aGlzLmFjY2Vzc0NvbnRyb2xDb25maWd1cmF0aW9uLmFsbG93ZWRCdXR0b25JZHMuZm9yRWFjaChidXR0b25JZCA9PiB0aGlzLmRhdGFTb3VyY2UucHVzaCh7IG5hbWU6IGJ1dHRvbklkLCB0eXBlOiAnYnV0dG9uJyB9KSk7XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSBkYXRhU291cmNlIHdpdGggdGhlIHByZXZpb3VzIGNvbmZpZ3VyYXRpb25cbiAgICAgICAgdGhpcy5hY2Nlc3NDb250cm9sQ29uZmlndXJhdGlvbi5jb25maWd1cmF0aW9uLmZvckVhY2goY29uZmlnRWxlbWVudCA9PiB7XG4gICAgICAgICAgICAvLyBSb3V0ZXNcbiAgICAgICAgICAgIGNvbmZpZ0VsZW1lbnQucm91dGVzLmZvckVhY2goY29uZmlnUm91dGUgPT4ge1xuICAgICAgICAgICAgICAgIGxldCByb3cgPSB0aGlzLmRhdGFTb3VyY2UuZmlsdGVyKGVudHJ5ID0+IGVudHJ5Lm5hbWUgPT09IGNvbmZpZ1JvdXRlKVswXTtcbiAgICAgICAgICAgICAgICByb3dbY29uZmlnRWxlbWVudC5yb2xlSWRdID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIC8vIEJ1dHRvbnNJZHNcbiAgICAgICAgICAgIGNvbmZpZ0VsZW1lbnQuYnV0dG9uSWRzLmZvckVhY2goY29uZmlnUm91dGUgPT4ge1xuICAgICAgICAgICAgICAgIGxldCByb3cgPSB0aGlzLmRhdGFTb3VyY2UuZmlsdGVyKGVudHJ5ID0+IGVudHJ5Lm5hbWUgPT09IGNvbmZpZ1JvdXRlKVswXTtcbiAgICAgICAgICAgICAgICByb3dbY29uZmlnRWxlbWVudC5yb2xlSWRdID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgcHVibGljIGlzU2VsZWN0ZWQgPSAocm93LCByb2xlKTogYm9vbGVhbiA9PiB7XG4gICAgICAgIHJldHVybiByb3dbcm9sZV07XG4gICAgfVxuXG4gICAgcHVibGljIHRvZ2dsZSA9IChyb3csIHJvbGU6IHN0cmluZykgPT4ge1xuICAgICAgICBsZXQgZHNSb3cgPSB0aGlzLmRhdGFTb3VyY2UuZmlsdGVyKGVudHJ5ID0+IGVudHJ5Lm5hbWUgPT09IHJvdy5uYW1lKVswXTtcblxuICAgICAgICBpZiAoZHNSb3dbcm9sZV0pIHtcbiAgICAgICAgICAgIGRlbGV0ZSBkc1Jvd1tyb2xlXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRzUm93W3JvbGVdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==