/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { HttpClient } from '@angular/common/http';
import { map, take, takeUntil } from 'rxjs/operators';
import { LiveAppsService } from '../../services/live-apps.service';
import { Location } from '@angular/common';
import { LiveAppsComponent } from '../live-apps-component/live-apps-component.component';
import { TcCoreCommonFunctions } from '@tibco-tcstk/tc-core-lib';
import { GENERIC_CASETYPE_ICON_SVG, GENERIC_STATE_ICON_SVG } from '../../services/tc-case-card-config.service';
/**
 * renders a single icon for a state
 *
 * ![alt-text](../live-apps-state-icon.png "")
 *
 * \@example <tcla-live-apps-state-icon></tcla-live-apps-state-icon>
 */
var LiveAppsStateIconComponent = /** @class */ (function (_super) {
    tslib_1.__extends(LiveAppsStateIconComponent, _super);
    function LiveAppsStateIconComponent(sanitizer, http, liveapps, location) {
        var _this = _super.call(this) || this;
        _this.sanitizer = sanitizer;
        _this.http = http;
        _this.liveapps = liveapps;
        _this.location = location;
        _this.svgcontents = undefined;
        _this.refillSVG = (/**
         * @param {?} fill
         * @return {?}
         */
        function (fill) {
            /** @type {?} */
            var updatedsvg = this.svgcontents.replace('fill="<DYNAMICFILL>"', 'fill="' + fill + '"');
            /** @type {?} */
            var newval = this.sanitizer.bypassSecurityTrustHtml(updatedsvg);
            this.iconSVG = newval;
        });
        _this.refresh = (/**
         * @param {?} icon
         * @param {?} fill
         * @return {?}
         */
        function (icon, fill) {
            /** @type {?} */
            var url;
            if (icon && icon !== 'assets/icons/ic-generic-casetype.svg' && icon !== 'assets/icons/ic-generic-state.svg') {
                if (icon.slice(0, 13) === 'assets/icons/') {
                    // if icon is in assets folder we need to prepare the Url
                    url = TcCoreCommonFunctions.prepareUrlForStaticResource(_this.location, icon);
                }
                else {
                    url = '/' + icon;
                }
                _this.liveapps.getIconSVGText(url)
                    .pipe(take(1), takeUntil(_this._destroyed$), map((/**
                 * @param {?} val
                 * @return {?}
                 */
                function (val) {
                    _this.svgcontents = val;
                    val = val.toString().replace('fill="<DYNAMICFILL>"', 'fill="' + fill + '"');
                    /** @type {?} */
                    var newval = _this.sanitizer.bypassSecurityTrustHtml(val);
                    return newval;
                })))
                    .subscribe((/**
                 * @param {?} val
                 * @return {?}
                 */
                function (val) {
                    _this.iconSVG = val;
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    console.log('Unable to retrieve icon: ' + error.errorMsg);
                }));
            }
            else {
                // use generic icon
                /** @type {?} */
                var svgcontents = void 0;
                if (icon === 'assets/icons/ic-generic-casetype.svg') {
                    svgcontents = GENERIC_CASETYPE_ICON_SVG;
                }
                else {
                    svgcontents = GENERIC_STATE_ICON_SVG;
                }
                _this.svgcontents = svgcontents;
                svgcontents = svgcontents.replace('fill="<DYNAMICFILL>"', 'fill="' + fill + '"');
                /** @type {?} */
                var newval = _this.sanitizer.bypassSecurityTrustHtml(svgcontents);
                _this.iconSVG = newval;
            }
        });
        return _this;
    }
    /**
     * @return {?}
     */
    LiveAppsStateIconComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        // this.refresh(this.iconPath, this.color);
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    LiveAppsStateIconComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if ((changes.iconPath && (changes.iconPath.currentValue !== changes.iconPath.previousValue)) || (changes.color && (changes.color.currentValue !== changes.color.previousValue))) {
            this.refresh(this.iconPath, this.color);
        }
    };
    LiveAppsStateIconComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tcla-live-apps-state-icon',
                    template: "<div class=\"la-state-icon-svg\" [innerHtml]=\"iconSVG\" fxLayoutAlign=\"start center\"></div>\n",
                    styles: [":host ::ng-deep .la-state-icon-svg svg{height:16px;width:16px}"]
                }] }
    ];
    /** @nocollapse */
    LiveAppsStateIconComponent.ctorParameters = function () { return [
        { type: DomSanitizer },
        { type: HttpClient },
        { type: LiveAppsService },
        { type: Location }
    ]; };
    LiveAppsStateIconComponent.propDecorators = {
        id: [{ type: Input }],
        iconPath: [{ type: Input }],
        color: [{ type: Input }],
        iconHostURL: [{ type: Input }],
        appId: [{ type: Input }]
    };
    return LiveAppsStateIconComponent;
}(LiveAppsComponent));
export { LiveAppsStateIconComponent };
if (false) {
    /** @type {?} */
    LiveAppsStateIconComponent.prototype.id;
    /** @type {?} */
    LiveAppsStateIconComponent.prototype.iconPath;
    /** @type {?} */
    LiveAppsStateIconComponent.prototype.color;
    /** @type {?} */
    LiveAppsStateIconComponent.prototype.iconHostURL;
    /** @type {?} */
    LiveAppsStateIconComponent.prototype.appId;
    /** @type {?} */
    LiveAppsStateIconComponent.prototype.iconSVG;
    /** @type {?} */
    LiveAppsStateIconComponent.prototype.svgcontents;
    /** @type {?} */
    LiveAppsStateIconComponent.prototype.refillSVG;
    /** @type {?} */
    LiveAppsStateIconComponent.prototype.refresh;
    /**
     * @type {?}
     * @private
     */
    LiveAppsStateIconComponent.prototype.sanitizer;
    /**
     * @type {?}
     * @private
     */
    LiveAppsStateIconComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    LiveAppsStateIconComponent.prototype.liveapps;
    /**
     * @type {?}
     * @private
     */
    LiveAppsStateIconComponent.prototype.location;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLXN0YXRlLWljb24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRpYmNvLXRjc3RrL3RjLWxpdmVhcHBzLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2xpdmUtYXBwcy1zdGF0ZS1pY29uL2xpdmUtYXBwcy1zdGF0ZS1pY29uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsS0FBSyxFQUErRCxNQUFNLGVBQWUsQ0FBQztBQUU3RyxPQUFPLEVBQUMsWUFBWSxFQUFXLE1BQU0sMkJBQTJCLENBQUM7QUFDakUsT0FBTyxFQUFDLFVBQVUsRUFBMEIsTUFBTSxzQkFBc0IsQ0FBQztBQUN6RSxPQUFPLEVBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNwRCxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sa0NBQWtDLENBQUM7QUFDakUsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQ3pDLE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLHNEQUFzRCxDQUFDO0FBQ3ZGLE9BQU8sRUFBQyxxQkFBcUIsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBQy9ELE9BQU8sRUFBQyx5QkFBeUIsRUFBRSxzQkFBc0IsRUFBQyxNQUFNLDRDQUE0QyxDQUFDOzs7Ozs7OztBQVU3RztJQUtnRCxzREFBaUI7SUFVL0Qsb0NBQW9CLFNBQXVCLEVBQVUsSUFBZ0IsRUFBVSxRQUF5QixFQUFVLFFBQWtCO1FBQXBJLFlBQ0UsaUJBQU8sU0FDUjtRQUZtQixlQUFTLEdBQVQsU0FBUyxDQUFjO1FBQVUsVUFBSSxHQUFKLElBQUksQ0FBWTtRQUFVLGNBQVEsR0FBUixRQUFRLENBQWlCO1FBQVUsY0FBUSxHQUFSLFFBQVEsQ0FBVTtRQUY3SCxpQkFBVyxHQUFXLFNBQVMsQ0FBQztRQU1oQyxlQUFTOzs7O1FBQUcs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LENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3pDO0lBQ0gsQ0FBQzs7Z0JBN0VGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsMkJBQTJCO29CQUNyQyw0R0FBb0Q7O2lCQUVyRDs7OztnQkFyQk8sWUFBWTtnQkFDWixVQUFVO2dCQUVWLGVBQWU7Z0JBQ2YsUUFBUTs7O3FCQW1CYixLQUFLOzJCQUNMLEtBQUs7d0JBQ0wsS0FBSzs4QkFDTCxLQUFLO3dCQUNMLEtBQUs7O0lBcUVSLGlDQUFDO0NBQUEsQUEvRUQsQ0FLZ0QsaUJBQWlCLEdBMEVoRTtTQTFFWSwwQkFBMEI7OztJQUNyQyx3Q0FBb0I7O0lBQ3BCLDhDQUEwQjs7SUFDMUIsMkNBQXVCOztJQUN2QixpREFBNkI7O0lBQzdCLDJDQUF1Qjs7SUFFdkIsNkNBQXlCOztJQUN6QixpREFBdUM7O0lBTXZDLCtDQUlFOztJQUVGLDZDQXlDQzs7Ozs7SUFuRFcsK0NBQStCOzs7OztJQUFFLDBDQUF3Qjs7Ozs7SUFBRSw4Q0FBaUM7Ozs7O0lBQUUsOENBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIElucHV0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT25Jbml0LCBTZWN1cml0eUNvbnRleHQsIFNpbXBsZUNoYW5nZXN9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtTdWJqZWN0fSBmcm9tICdyeGpzJztcbmltcG9ydCB7RG9tU2FuaXRpemVyLCBTYWZlSHRtbH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG5pbXBvcnQge0h0dHBDbGllbnQsIEh0dHBIZWFkZXJzLCBIdHRwUGFyYW1zfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQge21hcCwgdGFrZSwgdGFrZVVudGlsfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQge0xpdmVBcHBzU2VydmljZX0gZnJvbSAnLi4vLi4vc2VydmljZXMvbGl2ZS1hcHBzLnNlcnZpY2UnO1xuaW1wb3J0IHtMb2NhdGlvbn0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7TGl2ZUFwcHNDb21wb25lbnR9IGZyb20gJy4uL2xpdmUtYXBwcy1jb21wb25lbnQvbGl2ZS1hcHBzLWNvbXBvbmVudC5jb21wb25lbnQnO1xuaW1wb3J0IHtUY0NvcmVDb21tb25GdW5jdGlvbnN9IGZyb20gJ0B0aWJjby10Y3N0ay90Yy1jb3JlLWxpYic7XG5pbXBvcnQge0dFTkVSSUNfQ0FTRVRZUEVfSUNPTl9TVkcsIEdFTkVSSUNfU1RBVEVfSUNPTl9TVkd9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3RjLWNhc2UtY2FyZC1jb25maWcuc2VydmljZSc7XG5cbi8qKlxuICogcmVuZGVycyBhIHNpbmdsZSBpY29uIGZvciBhIHN0YXRlXG4gKlxuICogIVthbHQtdGV4dF0oLi4vbGl2ZS1hcHBzLXN0YXRlLWljb24ucG5nIFwiXCIpXG4gKlxuICpAZXhhbXBsZSA8dGNsYS1saXZlLWFwcHMtc3RhdGUtaWNvbj48L3RjbGEtbGl2ZS1hcHBzLXN0YXRlLWljb24+XG4gKi9cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGNsYS1saXZlLWFwcHMtc3RhdGUtaWNvbicsXG4gIHRlbXBsYXRlVXJsOiAnLi9saXZlLWFwcHMtc3RhdGUtaWNvbi5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2xpdmUtYXBwcy1zdGF0ZS1pY29uLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBMaXZlQXBwc1N0YXRlSWNvbkNvbXBvbmVudCBleHRlbmRzIExpdmVBcHBzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuICBASW5wdXQoKSBpZDogc3RyaW5nO1xuICBASW5wdXQoKSBpY29uUGF0aDogc3RyaW5nO1xuICBASW5wdXQoKSBjb2xvcjogc3RyaW5nO1xuICBASW5wdXQoKSBpY29uSG9zdFVSTDogc3RyaW5nO1xuICBASW5wdXQoKSBhcHBJZDogc3RyaW5nO1xuXG4gIHB1YmxpYyBpY29uU1ZHOiBTYWZlSHRtbDtcbiAgcHVibGljIHN2Z2NvbnRlbnRzOiBzdHJpbmcgPSB1bmRlZmluZWQ7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzYW5pdGl6ZXI6IERvbVNhbml0aXplciwgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LCBwcml2YXRlIGxpdmVhcHBzOiBMaXZlQXBwc1NlcnZpY2UsIHByaXZhdGUgbG9jYXRpb246IExvY2F0aW9uKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHB1YmxpYyByZWZpbGxTVkcgPSBmdW5jdGlvbihmaWxsKSB7XG4gICAgY29uc3QgdXBkYXRlZHN2ZyA9IHRoaXMuc3ZnY29udGVudHMucmVwbGFjZSgnZmlsbD1cIjxEWU5BTUlDRklMTD5cIicsICdmaWxsPVwiJyArIGZpbGwgKyAnXCInKTtcbiAgICBjb25zdCBuZXd2YWwgPSB0aGlzLnNhbml0aXplci5ieXBhc3NTZWN1cml0eVRydXN0SHRtbCh1cGRhdGVkc3ZnKTtcbiAgICB0aGlzLmljb25TVkcgPSBuZXd2YWw7XG4gIH07XG5cbiAgcHVibGljIHJlZnJlc2ggPSAoaWNvbiwgZmlsbCkgPT4ge1xuICAgIGxldCB1cmw6IHN0cmluZztcbiAgICBpZiAoaWNvbiAmJiBpY29uICE9PSAnYXNzZXRzL2ljb25zL2ljLWdlbmVyaWMtY2FzZXR5cGUuc3ZnJyAmJiBpY29uICE9PSAnYXNzZXRzL2ljb25zL2ljLWdlbmVyaWMtc3RhdGUuc3ZnJykge1xuICAgICAgaWYgKGljb24uc2xpY2UoMCwgMTMpID09PSAnYXNzZXRzL2ljb25zLycpIHtcbiAgICAgICAgLy8gaWYgaWNvbiBpcyBpbiBhc3NldHMgZm9sZGVyIHdlIG5lZWQgdG8gcHJlcGFyZSB0aGUgVXJsXG4gICAgICAgIHVybCA9IFRjQ29yZUNvbW1vbkZ1bmN0aW9ucy5wcmVwYXJlVXJsRm9yU3RhdGljUmVzb3VyY2UodGhpcy5sb2NhdGlvbiwgaWNvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB1cmwgPSAnLycgKyBpY29uO1xuICAgICAgfVxuICAgICAgdGhpcy5saXZlYXBwcy5nZXRJY29uU1ZHVGV4dCh1cmwpXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIHRha2UoMSksXG4gICAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCQpLFxuICAgICAgICAgIG1hcCh2YWwgPT4ge1xuICAgICAgICAgICAgICB0aGlzLnN2Z2NvbnRlbnRzID0gdmFsO1xuICAgICAgICAgICAgICB2YWwgPSB2YWwudG9TdHJpbmcoKS5yZXBsYWNlKCdmaWxsPVwiPERZTkFNSUNGSUxMPlwiJywgJ2ZpbGw9XCInICsgZmlsbCArICdcIicpO1xuICAgICAgICAgICAgICBjb25zdCBuZXd2YWwgPSB0aGlzLnNhbml0aXplci5ieXBhc3NTZWN1cml0eVRydXN0SHRtbCh2YWwpO1xuICAgICAgICAgICAgICByZXR1cm4gbmV3dmFsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKHZhbCA9PiB7XG4gICAgICAgICAgICB0aGlzLmljb25TVkcgPSB2YWw7XG4gICAgICAgICAgfVxuICAgICAgICAgICwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1VuYWJsZSB0byByZXRyaWV2ZSBpY29uOiAnICsgZXJyb3IuZXJyb3JNc2cpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gdXNlIGdlbmVyaWMgaWNvblxuICAgICAgbGV0IHN2Z2NvbnRlbnRzOiBzdHJpbmc7XG4gICAgICBpZiAoaWNvbiA9PT0gJ2Fzc2V0cy9pY29ucy9pYy1nZW5lcmljLWNhc2V0eXBlLnN2ZycpIHtcbiAgICAgICAgc3ZnY29udGVudHMgPSBHRU5FUklDX0NBU0VUWVBFX0lDT05fU1ZHO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3ZnY29udGVudHMgPSBHRU5FUklDX1NUQVRFX0lDT05fU1ZHO1xuICAgICAgfVxuICAgICAgdGhpcy5zdmdjb250ZW50cyA9IHN2Z2NvbnRlbnRzO1xuICAgICAgc3ZnY29udGVudHMgPSBzdmdjb250ZW50cy5yZXBsYWNlKCdmaWxsPVwiPERZTkFNSUNGSUxMPlwiJywgJ2ZpbGw9XCInICsgZmlsbCArICdcIicpO1xuICAgICAgY29uc3QgbmV3dmFsID0gdGhpcy5zYW5pdGl6ZXIuYnlwYXNzU2VjdXJpdHlUcnVzdEh0bWwoc3ZnY29udGVudHMpO1xuICAgICAgdGhpcy5pY29uU1ZHID0gbmV3dmFsO1xuICAgIH1cbiAgfVxuXG5cbiAgbmdPbkluaXQoKSB7XG4gICAgLy8gdGhpcy5yZWZyZXNoKHRoaXMuaWNvblBhdGgsIHRoaXMuY29sb3IpO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmICgoY2hhbmdlcy5pY29uUGF0aCAmJiAoY2hhbmdlcy5pY29uUGF0aC5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXMuaWNvblBhdGgucHJldmlvdXNWYWx1ZSkpIHx8IChjaGFuZ2VzLmNvbG9yICYmIChjaGFuZ2VzLmNvbG9yLmN1cnJlbnRWYWx1ZSAhPT0gY2hhbmdlcy5jb2xvci5wcmV2aW91c1ZhbHVlKSkpIHtcbiAgICAgIHRoaXMucmVmcmVzaCh0aGlzLmljb25QYXRoLCB0aGlzLmNvbG9yKTtcbiAgICB9XG4gIH1cblxufVxuIl19