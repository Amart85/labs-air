/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { map, take, takeUntil } from 'rxjs/operators';
import { LiveAppsComponent } from '../live-apps-component/live-apps-component.component';
import { TcCaseAuditService } from '../../services/tc-case-audit.service';
/**
 * Render audit trail for a case
 *
 *  ![alt-text](../live-apps-case-audit.png "Image")
 *
 * \@example <tcla-live-apps-case-audit></tcla-live-apps-case-audit>
 */
var LiveAppsCaseAuditComponent = /** @class */ (function (_super) {
    tslib_1.__extends(LiveAppsCaseAuditComponent, _super);
    function LiveAppsCaseAuditComponent(caseAuditService) {
        var _this = _super.call(this) || this;
        _this.caseAuditService = caseAuditService;
        _this.auditEvents = [];
        _this.startat = undefined;
        _this.top = 20;
        _this.end = false;
        _this.refresh = (/**
         * @return {?}
         */
        function () {
            _this.startat = undefined;
            _this.top = 20;
            _this.end = false;
            _this.auditEvents = [];
            _this.getAuditEvents(_this.caseRef, _this.sandboxId, _this.startat, _this.top);
        });
        _this.getAuditEvents = (/**
         * @param {?} caseRef
         * @param {?} sandboxId
         * @param {?} startAt
         * @param {?} top
         * @return {?}
         */
        function (caseRef, sandboxId, startAt, top) {
            _this.caseAuditService.getCaseAudit(_this.caseRef, _this.sandboxId, _this.startat, _this.top)
                .pipe(take(1), takeUntil(_this._destroyed$), map((/**
             * @param {?} auditeventlist
             * @return {?}
             */
            function (auditeventlist) {
                // this will strip any duplicates that may have been retrieved due to fast scrolling
                /** @type {?} */
                var filteredEvents = auditeventlist.auditevents.filter((/**
                 * @param {?} x
                 * @return {?}
                 */
                function (x) { return _this.auditEvents.every((/**
                 * @param {?} y
                 * @return {?}
                 */
                function (y) { return y.key.value !== x.key.value; })); }));
                _this.auditEvents = _this.auditEvents.concat(filteredEvents);
                if (auditeventlist.auditevents.length < _this.top) {
                    _this.end = true;
                }
                else {
                    _this.startat = auditeventlist.auditevents[auditeventlist.auditevents.length - 1].key.value;
                }
            }))).subscribe(null, (/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                _this.errorMessage = 'Error retrieving case audit: ' + error.error.errorMsg;
            }));
        });
        _this.getNextBatch = (/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            if (!_this.end) {
                _this.getAuditEvents(_this.caseRef, _this.sandboxId, _this.startat, _this.top);
            }
        });
        return _this;
    }
    LiveAppsCaseAuditComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tcla-live-apps-case-audit',
                    template: "<div class=\"tcs-case-audit-pane\" fxLayout=\"column\" fxFill style=\"overflow: hidden;\">\n  <tc-tibco-cloud-widget-header fxFlex=\"nogrow\" [headerText]=\"'Audit'\"\n                                [icon]=\"'tcs-recent-icon'\"></tc-tibco-cloud-widget-header>\n\n\n  <!--div *ngIf=\"auditEvents && auditEvents.length > 0\" class=\"tcs-case-audit-container\">\n\n  </div-->\n  <div class=\"audit-template\" style=\"height: 100%\">\n  <cdk-virtual-scroll-viewport style=\"height: 100%\" itemSize=\"50\" (scrolledIndexChange)=\"getNextBatch($event)\">\n    <ul style=\"\"\n         *cdkVirtualFor=\"let item of auditEvents; let i = index\">\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.messageId.value === 'BP_INSTANCE_CREATED'\">\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"BP_INSTANCE_CREATED\"></mat-icon>\n        </div>\n        <div class=\"audit-details\">\n          <li>\n            <span *ngIf=\"item.principalName\">{{item.principalName.value}} </span>\n            <span>\n                      <span> started </span>\n                      <b>{{item.procName.value}}</b>\n                      <span> on {{item.creationTime.value | date:'full'}}</span>\n                  </span>\n          </li>\n        </div>\n        <div class=\"audit-line\"></div>\n      </div>\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.messageId.value === 'BP_AUTO_STARTED_INSTANCE'\">\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"BP_AUTO_STARTED_INSTANCE\"></mat-icon>\n        </div>\n        <li>\n          <!--span *ngIf=\"item.principalName\">{{item.principalName.value}} </span-->\n          <span>\n                    <b>{{item.procName.value}}</b>\n                    <span> auto initiated on {{item.creationTime.value | date:'full'}}</span>\n                </span>\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.messageId.value === 'BP_DELAYED_AUTO_STARTED_INSTANCE'\">\n        <!-- todo: JS fix this -->\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"BP_DELAYED_AUTO_STARTED_INSTANCE\"></mat-icon>\n        </div>\n        <li>\n          <span>\n                    <b>{{item.procName.value}}</b>\n\t\t\t\t\t<span> deadline auto initiated on {{item.creationTime.value | date:'full'}}</span>\n          <span>. </span>\n          <span> Time to deadline {{item.delayTime.value}}></span>. </span>\n          <!--span class=\"skip-delay\" *ngIf=\"isInstanceDelayed(item)\" ng-click=\"skipDelay(item)\" skip\"></span>\n                </span-->\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.messageId.value === 'BP_DELAYED_AUTO_START_TIMER_EXPIRED'\">\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"BP_DELAYED_AUTO_START_TIMER_EXPIRED\"></mat-icon>\n        </div>\n        <li>\n          <span>\n            <b>{{item.procName.value}}</b>\n\t\t\t\t\t  <span> deadline reached {{item.creationTime.value | date: 'full'}}></span>\n          </span>\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.messageId.value === 'BP_DELAYED_AUTO_STARTED_INSTANCE_CANCELLED_DUE_TO_STATE_CHANGE'\">\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"BP_DELAYED_AUTO_STARTED_INSTANCE_CANCELLED_DUE_TO_STATE_CHANGE\"></mat-icon>\n        </div>\n        <li>\n          <!--span *ngIf=\"item.principalName\">{{item.principalName.value}} </span-->\n          <span>\n                    <b>{{item.procName.value}}</b>\n            <span> deadline cancelled {{item.creationTime.value | date: 'full'}}</span>\n          </span>\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.messageId.value === 'BP_TASK_CREATED' && ['User Task','Email Task','Calculation Task','TCI Task','AuditSafe Task'].indexOf(item.taskType.value) > -1\">\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"{{item.taskType.value}}\"></mat-icon>\n        </div>\n        <li>\n                <span>\n                    <b>{{item.taskName.value}}</b>\n                    <span> initiated on {{item.creationTime.value | date: 'full'}}</span>\n                </span>\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.messageId.value === 'CM_CASE_CREATED'\">\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"CM_CASE_CREATED\"></mat-icon>\n        </div>\n        <li>\n          <span *ngIf=\"item.principalName\">{{item.principalName.value}}</span>\n          <span class=\"spanPadding\">\n                    <span> created </span>\n                    <b> {{item.label.value}}</b>\n                    <span> in state</span>\n                    <span class=\"audit-state\">\"{{item.caseState.value}}\"</span>\n                    <span> on {{item.creationTime.value | date: 'full'}}</span>\n                </span>\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.messageId.value === 'CM_CASE_UPDATED_STATE_CHANGED'\">\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"CM_CASE_UPDATED_STATE_CHANGED\"></mat-icon>\n        </div>\n        <li>\n          <span *ngIf=\"item.principalName\">{{item.principalName.value}}</span>\n          <span class=\"spanPadding\">\n                    <span> updated </span>\n                    <b> {{item.label.value}}</b>\n                    <span>, new state is></span>\n                    <span class=\"audit-state\"> \"{{item.caseState.value}}\" </span>\n                    <span> on {{item.creationTime.value | date: 'full'}}</span>\n                </span>\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.messageId.value === 'CM_CASE_UPDATED'\">\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"CM_CASE_UPDATED\"></mat-icon>\n        </div>\n        <li>\n          <span *ngIf=\"item.principalName\">{{item.principalName.value}}</span>\n          <span class=\"spanPadding\">\n                    <span> updated </span>\n                    <b> {{item.label.value}} </b>\n                    <span> on {{item.creationTime.value | date: 'full'}}</span>\n                </span>\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.messageId.value === 'WR_FOLDER_ARTIFACT_CREATED'\">\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"WR_FOLDER_ARTIFACT_CREATED\"></mat-icon>\n        </div>\n        <li>\n          <span *ngIf=\"item.principalName\">{{item.principalName.value}}</span>\n          <span class=\"spanPadding\">\n                    <span> uploaded </span>\n                    <span>{{item.artifactName.value}}</span>\n                    <span> on {{item.creationTime.value | date:'full'}}</span>\n                </span>\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.messageId.value === 'WR_FOLDER_ARTIFACT_UPDATED'\">\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"WR_FOLDER_ARTIFACT_UPDATED\"></mat-icon>\n        </div>\n        <li>\n          <span *ngIf=\"item.principalName\">{{item.principalName.value}}</span>\n          <span class=\"spanPadding\">\n                    <span> updated </span>\n                    <span>{{item.artifactName.value}}</span>\n                    <span> on {{item.creationTime.value | date:'full'}}</span>\n                </span>\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.messageId.value === 'WR_FOLDER_ARTIFACT_DELETED'\">\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"WR_FOLDER_ARTIFACT_DELETED\"></mat-icon>\n        </div>\n        <li>\n          <span *ngIf=\"item.principalName\">{{item.principalName.value}}</span>\n          <span class=\"spanPadding\">\n                    <span> deleted </span>\n                    <span>{{item.artifactName.value}}</span>\n                    <span> on {{item.creationTime.value | date:'full'}}</span>\n                </span>\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.messageId.value === 'BP_TASK_COMPLETED' && ['User Task','Email Task','Calculation Task','TCI Task','AuditSafe Task'].indexOf(item.taskType.value) > -1\">\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"{{item.taskType.value}}\"></mat-icon>\n        </div>\n        <li>\n          <span *ngIf=\"item.principalName\">{{item.principalName.value}} </span>\n          <span>\n                    <span> completed </span>\n                    <b> {{item.taskName.value}} </b>\n                    <span> on {{item.creationTime.value | date: 'full'}}</span>\n                </span>\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.messageId.value === 'BP_INSTANCE_COMPLETED'\">\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"BP_INSTANCE_COMPLETED\"></mat-icon>\n        </div>\n        <li>\n                <span>\n                    <b>{{item.procName.value}} </b>\n                    <span> on {{item.creationTime.value | date: 'full'}}</span>\n                </span>\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.severity.value === 'ERROR'\">\n        <div class=\"audit-icon-container\">\n          <mat-icon svgIcon=\"ERROR\"></mat-icon>\n        </div>\n        <li>\n                <span *ngIf=\"item.principalName\">{{item.principalName.value}} has error at {{item.taskName.value}}\n                </span>\n          <b> {{item.message.value | parseAuditMessage : item }}</b>\n          <span> on {{item.creationTime.value | date: 'full'}}</span>\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n      <div class=\"tcs-case-audit-dtl\" *ngIf=\"item.severity.value === 'WARN'\">\n        <div class=\"audit-icon-container warn-icon\">\n          <mat-icon svgIcon=\"ERROR\"></mat-icon>\n        </div>\n        <li>\n                <span *ngIf=\"item.principalName\">{{item.principalName.value}} has warning at {{item.taskName.value}}>\n                </span>\n          <b> {{item.message.value | parseAuditMessage : item }}</b>\n          <span> on {{item.creationTime.value | date: 'full'}}</span>\n        </li>\n        <div class=\"audit-line\"></div>\n      </div>\n\n\n    </ul>\n  </cdk-virtual-scroll-viewport>\n  </div>\n</div>\n",
                    styles: [".tcs-case-audit-pane{border-radius:3px;box-shadow:0 2px 4px 0 rgba(0,0,0,.33);background-color:#fff}.tcs-case-audit-container{height:100%;overflow-x:auto;padding:11px}.tcs-case-audit-dtl{height:70px}.audit-template{padding:20px}.audit-template span{font-family:Source Sans Pro;font-size:12px;font-weight:400;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:normal}.audit-template ul{padding-left:25px;border-left:2px solid #bfbfbf;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;-webkit-box-align:center;align-items:center;position:relative;margin-left:20px;margin-right:20px}.audit-icon-container{background-color:#fff;padding:5px;position:absolute;left:-19px;border-radius:50%;border:1px solid #0081cb}.audit-icon-container mat-icon{padding:4px}"]
                }] }
    ];
    /** @nocollapse */
    LiveAppsCaseAuditComponent.ctorParameters = function () { return [
        { type: TcCaseAuditService }
    ]; };
    LiveAppsCaseAuditComponent.propDecorators = {
        caseRef: [{ type: Input }],
        sandboxId: [{ type: Input }]
    };
    return LiveAppsCaseAuditComponent;
}(LiveAppsComponent));
export { LiveAppsCaseAuditComponent };
if (false) {
    /**
     * The case reference
     * @type {?}
     */
    LiveAppsCaseAuditComponent.prototype.caseRef;
    /**
     * sandboxId - this comes from claims resolver
     * @type {?}
     */
    LiveAppsCaseAuditComponent.prototype.sandboxId;
    /** @type {?} */
    LiveAppsCaseAuditComponent.prototype.auditEvents;
    /** @type {?} */
    LiveAppsCaseAuditComponent.prototype.errorMessage;
    /** @type {?} */
    LiveAppsCaseAuditComponent.prototype.startat;
    /** @type {?} */
    LiveAppsCaseAuditComponent.prototype.top;
    /** @type {?} */
    LiveAppsCaseAuditComponent.prototype.end;
    /** @type {?} */
    LiveAppsCaseAuditComponent.prototype.refresh;
    /** @type {?} */
    LiveAppsCaseAuditComponent.prototype.getAuditEvents;
    /** @type {?} */
    LiveAppsCaseAuditComponent.prototype.getNextBatch;
    /**
     * @type {?}
     * @private
     */
    LiveAppsCaseAuditComponent.prototype.caseAuditService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLWNhc2UtYXVkaXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRpYmNvLXRjc3RrL3RjLWxpdmVhcHBzLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2xpdmUtYXBwcy1jYXNlLWF1ZGl0L2xpdmUtYXBwcy1jYXNlLWF1ZGl0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsS0FBSyxFQUFvQixNQUFNLGVBQWUsQ0FBQztBQUNsRSxPQUFPLEVBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUVwRCxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxzREFBc0QsQ0FBQztBQUN2RixPQUFPLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSxzQ0FBc0MsQ0FBQzs7Ozs7Ozs7QUFTeEU7SUFLZ0Qsc0RBQWlCO0lBcUQvRCxvQ0FBb0IsZ0JBQW9DO1FBQXhELFlBQ0UsaUJBQU8sU0FDUjtRQUZtQixzQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQW9CO1FBekNqRCxpQkFBVyxHQUFpQixFQUFFLENBQUM7UUFFL0IsYUFBTyxHQUFHLFNBQVMsQ0FBQztRQUNwQixTQUFHLEdBQUcsRUFBRSxDQUFDO1FBQ1QsU0FBRyxHQUFHLEtBQUssQ0FBQztRQUVaLGFBQU87OztRQUFHO1lBQ2YsS0FBSSxDQUFDLE9BQU8sR0FBRyxTQUFTLENBQUM7WUFDekIsS0FBSSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUM7WUFDZCxLQUFJLENBQUMsR0FBRyxHQUFHLEtBQUssQ0FBQztZQUNqQixLQUFJLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztZQUN0QixLQUFJLENBQUMsY0FBYyxDQUFDLEtBQUksQ0FBQyxPQUFPLEVBQUUsS0FBSSxDQUFDLFNBQVMsRUFBRSxLQUFJLENBQUMsT0FBTyxFQUFFLEtBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUM1RSxDQUFDLEVBQUE7UUFFTSxvQkFBYzs7Ozs7OztRQUFHLFVBQUMsT0FBZSxFQUFFLFNBQWlCLEVBQUUsT0FBZSxFQUFFLEdBQVc7WUFDdkYsS0FBSSxDQUFDLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxLQUFJLENBQUMsT0FBTyxFQUFFLEtBQUksQ0FBQyxTQUFTLEVBQUUsS0FBSSxDQUFDLE9BQU8sRUFBRSxLQUFJLENBQUMsR0FBRyxDQUFDO2lCQUNyRixJQUFJLENBQ0gsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNQLFNBQVMsQ0FBQyxLQUFJLENBQUMsV0FBVyxDQUFDLEVBQzNCLEdBQUc7Ozs7WUFBQyxVQUFBLGNBQWM7OztvQkFFVixjQUFjLEdBQUcsY0FBYyxDQUFDLFdBQVcsQ0FBQyxNQUFNOzs7O2dCQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsS0FBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLOzs7O2dCQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQTNCLENBQTJCLEVBQUMsRUFBeEQsQ0FBd0QsRUFBQztnQkFDdkgsS0FBSSxDQUFDLFdBQVcsR0FBRyxLQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztnQkFDM0QsSUFBSSxjQUFjLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxLQUFJLENBQUMsR0FBRyxFQUFFO29CQUNoRCxLQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQztpQkFDakI7cUJBQU07b0JBQ0wsS0FBSSxDQUFDLE9BQU8sR0FBRyxjQUFjLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUM7aUJBQzVGO1lBQ0gsQ0FBQyxFQUFDLENBQ0gsQ0FBQyxTQUFTLENBQ1gsSUFBSTs7OztZQUFFLFVBQUEsS0FBSztnQkFDVCxLQUFJLENBQUMsWUFBWSxHQUFHLCtCQUErQixHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDO1lBQzdFLENBQUMsRUFBQyxDQUFDO1FBQ1AsQ0FBQyxFQUFBO1FBRU0sa0JBQVk7Ozs7UUFBRyxVQUFDLEtBQUs7WUFDMUIsSUFBSSxDQUFDLEtBQUksQ0FBQyxHQUFHLEVBQUU7Z0JBQ2IsS0FBSSxDQUFDLGNBQWMsQ0FBQyxLQUFJLENBQUMsT0FBTyxFQUFFLEtBQUksQ0FBQyxTQUFTLEVBQUUsS0FBSSxDQUFDLE9BQU8sRUFBRSxLQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDM0U7UUFDSCxDQUFDLEVBQUE7O0lBSUQsQ0FBQzs7Z0JBNURGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsMkJBQTJCO29CQUNyQyxzMlZBQW9EOztpQkFFckQ7Ozs7Z0JBYk8sa0JBQWtCOzs7MEJBbUJ2QixLQUFLOzRCQUtMLEtBQUs7O0lBK0NSLGlDQUFDO0NBQUEsQUE5REQsQ0FLZ0QsaUJBQWlCLEdBeURoRTtTQXpEWSwwQkFBMEI7Ozs7OztJQUtyQyw2Q0FBeUI7Ozs7O0lBS3pCLCtDQUEyQjs7SUFFM0IsaURBQXNDOztJQUN0QyxrREFBNEI7O0lBQzVCLDZDQUEyQjs7SUFDM0IseUNBQWdCOztJQUNoQix5Q0FBbUI7O0lBRW5CLDZDQU1DOztJQUVELG9EQW1CQzs7SUFFRCxrREFJQzs7Ozs7SUFFVyxzREFBNEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgSW5wdXQsIE9uRGVzdHJveSwgT25Jbml0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7bWFwLCB0YWtlLCB0YWtlVW50aWx9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7QXVkaXRFdmVudH0gZnJvbSAnLi4vLi4vbW9kZWxzL3RjLWNhc2UtYXVkaXQnO1xuaW1wb3J0IHtMaXZlQXBwc0NvbXBvbmVudH0gZnJvbSAnLi4vbGl2ZS1hcHBzLWNvbXBvbmVudC9saXZlLWFwcHMtY29tcG9uZW50LmNvbXBvbmVudCc7XG5pbXBvcnQge1RjQ2FzZUF1ZGl0U2VydmljZX0gZnJvbSAnLi4vLi4vc2VydmljZXMvdGMtY2FzZS1hdWRpdC5zZXJ2aWNlJztcblxuLyoqXG4gKiBSZW5kZXIgYXVkaXQgdHJhaWwgZm9yIGEgY2FzZVxuICpcbiAqICAhW2FsdC10ZXh0XSguLi9saXZlLWFwcHMtY2FzZS1hdWRpdC5wbmcgXCJJbWFnZVwiKVxuICpcbiAqQGV4YW1wbGUgPHRjbGEtbGl2ZS1hcHBzLWNhc2UtYXVkaXQ+PC90Y2xhLWxpdmUtYXBwcy1jYXNlLWF1ZGl0PlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0Y2xhLWxpdmUtYXBwcy1jYXNlLWF1ZGl0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL2xpdmUtYXBwcy1jYXNlLWF1ZGl0LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbGl2ZS1hcHBzLWNhc2UtYXVkaXQuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIExpdmVBcHBzQ2FzZUF1ZGl0Q29tcG9uZW50IGV4dGVuZHMgTGl2ZUFwcHNDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuXG4gIC8qKlxuICAgKiBUaGUgY2FzZSByZWZlcmVuY2VcbiAgICovXG4gIEBJbnB1dCgpIGNhc2VSZWY6IHN0cmluZztcblxuICAvKipcbiAgICogc2FuZGJveElkIC0gdGhpcyBjb21lcyBmcm9tIGNsYWltcyByZXNvbHZlclxuICAgKi9cbiAgQElucHV0KCkgc2FuZGJveElkOiBudW1iZXI7XG5cbiAgcHVibGljIGF1ZGl0RXZlbnRzOiBBdWRpdEV2ZW50W10gPSBbXTtcbiAgcHVibGljIGVycm9yTWVzc2FnZTogc3RyaW5nO1xuICBwdWJsaWMgc3RhcnRhdCA9IHVuZGVmaW5lZDtcbiAgcHVibGljIHRvcCA9IDIwO1xuICBwdWJsaWMgZW5kID0gZmFsc2U7XG5cbiAgcHVibGljIHJlZnJlc2ggPSAoKSA9PiB7XG4gICAgdGhpcy5zdGFydGF0ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudG9wID0gMjA7XG4gICAgdGhpcy5lbmQgPSBmYWxzZTtcbiAgICB0aGlzLmF1ZGl0RXZlbnRzID0gW107XG4gICAgdGhpcy5nZXRBdWRpdEV2ZW50cyh0aGlzLmNhc2VSZWYsIHRoaXMuc2FuZGJveElkLCB0aGlzLnN0YXJ0YXQsIHRoaXMudG9wKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRBdWRpdEV2ZW50cyA9IChjYXNlUmVmOiBzdHJpbmcsIHNhbmRib3hJZDogbnVtYmVyLCBzdGFydEF0OiBudW1iZXIsIHRvcDogbnVtYmVyKSA9PiB7XG4gICAgdGhpcy5jYXNlQXVkaXRTZXJ2aWNlLmdldENhc2VBdWRpdCh0aGlzLmNhc2VSZWYsIHRoaXMuc2FuZGJveElkLCB0aGlzLnN0YXJ0YXQsIHRoaXMudG9wKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRha2UoMSksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQkKSxcbiAgICAgICAgbWFwKGF1ZGl0ZXZlbnRsaXN0ID0+IHtcbiAgICAgICAgICAvLyB0aGlzIHdpbGwgc3RyaXAgYW55IGR1cGxpY2F0ZXMgdGhhdCBtYXkgaGF2ZSBiZWVuIHJldHJpZXZlZCBkdWUgdG8gZmFzdCBzY3JvbGxpbmdcbiAgICAgICAgICBjb25zdCBmaWx0ZXJlZEV2ZW50cyA9IGF1ZGl0ZXZlbnRsaXN0LmF1ZGl0ZXZlbnRzLmZpbHRlcih4ID0+IHRoaXMuYXVkaXRFdmVudHMuZXZlcnkoeSA9PiB5LmtleS52YWx1ZSAhPT0geC5rZXkudmFsdWUpKVxuICAgICAgICAgIHRoaXMuYXVkaXRFdmVudHMgPSB0aGlzLmF1ZGl0RXZlbnRzLmNvbmNhdChmaWx0ZXJlZEV2ZW50cyk7XG4gICAgICAgICAgaWYgKGF1ZGl0ZXZlbnRsaXN0LmF1ZGl0ZXZlbnRzLmxlbmd0aCA8IHRoaXMudG9wKSB7XG4gICAgICAgICAgICB0aGlzLmVuZCA9IHRydWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRhdCA9IGF1ZGl0ZXZlbnRsaXN0LmF1ZGl0ZXZlbnRzW2F1ZGl0ZXZlbnRsaXN0LmF1ZGl0ZXZlbnRzLmxlbmd0aCAtIDFdLmtleS52YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICApLnN1YnNjcmliZShcbiAgICAgIG51bGwsIGVycm9yID0+IHtcbiAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSAnRXJyb3IgcmV0cmlldmluZyBjYXNlIGF1ZGl0OiAnICsgZXJyb3IuZXJyb3IuZXJyb3JNc2c7XG4gICAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBnZXROZXh0QmF0Y2ggPSAoZXZlbnQpID0+IHtcbiAgICBpZiAoIXRoaXMuZW5kKSB7XG4gICAgICB0aGlzLmdldEF1ZGl0RXZlbnRzKHRoaXMuY2FzZVJlZiwgdGhpcy5zYW5kYm94SWQsIHRoaXMuc3RhcnRhdCwgdGhpcy50b3ApO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2FzZUF1ZGl0U2VydmljZTogVGNDYXNlQXVkaXRTZXJ2aWNlKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG59XG4iXX0=