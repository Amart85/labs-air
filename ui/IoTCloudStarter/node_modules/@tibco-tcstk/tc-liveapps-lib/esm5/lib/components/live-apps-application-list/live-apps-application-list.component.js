/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { LiveAppsApplicationsComponent } from '../live-apps-applications/live-apps-applications.component';
import { map, take, takeUntil } from 'rxjs/operators';
import { MatSelectionList } from '@angular/material';
/**
 * Special rendering of LiveAppsApplicationsComponent
 *
 * \@example <tcla-live-apps-application-list></tcla-live-apps-application-list>
 */
var LiveAppsApplicationListComponent = /** @class */ (function (_super) {
    tslib_1.__extends(LiveAppsApplicationListComponent, _super);
    function LiveAppsApplicationListComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        /**
         * The app Ids selected (output)
         */
        _this.selectedAppIds = [];
        /**
         * ~event appsSelected : Applications selected in component (CaseType objects)
         * ~payload CaseType[] : Array of CaseType objects of what was selected
         */
        _this.appsSelected = new EventEmitter();
        /**
         * ~event appIdsSelected : Applications selected in component (appIds)
         * ~payload string[] : selected App Ids from the application list (used on config)
         */
        _this.appIdsSelected = new EventEmitter();
        _this.handleAppSelection = (/**
         * @param {?} selectionEvent
         * @return {?}
         */
        function (selectionEvent) {
            _this.appsSelected.emit(selectionEvent);
            /** @type {?} */
            var selIds = [];
            selectionEvent.forEach((/**
             * @param {?} selected
             * @return {?}
             */
            function (selected) {
                selIds.push(selected.applicationId);
            }));
            _this.appIdsSelected.emit(selIds);
        });
        _this.handleSelectAll = (/**
         * @return {?}
         */
        function () {
            _this.mySelectedOptions = _this.applications.casetypes;
            _this.appIdsSelected.emit(_this.getAppIds(_this.mySelectedOptions));
            _this.appsSelected.emit(_this.applications.casetypes);
        });
        _this.handleDeselectAll = (/**
         * @return {?}
         */
        function () {
            _this.mySelectedOptions = [];
            _this.appIdsSelected.emit([]);
            _this.appsSelected.emit([]);
        });
        _this.getAppIds = (/**
         * @param {?} casetypes
         * @return {?}
         */
        function (casetypes) {
            /** @type {?} */
            var selIds = [];
            casetypes.forEach((/**
             * @param {?} selected
             * @return {?}
             */
            function (selected) {
                selIds.push(selected.applicationId);
            }));
            return selIds;
        });
        _this.refresh = (/**
         * @param {?} bypassCache
         * @return {?}
         */
        function (bypassCache) {
            _this.liveapps.getApplications(_this.sandboxId, _this.appIds, 100, bypassCache)
                .pipe(take(1), takeUntil(_this._destroyed$), map((/**
             * @param {?} applicationList
             * @return {?}
             */
            function (applicationList) {
                _this.applications = applicationList;
                // handle single app selection input
                if (_this.selectedApp && _this.selectedApp.applicationId) {
                    _this.selectedApp = applicationList.casetypes.find((/**
                     * @param {?} casetype
                     * @return {?}
                     */
                    function (casetype) {
                        return casetype.applicationId === _this.selectedApp.applicationId;
                    }));
                    // this.selection.emit(this.selectedApp);
                }
                else if (_this.selectedAppIds && _this.selectedAppIds.length > 0) {
                    // pre select any casetypes that were passed in the selectedAppIds input attribute
                    _this.mySelectedOptions = _this.applications.casetypes.filter((/**
                     * @param {?} casetype
                     * @return {?}
                     */
                    function (casetype) {
                        return (_this.selectedAppIds.findIndex((/**
                         * @param {?} ct
                         * @return {?}
                         */
                        function (ct) {
                            return ct === casetype.applicationId;
                        })) !== -1);
                    }));
                }
            })))
                .subscribe(null, (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { _this.errorMessage = 'Error retrieving applications: ' + error.error.errorMsg; }));
        });
        return _this;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    LiveAppsApplicationListComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        // only interested in initial selection - catching every change would create an infinite loop!
        if (changes.selectedAppIds && (changes.selectedAppIds.firstChange)) {
            this.refresh(false);
        }
    };
    /**
     * @return {?}
     */
    LiveAppsApplicationListComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        // leave this blank so superclass ngOnInit not called
    };
    LiveAppsApplicationListComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tcla-live-apps-application-list',
                    template: "<div fxFlex style=\"padding: 10px;\" fxLayout=\"column\">\n  <div fxLayout=\"row\" class=\"tcs-application-list-buttons\">\n    <button mat-button (click)=\"handleSelectAll()\">\n      <span>Select All</span>\n    </button>\n    <button mat-button (click)=\"handleDeselectAll()\">\n      <span>Deselect All</span>\n    </button>\n  </div>\n  <mat-selection-list class=\"tcs-application-list\" #selectedApps [(ngModel)]=\"mySelectedOptions\" (ngModelChange)=\"handleAppSelection($event)\"\n                      fxLayout=\"column\" fxLayout=\"row wrap\">\n    <mat-list-option class=\"tcs-application-option\" checkboxPosition=\"before\"\n                     *ngFor=\"let casetype of applications.casetypes\"\n                     [value]=\"casetype\">\n      <span>{{casetype.label}}</span>\n    </mat-list-option>\n  </mat-selection-list>\n</div>\n",
                    styles: [".tcs-application-option{max-width:320px}.tcs-application-list{overflow:auto}.tcs-application-list-buttons{min-height:40px}"]
                }] }
    ];
    LiveAppsApplicationListComponent.propDecorators = {
        appSelectionList: [{ type: ViewChild, args: [MatSelectionList, { static: false },] }],
        selectedAppIds: [{ type: Input }],
        appsSelected: [{ type: Output }],
        appIdsSelected: [{ type: Output }]
    };
    return LiveAppsApplicationListComponent;
}(LiveAppsApplicationsComponent));
export { LiveAppsApplicationListComponent };
if (false) {
    /** @type {?} */
    LiveAppsApplicationListComponent.prototype.appSelectionList;
    /**
     * The app Ids selected (output)
     * @type {?}
     */
    LiveAppsApplicationListComponent.prototype.selectedAppIds;
    /**
     * ~event appsSelected : Applications selected in component (CaseType objects)
     * ~payload CaseType[] : Array of CaseType objects of what was selected
     * @type {?}
     */
    LiveAppsApplicationListComponent.prototype.appsSelected;
    /**
     * ~event appIdsSelected : Applications selected in component (appIds)
     * ~payload string[] : selected App Ids from the application list (used on config)
     * @type {?}
     */
    LiveAppsApplicationListComponent.prototype.appIdsSelected;
    /** @type {?} */
    LiveAppsApplicationListComponent.prototype.mySelectedOptions;
    /** @type {?} */
    LiveAppsApplicationListComponent.prototype.handleAppSelection;
    /** @type {?} */
    LiveAppsApplicationListComponent.prototype.handleSelectAll;
    /** @type {?} */
    LiveAppsApplicationListComponent.prototype.handleDeselectAll;
    /**
     * @type {?}
     * @private
     */
    LiveAppsApplicationListComponent.prototype.getAppIds;
    /** @type {?} */
    LiveAppsApplicationListComponent.prototype.refresh;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLWFwcGxpY2F0aW9uLWxpc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRpYmNvLXRjc3RrL3RjLWxpdmVhcHBzLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2xpdmUtYXBwcy1hcHBsaWNhdGlvbi1saXN0L2xpdmUtYXBwcy1hcHBsaWNhdGlvbi1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFpQixTQUFTLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFFbEgsT0FBTyxFQUFDLDZCQUE2QixFQUFDLE1BQU0sNERBQTRELENBQUM7QUFDekcsT0FBTyxFQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEQsT0FBTyxFQUFDLGdCQUFnQixFQUFDLE1BQU0sbUJBQW1CLENBQUM7Ozs7OztBQVNuRDtJQUtzRCw0REFBNkI7SUFMbkY7UUFBQSxxRUErRkM7Ozs7UUFwRlUsb0JBQWMsR0FBYSxFQUFFLENBQUM7Ozs7O1FBTTdCLGtCQUFZLEdBQTZCLElBQUksWUFBWSxFQUFjLENBQUM7Ozs7O1FBTXhFLG9CQUFjLEdBQTJCLElBQUksWUFBWSxFQUFZLENBQUM7UUFLaEYsd0JBQWtCOzs7O1FBQUcsVUFBQyxjQUEwQjtZQUM5QyxLQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQzs7Z0JBQ2pDLE1BQU0sR0FBRyxFQUFFO1lBQ2pCLGNBQWMsQ0FBQyxPQUFPOzs7O1lBQUMsVUFBQyxRQUFRO2dCQUM5QixNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUN0QyxDQUFDLEVBQUMsQ0FBQztZQUNILEtBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ25DLENBQUMsRUFBQTtRQUVELHFCQUFlOzs7UUFBRztZQUNoQixLQUFJLENBQUMsaUJBQWlCLEdBQUcsS0FBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUM7WUFDckQsS0FBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLFNBQVMsQ0FBQyxLQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDO1lBQ2pFLEtBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdEQsQ0FBQyxFQUFBO1FBRUQsdUJBQWlCOzs7UUFBRztZQUNsQixLQUFJLENBQUMsaUJBQWlCLEdBQUcsRUFBRSxDQUFDO1lBQzVCLEtBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzdCLEtBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzdCLENBQUMsRUFBQTtRQUVPLGVBQVM7Ozs7UUFBRyxVQUFDLFNBQXFCOztnQkFDbEMsTUFBTSxHQUFHLEVBQUU7WUFDakIsU0FBUyxDQUFDLE9BQU87Ozs7WUFBQyxVQUFDLFFBQVE7Z0JBQ3pCLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ3RDLENBQUMsRUFBQyxDQUFDO1lBQ0gsT0FBTyxNQUFNLENBQUM7UUFDaEIsQ0FBQyxFQUFBO1FBRU0sYUFBTzs7OztRQUFHLFVBQUMsV0FBb0I7WUFDcEMsS0FBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsS0FBSSxDQUFDLFNBQVMsRUFBRSxLQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxXQUFXLENBQUM7aUJBQ3pFLElBQUksQ0FDSCxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQ1AsU0FBUyxDQUFDLEtBQUksQ0FBQyxXQUFXLENBQUMsRUFDM0IsR0FBRzs7OztZQUFDLFVBQUEsZUFBZTtnQkFDakIsS0FBSSxDQUFDLFlBQVksR0FBRyxlQUFlLENBQUM7Z0JBQ3BDLG9DQUFvQztnQkFDcEMsSUFBSSxLQUFJLENBQUMsV0FBVyxJQUFJLEtBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxFQUFFO29CQUN0RCxLQUFJLENBQUMsV0FBVyxHQUFHLGVBQWUsQ0FBQyxTQUFTLENBQUMsSUFBSTs7OztvQkFBQyxVQUFDLFFBQVE7d0JBQ3pELE9BQU8sUUFBUSxDQUFDLGFBQWEsS0FBSyxLQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQztvQkFDbkUsQ0FBQyxFQUFDLENBQUM7b0JBQ0gseUNBQXlDO2lCQUMxQztxQkFBTSxJQUFJLEtBQUksQ0FBQyxjQUFjLElBQUksS0FBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO29CQUNoRSxrRkFBa0Y7b0JBQ2xGLEtBQUksQ0FBQyxpQkFBaUIsR0FBRyxLQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxNQUFNOzs7O29CQUFDLFVBQUEsUUFBUTt3QkFDbEUsT0FBTyxDQUFDLEtBQUksQ0FBQyxjQUFjLENBQUMsU0FBUzs7Ozt3QkFBQyxVQUFDLEVBQUU7NEJBQ3ZDLE9BQU8sRUFBRSxLQUFLLFFBQVEsQ0FBQyxhQUFhLENBQUM7d0JBQ3ZDLENBQUMsRUFDQSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ1osQ0FBQyxFQUFDLENBQUM7aUJBQ0o7WUFDSCxDQUFDLEVBQUMsQ0FDSDtpQkFDQSxTQUFTLENBQUMsSUFBSTs7OztZQUFFLFVBQUEsS0FBSyxJQUFNLEtBQUksQ0FBQyxZQUFZLEdBQUcsaUNBQWlDLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQztRQUNqSCxDQUFDLEVBQUE7O0lBYUgsQ0FBQzs7Ozs7SUFYQyxzREFBVzs7OztJQUFYLFVBQVksT0FBc0I7UUFDaEMsOEZBQThGO1FBQzlGLElBQUksT0FBTyxDQUFDLGNBQWMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLEVBQUU7WUFDbEUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUNyQjtJQUNILENBQUM7Ozs7SUFHRCxtREFBUTs7O0lBQVI7UUFDRSxxREFBcUQ7SUFDdkQsQ0FBQzs7Z0JBOUZGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsaUNBQWlDO29CQUMzQyw4MUJBQTBEOztpQkFFM0Q7OzttQ0FFRSxTQUFTLFNBQUUsZ0JBQWdCLEVBQUUsRUFBQyxNQUFNLEVBQUUsS0FBSyxFQUFDO2lDQUs1QyxLQUFLOytCQU1MLE1BQU07aUNBTU4sTUFBTTs7SUF3RVQsdUNBQUM7Q0FBQSxBQS9GRCxDQUtzRCw2QkFBNkIsR0EwRmxGO1NBMUZZLGdDQUFnQzs7O0lBQzNDLDREQUFrRjs7Ozs7SUFLbEYsMERBQXVDOzs7Ozs7SUFNdkMsd0RBQWtGOzs7Ozs7SUFNbEYsMERBQWdGOztJQUdoRiw2REFBcUM7O0lBRXJDLDhEQU9DOztJQUVELDJEQUlDOztJQUVELDZEQUlDOzs7OztJQUVELHFEQU1DOztJQUVELG1EQXlCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkNoYW5nZXMsIE9uSW5pdCwgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtDYXNlVHlwZX0gZnJvbSAnLi4vLi4vbW9kZWxzL2xpdmVhcHBzZGF0YSc7XG5pbXBvcnQge0xpdmVBcHBzQXBwbGljYXRpb25zQ29tcG9uZW50fSBmcm9tICcuLi9saXZlLWFwcHMtYXBwbGljYXRpb25zL2xpdmUtYXBwcy1hcHBsaWNhdGlvbnMuY29tcG9uZW50JztcbmltcG9ydCB7bWFwLCB0YWtlLCB0YWtlVW50aWx9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7TWF0U2VsZWN0aW9uTGlzdH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuXG5cbi8qKlxuICogU3BlY2lhbCByZW5kZXJpbmcgb2YgTGl2ZUFwcHNBcHBsaWNhdGlvbnNDb21wb25lbnRcbiAqXG4gKkBleGFtcGxlIDx0Y2xhLWxpdmUtYXBwcy1hcHBsaWNhdGlvbi1saXN0PjwvdGNsYS1saXZlLWFwcHMtYXBwbGljYXRpb24tbGlzdD5cbiAqL1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0Y2xhLWxpdmUtYXBwcy1hcHBsaWNhdGlvbi1saXN0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL2xpdmUtYXBwcy1hcHBsaWNhdGlvbi1saXN0LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbGl2ZS1hcHBzLWFwcGxpY2F0aW9uLWxpc3QuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIExpdmVBcHBzQXBwbGljYXRpb25MaXN0Q29tcG9uZW50IGV4dGVuZHMgTGl2ZUFwcHNBcHBsaWNhdGlvbnNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG4gIEBWaWV3Q2hpbGQgKE1hdFNlbGVjdGlvbkxpc3QsIHtzdGF0aWM6IGZhbHNlfSkgYXBwU2VsZWN0aW9uTGlzdDogTWF0U2VsZWN0aW9uTGlzdDtcblxuICAvKipcbiAgICogVGhlIGFwcCBJZHMgc2VsZWN0ZWQgKG91dHB1dClcbiAgICovXG4gIEBJbnB1dCgpIHNlbGVjdGVkQXBwSWRzOiBzdHJpbmdbXSA9IFtdO1xuXG4gIC8qKlxuICAgKiB+ZXZlbnQgYXBwc1NlbGVjdGVkIDogQXBwbGljYXRpb25zIHNlbGVjdGVkIGluIGNvbXBvbmVudCAoQ2FzZVR5cGUgb2JqZWN0cylcbiAgICogfnBheWxvYWQgQ2FzZVR5cGVbXSA6IEFycmF5IG9mIENhc2VUeXBlIG9iamVjdHMgb2Ygd2hhdCB3YXMgc2VsZWN0ZWRcbiAgICovXG4gIEBPdXRwdXQoKSBhcHBzU2VsZWN0ZWQ6IEV2ZW50RW1pdHRlcjxDYXNlVHlwZVtdPiA9IG5ldyBFdmVudEVtaXR0ZXI8Q2FzZVR5cGVbXT4oKTtcblxuICAvKipcbiAgICogfmV2ZW50IGFwcElkc1NlbGVjdGVkIDogQXBwbGljYXRpb25zIHNlbGVjdGVkIGluIGNvbXBvbmVudCAoYXBwSWRzKVxuICAgKiB+cGF5bG9hZCBzdHJpbmdbXSA6IHNlbGVjdGVkIEFwcCBJZHMgZnJvbSB0aGUgYXBwbGljYXRpb24gbGlzdCAodXNlZCBvbiBjb25maWcpXG4gICAqL1xuICBAT3V0cHV0KCkgYXBwSWRzU2VsZWN0ZWQ6IEV2ZW50RW1pdHRlcjxzdHJpbmdbXT4gPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZ1tdPigpO1xuXG5cbiAgcHVibGljIG15U2VsZWN0ZWRPcHRpb25zOiBDYXNlVHlwZVtdO1xuXG4gIGhhbmRsZUFwcFNlbGVjdGlvbiA9IChzZWxlY3Rpb25FdmVudDogQ2FzZVR5cGVbXSkgPT4ge1xuICAgIHRoaXMuYXBwc1NlbGVjdGVkLmVtaXQoc2VsZWN0aW9uRXZlbnQpO1xuICAgIGNvbnN0IHNlbElkcyA9IFtdO1xuICAgIHNlbGVjdGlvbkV2ZW50LmZvckVhY2goKHNlbGVjdGVkKSA9PiB7XG4gICAgICBzZWxJZHMucHVzaChzZWxlY3RlZC5hcHBsaWNhdGlvbklkKTtcbiAgICB9KTtcbiAgICB0aGlzLmFwcElkc1NlbGVjdGVkLmVtaXQoc2VsSWRzKTtcbiAgfVxuXG4gIGhhbmRsZVNlbGVjdEFsbCA9ICgpID0+IHtcbiAgICB0aGlzLm15U2VsZWN0ZWRPcHRpb25zID0gdGhpcy5hcHBsaWNhdGlvbnMuY2FzZXR5cGVzO1xuICAgIHRoaXMuYXBwSWRzU2VsZWN0ZWQuZW1pdCh0aGlzLmdldEFwcElkcyh0aGlzLm15U2VsZWN0ZWRPcHRpb25zKSk7XG4gICAgdGhpcy5hcHBzU2VsZWN0ZWQuZW1pdCh0aGlzLmFwcGxpY2F0aW9ucy5jYXNldHlwZXMpO1xuICB9XG5cbiAgaGFuZGxlRGVzZWxlY3RBbGwgPSAoKSA9PiB7XG4gICAgdGhpcy5teVNlbGVjdGVkT3B0aW9ucyA9IFtdO1xuICAgIHRoaXMuYXBwSWRzU2VsZWN0ZWQuZW1pdChbXSk7XG4gICAgdGhpcy5hcHBzU2VsZWN0ZWQuZW1pdChbXSk7XG4gIH1cblxuICBwcml2YXRlIGdldEFwcElkcyA9IChjYXNldHlwZXM6IENhc2VUeXBlW10pOiBzdHJpbmdbXSA9PiB7XG4gICAgY29uc3Qgc2VsSWRzID0gW107XG4gICAgY2FzZXR5cGVzLmZvckVhY2goKHNlbGVjdGVkKSA9PiB7XG4gICAgICBzZWxJZHMucHVzaChzZWxlY3RlZC5hcHBsaWNhdGlvbklkKTtcbiAgICB9KTtcbiAgICByZXR1cm4gc2VsSWRzO1xuICB9XG5cbiAgcHVibGljIHJlZnJlc2ggPSAoYnlwYXNzQ2FjaGU6IGJvb2xlYW4pID0+IHtcbiAgICB0aGlzLmxpdmVhcHBzLmdldEFwcGxpY2F0aW9ucyh0aGlzLnNhbmRib3hJZCwgdGhpcy5hcHBJZHMsIDEwMCwgYnlwYXNzQ2FjaGUpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCQpLFxuICAgICAgICBtYXAoYXBwbGljYXRpb25MaXN0ID0+IHtcbiAgICAgICAgICB0aGlzLmFwcGxpY2F0aW9ucyA9IGFwcGxpY2F0aW9uTGlzdDtcbiAgICAgICAgICAvLyBoYW5kbGUgc2luZ2xlIGFwcCBzZWxlY3Rpb24gaW5wdXRcbiAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEFwcCAmJiB0aGlzLnNlbGVjdGVkQXBwLmFwcGxpY2F0aW9uSWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRBcHAgPSBhcHBsaWNhdGlvbkxpc3QuY2FzZXR5cGVzLmZpbmQoKGNhc2V0eXBlKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBjYXNldHlwZS5hcHBsaWNhdGlvbklkID09PSB0aGlzLnNlbGVjdGVkQXBwLmFwcGxpY2F0aW9uSWQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIHRoaXMuc2VsZWN0aW9uLmVtaXQodGhpcy5zZWxlY3RlZEFwcCk7XG4gICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNlbGVjdGVkQXBwSWRzICYmIHRoaXMuc2VsZWN0ZWRBcHBJZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgLy8gcHJlIHNlbGVjdCBhbnkgY2FzZXR5cGVzIHRoYXQgd2VyZSBwYXNzZWQgaW4gdGhlIHNlbGVjdGVkQXBwSWRzIGlucHV0IGF0dHJpYnV0ZVxuICAgICAgICAgICAgdGhpcy5teVNlbGVjdGVkT3B0aW9ucyA9IHRoaXMuYXBwbGljYXRpb25zLmNhc2V0eXBlcy5maWx0ZXIoY2FzZXR5cGUgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gKHRoaXMuc2VsZWN0ZWRBcHBJZHMuZmluZEluZGV4KChjdCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBjdCA9PT0gY2FzZXR5cGUuYXBwbGljYXRpb25JZDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICApICE9PSAtMSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKG51bGwsIGVycm9yID0+IHsgdGhpcy5lcnJvck1lc3NhZ2UgPSAnRXJyb3IgcmV0cmlldmluZyBhcHBsaWNhdGlvbnM6ICcgKyBlcnJvci5lcnJvci5lcnJvck1zZzsgfSk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgLy8gb25seSBpbnRlcmVzdGVkIGluIGluaXRpYWwgc2VsZWN0aW9uIC0gY2F0Y2hpbmcgZXZlcnkgY2hhbmdlIHdvdWxkIGNyZWF0ZSBhbiBpbmZpbml0ZSBsb29wIVxuICAgIGlmIChjaGFuZ2VzLnNlbGVjdGVkQXBwSWRzICYmIChjaGFuZ2VzLnNlbGVjdGVkQXBwSWRzLmZpcnN0Q2hhbmdlKSkge1xuICAgICAgdGhpcy5yZWZyZXNoKGZhbHNlKTtcbiAgICB9XG4gIH1cblxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIC8vIGxlYXZlIHRoaXMgYmxhbmsgc28gc3VwZXJjbGFzcyBuZ09uSW5pdCBub3QgY2FsbGVkXG4gIH1cbn1cbiJdfQ==