/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { BaseChartDirective } from 'ng2-charts';
import { LiveAppsComponent } from '../live-apps-component/live-apps-component.component';
import { TcLiveAppsReportingService } from '../../services/tc-live-apps-reporting.service';
import { take, takeUntil } from 'rxjs/operators';
import 'chartjs-plugin-datalabels';
import { DEFAULT_COLORS, DEFAULT_TYPE_COLOR } from '../../services/tc-case-card-config.service';
/**
 * Home page active cases widget sub component
 *
 * \@example <tcla-live-apps-active-cases-for-type-report></tcla-live-apps-active-cases-for-type-report>
 */
export class LiveAppsActiveCasesForTypeReportComponent extends LiveAppsComponent {
    /**
     * @param {?} reportingService
     */
    constructor(reportingService) {
        super();
        this.reportingService = reportingService;
        /**
         * Maximum rows to show in legend before it is hidden (otherwise would take whole widget)
         */
        this.maxLegendItems = this.maxLegendItems ? this.maxLegendItems : 8;
        /**
         * Whether to show percentages or raw case numbers on the doughnut chart
         */
        this.showPercentages = this.showPercentages ? this.showPercentages : false;
        /**
         * ~event selectedCaseTypeState : Case Type state selected in vizualization
         * ~payload CaseTypeStateReportStateInfo : CaseTypeStateReportStateInfo object selected from component (to drive caller to display something different (drill down))
         */
        this.selectedCaseTypeState = new EventEmitter();
        this.renderChart = false;
        this.doughnutChartData = [];
        this.doughnutChartType = 'doughnut';
        this.chartColors = [];
        this.defaultColors = DEFAULT_COLORS.slice().reverse();
        this.getCaseCount = (/**
         * @return {?}
         */
        () => {
            return this.totalActiveCaseCount;
        });
        this.doughnutChartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            legend: {
                position: 'left'
            },
            layout: {
                padding: {
                    left: 0,
                    right: 0,
                    top: 10,
                    bottom: 10
                }
            },
            plugins: {
                doughnutlabel: {
                    labels: [
                        {
                            text: this.getCaseCount,
                            font: {
                                size: '20',
                                family: 'Source Sans Pro',
                                weight: 'bold'
                            },
                            color: '#FF7800'
                        },
                        {
                            text: 'cases',
                            font: {
                                size: '16',
                                family: 'Source Sans Pro',
                            },
                            color: '#FF7800'
                        }
                    ]
                },
                datalabels: {
                    anchor: 'end',
                    backgroundColor: (/**
                     * @param {?} context
                     * @return {?}
                     */
                    function (context) {
                        return context.dataset.backgroundColor;
                    }),
                    borderColor: 'white',
                    borderRadius: 25,
                    borderWidth: 2,
                    color: 'white',
                    display: (/**
                     * @param {?} context
                     * @return {?}
                     */
                    function (context) {
                        /** @type {?} */
                        const dataset = context.dataset;
                        /** @type {?} */
                        const value = dataset.data[context.dataIndex];
                        return value > 0;
                    }),
                    font: {
                        weight: 'bold'
                    },
                    formatter: (/**
                     * @param {?} value
                     * @param {?} ctx
                     * @return {?}
                     */
                    (value, ctx) => {
                        /** @type {?} */
                        const datasets = ctx.chart.data.datasets;
                        if (datasets.indexOf(ctx.dataset) === datasets.length - 1) {
                            if (this.showPercentages) {
                                /** @type {?} */
                                const sum = datasets[0].data.reduce((/**
                                 * @param {?} a
                                 * @param {?} b
                                 * @return {?}
                                 */
                                (a, b) => a + b), 0);
                                /** @type {?} */
                                const percentage = Math.round((value / sum) * 100) + '%';
                                return percentage;
                            }
                            else {
                                return value;
                            }
                        }
                        else {
                            return 0;
                        }
                    })
                }
            }
        };
        this.initReportDataToChart = (/**
         * @param {?} reportData
         * @param {?} status
         * @return {?}
         */
        (reportData, status) => {
            this.doughnutChartData = [];
            this.totalActiveCaseCount = 0;
            /** @type {?} */
            const casesByStateArray = [];
            /** @type {?} */
            const labels = [];
            /** @type {?} */
            const colorArray = [];
            // remove any taken colors from the defaultColors
            // we have to do this before parsing the record to avoid getting same colors
            reportData.caseStates.forEach((/**
             * @param {?} cs
             * @return {?}
             */
            cs => {
                // remove color from defaults
                if (cs.stateInfo.color) {
                    this.defaultColors = this.defaultColors.filter((/**
                     * @param {?} item
                     * @return {?}
                     */
                    item => item !== cs.stateInfo.color));
                }
            }));
            // parse record
            reportData.caseStates.forEach((/**
             * @param {?} caseState
             * @return {?}
             */
            caseState => {
                this.totalActiveCaseCount = this.totalActiveCaseCount + caseState.caseCount;
                casesByStateArray.push(caseState.caseCount);
                labels.push(caseState.stateInfo.label);
                // we will re-color anything that has the default color
                /** @type {?} */
                let col;
                if (caseState.stateInfo.color && caseState.stateInfo.color !== DEFAULT_TYPE_COLOR) {
                    // use the set color
                    col = caseState.stateInfo.color;
                }
                else {
                    // try and get a color from the palette
                    /** @type {?} */
                    const palCol = this.defaultColors.pop();
                    if (palCol) {
                        col = palCol;
                    }
                    else {
                        // if no more in palette use a random color!
                        /** @type {?} */
                        const i = Math.random() * 0xffffff;
                        /** @type {?} */
                        const p = parseInt(i.toString(), 0);
                        col = '#' + p.toString(16);
                    }
                }
                colorArray.push(col);
            }));
            this.doughnutChartData.push(casesByStateArray);
            this.doughnutChartLabels = labels;
            this.chartColors.push({ backgroundColor: colorArray });
            // showing more than 8 in the legend will take up too much space
            this.doughnutChartOptions.legend.display = labels.length <= 8;
            this.renderChart = true;
        });
        this.refresh = (/**
         * @return {?}
         */
        () => {
            this.reportingService.getCaseTypeStateReport(this.sandboxId, this.appId, this.typeId, false, this.uiAppId).pipe(take(1), takeUntil(this._destroyed$))
                .subscribe((/**
             * @param {?} report
             * @return {?}
             */
            report => {
                this.caseTypeStateReport = report;
                this.initReportDataToChart(report, status);
                return report;
            }), (/**
             * @param {?} error
             * @return {?}
             */
            error => { this.errorMessage = 'Error retrieving case types report: ' + error.error.errorMsg; }));
        });
    }
    // events
    /**
     * @param {?} __0
     * @return {?}
     */
    chartClicked({ event, active }) {
        if (active.length > 0) {
            /** @type {?} */
            const chart = active[0]._chart;
            /** @type {?} */
            const activePoints = chart.getElementAtEvent(event);
            if (activePoints.length > 0) {
                // get the internal index of slice in pie chart
                /** @type {?} */
                const clickedElementIndex = activePoints[0]._index;
                /** @type {?} */
                const label = chart.data.labels[clickedElementIndex];
                // get value by index
                /** @type {?} */
                const value = chart.data.datasets[0].data[clickedElementIndex];
                console.log(clickedElementIndex, label, value);
                this.selectedCaseTypeState.emit(this.caseTypeStateReport.caseStates[clickedElementIndex].stateInfo);
            }
        }
    }
    /**
     * @param {?} __0
     * @return {?}
     */
    chartHovered({ event, active }) {
        // console.log(event, active);
    }
    /**
     * @return {?}
     */
    ngAfterViewChecked() {
        if (this.componentDiv && this.caseTypeStateReport && this.componentDiv.nativeElement.offsetWidth) {
            if (this.widgetWidth !== this.componentDiv.nativeElement.offsetWidth || this.widgetHeight !== this.componentDiv.nativeElement.offsetHeight) {
                this.widgetWidth = this.componentDiv.nativeElement.offsetWidth;
                this.widgetHeight = this.componentDiv.nativeElement.offsetHeight;
                this.caseTypeStateReportChart.chart.resize();
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.appId && (changes.firstChange || (changes.appId.currentValue !== changes.appId.previousValue))) {
            this.refresh();
        }
    }
}
LiveAppsActiveCasesForTypeReportComponent.decorators = [
    { type: Component, args: [{
                selector: 'tcla-live-apps-active-cases-for-type-report',
                template: "<div #componentDiv fxLayout=\"column\" fxFlex style=\"overflow: auto\">\n  <div *ngIf=\"renderChart\" style=\"height:100%; width:100%; padding: 20px\" class=\"relative\">\n    <canvas #caseReportChart baseChart\n            [data]=\"doughnutChartData\"\n            [labels]=\"doughnutChartLabels\"\n            [chartType]=\"doughnutChartType\"\n            [options]=\"doughnutChartOptions\"\n            [colors]=\"chartColors\"\n            (chartHover)=\"chartHovered($event)\"\n            (chartClick)=\"chartClicked($event)\"\n    >\n    </canvas>\n  </div>\n</div>\n",
                styles: [""]
            }] }
];
/** @nocollapse */
LiveAppsActiveCasesForTypeReportComponent.ctorParameters = () => [
    { type: TcLiveAppsReportingService }
];
LiveAppsActiveCasesForTypeReportComponent.propDecorators = {
    sandboxId: [{ type: Input }],
    appId: [{ type: Input }],
    typeId: [{ type: Input }],
    uiAppId: [{ type: Input }],
    maxLegendItems: [{ type: Input }],
    showPercentages: [{ type: Input }],
    selectedCaseTypeState: [{ type: Output }],
    caseTypeStateReportChart: [{ type: ViewChild, args: [BaseChartDirective, { static: false },] }],
    componentDiv: [{ type: ViewChild, args: ['componentDiv', { static: false },] }]
};
if (false) {
    /**
     * sandboxId - this comes from claims resolver
     * @type {?}
     */
    LiveAppsActiveCasesForTypeReportComponent.prototype.sandboxId;
    /**
     * The LA Application Id
     * @type {?}
     */
    LiveAppsActiveCasesForTypeReportComponent.prototype.appId;
    /**
     * The LA Application Type Id (generally 1)
     * @type {?}
     */
    LiveAppsActiveCasesForTypeReportComponent.prototype.typeId;
    /**
     * The Application ID of the UI (should ideally be unique as it is shared state key)
     * @type {?}
     */
    LiveAppsActiveCasesForTypeReportComponent.prototype.uiAppId;
    /**
     * Maximum rows to show in legend before it is hidden (otherwise would take whole widget)
     * @type {?}
     */
    LiveAppsActiveCasesForTypeReportComponent.prototype.maxLegendItems;
    /**
     * Whether to show percentages or raw case numbers on the doughnut chart
     * @type {?}
     */
    LiveAppsActiveCasesForTypeReportComponent.prototype.showPercentages;
    /**
     * ~event selectedCaseTypeState : Case Type state selected in vizualization
     * ~payload CaseTypeStateReportStateInfo : CaseTypeStateReportStateInfo object selected from component (to drive caller to display something different (drill down))
     * @type {?}
     */
    LiveAppsActiveCasesForTypeReportComponent.prototype.selectedCaseTypeState;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.caseTypeStateReportChart;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.componentDiv;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.errorMessage;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.caseTypeStateReport;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.renderChart;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.doughnutChartLabels;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.doughnutChartData;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.doughnutChartType;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.chartColors;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.defaultColors;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.widgetWidth;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.widgetHeight;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.legendData;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.totalActiveCaseCount;
    /**
     * @type {?}
     * @private
     */
    LiveAppsActiveCasesForTypeReportComponent.prototype.getCaseCount;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.doughnutChartOptions;
    /**
     * @type {?}
     * @private
     */
    LiveAppsActiveCasesForTypeReportComponent.prototype.initReportDataToChart;
    /** @type {?} */
    LiveAppsActiveCasesForTypeReportComponent.prototype.refresh;
    /**
     * @type {?}
     * @protected
     */
    LiveAppsActiveCasesForTypeReportComponent.prototype.reportingService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLWFjdGl2ZS1jYXNlcy1mb3ItdHlwZS1yZXBvcnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRpYmNvLXRjc3RrL3RjLWxpdmVhcHBzLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2xpdmUtYXBwcy1hY3RpdmUtY2FzZXMtZm9yLXR5cGUtcmVwb3J0L2xpdmUtYXBwcy1hY3RpdmUtY2FzZXMtZm9yLXR5cGUtcmVwb3J0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFHTCxNQUFNLEVBRU4sU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBQyxrQkFBa0IsRUFBc0IsTUFBTSxZQUFZLENBQUM7QUFDbkUsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sc0RBQXNELENBQUM7QUFDdkYsT0FBTyxFQUFDLDBCQUEwQixFQUFDLE1BQU0sK0NBQStDLENBQUM7QUFFekYsT0FBTyxFQUFNLElBQUksRUFBRSxTQUFTLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNwRCxPQUFPLDJCQUEyQixDQUFDO0FBQ25DLE9BQU8sRUFBQyxjQUFjLEVBQUUsa0JBQWtCLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQzs7Ozs7O0FBYTlGLE1BQU0sT0FBTyx5Q0FBMEMsU0FBUSxpQkFBaUI7Ozs7SUF3STlFLFlBQXNCLGdCQUE0QztRQUNoRSxLQUFLLEVBQUUsQ0FBQztRQURZLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBNEI7Ozs7UUE3R3pELG1CQUFjLEdBQVcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDOzs7O1FBS3ZFLG9CQUFlLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FB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RTs7OztZQWhCTywwQkFBMEI7Ozt3QkF3Qi9CLEtBQUs7b0JBS0wsS0FBSztxQkFLTCxLQUFLO3NCQUtMLEtBQUs7NkJBS0wsS0FBSzs4QkFLTCxLQUFLO29DQU1MLE1BQU07dUNBRU4sU0FBUyxTQUFDLGtCQUFrQixFQUFFLEVBQUMsTUFBTSxFQUFFLEtBQUssRUFBQzsyQkFDN0MsU0FBUyxTQUFDLGNBQWMsRUFBRSxFQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUM7Ozs7Ozs7SUFsQzFDLDhEQUEyQjs7Ozs7SUFLM0IsMERBQXVCOzs7OztJQUt2QiwyREFBd0I7Ozs7O0lBS3hCLDREQUF5Qjs7Ozs7SUFLekIsbUVBQWdGOzs7OztJQUtoRixvRUFBK0U7Ozs7OztJQU0vRSwwRUFBK0g7O0lBRS9ILDZFQUE2Rjs7SUFDN0YsaUVBQXFFOztJQUVyRSxpRUFBNEI7O0lBQzVCLHdFQUFnRDs7SUFDaEQsZ0VBQTJCOztJQUUzQix3RUFBb0M7O0lBQ3BDLHNFQUE0Qzs7SUFDNUMsc0VBQWlEOztJQUNqRCxnRUFBK0I7O0lBQy9CLGtFQUFrRTs7SUFDbEUsZ0VBQTJCOztJQUMzQixpRUFBNEI7O0lBRTVCLCtEQUF1Qjs7SUFDdkIseUVBQW9DOzs7OztJQUVwQyxpRUFFQzs7SUFFRCx5RUF3RUU7Ozs7O0lBTUYsMEVBNENDOztJQUVELDREQVlDOzs7OztJQTlEVyxxRUFBc0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdDaGVja2VkLFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7Q2hhcnRUeXBlfSBmcm9tICdjaGFydC5qcyc7XG5pbXBvcnQge0Jhc2VDaGFydERpcmVjdGl2ZSwgTGFiZWwsIE11bHRpRGF0YVNldH0gZnJvbSAnbmcyLWNoYXJ0cyc7XG5pbXBvcnQge0xpdmVBcHBzQ29tcG9uZW50fSBmcm9tICcuLi9saXZlLWFwcHMtY29tcG9uZW50L2xpdmUtYXBwcy1jb21wb25lbnQuY29tcG9uZW50JztcbmltcG9ydCB7VGNMaXZlQXBwc1JlcG9ydGluZ1NlcnZpY2V9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3RjLWxpdmUtYXBwcy1yZXBvcnRpbmcuc2VydmljZSc7XG5pbXBvcnQge0Nhc2VUeXBlU3RhdGVSZXBvcnQsIENhc2VUeXBlU3RhdGVSZXBvcnRTdGF0ZUluZm99IGZyb20gJy4uLy4uL21vZGVscy90Yy1saXZlLWFwcHMtcmVwb3J0aW5nJztcbmltcG9ydCB7bWFwLCB0YWtlLCB0YWtlVW50aWx9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCAnY2hhcnRqcy1wbHVnaW4tZGF0YWxhYmVscyc7XG5pbXBvcnQge0RFRkFVTFRfQ09MT1JTLCBERUZBVUxUX1RZUEVfQ09MT1J9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3RjLWNhc2UtY2FyZC1jb25maWcuc2VydmljZSc7XG5cblxuLyoqXG4gKiBIb21lIHBhZ2UgYWN0aXZlIGNhc2VzIHdpZGdldCBzdWIgY29tcG9uZW50XG4gKlxuICpAZXhhbXBsZSA8dGNsYS1saXZlLWFwcHMtYWN0aXZlLWNhc2VzLWZvci10eXBlLXJlcG9ydD48L3RjbGEtbGl2ZS1hcHBzLWFjdGl2ZS1jYXNlcy1mb3ItdHlwZS1yZXBvcnQ+XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RjbGEtbGl2ZS1hcHBzLWFjdGl2ZS1jYXNlcy1mb3ItdHlwZS1yZXBvcnQnLFxuICB0ZW1wbGF0ZVVybDogJy4vbGl2ZS1hcHBzLWFjdGl2ZS1jYXNlcy1mb3ItdHlwZS1yZXBvcnQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9saXZlLWFwcHMtYWN0aXZlLWNhc2VzLWZvci10eXBlLXJlcG9ydC5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgTGl2ZUFwcHNBY3RpdmVDYXNlc0ZvclR5cGVSZXBvcnRDb21wb25lbnQgZXh0ZW5kcyBMaXZlQXBwc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBBZnRlclZpZXdDaGVja2VkIHtcblxuXG5cbiAgLyoqXG4gICAqIHNhbmRib3hJZCAtIHRoaXMgY29tZXMgZnJvbSBjbGFpbXMgcmVzb2x2ZXJcbiAgICovXG4gIEBJbnB1dCgpIHNhbmRib3hJZDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgTEEgQXBwbGljYXRpb24gSWRcbiAgICovXG4gIEBJbnB1dCgpIGFwcElkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBMQSBBcHBsaWNhdGlvbiBUeXBlIElkIChnZW5lcmFsbHkgMSlcbiAgICovXG4gIEBJbnB1dCgpIHR5cGVJZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgQXBwbGljYXRpb24gSUQgb2YgdGhlIFVJIChzaG91bGQgaWRlYWxseSBiZSB1bmlxdWUgYXMgaXQgaXMgc2hhcmVkIHN0YXRlIGtleSlcbiAgICovXG4gIEBJbnB1dCgpIHVpQXBwSWQ6IHN0cmluZztcblxuICAvKipcbiAgICogTWF4aW11bSByb3dzIHRvIHNob3cgaW4gbGVnZW5kIGJlZm9yZSBpdCBpcyBoaWRkZW4gKG90aGVyd2lzZSB3b3VsZCB0YWtlIHdob2xlIHdpZGdldClcbiAgICovXG4gIEBJbnB1dCgpIG1heExlZ2VuZEl0ZW1zOiBudW1iZXIgPSB0aGlzLm1heExlZ2VuZEl0ZW1zID8gdGhpcy5tYXhMZWdlbmRJdGVtcyA6IDg7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gc2hvdyBwZXJjZW50YWdlcyBvciByYXcgY2FzZSBudW1iZXJzIG9uIHRoZSBkb3VnaG51dCBjaGFydFxuICAgKi9cbiAgQElucHV0KCkgc2hvd1BlcmNlbnRhZ2VzID0gdGhpcy5zaG93UGVyY2VudGFnZXMgPyB0aGlzLnNob3dQZXJjZW50YWdlcyA6IGZhbHNlO1xuXG4gIC8qKlxuICAgKiB+ZXZlbnQgc2VsZWN0ZWRDYXNlVHlwZVN0YXRlIDogQ2FzZSBUeXBlIHN0YXRlIHNlbGVjdGVkIGluIHZpenVhbGl6YXRpb25cbiAgICogfnBheWxvYWQgQ2FzZVR5cGVTdGF0ZVJlcG9ydFN0YXRlSW5mbyA6IENhc2VUeXBlU3RhdGVSZXBvcnRTdGF0ZUluZm8gb2JqZWN0IHNlbGVjdGVkIGZyb20gY29tcG9uZW50ICh0byBkcml2ZSBjYWxsZXIgdG8gZGlzcGxheSBzb21ldGhpbmcgZGlmZmVyZW50IChkcmlsbCBkb3duKSlcbiAgICovXG4gIEBPdXRwdXQoKSBzZWxlY3RlZENhc2VUeXBlU3RhdGU6IEV2ZW50RW1pdHRlcjxDYXNlVHlwZVN0YXRlUmVwb3J0U3RhdGVJbmZvPiA9IG5ldyBFdmVudEVtaXR0ZXI8Q2FzZVR5cGVTdGF0ZVJlcG9ydFN0YXRlSW5mbz4oKTtcblxuICBAVmlld0NoaWxkKEJhc2VDaGFydERpcmVjdGl2ZSwge3N0YXRpYzogZmFsc2V9KSBjYXNlVHlwZVN0YXRlUmVwb3J0Q2hhcnQ6IEJhc2VDaGFydERpcmVjdGl2ZTtcbiAgQFZpZXdDaGlsZCgnY29tcG9uZW50RGl2Jywge3N0YXRpYzogZmFsc2V9KSBjb21wb25lbnREaXY6IEVsZW1lbnRSZWY7XG5cbiAgcHVibGljIGVycm9yTWVzc2FnZTogc3RyaW5nO1xuICBwdWJsaWMgY2FzZVR5cGVTdGF0ZVJlcG9ydDogQ2FzZVR5cGVTdGF0ZVJlcG9ydDtcbiAgcHVibGljIHJlbmRlckNoYXJ0ID0gZmFsc2U7XG5cbiAgcHVibGljIGRvdWdobnV0Q2hhcnRMYWJlbHM6IExhYmVsW107XG4gIHB1YmxpYyBkb3VnaG51dENoYXJ0RGF0YTogTXVsdGlEYXRhU2V0ID0gW107XG4gIHB1YmxpYyBkb3VnaG51dENoYXJ0VHlwZTogQ2hhcnRUeXBlID0gJ2RvdWdobnV0JztcbiAgcHVibGljIGNoYXJ0Q29sb3JzOiBhbnlbXSA9IFtdO1xuICBwdWJsaWMgZGVmYXVsdENvbG9yczogc3RyaW5nW10gPSBERUZBVUxUX0NPTE9SUy5zbGljZSgpLnJldmVyc2UoKTtcbiAgcHVibGljIHdpZGdldFdpZHRoOiBudW1iZXI7XG4gIHB1YmxpYyB3aWRnZXRIZWlnaHQ6IG51bWJlcjtcblxuICBwdWJsaWMgbGVnZW5kRGF0YTogYW55O1xuICBwdWJsaWMgdG90YWxBY3RpdmVDYXNlQ291bnQ6IG51bWJlcjtcblxuICBwcml2YXRlIGdldENhc2VDb3VudCA9ICgpID0+IHtcbiAgICByZXR1cm4gdGhpcy50b3RhbEFjdGl2ZUNhc2VDb3VudDtcbiAgfVxuXG4gIHB1YmxpYyBkb3VnaG51dENoYXJ0T3B0aW9uczogYW55ID0ge1xuICAgIHJlc3BvbnNpdmU6IHRydWUsXG4gICAgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsXG4gICAgbGVnZW5kOiB7XG4gICAgICBwb3NpdGlvbjogJ2xlZnQnXG4gICAgfSxcbiAgICBsYXlvdXQ6IHtcbiAgICAgIHBhZGRpbmc6IHtcbiAgICAgICAgbGVmdDogMCxcbiAgICAgICAgcmlnaHQ6IDAsXG4gICAgICAgIHRvcDogMTAsXG4gICAgICAgIGJvdHRvbTogMTBcbiAgICAgIH1cbiAgICB9LFxuICAgIHBsdWdpbnM6IHtcbiAgICAgIGRvdWdobnV0bGFiZWw6IHtcbiAgICAgICAgbGFiZWxzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGV4dDogdGhpcy5nZXRDYXNlQ291bnQsXG4gICAgICAgICAgICBmb250OiB7XG4gICAgICAgICAgICAgIHNpemU6ICcyMCcsXG4gICAgICAgICAgICAgIGZhbWlseTogJ1NvdXJjZSBTYW5zIFBybycsXG4gICAgICAgICAgICAgIHdlaWdodDogJ2JvbGQnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29sb3I6ICcjRkY3ODAwJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGV4dDogJ2Nhc2VzJyxcbiAgICAgICAgICAgIGZvbnQ6IHtcbiAgICAgICAgICAgICAgc2l6ZTogJzE2JyxcbiAgICAgICAgICAgICAgZmFtaWx5OiAnU291cmNlIFNhbnMgUHJvJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb2xvcjogJyNGRjc4MDAnXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9LFxuICAgICAgZGF0YWxhYmVsczoge1xuICAgICAgICBhbmNob3I6ICdlbmQnLFxuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGZ1bmN0aW9uKGNvbnRleHQpIHtcbiAgICAgICAgICByZXR1cm4gY29udGV4dC5kYXRhc2V0LmJhY2tncm91bmRDb2xvcjtcbiAgICAgICAgfSxcbiAgICAgICAgYm9yZGVyQ29sb3I6ICd3aGl0ZScsXG4gICAgICAgIGJvcmRlclJhZGl1czogMjUsXG4gICAgICAgIGJvcmRlcldpZHRoOiAyLFxuICAgICAgICBjb2xvcjogJ3doaXRlJyxcbiAgICAgICAgZGlzcGxheTogZnVuY3Rpb24oY29udGV4dCkge1xuICAgICAgICAgIGNvbnN0IGRhdGFzZXQgPSBjb250ZXh0LmRhdGFzZXQ7XG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBkYXRhc2V0LmRhdGFbY29udGV4dC5kYXRhSW5kZXhdO1xuICAgICAgICAgIHJldHVybiB2YWx1ZSA+IDA7XG4gICAgICAgIH0sXG4gICAgICAgIGZvbnQ6IHtcbiAgICAgICAgICB3ZWlnaHQ6ICdib2xkJ1xuICAgICAgICB9LFxuICAgICAgICBmb3JtYXR0ZXI6ICh2YWx1ZSwgY3R4KSA9PiB7XG5cbiAgICAgICAgICBjb25zdCBkYXRhc2V0cyA9IGN0eC5jaGFydC5kYXRhLmRhdGFzZXRzO1xuXG4gICAgICAgICAgaWYgKGRhdGFzZXRzLmluZGV4T2YoY3R4LmRhdGFzZXQpID09PSBkYXRhc2V0cy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zaG93UGVyY2VudGFnZXMpIHtcbiAgICAgICAgICAgICAgY29uc3Qgc3VtID0gZGF0YXNldHNbMF0uZGF0YS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKTtcbiAgICAgICAgICAgICAgY29uc3QgcGVyY2VudGFnZSA9IE1hdGgucm91bmQoKHZhbHVlIC8gc3VtKSAqIDEwMCkgKyAnJSc7XG4gICAgICAgICAgICAgIHJldHVybiBwZXJjZW50YWdlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH1cbiAgfTtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgcmVwb3J0aW5nU2VydmljZTogVGNMaXZlQXBwc1JlcG9ydGluZ1NlcnZpY2UpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0UmVwb3J0RGF0YVRvQ2hhcnQgPSAocmVwb3J0RGF0YTogQ2FzZVR5cGVTdGF0ZVJlcG9ydCwgc3RhdHVzOiBzdHJpbmcpID0+IHtcbiAgICB0aGlzLmRvdWdobnV0Q2hhcnREYXRhID0gW107XG4gICAgdGhpcy50b3RhbEFjdGl2ZUNhc2VDb3VudCA9IDA7XG4gICAgY29uc3QgY2FzZXNCeVN0YXRlQXJyYXk6IG51bWJlcltdID0gW107XG4gICAgY29uc3QgbGFiZWxzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IGNvbG9yQXJyYXk6IHN0cmluZ1tdID0gW107XG4gICAgLy8gcmVtb3ZlIGFueSB0YWtlbiBjb2xvcnMgZnJvbSB0aGUgZGVmYXVsdENvbG9yc1xuICAgIC8vIHdlIGhhdmUgdG8gZG8gdGhpcyBiZWZvcmUgcGFyc2luZyB0aGUgcmVjb3JkIHRvIGF2b2lkIGdldHRpbmcgc2FtZSBjb2xvcnNcbiAgICByZXBvcnREYXRhLmNhc2VTdGF0ZXMuZm9yRWFjaChjcyA9PiB7XG4gICAgICAvLyByZW1vdmUgY29sb3IgZnJvbSBkZWZhdWx0c1xuICAgICAgaWYgKGNzLnN0YXRlSW5mby5jb2xvcikge1xuICAgICAgICB0aGlzLmRlZmF1bHRDb2xvcnMgPSB0aGlzLmRlZmF1bHRDb2xvcnMuZmlsdGVyKGl0ZW0gPT4gaXRlbSAhPT0gY3Muc3RhdGVJbmZvLmNvbG9yKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBwYXJzZSByZWNvcmRcbiAgICByZXBvcnREYXRhLmNhc2VTdGF0ZXMuZm9yRWFjaChjYXNlU3RhdGUgPT4ge1xuICAgICAgICB0aGlzLnRvdGFsQWN0aXZlQ2FzZUNvdW50ID0gdGhpcy50b3RhbEFjdGl2ZUNhc2VDb3VudCArIGNhc2VTdGF0ZS5jYXNlQ291bnQ7XG4gICAgICAgIGNhc2VzQnlTdGF0ZUFycmF5LnB1c2goY2FzZVN0YXRlLmNhc2VDb3VudCk7XG4gICAgICAgIGxhYmVscy5wdXNoKGNhc2VTdGF0ZS5zdGF0ZUluZm8ubGFiZWwpO1xuICAgICAgLy8gd2Ugd2lsbCByZS1jb2xvciBhbnl0aGluZyB0aGF0IGhhcyB0aGUgZGVmYXVsdCBjb2xvclxuICAgICAgbGV0IGNvbDogc3RyaW5nO1xuICAgICAgaWYgKGNhc2VTdGF0ZS5zdGF0ZUluZm8uY29sb3IgJiYgY2FzZVN0YXRlLnN0YXRlSW5mby5jb2xvciAhPT0gREVGQVVMVF9UWVBFX0NPTE9SKSB7XG4gICAgICAgIC8vIHVzZSB0aGUgc2V0IGNvbG9yXG4gICAgICAgIGNvbCA9IGNhc2VTdGF0ZS5zdGF0ZUluZm8uY29sb3I7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyB0cnkgYW5kIGdldCBhIGNvbG9yIGZyb20gdGhlIHBhbGV0dGVcbiAgICAgICAgY29uc3QgcGFsQ29sID0gdGhpcy5kZWZhdWx0Q29sb3JzLnBvcCgpO1xuICAgICAgICBpZiAocGFsQ29sKSB7XG4gICAgICAgICAgY29sID0gcGFsQ29sO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGlmIG5vIG1vcmUgaW4gcGFsZXR0ZSB1c2UgYSByYW5kb20gY29sb3IhXG4gICAgICAgICAgY29uc3QgaSA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZjtcbiAgICAgICAgICBjb25zdCBwID0gcGFyc2VJbnQoaS50b1N0cmluZygpLCAwKTtcbiAgICAgICAgICBjb2wgPSAnIycgKyBwLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29sb3JBcnJheS5wdXNoKGNvbCk7XG4gICAgfSk7XG4gICAgdGhpcy5kb3VnaG51dENoYXJ0RGF0YS5wdXNoKGNhc2VzQnlTdGF0ZUFycmF5KTtcbiAgICB0aGlzLmRvdWdobnV0Q2hhcnRMYWJlbHMgPSBsYWJlbHM7XG4gICAgdGhpcy5jaGFydENvbG9ycy5wdXNoKCB7IGJhY2tncm91bmRDb2xvcjogY29sb3JBcnJheX0pO1xuICAgIC8vIHNob3dpbmcgbW9yZSB0aGFuIDggaW4gdGhlIGxlZ2VuZCB3aWxsIHRha2UgdXAgdG9vIG11Y2ggc3BhY2VcbiAgICB0aGlzLmRvdWdobnV0Q2hhcnRPcHRpb25zLmxlZ2VuZC5kaXNwbGF5ID0gbGFiZWxzLmxlbmd0aCA8PSA4O1xuICAgIHRoaXMucmVuZGVyQ2hhcnQgPSB0cnVlO1xuICB9XG5cbiAgcHVibGljIHJlZnJlc2ggPSAoKSA9PiB7XG4gICAgdGhpcy5yZXBvcnRpbmdTZXJ2aWNlLmdldENhc2VUeXBlU3RhdGVSZXBvcnQodGhpcy5zYW5kYm94SWQsIHRoaXMuYXBwSWQsIHRoaXMudHlwZUlkLCBmYWxzZSwgdGhpcy51aUFwcElkKS5waXBlKFxuICAgICAgdGFrZSgxKSxcbiAgICAgIHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQkKVxuICAgIClcbiAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgIHJlcG9ydCA9PiB7XG4gICAgICAgICAgdGhpcy5jYXNlVHlwZVN0YXRlUmVwb3J0ID0gcmVwb3J0O1xuICAgICAgICAgIHRoaXMuaW5pdFJlcG9ydERhdGFUb0NoYXJ0KHJlcG9ydCwgc3RhdHVzKTtcbiAgICAgICAgICByZXR1cm4gcmVwb3J0O1xuICAgICAgICB9LCBlcnJvciA9PiB7IHRoaXMuZXJyb3JNZXNzYWdlID0gJ0Vycm9yIHJldHJpZXZpbmcgY2FzZSB0eXBlcyByZXBvcnQ6ICcgKyBlcnJvci5lcnJvci5lcnJvck1zZzsgfVxuICAgICAgKTtcbiAgfVxuXG4gIC8vIGV2ZW50c1xuICBwdWJsaWMgY2hhcnRDbGlja2VkKHsgZXZlbnQsIGFjdGl2ZSB9OiB7IGV2ZW50OiBNb3VzZUV2ZW50LCBhY3RpdmU6IGFueSB9KTogdm9pZCB7XG4gICAgaWYgKGFjdGl2ZS5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBjaGFydCA9IGFjdGl2ZVswXS5fY2hhcnQ7XG4gICAgICBjb25zdCBhY3RpdmVQb2ludHM6IGFueSA9IGNoYXJ0LmdldEVsZW1lbnRBdEV2ZW50KGV2ZW50KTtcbiAgICAgIGlmICggYWN0aXZlUG9pbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gZ2V0IHRoZSBpbnRlcm5hbCBpbmRleCBvZiBzbGljZSBpbiBwaWUgY2hhcnRcbiAgICAgICAgY29uc3QgY2xpY2tlZEVsZW1lbnRJbmRleCA9IGFjdGl2ZVBvaW50c1swXS5faW5kZXg7XG4gICAgICAgIGNvbnN0IGxhYmVsID0gY2hhcnQuZGF0YS5sYWJlbHNbY2xpY2tlZEVsZW1lbnRJbmRleF07XG4gICAgICAgIC8vIGdldCB2YWx1ZSBieSBpbmRleFxuICAgICAgICBjb25zdCB2YWx1ZSA9IGNoYXJ0LmRhdGEuZGF0YXNldHNbMF0uZGF0YVtjbGlja2VkRWxlbWVudEluZGV4XTtcbiAgICAgICAgY29uc29sZS5sb2coY2xpY2tlZEVsZW1lbnRJbmRleCwgbGFiZWwsIHZhbHVlKTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZENhc2VUeXBlU3RhdGUuZW1pdCh0aGlzLmNhc2VUeXBlU3RhdGVSZXBvcnQuY2FzZVN0YXRlc1tjbGlja2VkRWxlbWVudEluZGV4XS5zdGF0ZUluZm8pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBjaGFydEhvdmVyZWQoeyBldmVudCwgYWN0aXZlIH06IHsgZXZlbnQ6IE1vdXNlRXZlbnQsIGFjdGl2ZToge31bXSB9KTogdm9pZCB7XG4gICAgLy8gY29uc29sZS5sb2coZXZlbnQsIGFjdGl2ZSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0NoZWNrZWQoKSB7XG4gICAgaWYgKHRoaXMuY29tcG9uZW50RGl2ICYmIHRoaXMuY2FzZVR5cGVTdGF0ZVJlcG9ydCAmJiB0aGlzLmNvbXBvbmVudERpdi5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoKSB7XG4gICAgICBpZiAodGhpcy53aWRnZXRXaWR0aCAhPT0gdGhpcy5jb21wb25lbnREaXYubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCB8fCB0aGlzLndpZGdldEhlaWdodCAhPT0gdGhpcy5jb21wb25lbnREaXYubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQpIHtcbiAgICAgICAgdGhpcy53aWRnZXRXaWR0aCA9IHRoaXMuY29tcG9uZW50RGl2Lm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgICAgIHRoaXMud2lkZ2V0SGVpZ2h0ID0gdGhpcy5jb21wb25lbnREaXYubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgICAgIHRoaXMuY2FzZVR5cGVTdGF0ZVJlcG9ydENoYXJ0LmNoYXJ0LnJlc2l6ZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGlmIChjaGFuZ2VzLmFwcElkICYmIChjaGFuZ2VzLmZpcnN0Q2hhbmdlIHx8IChjaGFuZ2VzLmFwcElkLmN1cnJlbnRWYWx1ZSAhPT0gY2hhbmdlcy5hcHBJZC5wcmV2aW91c1ZhbHVlKSkpIHtcbiAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgIH1cbiAgfVxuXG59XG4iXX0=