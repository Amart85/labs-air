/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// todo: JS deprecate this since now using private API to allow only listing of enabled creators
import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { LaProcessSelection } from '../../models/tc-case-processes';
import { LiveAppsComponent } from '../live-apps-component/live-apps-component.component';
import { LiveAppsService } from '../../services/live-apps.service';
import { map } from 'rxjs/operators';
import { MatSelect } from '@angular/material';
export class LiveAppsCreatorSelectorComponent extends LiveAppsComponent {
    /**
     * @param {?} liveapps
     */
    constructor(liveapps) {
        super();
        this.liveapps = liveapps;
        /**
         * ~event creatorSelection : Case Creator selected
         * ~payload LaProcessSelection : LaProcessSelection object output when a creator is selected from a drop down
         */
        this.creatorSelection = new EventEmitter();
        // run when the user clicks on a case creator
        this.selectProcess = (/**
         * @param {?} process
         * @return {?}
         */
        (process) => {
            this.creatorSelection.emit(new LaProcessSelection('creator', this.appSchema, this.getCaseIDAttributeName(), process, 
            // Format of ref is <applicationName>.<applicationInternalName>.<processType>.<processName>
            (this.caseType.applicationName + '.' + this.caseType.applicationInternalName + '.' + 'creator' + '.' + process.name), undefined));
        });
        this.reset = (/**
         * @return {?}
         */
        () => {
            this.creatorSelector.value = undefined;
        });
        this.getCaseIDAttributeName = (/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            let caseIdAttrib;
            this.caseType.attributes.forEach((/**
             * @param {?} attribute
             * @return {?}
             */
            (attribute) => {
                if (attribute.isIdentifier) {
                    caseIdAttrib = attribute;
                }
            }));
            return caseIdAttrib;
        });
        this.refresh = (/**
         * @return {?}
         */
        () => {
            // retrieve the schema for this case type so we can display case creators and case actions for this case type
            this.liveapps.getCaseTypeSchema(this.sandboxId, this.appId, 100).pipe(map((/**
             * @param {?} schema
             * @return {?}
             */
            schema => {
                this.appSchema = schema;
                schema.casetypes.forEach((/**
                 * @param {?} casetype
                 * @return {?}
                 */
                (casetype) => {
                    // the schema will contain definitions for both the 'case' and any defined types in that case.
                    // We want the schema for this 'case'.
                    if (casetype.applicationId === this.appId && casetype.id === this.typeId) {
                        if (casetype.jsonSchema !== undefined) {
                            this.caseType = casetype;
                            this.caseCreatorList = casetype.creators ? casetype.creators : [];
                            if (this.caseCreatorList.length === 1) {
                                this.selectProcess(this.caseCreatorList[0]);
                            }
                        }
                        else {
                            console.error('No schema returned for this case type: You may need to update/re-deploy the live apps application');
                        }
                    }
                }));
            }))).subscribe();
        });
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.appId && (changes.appId.currentValue !== changes.appId.previousValue)) {
            this.caseCreatorList = [];
            this.refresh();
        }
    }
}
LiveAppsCreatorSelectorComponent.decorators = [
    { type: Component, args: [{
                selector: 'tcla-live-apps-creator-selector',
                template: "<div *ngIf=\"caseCreatorList && caseCreatorList.length > 1\" fxFlex style=\"margin-left: 10px;\">\n    <span class=\"tcs-case-creation-dialog-instruction\">Select a case creator</span>\n    <mat-select #creatorSelector class=\"tcs-creator-selector-option\" [disableOptionCentering]=\"true\"\n                placeholder=\"Case Creators\" (selectionChange)=\"selectProcess($event.value)\">\n      <mat-option *ngFor=\"let creator of caseCreatorList\" [value]=\"creator\">\n        <span>{{creator.name}}</span>\n      </mat-option>\n    </mat-select>\n</div>\n",
                styles: [":host ::ng-deep .tcs-creator-selector-option .mat-select-value span{font-family:Source Sans Pro;font-size:16px;font-weight:400;font-style:normal;font-stretch:normal;line-height:1.5;letter-spacing:.3px;color:#0081cb}:host ::ng-deep .tcs-creator-selector-option .mat-select-arrow-wrapper div{color:#0081cb}:host ::ng-deep .mat-select-value{min-width:100px;max-width:100%;width:auto}.tcs-creators-box{width:200px;height:44px;box-shadow:inset 0 1px 3px 0 rgba(0,0,0,.5);background-color:#fff}tcs-creator-selector-option{width:170px;margin-left:5px;margin-right:5px;background-color:#eee;padding-left:20px;padding-right:20px;height:35px}.tcs-case-creation-dialog-instruction{font-family:Source Sans Pro;font-size:16px;font-weight:600;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:normal;color:#727272}"]
            }] }
];
/** @nocollapse */
LiveAppsCreatorSelectorComponent.ctorParameters = () => [
    { type: LiveAppsService }
];
LiveAppsCreatorSelectorComponent.propDecorators = {
    creatorSelector: [{ type: ViewChild, args: ['creatorSelector', { static: false },] }],
    sandboxId: [{ type: Input }],
    appId: [{ type: Input }],
    typeId: [{ type: Input }],
    creatorSelection: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.creatorSelector;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.sandboxId;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.appId;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.typeId;
    /**
     * ~event creatorSelection : Case Creator selected
     * ~payload LaProcessSelection : LaProcessSelection object output when a creator is selected from a drop down
     * @type {?}
     */
    LiveAppsCreatorSelectorComponent.prototype.creatorSelection;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.appSchema;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.caseType;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.caseCreatorList;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.selectProcess;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.reset;
    /**
     * @type {?}
     * @private
     */
    LiveAppsCreatorSelectorComponent.prototype.getCaseIDAttributeName;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.refresh;
    /**
     * @type {?}
     * @private
     */
    LiveAppsCreatorSelectorComponent.prototype.liveapps;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLWNyZWF0b3Itc2VsZWN0b3IuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRpYmNvLXRjc3RrL3RjLWxpdmVhcHBzLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2xpdmUtYXBwcy1jcmVhdG9yLXNlbGVjdG9yL2xpdmUtYXBwcy1jcmVhdG9yLXNlbGVjdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBLE9BQU8sRUFBQyxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFpQixTQUFTLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFFbEgsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0sZ0NBQWdDLENBQUM7QUFDbEUsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sc0RBQXNELENBQUM7QUFDdkYsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLGtDQUFrQyxDQUFDO0FBQ2pFLE9BQU8sRUFBQyxHQUFHLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUVuQyxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sbUJBQW1CLENBQUM7QUFPNUMsTUFBTSxPQUFPLGdDQUFpQyxTQUFRLGlCQUFpQjs7OztJQWtFckUsWUFBb0IsUUFBeUI7UUFDM0MsS0FBSyxFQUFFLENBQUM7UUFEVSxhQUFRLEdBQVIsUUFBUSxDQUFpQjs7Ozs7UUF4RG5DLHFCQUFnQixHQUFHLElBQUksWUFBWSxFQUFzQixDQUFDOztRQU83RCxrQkFBYTs7OztRQUFHLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDakMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxJQUFJLGtCQUFrQixDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxFQUFFLE9BQU87WUFDakgsMkZBQTJGO1lBQzNGLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLEdBQUcsR0FB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Qjs7SUFHM0IseURBTUM7O0lBRUQsaURBRUM7Ozs7O0lBRUQsa0VBUUM7O0lBRUQsbURBd0JDOzs7OztJQUdXLG9EQUFpQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRvZG86IEpTIGRlcHJlY2F0ZSB0aGlzIHNpbmNlIG5vdyB1c2luZyBwcml2YXRlIEFQSSB0byBhbGxvdyBvbmx5IGxpc3Rpbmcgb2YgZW5hYmxlZCBjcmVhdG9yc1xuXG5pbXBvcnQge0NvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQsIE91dHB1dCwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7Q2FzZVR5cGUsIENhc2VUeXBlc0xpc3QsIFByb2Nlc3N9IGZyb20gJy4uLy4uL21vZGVscy9saXZlYXBwc2RhdGEnO1xuaW1wb3J0IHtMYVByb2Nlc3NTZWxlY3Rpb259IGZyb20gJy4uLy4uL21vZGVscy90Yy1jYXNlLXByb2Nlc3Nlcyc7XG5pbXBvcnQge0xpdmVBcHBzQ29tcG9uZW50fSBmcm9tICcuLi9saXZlLWFwcHMtY29tcG9uZW50L2xpdmUtYXBwcy1jb21wb25lbnQuY29tcG9uZW50JztcbmltcG9ydCB7TGl2ZUFwcHNTZXJ2aWNlfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9saXZlLWFwcHMuc2VydmljZSc7XG5pbXBvcnQge21hcH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtMaXZlQXBwc1N0YXRlSWNvbkNvbXBvbmVudH0gZnJvbSAnLi4vbGl2ZS1hcHBzLXN0YXRlLWljb24vbGl2ZS1hcHBzLXN0YXRlLWljb24uY29tcG9uZW50JztcbmltcG9ydCB7TWF0U2VsZWN0fSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RjbGEtbGl2ZS1hcHBzLWNyZWF0b3Itc2VsZWN0b3InLFxuICB0ZW1wbGF0ZVVybDogJy4vbGl2ZS1hcHBzLWNyZWF0b3Itc2VsZWN0b3IuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9saXZlLWFwcHMtY3JlYXRvci1zZWxlY3Rvci5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgTGl2ZUFwcHNDcmVhdG9yU2VsZWN0b3JDb21wb25lbnQgZXh0ZW5kcyBMaXZlQXBwc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG4gIEBWaWV3Q2hpbGQoJ2NyZWF0b3JTZWxlY3RvcicsIHtzdGF0aWM6IGZhbHNlfSkgY3JlYXRvclNlbGVjdG9yOiBNYXRTZWxlY3Q7XG4gIEBJbnB1dCgpIHNhbmRib3hJZDogbnVtYmVyO1xuICBASW5wdXQoKSBhcHBJZDogc3RyaW5nO1xuICBASW5wdXQoKSB0eXBlSWQ6IHN0cmluZztcbiAgLyoqXG4gICAqIH5ldmVudCBjcmVhdG9yU2VsZWN0aW9uIDogQ2FzZSBDcmVhdG9yIHNlbGVjdGVkXG4gICAqIH5wYXlsb2FkIExhUHJvY2Vzc1NlbGVjdGlvbiA6IExhUHJvY2Vzc1NlbGVjdGlvbiBvYmplY3Qgb3V0cHV0IHdoZW4gYSBjcmVhdG9yIGlzIHNlbGVjdGVkIGZyb20gYSBkcm9wIGRvd25cbiAgICovXG5cbiAgQE91dHB1dCgpIGNyZWF0b3JTZWxlY3Rpb24gPSBuZXcgRXZlbnRFbWl0dGVyPExhUHJvY2Vzc1NlbGVjdGlvbj4oKTtcblxuICBhcHBTY2hlbWE6IENhc2VUeXBlc0xpc3Q7XG4gIGNhc2VUeXBlOiBDYXNlVHlwZTtcbiAgY2FzZUNyZWF0b3JMaXN0OiBQcm9jZXNzW107XG5cbiAgLy8gcnVuIHdoZW4gdGhlIHVzZXIgY2xpY2tzIG9uIGEgY2FzZSBjcmVhdG9yXG4gIHB1YmxpYyBzZWxlY3RQcm9jZXNzID0gKHByb2Nlc3MpID0+IHtcbiAgICB0aGlzLmNyZWF0b3JTZWxlY3Rpb24uZW1pdChuZXcgTGFQcm9jZXNzU2VsZWN0aW9uKCdjcmVhdG9yJywgdGhpcy5hcHBTY2hlbWEsIHRoaXMuZ2V0Q2FzZUlEQXR0cmlidXRlTmFtZSgpLCBwcm9jZXNzLFxuICAgICAgLy8gRm9ybWF0IG9mIHJlZiBpcyA8YXBwbGljYXRpb25OYW1lPi48YXBwbGljYXRpb25JbnRlcm5hbE5hbWU+Ljxwcm9jZXNzVHlwZT4uPHByb2Nlc3NOYW1lPlxuICAgICAgKHRoaXMuY2FzZVR5cGUuYXBwbGljYXRpb25OYW1lICsgJy4nICsgdGhpcy5jYXNlVHlwZS5hcHBsaWNhdGlvbkludGVybmFsTmFtZSArICcuJyArICdjcmVhdG9yJyArICcuJyArIHByb2Nlc3MubmFtZSksXG4gICAgICB1bmRlZmluZWRcbiAgICApKTtcbiAgfVxuXG4gIHB1YmxpYyByZXNldCA9ICgpID0+IHtcbiAgICB0aGlzLmNyZWF0b3JTZWxlY3Rvci52YWx1ZSA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q2FzZUlEQXR0cmlidXRlTmFtZSA9ICgpID0+IHtcbiAgICBsZXQgY2FzZUlkQXR0cmliOiBhbnk7XG4gICAgdGhpcy5jYXNlVHlwZS5hdHRyaWJ1dGVzLmZvckVhY2goKGF0dHJpYnV0ZSkgPT4ge1xuICAgICAgaWYgKGF0dHJpYnV0ZS5pc0lkZW50aWZpZXIpIHtcbiAgICAgICAgY2FzZUlkQXR0cmliID0gYXR0cmlidXRlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBjYXNlSWRBdHRyaWI7XG4gIH1cblxuICBwdWJsaWMgcmVmcmVzaCA9ICgpID0+IHtcbiAgICAvLyByZXRyaWV2ZSB0aGUgc2NoZW1hIGZvciB0aGlzIGNhc2UgdHlwZSBzbyB3ZSBjYW4gZGlzcGxheSBjYXNlIGNyZWF0b3JzIGFuZCBjYXNlIGFjdGlvbnMgZm9yIHRoaXMgY2FzZSB0eXBlXG4gICAgdGhpcy5saXZlYXBwcy5nZXRDYXNlVHlwZVNjaGVtYSh0aGlzLnNhbmRib3hJZCwgdGhpcy5hcHBJZCwgMTAwKS5waXBlKFxuICAgICAgbWFwKHNjaGVtYSA9PiB7XG4gICAgICAgICAgdGhpcy5hcHBTY2hlbWEgPSBzY2hlbWE7XG4gICAgICAgICAgc2NoZW1hLmNhc2V0eXBlcy5mb3JFYWNoKChjYXNldHlwZSkgPT4ge1xuICAgICAgICAgICAgICAvLyB0aGUgc2NoZW1hIHdpbGwgY29udGFpbiBkZWZpbml0aW9ucyBmb3IgYm90aCB0aGUgJ2Nhc2UnIGFuZCBhbnkgZGVmaW5lZCB0eXBlcyBpbiB0aGF0IGNhc2UuXG4gICAgICAgICAgICAgIC8vIFdlIHdhbnQgdGhlIHNjaGVtYSBmb3IgdGhpcyAnY2FzZScuXG4gICAgICAgICAgICAgIGlmIChjYXNldHlwZS5hcHBsaWNhdGlvbklkID09PSB0aGlzLmFwcElkICYmIGNhc2V0eXBlLmlkID09PSB0aGlzLnR5cGVJZCkge1xuICAgICAgICAgICAgICAgIGlmIChjYXNldHlwZS5qc29uU2NoZW1hICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgIHRoaXMuY2FzZVR5cGUgPSBjYXNldHlwZTtcbiAgICAgICAgICAgICAgICAgIHRoaXMuY2FzZUNyZWF0b3JMaXN0ID0gY2FzZXR5cGUuY3JlYXRvcnMgPyBjYXNldHlwZS5jcmVhdG9ycyA6IFtdO1xuICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2FzZUNyZWF0b3JMaXN0Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0UHJvY2Vzcyh0aGlzLmNhc2VDcmVhdG9yTGlzdFswXSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ05vIHNjaGVtYSByZXR1cm5lZCBmb3IgdGhpcyBjYXNlIHR5cGU6IFlvdSBtYXkgbmVlZCB0byB1cGRhdGUvcmUtZGVwbG95IHRoZSBsaXZlIGFwcHMgYXBwbGljYXRpb24nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICApXG4gICAgKS5zdWJzY3JpYmUoKTtcbiAgfVxuXG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBsaXZlYXBwczogTGl2ZUFwcHNTZXJ2aWNlKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBpZiAoY2hhbmdlcy5hcHBJZCAmJiAoY2hhbmdlcy5hcHBJZC5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXMuYXBwSWQucHJldmlvdXNWYWx1ZSkpIHtcbiAgICAgICAgdGhpcy5jYXNlQ3JlYXRvckxpc3QgPSBbXTtcbiAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgIH1cbiAgfVxufVxuIl19