/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import { RouteAccessControlConfigurationElement } from '../../models/tc-groups-data';
import { TcAccessControlService } from '../../services/tc-access-control.service';
import { MatSnackBar } from '@angular/material';
export class LiveAppsSettingsAccessControlComponent {
    /**
     * @param {?} route
     * @param {?} accessControlService
     * @param {?} snackBar
     */
    constructor(route, accessControlService, snackBar) {
        this.route = route;
        this.accessControlService = accessControlService;
        this.snackBar = snackBar;
        this.displayedColumns = [];
        this.dataSource = [];
        this.generateTables = (/**
         * @return {?}
         */
        () => {
            this.displayedColumns = ['name'];
            this.allRoles.roles.forEach((/**
             * @param {?} role
             * @return {?}
             */
            role => {
                this.displayedColumns.push(role.id);
            }));
            // Create in dataSource all rows with the appropriate order
            this.dataSource.push({ initial: 'Routes', isGroupBy: true });
            this.accessControlConfiguration.allowedRoutes.forEach((/**
             * @param {?} route
             * @return {?}
             */
            route => this.dataSource.push({ name: route, type: 'route' })));
            this.dataSource.push({ initial: 'Buttons', isGroupBy: true });
            this.accessControlConfiguration.allowedButtonIds.forEach((/**
             * @param {?} buttonId
             * @return {?}
             */
            buttonId => this.dataSource.push({ name: buttonId, type: 'button' })));
            // Update the dataSource with the previous configuration
            this.accessControlConfiguration.configuration.forEach((/**
             * @param {?} configElement
             * @return {?}
             */
            configElement => {
                // Routes
                configElement.routes.forEach((/**
                 * @param {?} configRoute
                 * @return {?}
                 */
                configRoute => {
                    /** @type {?} */
                    let row = this.dataSource.filter((/**
                     * @param {?} entry
                     * @return {?}
                     */
                    entry => entry.name === configRoute))[0];
                    row[configElement.roleId] = true;
                }));
                // ButtonsIds
                configElement.buttonIds.forEach((/**
                 * @param {?} configRoute
                 * @return {?}
                 */
                configRoute => {
                    /** @type {?} */
                    let row = this.dataSource.filter((/**
                     * @param {?} entry
                     * @return {?}
                     */
                    entry => entry.name === configRoute))[0];
                    row[configElement.roleId] = true;
                }));
            }));
        });
        this.isSelected = (/**
         * @param {?} row
         * @param {?} role
         * @return {?}
         */
        (row, role) => {
            return row[role];
        });
        this.toggle = (/**
         * @param {?} row
         * @param {?} role
         * @return {?}
         */
        (row, role) => {
            /** @type {?} */
            let dsRow = this.dataSource.filter((/**
             * @param {?} entry
             * @return {?}
             */
            entry => entry.name === row.name))[0];
            if (dsRow[role]) {
                delete dsRow[role];
            }
            else {
                dsRow[role] = true;
            }
        });
    }
    /**
     * @param {?} index
     * @param {?} item
     * @return {?}
     */
    isGroup(index, item) {
        return item.isGroupBy;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.accessControlConfiguration = this.route.snapshot.data.accessControlConfigHolder;
        this.allRoles = this.route.snapshot.data.allRoles;
        this.generateTables();
    }
    /**
     * @return {?}
     */
    runSaveFunction() {
        this.accessControlConfiguration.configuration = [];
        for (const role of this.allRoles.roles) {
            /** @type {?} */
            let userConfiguration = this.dataSource.filter((/**
             * @param {?} entry
             * @return {?}
             */
            entry => entry[role.id]));
            /** @type {?} */
            let routes = userConfiguration.filter((/**
             * @param {?} row
             * @return {?}
             */
            row => row.type === 'route')).map((/**
             * @param {?} element
             * @return {?}
             */
            element => element.name));
            /** @type {?} */
            let buttonIds = userConfiguration.filter((/**
             * @param {?} row
             * @return {?}
             */
            row => row.type === 'button')).map((/**
             * @param {?} element
             * @return {?}
             */
            element => element.name));
            this.accessControlConfiguration.configuration.push(new RouteAccessControlConfigurationElement().deserialize({ 'roleId': role.id, routes: routes, buttonIds: buttonIds }));
        }
        this.accessControlService.updateAccessControlConfig(Number(this.route.snapshot.data.claims.primaryProductionSandbox.id).valueOf(), this.accessControlConfiguration.uiAppId, this.accessControlConfiguration, this.accessControlConfiguration.id).subscribe((/**
         * @param {?} result
         * @return {?}
         */
        result => {
            this.snackBar.open('Access Control configuration saved', 'OK', {
                duration: 3000
            });
        }), (/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this.snackBar.open('Error saving Access Control configuration saved', 'OK', {
                duration: 3000
            });
        }));
    }
}
LiveAppsSettingsAccessControlComponent.decorators = [
    { type: Component, args: [{
                selector: 'tcla-live-apps-settings-access-control',
                template: "<div fxLayout=\"column\" fxFill>\n  <tc-tibco-cloud-widget-header style=\"height: 40px;\" [icon]=\"'tcs-capabilities'\"\n                                [headerText]=\"'Access Control Configuration'\">\n  </tc-tibco-cloud-widget-header>\n  <div fxFlex style=\"padding: 20px; overflow: hidden\" fxLayout=\"column\">\n    <div style=\"overflow: auto;\" fxFlex fxLayout=\"column\">\n      <div fxLayout=\"column\">\n        <p>You can configure roles by here:</p>\n        <br>\n        <table fxFlex mat-table [dataSource]=\"dataSource\" class=\"mat-elevation-z8\">\n\n          <!-- Name Column -->\n          <ng-container matColumnDef=\"name\">\n            <th mat-header-cell *matHeaderCellDef></th>\n            <td mat-cell *matCellDef=\"let element\"> {{element.name}} </td>\n          </ng-container>\n\n          <ng-container *ngFor=\"let role of allRoles.roles\" matColumnDef=\"{{role.id}}\">\n            <th mat-header-cell *matHeaderCellDef [ngClass]=\"'centered-cell'\">{{role.id}}</th>\n            <td mat-cell [ngClass]=\"'centered-cell'\" *matCellDef=\"let row\">\n              <!-- (click)=\"$event.stopPropagation()\" (change)=\"$event ? selection.toggle(row) : null\" [checked]=\"selection.isSelected(row)\" -->\n              <mat-checkbox [disabled]=\"(row.type === 'button' && row.name === 'configure') || (row.type === 'route' && row.name === '/starterApp/configuration') \"\n                            (click)=\"$event.stopPropagation()\" [checked]=\"isSelected(row, role.id)\"\n                            (change)=\"$event ? toggle(row, role.id) : null\"\n              ></mat-checkbox>\n            </td>\n          </ng-container>\n\n          <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n          <tr mat-row *matRowDef=\"let row; columns: displayedColumns;\"></tr>\n\n          <!-- Group header -->\n          <ng-container matColumnDef=\"groupHeader\">\n            <td colspan=\"999\" mat-cell *matCellDef=\"let groupBy\"><strong>{{groupBy.initial}}</strong></td>\n          </ng-container>\n\n          <tr mat-row *matRowDef=\"let row; columns: ['groupHeader']; when: isGroup\"></tr>\n\n        </table>\n      </div>\n      <div fxFlex class=\"tcs-filler-panel\"></div>\n      <div fxLayout=\"row\" fxLayoutAlign=\"end end\" fxLayoutGap=\"10px\" style=\"min-height: 50px\">\n        <button mat-raised-button color=\"primary\" (click)=\"runSaveFunction()\">Save</button>\n      </div>\n    </div>\n  </div>\n</div>\n",
                styles: [".centered-cell{text-align:center}"]
            }] }
];
/** @nocollapse */
LiveAppsSettingsAccessControlComponent.ctorParameters = () => [
    { type: ActivatedRoute },
    { type: TcAccessControlService },
    { type: MatSnackBar }
];
if (false) {
    /** @type {?} */
    LiveAppsSettingsAccessControlComponent.prototype.displayedColumns;
    /** @type {?} */
    LiveAppsSettingsAccessControlComponent.prototype.dataSource;
    /**
     * @type {?}
     * @private
     */
    LiveAppsSettingsAccessControlComponent.prototype.accessControlConfiguration;
    /** @type {?} */
    LiveAppsSettingsAccessControlComponent.prototype.allRoles;
    /**
     * @type {?}
     * @private
     */
    LiveAppsSettingsAccessControlComponent.prototype.generateTables;
    /** @type {?} */
    LiveAppsSettingsAccessControlComponent.prototype.isSelected;
    /** @type {?} */
    LiveAppsSettingsAccessControlComponent.prototype.toggle;
    /**
     * @type {?}
     * @private
     */
    LiveAppsSettingsAccessControlComponent.prototype.route;
    /**
     * @type {?}
     * @private
     */
    LiveAppsSettingsAccessControlComponent.prototype.accessControlService;
    /**
     * @type {?}
     * @private
     */
    LiveAppsSettingsAccessControlComponent.prototype.snackBar;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLXNldHRpbmdzLWFjY2Vzcy1jb250cm9sLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0aWJjby10Y3N0ay90Yy1saXZlYXBwcy1saWIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9saXZlLWFwcHMtc2V0dGluZ3MtYWNjZXNzLWNvbnRyb2wvbGl2ZS1hcHBzLXNldHRpbmdzLWFjY2Vzcy1jb250cm9sLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUNsRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDakQsT0FBTyxFQUE0QixzQ0FBc0MsRUFBUyxNQUFNLDZCQUE2QixDQUFDO0FBQ3RILE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQ2xGLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQU9oRCxNQUFNLE9BQU8sc0NBQXNDOzs7Ozs7SUFXL0MsWUFDWSxLQUFxQixFQUNyQixvQkFBNEMsRUFDNUMsUUFBcUI7UUFGckIsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFDckIseUJBQW9CLEdBQXBCLG9CQUFvQixDQUF3QjtRQUM1QyxhQUFRLEdBQVIsUUFBUSxDQUFhO1FBYmpDLHFCQUFnQixHQUFhLEVBQUUsQ0FBQztRQUNoQyxlQUFVLEdBQUcsRUFBRSxDQUFDO1FBa0RSLG1CQUFjOzs7UUFBRyxHQUFTLEVBQUU7WUFDaEMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDakMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsT0FBTzs7OztZQUFDLElBQUksQ0FBQyxFQUFFO2dCQUMvQixJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN4QyxDQUFDLEVB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QUMsT0FBTyxFQUFFLEVBQUUsSUFBSSxDQUFDLDBCQUEwQixDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsMEJBQTBCLEVBQUUsSUFBSSxDQUFDLDBCQUEwQixDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVM7Ozs7UUFDdFAsTUFBTSxDQUFDLEVBQUU7WUFDTCxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxvQ0FBb0MsRUFBRSxJQUFJLEVBQUU7Z0JBQzNELFFBQVEsRUFBRSxJQUFJO2FBQ2pCLENBQUMsQ0FBQztRQUNQLENBQUM7Ozs7UUFDRCxLQUFLLENBQUMsRUFBRTtZQUNKLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGlEQUFpRCxFQUFFLElBQUksRUFBRTtnQkFDeEUsUUFBUSxFQUFFLElBQUk7YUFDakIsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxFQUNKLENBQUM7SUFLTixDQUFDOzs7WUF2REosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSx3Q0FBd0M7Z0JBQ2xELHc3RUFBaUU7O2FBRXBFOzs7O1lBVFEsY0FBYztZQUVkLHNCQUFzQjtZQUN0QixXQUFXOzs7O0lBUWhCLGtFQUFnQzs7SUFDaEMsNERBQWdCOzs7OztJQUVoQiw0RUFBNkQ7O0lBQzVELDBEQUFnQjs7Ozs7SUErQ2pCLGdFQTRCQzs7SUFFRCw0REFFQzs7SUFFRCx3REFRQzs7Ozs7SUFsRkcsdURBQTZCOzs7OztJQUM3QixzRUFBb0Q7Ozs7O0lBQ3BELDBEQUE2QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBSb3V0ZUFjY2Vzc0NvbnRyb2xDb25maWcsIFJvdXRlQWNjZXNzQ29udHJvbENvbmZpZ3VyYXRpb25FbGVtZW50LCBSb2xlcyB9IGZyb20gJy4uLy4uL21vZGVscy90Yy1ncm91cHMtZGF0YSc7XG5pbXBvcnQgeyBUY0FjY2Vzc0NvbnRyb2xTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvdGMtYWNjZXNzLWNvbnRyb2wuc2VydmljZSc7XG5pbXBvcnQgeyBNYXRTbmFja0JhciB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICd0Y2xhLWxpdmUtYXBwcy1zZXR0aW5ncy1hY2Nlc3MtY29udHJvbCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL2xpdmUtYXBwcy1zZXR0aW5ncy1hY2Nlc3MtY29udHJvbC5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vbGl2ZS1hcHBzLXNldHRpbmdzLWFjY2Vzcy1jb250cm9sLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBMaXZlQXBwc1NldHRpbmdzQWNjZXNzQ29udHJvbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gICAgZGlzcGxheWVkQ29sdW1uczogc3RyaW5nW10gPSBbXTtcbiAgICBkYXRhU291cmNlID0gW107XG5cbiAgICBwcml2YXRlIGFjY2Vzc0NvbnRyb2xDb25maWd1cmF0aW9uOiBSb3V0ZUFjY2Vzc0NvbnRyb2xDb25maWc7XG4gICAgIGFsbFJvbGVzOiBSb2xlcztcblxuICAgIGlzR3JvdXAoaW5kZXgsIGl0ZW0pOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGl0ZW0uaXNHcm91cEJ5O1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSxcbiAgICAgICAgcHJpdmF0ZSBhY2Nlc3NDb250cm9sU2VydmljZTogVGNBY2Nlc3NDb250cm9sU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBzbmFja0JhcjogTWF0U25hY2tCYXJcbiAgICApIHsgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuYWNjZXNzQ29udHJvbENvbmZpZ3VyYXRpb24gPSB0aGlzLnJvdXRlLnNuYXBzaG90LmRhdGEuYWNjZXNzQ29udHJvbENvbmZpZ0hvbGRlcjtcbiAgICAgICAgdGhpcy5hbGxSb2xlcyA9IHRoaXMucm91dGUuc25hcHNob3QuZGF0YS5hbGxSb2xlcztcbiAgICAgICAgdGhpcy5nZW5lcmF0ZVRhYmxlcygpO1xuICAgIH1cblxuICAgIHJ1blNhdmVGdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5hY2Nlc3NDb250cm9sQ29uZmlndXJhdGlvbi5jb25maWd1cmF0aW9uID0gW107XG4gICAgICAgIGZvciAoY29uc3Qgcm9sZSBvZiB0aGlzLmFsbFJvbGVzLnJvbGVzKXtcbiAgICAgICAgICAgIGxldCB1c2VyQ29uZmlndXJhdGlvbiA9IHRoaXMuZGF0YVNvdXJjZS5maWx0ZXIoZW50cnkgPT4gZW50cnlbcm9sZS5pZF0pO1xuICAgICAgICAgICAgbGV0IHJvdXRlcyA9IHVzZXJDb25maWd1cmF0aW9uLmZpbHRlcihyb3cgPT4gcm93LnR5cGUgPT09ICdyb3V0ZScpLm1hcChlbGVtZW50ID0+IGVsZW1lbnQubmFtZSk7XG4gICAgICAgICAgICBsZXQgYnV0dG9uSWRzID0gdXNlckNvbmZpZ3VyYXRpb24uZmlsdGVyKHJvdyA9PiByb3cudHlwZSA9PT0gJ2J1dHRvbicpLm1hcChlbGVtZW50ID0+IGVsZW1lbnQubmFtZSk7XG4gICAgICAgICAgICB0aGlzLmFjY2Vzc0NvbnRyb2xDb25maWd1cmF0aW9uLmNvbmZpZ3VyYXRpb24ucHVzaChcbiAgICAgICAgICAgICAgICBuZXcgUm91dGVBY2Nlc3NDb250cm9sQ29uZmlndXJhdGlvbkVsZW1lbnQoKS5kZXNlcmlhbGl6ZSh7J3JvbGVJZCc6IHJvbGUuaWQsIHJvdXRlczogcm91dGVzLCBidXR0b25JZHM6IGJ1dHRvbklkc30pXG4gICAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmFjY2Vzc0NvbnRyb2xTZXJ2aWNlLnVwZGF0ZUFjY2Vzc0NvbnRyb2xDb25maWcoTnVtYmVyKHRoaXMucm91dGUuc25hcHNob3QuZGF0YS5jbGFpbXMucHJpbWFyeVByb2R1Y3Rpb25TYW5kYm94LmlkKS52YWx1ZU9mKCksIHRoaXMuYWNjZXNzQ29udHJvbENvbmZpZ3VyYXRpb24udWlBcHBJZCwgdGhpcy5hY2Nlc3NDb250cm9sQ29uZmlndXJhdGlvbiwgdGhpcy5hY2Nlc3NDb250cm9sQ29uZmlndXJhdGlvbi5pZCkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgcmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNuYWNrQmFyLm9wZW4oJ0FjY2VzcyBDb250cm9sIGNvbmZpZ3VyYXRpb24gc2F2ZWQnLCAnT0snLCB7XG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAzMDAwXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc25hY2tCYXIub3BlbignRXJyb3Igc2F2aW5nIEFjY2VzcyBDb250cm9sIGNvbmZpZ3VyYXRpb24gc2F2ZWQnLCAnT0snLCB7XG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAzMDAwXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cblxuXG5cbiAgICB9XG5cbiAgICBwcml2YXRlIGdlbmVyYXRlVGFibGVzID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICB0aGlzLmRpc3BsYXllZENvbHVtbnMgPSBbJ25hbWUnXTsgXG4gICAgICAgIHRoaXMuYWxsUm9sZXMucm9sZXMuZm9yRWFjaChyb2xlID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheWVkQ29sdW1ucy5wdXNoKHJvbGUuaWQpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDcmVhdGUgaW4gZGF0YVNvdXJjZSBhbGwgcm93cyB3aXRoIHRoZSBhcHByb3ByaWF0ZSBvcmRlclxuICAgICAgICB0aGlzLmRhdGFTb3VyY2UucHVzaCh7IGluaXRpYWw6ICdSb3V0ZXMnLCBpc0dyb3VwQnk6IHRydWUgfSk7XG4gICAgICAgIHRoaXMuYWNjZXNzQ29udHJvbENvbmZpZ3VyYXRpb24uYWxsb3dlZFJvdXRlcy5mb3JFYWNoKHJvdXRlID0+IHRoaXMuZGF0YVNvdXJjZS5wdXNoKHtuYW1lOiByb3V0ZSwgdHlwZTogJ3JvdXRlJ30pKTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuZGF0YVNvdXJjZS5wdXNoKHsgaW5pdGlhbDogJ0J1dHRvbnMnLCBpc0dyb3VwQnk6IHRydWUgfSk7XG4gICAgICAgIHRoaXMuYWNjZXNzQ29udHJvbENvbmZpZ3VyYXRpb24uYWxsb3dlZEJ1dHRvbklkcy5mb3JFYWNoKGJ1dHRvbklkID0+IHRoaXMuZGF0YVNvdXJjZS5wdXNoKHsgbmFtZTogYnV0dG9uSWQsIHR5cGU6ICdidXR0b24nIH0pKTtcblxuICAgICAgICAvLyBVcGRhdGUgdGhlIGRhdGFTb3VyY2Ugd2l0aCB0aGUgcHJldmlvdXMgY29uZmlndXJhdGlvblxuICAgICAgICB0aGlzLmFjY2Vzc0NvbnRyb2xDb25maWd1cmF0aW9uLmNvbmZpZ3VyYXRpb24uZm9yRWFjaChjb25maWdFbGVtZW50ID0+IHtcbiAgICAgICAgICAgIC8vIFJvdXRlc1xuICAgICAgICAgICAgY29uZmlnRWxlbWVudC5yb3V0ZXMuZm9yRWFjaChjb25maWdSb3V0ZSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHJvdyA9IHRoaXMuZGF0YVNvdXJjZS5maWx0ZXIoZW50cnkgPT4gZW50cnkubmFtZSA9PT0gY29uZmlnUm91dGUpWzBdO1xuICAgICAgICAgICAgICAgIHJvd1tjb25maWdFbGVtZW50LnJvbGVJZF0gPSB0cnVlO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy8gQnV0dG9uc0lkc1xuICAgICAgICAgICAgY29uZmlnRWxlbWVudC5idXR0b25JZHMuZm9yRWFjaChjb25maWdSb3V0ZSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHJvdyA9IHRoaXMuZGF0YVNvdXJjZS5maWx0ZXIoZW50cnkgPT4gZW50cnkubmFtZSA9PT0gY29uZmlnUm91dGUpWzBdO1xuICAgICAgICAgICAgICAgIHJvd1tjb25maWdFbGVtZW50LnJvbGVJZF0gPSB0cnVlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgaXNTZWxlY3RlZCA9IChyb3csIHJvbGUpOiBib29sZWFuID0+IHtcbiAgICAgICAgcmV0dXJuIHJvd1tyb2xlXTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdG9nZ2xlID0gKHJvdywgcm9sZTogc3RyaW5nKSA9PiB7XG4gICAgICAgIGxldCBkc1JvdyA9IHRoaXMuZGF0YVNvdXJjZS5maWx0ZXIoZW50cnkgPT4gZW50cnkubmFtZSA9PT0gcm93Lm5hbWUpWzBdO1xuXG4gICAgICAgIGlmIChkc1Jvd1tyb2xlXSkge1xuICAgICAgICAgICAgZGVsZXRlIGRzUm93W3JvbGVdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZHNSb3dbcm9sZV0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19