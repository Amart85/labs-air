/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// this resolver wraps claims and appConfig resolvers because we need claims to get and set AppConfig to default values.
// we actually cache the claims call using a HTTP interceptor to avoid making multiple REST calls
// note: claims only changes on logout/login so no point making lots of calls to claims
import { Injectable } from '@angular/core';
import { Router } from '@angular/router';
import { forkJoin } from 'rxjs';
import { GeneralConfigResolver, TcGeneralConfigService } from '@tibco-tcstk/tc-core-lib';
import { flatMap, map } from 'rxjs/operators';
import { TcSharedStateService } from '@tibco-tcstk/tc-core-lib';
import { ClaimsResolver } from './claims.resolver';
import { LiveAppsService } from '../services/live-apps.service';
import { HttpClient } from '@angular/common/http';
import { TcDocumentService } from '../services/tc-document.service';
import { LiveAppsConfigHolder } from '../models/tc-liveapps-config';
import { LiveAppsConfigResolver } from './liveapps-config.resolver';
import { TcLiveAppsConfigService } from '../services/tc-live-apps-config.service';
import { TcCaseCardConfigService } from '../services/tc-case-card-config.service';
import { Location } from '@angular/common';
export class LaConfigResolver {
    /**
     * @param {?} sharedStateService
     * @param {?} generalConfigService
     * @param {?} liveAppsConfigService
     * @param {?} documentService
     * @param {?} http
     * @param {?} liveAppsService
     * @param {?} caseCardConfigService
     * @param {?} location
     * @param {?} router
     */
    constructor(sharedStateService, generalConfigService, liveAppsConfigService, documentService, http, liveAppsService, caseCardConfigService, location, router) {
        this.sharedStateService = sharedStateService;
        this.generalConfigService = generalConfigService;
        this.liveAppsConfigService = liveAppsConfigService;
        this.documentService = documentService;
        this.http = http;
        this.liveAppsService = liveAppsService;
        this.caseCardConfigService = caseCardConfigService;
        this.location = location;
        this.router = router;
    }
    /**
     * @param {?} routeSnapshot
     * @return {?}
     */
    resolve(routeSnapshot) {
        // we will return a holder object that contains both general config and live apps config
        // we will return a holder object that contains both general config and live apps config
        /** @type {?} */
        const generalConfigResolver = new GeneralConfigResolver(this.sharedStateService, this.generalConfigService, this.http, this.location, this.router);
        /** @type {?} */
        const liveAppsConfigResolver = new LiveAppsConfigResolver(this.sharedStateService, this.liveAppsConfigService, this.caseCardConfigService, this.http, this.location);
        /** @type {?} */
        const claimResolver$ = new ClaimsResolver(this.liveAppsService).resolve().pipe(flatMap((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            /** @type {?} */
            const sandboxId = value.primaryProductionSandbox.id;
            generalConfigResolver.setSandbox(Number(sandboxId));
            liveAppsConfigResolver.setSandbox(Number(sandboxId));
            /** @type {?} */
            const generalConfig$ = generalConfigResolver.resolve();
            /** @type {?} */
            const liveAppsConfig$ = liveAppsConfigResolver.resolve(routeSnapshot);
            /** @type {?} */
            const forkJoinArray = [generalConfig$, liveAppsConfig$];
            return forkJoin(forkJoinArray).pipe(map((/**
             * @param {?} resultArr
             * @return {?}
             */
            resultArr => {
                return new LiveAppsConfigHolder().deserialize({ generalConfig: resultArr[0], liveAppsConfig: resultArr[1] });
            })));
        })));
        /** @type {?} */
        const resolveResp$ = claimResolver$.pipe(flatMap((/**
         * @param {?} liveAppsConfigHolder
         * @return {?}
         */
        liveAppsConfigHolder => {
            /** @type {?} */
            const topOrgFolder$ = this.documentService.initOrgFolder(liveAppsConfigHolder.generalConfig.uiAppId);
            /** @type {?} */
            const iconsFolder$ = this.documentService.initOrgFolder(liveAppsConfigHolder.generalConfig.uiAppId + '_Icons');
            /** @type {?} */
            const docsFolder$ = this.documentService.initOrgFolder(liveAppsConfigHolder.generalConfig.uiAppId + '_Docs');
            /** @type {?} */
            const forkJoinArray = [topOrgFolder$, iconsFolder$, docsFolder$];
            return forkJoin(forkJoinArray).pipe(map((/**
             * @param {?} resultArr
             * @return {?}
             */
            resultArr => {
                return liveAppsConfigHolder;
            })));
        })));
        return resolveResp$;
    }
}
LaConfigResolver.decorators = [
    { type: Injectable }
];
/** @nocollapse */
LaConfigResolver.ctorParameters = () => [
    { type: TcSharedStateService },
    { type: TcGeneralConfigService },
    { type: TcLiveAppsConfigService },
    { type: TcDocumentService },
    { type: HttpClient },
    { type: LiveAppsService },
    { type: TcCaseCardConfigService },
    { type: Location },
    { type: Router }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    LaConfigResolver.prototype.sharedStateService;
    /**
     * @type {?}
     * @private
     */
    LaConfigResolver.prototype.generalConfigService;
    /**
     * @type {?}
     * @private
     */
    LaConfigResolver.prototype.liveAppsConfigService;
    /**
     * @type {?}
     * @private
     */
    LaConfigResolver.prototype.documentService;
    /**
     * @type {?}
     * @private
     */
    LaConfigResolver.prototype.http;
    /**
     * @type {?}
     * @private
     */
    LaConfigResolver.prototype.liveAppsService;
    /**
     * @type {?}
     * @private
     */
    LaConfigResolver.prototype.caseCardConfigService;
    /**
     * @type {?}
     * @private
     */
    LaConfigResolver.prototype.location;
    /**
     * @type {?}
     * @private
     */
    LaConfigResolver.prototype.router;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGEtY29uZmlnLnJlc29sdmVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRpYmNvLXRjc3RrL3RjLWxpdmVhcHBzLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9yZXNvbHZlcnMvbGEtY29uZmlnLnJlc29sdmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFJQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBa0MsTUFBTSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDeEUsT0FBTyxFQUFDLFFBQVEsRUFBaUIsTUFBTSxNQUFNLENBQUM7QUFDOUMsT0FBTyxFQUFDLHFCQUFxQixFQUE4QixzQkFBc0IsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBQ25ILE9BQU8sRUFBQyxPQUFPLEVBQUUsR0FBRyxFQUFXLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEQsT0FBTyxFQUFDLG9CQUFvQixFQUFDLE1BQU0sMEJBQTBCLENBQUM7QUFFOUQsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLG1CQUFtQixDQUFDO0FBQ2pELE9BQU8sRUFBQyxlQUFlLEVBQUMsTUFBTSwrQkFBK0IsQ0FBQztBQUM5RCxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sc0JBQXNCLENBQUM7QUFDaEQsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0saUNBQWlDLENBQUM7QUFDbEUsT0FBTyxFQUFpQixvQkFBb0IsRUFBQyxNQUFNLDhCQUE4QixDQUFDO0FBQ2xGLE9BQU8sRUFBQyxzQkFBc0IsRUFBQyxNQUFNLDRCQUE0QixDQUFDO0FBQ2xFLE9BQU8sRUFBQyx1QkFBdUIsRUFBQyxNQUFNLHlDQUF5QyxDQUFDO0FBQ2hGLE9BQU8sRUFBQyx1QkFBdUIsRUFBQyxNQUFNLHlDQUF5QyxDQUFDO0FBQ2hGLE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUd6QyxNQUFNLE9BQU8sZ0JBQWdCOzs7Ozs7Ozs7Ozs7SUFFM0IsWUFBb0Is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TyxvQkFBb0IsQ0FBQztZQUM5QixDQUFDLEVBQ0YsQ0FDRixDQUFDO1FBQ0osQ0FBQyxFQUFDLENBQ0g7UUFFRCxPQUFPLFlBQVksQ0FBQztJQUN0QixDQUFDOzs7WUE3Q0YsVUFBVTs7OztZQVpILG9CQUFvQjtZQUYrQixzQkFBc0I7WUFVekUsdUJBQXVCO1lBSHZCLGlCQUFpQjtZQURqQixVQUFVO1lBRFYsZUFBZTtZQU1mLHVCQUF1QjtZQUN2QixRQUFRO1lBZHlCLE1BQU07Ozs7Ozs7SUFtQmpDLDhDQUFnRDs7Ozs7SUFBRSxnREFBb0Q7Ozs7O0lBQUUsaURBQXNEOzs7OztJQUFFLDJDQUEwQzs7Ozs7SUFBRSxnQ0FBd0I7Ozs7O0lBQUUsMkNBQXdDOzs7OztJQUFFLGlEQUFzRDs7Ozs7SUFBRSxvQ0FBMEI7Ozs7O0lBQUUsa0NBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdGhpcyByZXNvbHZlciB3cmFwcyBjbGFpbXMgYW5kIGFwcENvbmZpZyByZXNvbHZlcnMgYmVjYXVzZSB3ZSBuZWVkIGNsYWltcyB0byBnZXQgYW5kIHNldCBBcHBDb25maWcgdG8gZGVmYXVsdCB2YWx1ZXMuXG4vLyB3ZSBhY3R1YWxseSBjYWNoZSB0aGUgY2xhaW1zIGNhbGwgdXNpbmcgYSBIVFRQIGludGVyY2VwdG9yIHRvIGF2b2lkIG1ha2luZyBtdWx0aXBsZSBSRVNUIGNhbGxzXG4vLyBub3RlOiBjbGFpbXMgb25seSBjaGFuZ2VzIG9uIGxvZ291dC9sb2dpbiBzbyBubyBwb2ludCBtYWtpbmcgbG90cyBvZiBjYWxscyB0byBjbGFpbXNcblxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90LCBSZXNvbHZlLCBSb3V0ZXJ9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQge2ZvcmtKb2luLCBPYnNlcnZhYmxlLCBvZn0gZnJvbSAncnhqcyc7XG5pbXBvcnQge0dlbmVyYWxDb25maWdSZXNvbHZlciwgVWlBcHBDb25maWcsIEdlbmVyYWxDb25maWcsIFRjR2VuZXJhbENvbmZpZ1NlcnZpY2V9IGZyb20gJ0B0aWJjby10Y3N0ay90Yy1jb3JlLWxpYic7XG5pbXBvcnQge2ZsYXRNYXAsIG1hcCwgbWVyZ2VNYXB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7VGNTaGFyZWRTdGF0ZVNlcnZpY2V9IGZyb20gJ0B0aWJjby10Y3N0ay90Yy1jb3JlLWxpYic7XG5pbXBvcnQge0NsYWltfSBmcm9tICdAdGliY28tdGNzdGsvdGMtY29yZS1saWInO1xuaW1wb3J0IHtDbGFpbXNSZXNvbHZlcn0gZnJvbSAnLi9jbGFpbXMucmVzb2x2ZXInO1xuaW1wb3J0IHtMaXZlQXBwc1NlcnZpY2V9IGZyb20gJy4uL3NlcnZpY2VzL2xpdmUtYXBwcy5zZXJ2aWNlJztcbmltcG9ydCB7SHR0cENsaWVudH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHtUY0RvY3VtZW50U2VydmljZX0gZnJvbSAnLi4vc2VydmljZXMvdGMtZG9jdW1lbnQuc2VydmljZSc7XG5pbXBvcnQge0xpdmVBcHBzQ29uZmlnLCBMaXZlQXBwc0NvbmZpZ0hvbGRlcn0gZnJvbSAnLi4vbW9kZWxzL3RjLWxpdmVhcHBzLWNvbmZpZyc7XG5pbXBvcnQge0xpdmVBcHBzQ29uZmlnUmVzb2x2ZXJ9IGZyb20gJy4vbGl2ZWFwcHMtY29uZmlnLnJlc29sdmVyJztcbmltcG9ydCB7VGNMaXZlQXBwc0NvbmZpZ1NlcnZpY2V9IGZyb20gJy4uL3NlcnZpY2VzL3RjLWxpdmUtYXBwcy1jb25maWcuc2VydmljZSc7XG5pbXBvcnQge1RjQ2FzZUNhcmRDb25maWdTZXJ2aWNlfSBmcm9tICcuLi9zZXJ2aWNlcy90Yy1jYXNlLWNhcmQtY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHtMb2NhdGlvbn0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIExhQ29uZmlnUmVzb2x2ZXIgaW1wbGVtZW50cyBSZXNvbHZlPE9ic2VydmFibGU8TGl2ZUFwcHNDb25maWdIb2xkZXI+PiB7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzaGFyZWRTdGF0ZVNlcnZpY2U6IFRjU2hhcmVkU3RhdGVTZXJ2aWNlLCBwcml2YXRlIGdlbmVyYWxDb25maWdTZXJ2aWNlOiBUY0dlbmVyYWxDb25maWdTZXJ2aWNlLCBwcml2YXRlIGxpdmVBcHBzQ29uZmlnU2VydmljZTogVGNMaXZlQXBwc0NvbmZpZ1NlcnZpY2UsIHByaXZhdGUgZG9jdW1lbnRTZXJ2aWNlOiBUY0RvY3VtZW50U2VydmljZSwgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LCBwcml2YXRlIGxpdmVBcHBzU2VydmljZTogTGl2ZUFwcHNTZXJ2aWNlLCBwcml2YXRlIGNhc2VDYXJkQ29uZmlnU2VydmljZTogVGNDYXNlQ2FyZENvbmZpZ1NlcnZpY2UsIHByaXZhdGUgbG9jYXRpb246IExvY2F0aW9uLCBwcml2YXRlIHJvdXRlcjogUm91dGVyKSB7fVxuXG4gIHJlc29sdmUocm91dGVTbmFwc2hvdDogQWN0aXZhdGVkUm91dGVTbmFwc2hvdCk6IE9ic2VydmFibGU8TGl2ZUFwcHNDb25maWdIb2xkZXI+IHtcbiAgICAvLyB3ZSB3aWxsIHJldHVybiBhIGhvbGRlciBvYmplY3QgdGhhdCBjb250YWlucyBib3RoIGdlbmVyYWwgY29uZmlnIGFuZCBsaXZlIGFwcHMgY29uZmlnXG5cbiAgICBjb25zdCBnZW5lcmFsQ29uZmlnUmVzb2x2ZXIgPSBuZXcgR2VuZXJhbENvbmZpZ1Jlc29sdmVyKHRoaXMuc2hhcmVkU3RhdGVTZXJ2aWNlLCB0aGlzLmdlbmVyYWxDb25maWdTZXJ2aWNlLCB0aGlzLmh0dHAsIHRoaXMubG9jYXRpb24sIHRoaXMucm91dGVyKTtcbiAgICBjb25zdCBsaXZlQXBwc0NvbmZpZ1Jlc29sdmVyID0gbmV3IExpdmVBcHBzQ29uZmlnUmVzb2x2ZXIodGhpcy5zaGFyZWRTdGF0ZVNlcnZpY2UsIHRoaXMubGl2ZUFwcHNDb25maWdTZXJ2aWNlLCB0aGlzLmNhc2VDYXJkQ29uZmlnU2VydmljZSwgdGhpcy5odHRwLCB0aGlzLmxvY2F0aW9uKTtcblxuICAgIGNvbnN0IGNsYWltUmVzb2x2ZXIkID0gbmV3IENsYWltc1Jlc29sdmVyKHRoaXMubGl2ZUFwcHNTZXJ2aWNlKS5yZXNvbHZlKCkucGlwZShcbiAgICAgIGZsYXRNYXAodmFsdWUgPT4ge1xuICAgICAgICAgIGNvbnN0IHNhbmRib3hJZCA9IHZhbHVlLnByaW1hcnlQcm9kdWN0aW9uU2FuZGJveC5pZDtcbiAgICAgICAgICBnZW5lcmFsQ29uZmlnUmVzb2x2ZXIuc2V0U2FuZGJveChOdW1iZXIoc2FuZGJveElkKSk7XG4gICAgICAgICAgbGl2ZUFwcHNDb25maWdSZXNvbHZlci5zZXRTYW5kYm94KE51bWJlcihzYW5kYm94SWQpKTtcblxuICAgICAgICAgIGNvbnN0IGdlbmVyYWxDb25maWckID0gZ2VuZXJhbENvbmZpZ1Jlc29sdmVyLnJlc29sdmUoKTtcbiAgICAgICAgICBjb25zdCBsaXZlQXBwc0NvbmZpZyQgPSBsaXZlQXBwc0NvbmZpZ1Jlc29sdmVyLnJlc29sdmUocm91dGVTbmFwc2hvdCk7XG4gICAgICAgICAgY29uc3QgZm9ya0pvaW5BcnJheSA9IFtnZW5lcmFsQ29uZmlnJCwgbGl2ZUFwcHNDb25maWckXTtcbiAgICAgICAgICByZXR1cm4gZm9ya0pvaW4oZm9ya0pvaW5BcnJheSkucGlwZShcbiAgICAgICAgICAgIG1hcChyZXN1bHRBcnIgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gbmV3IExpdmVBcHBzQ29uZmlnSG9sZGVyKCkuZGVzZXJpYWxpemUoeyBnZW5lcmFsQ29uZmlnOiByZXN1bHRBcnJbMF0sIGxpdmVBcHBzQ29uZmlnOiByZXN1bHRBcnJbMV0gfSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgKVxuICAgICk7XG5cbiAgICBjb25zdCByZXNvbHZlUmVzcCQgPSBjbGFpbVJlc29sdmVyJC5waXBlKFxuICAgICAgZmxhdE1hcChsaXZlQXBwc0NvbmZpZ0hvbGRlciA9PiB7XG4gICAgICAgIGNvbnN0IHRvcE9yZ0ZvbGRlciQgPSB0aGlzLmRvY3VtZW50U2VydmljZS5pbml0T3JnRm9sZGVyKGxpdmVBcHBzQ29uZmlnSG9sZGVyLmdlbmVyYWxDb25maWcudWlBcHBJZCk7XG4gICAgICAgIGNvbnN0IGljb25zRm9sZGVyJCA9IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLmluaXRPcmdGb2xkZXIobGl2ZUFwcHNDb25maWdIb2xkZXIuZ2VuZXJhbENvbmZpZy51aUFwcElkICsgJ19JY29ucycpO1xuICAgICAgICBjb25zdCBkb2NzRm9sZGVyJCA9IHRoaXMuZG9jdW1lbnRTZXJ2aWNlLmluaXRPcmdGb2xkZXIobGl2ZUFwcHNDb25maWdIb2xkZXIuZ2VuZXJhbENvbmZpZy51aUFwcElkICsgJ19Eb2NzJyk7XG4gICAgICAgIGNvbnN0IGZvcmtKb2luQXJyYXkgPSBbdG9wT3JnRm9sZGVyJCwgaWNvbnNGb2xkZXIkLCBkb2NzRm9sZGVyJF07XG4gICAgICAgIHJldHVybiBmb3JrSm9pbihmb3JrSm9pbkFycmF5KS5waXBlKFxuICAgICAgICAgIG1hcChcbiAgICAgICAgICAgIHJlc3VsdEFyciA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBsaXZlQXBwc0NvbmZpZ0hvbGRlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgIClcblxuICAgIHJldHVybiByZXNvbHZlUmVzcCQ7XG4gIH1cblxufVxuIl19