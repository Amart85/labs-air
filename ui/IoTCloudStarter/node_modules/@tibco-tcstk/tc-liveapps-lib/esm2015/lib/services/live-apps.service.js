/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { HttpHeaders } from '@angular/common/http';
import { HttpClient } from '@angular/common/http';
import { CaseInfo, CaseInfoList, CaseTypesList, CaseTypeStatesList, CaseList, UserInfo, NotesList, Note, ThreadList, NoteThread, NotificationList, CaseSearchResults, CaseTypeStatesListList } from '../models/liveappsdata';
import { SharedStateContent, TcSharedStateService, TcCoreCommonFunctions, Claim, SandboxList } from '@tibco-tcstk/tc-core-lib';
import { Groups } from '../models/tc-groups-data';
import { debounceTime, distinctUntilChanged, map, shareReplay, switchMap, tap } from 'rxjs/operators';
import { Location } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@angular/common";
import * as i3 from "@tibco-tcstk/tc-core-lib";
export class LiveAppsService {
    /**
     * @param {?} http
     * @param {?} location
     * @param {?} sharedStateService
     */
    constructor(http, location, sharedStateService) {
        this.http = http;
        this.location = location;
        this.sharedStateService = sharedStateService;
        // these are 'per session' caches. They won't time out unless explicitly cleared or browser is refreshed
        this.claimsCacheMap = new Map();
        this.userInfoCacheMap = new Map();
        this.caseTypesCacheMap = new Map();
        this.iconSVGTextCacheMap = new Map();
    }
    /**
     * @return {?}
     */
    getSandboxes() {
        /** @type {?} */
        const url = '/organisation/v1/sandboxes';
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} sandboxList
         * @return {?}
         */
        sandboxList => new SandboxList().deserialize(sandboxList))));
    }
    /**
     * @param {?} sandboxId
     * @param {?} appIds
     * @param {?} top
     * @param {?} useCache
     * @return {?}
     */
    getApplications(sandboxId, appIds, top, useCache) {
        /** @type {?} */
        const select = 'b';
        /** @type {?} */
        let url = '/case/v1/types?$sandbox=' + sandboxId + '&$select=' + select + '&$top=' + top;
        if (appIds && appIds.length > 0) {
            url = url + '&$filter=applicationId in(' + appIds.toString() + ') and isCase eq TRUE';
        }
        // note: since this is cached it will require a reload to see new apps
        /** @type {?} */
        let headers;
        if (useCache) {
            headers = new HttpHeaders().set('cacheResponse', 'true');
        }
        else {
            headers = new HttpHeaders();
        }
        return this.http.get(url, { headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} casetypes
         * @return {?}
         */
        casetypes => {
            if (appIds && appIds.length > 0) {
                // This is to workaround a bug where non case type types are returned when > 1 appId
                /** @type {?} */
                const tmpCaseTypes = new CaseTypesList().deserialize(casetypes);
                /** @type {?} */
                const filteredCaseTypes = new CaseTypesList().deserialize({ casetypes: [] });
                tmpCaseTypes.casetypes.forEach((/**
                 * @param {?} ctype
                 * @return {?}
                 */
                ctype => {
                    if (ctype.id === '1') {
                        filteredCaseTypes.casetypes.push(ctype);
                    }
                }));
                return filteredCaseTypes;
            }
            else {
                return new CaseTypesList().deserialize(casetypes);
            }
        })));
    }
    /**
     * @return {?}
     */
    getClaims() {
        /** @type {?} */
        const url = '/organisation/v1/claims';
        /** @type {?} */
        const headers = new HttpHeaders().set('cacheResponse', 'true');
        return this.http.get(url, { headers: headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} claim
         * @return {?}
         */
        claim => new Claim().deserialize(claim))));
    }
    /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} skip
     * @param {?} top
     * @return {?}
     */
    getCases(sandboxId, appId, typeId, skip, top) {
        /** @type {?} */
        const url = '/case/v1/cases' + '?$sandbox=' + sandboxId + '&$filter=applicationId eq '
            + appId + ' and typeId eq ' + typeId + '&$skip=' + skip + '&$top=' + top;
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} caseinfos
         * @return {?}
         */
        caseinfos => new CaseInfoList().deserialize(caseinfos))));
    }
    /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @return {?}
     */
    getCasesCount(sandboxId, appId, typeId) {
        /** @type {?} */
        const url = '/case/v1/cases' + '?$sandbox=' + sandboxId + '&$filter=applicationId eq '
            + appId + ' and typeId eq ' + typeId + '&$count=true';
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} casecount
         * @return {?}
         */
        casecount => casecount.toString())));
    }
    /**
     * @param {?} sandboxId
     * @param {?} caseRef
     * @return {?}
     */
    getCaseByRef(sandboxId, caseRef) {
        /** @type {?} */
        const url = '/case/v1/cases/' + caseRef
            + '?$sandbox=' + sandboxId;
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} caseinfo
         * @return {?}
         */
        caseinfo => new CaseInfo().deserialize(caseinfo))));
    }
    /**
     * @param {?} caseRef
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @return {?}
     */
    getCase(caseRef, sandboxId, appId, typeId) {
        /** @type {?} */
        const url = '/case/v1/cases/' + caseRef + '/' + '?$sandbox=' + sandboxId + '&$filter=applicationId eq '
            + appId + ' and typeId eq ' + typeId + '&$select=uc, m';
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} caseinfo
         * @return {?}
         */
        caseinfo => new CaseInfo().deserialize(caseinfo))));
    }
    /**
     * @param {?} terms
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} skip
     * @param {?} top
     * @param {?} stateId
     * @return {?}
     */
    caseSearch(terms, sandboxId, appId, typeId, skip, top, stateId) {
        return terms
            .pipe(debounceTime(500), distinctUntilChanged(), switchMap((/**
         * @param {?} term
         * @return {?}
         */
        term => this.caseSearchEntries(term, sandboxId, appId, typeId, false, skip, top, stateId))));
    }
    /**
     * @param {?} term
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} force
     * @param {?} skip
     * @param {?} top
     * @param {?} stateId
     * @return {?}
     */
    caseSearchEntries(term, sandboxId, appId, typeId, force, skip, top, stateId) {
        /** @type {?} */
        let url = '/case/v1/cases' + '?$sandbox=' + sandboxId + '&$filter=applicationId eq '
            + appId + ' and typeId eq ' + typeId;
        if (stateId) {
            url = url + ' and stateId eq ' + stateId;
        }
        url = url + '&$skip=' + skip + '&$top=' + top
            + '&$select=cr';
        if (term || (!term && !force)) {
            url = url + '&$search=' + term;
        }
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} caseinfos
         * @return {?}
         */
        caseinfos => {
            /** @type {?} */
            const caserefs = [];
            /** @type {?} */
            const caseinfolist = new CaseInfoList().deserialize(caseinfos);
            caseinfolist.caseinfos.forEach((/**
             * @param {?} caseinfo
             * @return {?}
             */
            caseinfo => {
                caserefs.push(caseinfo.caseReference);
            }));
            return new CaseSearchResults().deserialize({ caserefs: caserefs, searchString: term });
        })));
    }
    /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} top
     * @return {?}
     */
    getCaseTypes(sandboxId, appId, top) {
        /** @type {?} */
        const select = 'b,s,sa,a';
        /** @type {?} */
        let url = '/case/v1/types?$sandbox=' + sandboxId + '&$select=' + select + '&$top=' + top;
        if (appId != null) {
            url = url + '&$filter=applicationId eq ' + appId;
        }
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} casetypes
         * @return {?}
         */
        casetypes => new CaseTypesList().deserialize(casetypes))));
    }
    /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} top
     * @return {?}
     */
    getCaseTypeSchema(sandboxId, appId, top) {
        // https://eu.liveapps.cloud.tibco.com/case/v1/types?$sandbox=25&&$filter=applicationName eq 'Customer Complaint'&$select=b,js,c,ac
        /** @type {?} */
        const select = 'b,js,c,ac,a';
        /** @type {?} */
        let url = '/case/v1/types?$sandbox=' + sandboxId + '&$select=' + select + '&$top=' + top;
        if (appId != null) {
            url = url + '&$filter=applicationId eq ' + appId;
        }
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} casetypes
         * @return {?}
         */
        casetypes => new CaseTypesList().deserialize(casetypes))));
    }
    /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} top
     * @return {?}
     */
    getCaseTypeStates(sandboxId, appId, top) {
        /** @type {?} */
        const select = 's';
        /** @type {?} */
        let url = '/case/v1/types?$sandbox=' + sandboxId + '&$select=' + select + '&$top=' + top;
        if (appId != null) {
            url = url + '&$filter=applicationId eq ' + appId;
        }
        /** @type {?} */
        const headers = new HttpHeaders().set('cacheResponse', 'true');
        return this.http.get(url, { headers: headers })
            // return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} casetypestates
         * @return {?}
         */
        casetypestates => {
            // const x = new CaseTypeStatesList().deserialize(casetypestates[0].states);
            // return x;
            // const x = new CaseTypeStatesList().deserialize(casetypestates[0].states);
            // return x;
            /** @type {?} */
            const casetypelist = new CaseTypeStatesListList().deserialize(casetypestates);
            /** @type {?} */
            let states;
            casetypelist.casetypes.forEach((/**
             * @param {?} casetype
             * @return {?}
             */
            (casetype) => {
                if (casetype.states !== undefined) {
                    states = new CaseTypeStatesList().deserialize(casetype.states);
                }
            }));
            return states;
        })));
    }
    /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} top
     * @return {?}
     */
    getCaseTypeBasicInfo(sandboxId, appId, typeId, top) {
        /** @type {?} */
        const select = 'b';
        /** @type {?} */
        let url = '/case/v1/types?$sandbox=' + sandboxId + '&$select=' + select + '&$top=' + top;
        if (appId != null) {
            url = url + '&$filter=applicationId eq ' + appId;
        }
        if (!this.caseTypesCacheMap.get(url)) {
            /** @type {?} */
            const cacheEntry$ = this.getCaseTypeBasicInfoCached(url, typeId)
                .pipe(shareReplay(1));
            this.caseTypesCacheMap.set(url, cacheEntry$);
        }
        return this.caseTypesCacheMap.get(url);
    }
    /**
     * @private
     * @param {?} url
     * @param {?} typeId
     * @return {?}
     */
    getCaseTypeBasicInfoCached(url, typeId) {
        /** @type {?} */
        const headers = new HttpHeaders().set('cacheResponse', 'true');
        return this.http.get(url, { headers: headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} casetypes
         * @return {?}
         */
        casetypes => {
            /** @type {?} */
            const caseTypesList = new CaseTypesList().deserialize(casetypes);
            /** @type {?} */
            let requestedType;
            caseTypesList.casetypes.forEach((/**
             * @param {?} casetype
             * @return {?}
             */
            (casetype) => {
                if (casetype.id === typeId) {
                    requestedType = casetype;
                }
            }));
            return requestedType;
        })));
    }
    /**
     * @param {?} url
     * @return {?}
     */
    clearFromIconSVGTextCache(url) {
        if (this.iconSVGTextCacheMap.get(url)) {
            this.iconSVGTextCacheMap.delete(url);
        }
    }
    /**
     * @param {?} url
     * @return {?}
     */
    getIconSVGText(url) {
        // todo: revisit the base href issue
        if (url.substr(0, 2) === '//') {
            url = url.substr(1, url.length - 1);
        }
        if (!this.iconSVGTextCacheMap.get(url)) {
            // const fixedUrl = window.location.protocol + '//' + window.location.host  + url;
            /** @type {?} */
            const cacheEntry$ = this.getIconSVGTextCache(url)
                .pipe(shareReplay(1));
            this.iconSVGTextCacheMap.set(url, cacheEntry$);
        }
        return this.iconSVGTextCacheMap.get(url);
    }
    /**
     * @private
     * @param {?} url
     * @return {?}
     */
    getIconSVGTextCache(url) {
        /** @type {?} */
        const headers = new HttpHeaders().set('cacheResponse', 'true');
        return this.http.get(url, { responseType: 'text', headers: headers })
            .pipe(map((/**
         * @param {?} val
         * @return {?}
         */
        val => {
            /** @type {?} */
            const svgContents = val.toString();
            return svgContents;
        })));
    }
    /**
     * @private
     * @param {?} casesContent
     * @param {?} caseRef
     * @param {?} toggle
     * @return {?}
     */
    updateCasesRecord(casesContent, caseRef, toggle) {
        /** @type {?} */
        const sharedStateContent = new SharedStateContent().deserialize(casesContent);
        /** @type {?} */
        const casesRec = JSON.parse(sharedStateContent.json);
        /** @type {?} */
        let existing = false;
        // check if already exists
        if (caseRef === '-1') {
            // clear list
            casesRec.caseRefs.length = 0;
        }
        else {
            if (casesRec.caseRefs.indexOf(caseRef) !== -1) {
                // remove it if it is already in the array
                casesRec.caseRefs.splice(casesRec.caseRefs.indexOf(caseRef), 1);
                existing = true;
            }
            if (!toggle || existing === false) {
                // only add it if we are not in toggle mode (favorites) or if the caseRef didnt already exist in the list
                // now add case to front of array
                casesRec.caseRefs.unshift(caseRef);
                // check if we are > max size
                if (casesRec.maxSize !== -1 && casesRec.caseRefs.length > casesRec.maxSize) {
                    // remove oldest entry
                    casesRec.caseRefs.pop();
                }
            }
        }
        sharedStateContent.json = TcCoreCommonFunctions.escapeString(JSON.stringify(casesRec));
        return sharedStateContent;
    }
    /**
     * @private
     * @param {?} caseRef
     * @param {?} maxSize
     * @return {?}
     */
    newCasesRecord(caseRef, maxSize) {
        /** @type {?} */
        const casesRec = new CaseList();
        casesRec.maxSize = maxSize;
        if (caseRef === '-1') {
            casesRec.caseRefs = [];
        }
        else {
            casesRec.caseRefs = [caseRef];
        }
        casesRec.uniqueKey = 'caseReference';
        /** @type {?} */
        const sharedStateContent = new SharedStateContent();
        sharedStateContent.json = TcCoreCommonFunctions.escapeString(JSON.stringify(casesRec));
        return sharedStateContent;
    }
    /**
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    getRecentCases(uiAppId, sandboxId) {
        /** @type {?} */
        const ssName = uiAppId + '.recentcases.tibcolabs.client.context.PRIVATE';
        return this.getSSCasesList(ssName, sandboxId);
    }
    /**
     * @private
     * @param {?} ssName
     * @param {?} sandboxId
     * @return {?}
     */
    getSSCasesList(ssName, sandboxId) {
        return this.sharedStateService.getSharedState(ssName, 'PRIVATE', false, false)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} sharedStateList
         * @return {?}
         */
        sharedStateList => {
            if (sharedStateList.sharedStateEntries.length > 0) {
                return new CaseList().deserialize(JSON.parse(sharedStateList.sharedStateEntries[0].content.json));
            }
            else {
                return new CaseList();
            }
        })));
    }
    /**
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    unsetRecentCase(caseRef, uiAppId, sandboxId) {
        // NOTE: Use '-1' as caseRef to clear recent cases list
        /** @type {?} */
        const ssName = uiAppId + '.recentcases.tibcolabs.client.context.PRIVATE';
        this.setCasesRecord(ssName, caseRef, uiAppId, sandboxId, 10, true);
    }
    /**
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    setRecentCase(caseRef, uiAppId, sandboxId) {
        // NOTE: Use '-1' as caseRef to clear recent cases list
        /** @type {?} */
        const ssName = uiAppId + '.recentcases.tibcolabs.client.context.PRIVATE';
        this.setCasesRecord(ssName, caseRef, uiAppId, sandboxId, 10, false);
    }
    /**
     * @private
     * @param {?} ssName
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @param {?} maxSize
     * @param {?} toggle
     * @return {?}
     */
    setCasesRecord(ssName, caseRef, uiAppId, sandboxId, maxSize, toggle) {
        // get cases list from shared state if any
        // update cases data removing oldest if > maxsize
        // set shared state
        /** @type {?} */
        let casesEntry;
        this.sharedStateService.getSharedState(ssName, 'PRIVATE', false, false)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} sharedStateList
         * @return {?}
         */
        sharedStateList => {
            casesEntry = sharedStateList.sharedStateEntries[0] || undefined;
            /** @type {?} */
            let content;
            if (casesEntry) {
                content = this.updateCasesRecord(casesEntry.content, caseRef, toggle);
                casesEntry.content = content;
                sharedStateList.sharedStateEntries[0] = casesEntry;
                this.sharedStateService.updateSharedState(sharedStateList.sharedStateEntries).subscribe();
            }
            else {
                content = this.newCasesRecord(caseRef, maxSize);
                this.sharedStateService.createSharedState(ssName, 'PRIVATE', '', sandboxId, undefined, undefined, undefined, content).subscribe();
            }
            return casesEntry;
        }))).subscribe(null, (/**
         * @param {?} error
         * @return {?}
         */
        error => console.log('Unable to set recent cases: ' + error)));
    }
    /**
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    getFavoriteCases(uiAppId, sandboxId) {
        /** @type {?} */
        const ssName = uiAppId + '.favoritecases.tibcolabs.client.context.PRIVATE';
        return this.sharedStateService.getSharedState(ssName, 'PRIVATE', false, false)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} sharedStateList
         * @return {?}
         */
        sharedStateList => {
            if (sharedStateList.sharedStateEntries.length > 0) {
                return new CaseList().deserialize(JSON.parse(sharedStateList.sharedStateEntries[0].content.json));
            }
            else {
                return new CaseList();
            }
        })));
    }
    /**
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    setFavoriteCase(caseRef, uiAppId, sandboxId) {
        // NOTE: Use '-1' as caseRef to clear recent cases list
        /** @type {?} */
        const ssName = uiAppId + '.favoritecases.tibcolabs.client.context.PRIVATE';
        this.setCasesRecord(ssName, caseRef, uiAppId, sandboxId, -1, true);
    }
    /**
     * @param {?} caseRef
     * @param {?} uiAppId
     * @param {?} sandboxId
     * @return {?}
     */
    isFavoriteCase(caseRef, uiAppId, sandboxId) {
        /** @type {?} */
        const ssName = uiAppId + '.favoritecases.tibcolabs.client.context.PRIVATE';
        return this.getSSCasesList(ssName, sandboxId)
            .pipe(map((/**
         * @param {?} caselist
         * @return {?}
         */
        caselist => {
            return caselist.caseRefs ? (caselist.caseRefs.indexOf(caseRef) !== -1) : false;
        })));
    }
    /**
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} processId
     * @param {?} caseReference
     * @param {?} data
     * @return {?}
     */
    runProcess(sandboxId, appId, processId, caseReference, data) {
        /** @type {?} */
        const url = '/process/v1/processes';
        // convert data to an escaped JSON string
        /** @type {?} */
        let dataJson;
        if (data) {
            dataJson = TcCoreCommonFunctions.escapeString(JSON.stringify(data));
        }
        else {
            dataJson = TcCoreCommonFunctions.escapeString(JSON.stringify({}));
        }
        /** @type {?} */
        const body = {
            'id': processId,
            'sandboxId': sandboxId,
            'applicationId': appId,
            'data': dataJson
        };
        if (caseReference) {
            body['caseReference'] = caseReference;
        }
        /** @type {?} */
        const bodyStr = JSON.stringify(body);
        /** @type {?} */
        const headers = new HttpHeaders()
            .set('Content-Type', 'application/json');
        return this.http.post(url, bodyStr, { headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} response
         * @return {?}
         */
        response => response)));
    }
    // Since we call get userinfo a lot - and the data doesn't tend to change - I will cache it for the session
    /**
     * @param {?} userId
     * @return {?}
     */
    getUserInfo(userId) {
        /** @type {?} */
        const url = '/organisation/v1/users/' + userId;
        if (!this.userInfoCacheMap.get(userId)) {
            /** @type {?} */
            const cacheEntry$ = this.getUserCached(url)
                .pipe(shareReplay(1));
            this.userInfoCacheMap.set(userId, cacheEntry$);
        }
        return this.userInfoCacheMap.get(userId);
    }
    /**
     * @private
     * @param {?} url
     * @return {?}
     */
    getUserCached(url) {
        /** @type {?} */
        const headers = new HttpHeaders().set('cacheResponse', 'true');
        return this.http.get(url, { headers: headers })
            .pipe(map((/**
         * @param {?} userinfo
         * @return {?}
         */
        userinfo => new UserInfo().deserialize(userinfo))));
    }
    /* notes service */
    /**
     * @param {?} relatedItemType
     * @param {?} itemTypeId
     * @param {?} skip
     * @param {?} top
     * @return {?}
     */
    getThreads(relatedItemType, itemTypeId, skip, top) {
        // https://liveapps.tenant-integration.tcie.pro/collaboration/notes?$relatedItemCollection=CASE_APP_15441&$orderby=createdDate%20ASC
        /** @type {?} */
        const url = '/collaboration/v1/notes?$relatedItemCollection=' + relatedItemType + '_' + itemTypeId
            + '&$orderby=createdDate desc'
            + '&$top=' + top + '&$skip=' + skip;
        return this.http.get(url)
            .pipe(map((/**
         * @param {?} notes
         * @return {?}
         */
        notes => {
            /** @type {?} */
            const returnedNotes = new NotesList().deserialize(notes);
            /** @type {?} */
            const threadList = new ThreadList();
            threadList.threads = [];
            // create threads
            returnedNotes.notes.forEach((/**
             * @param {?} note
             * @return {?}
             */
            function (note) {
                if (note.level === 1) {
                    /** @type {?} */
                    const noteThread = new NoteThread(note.thread.id, false, false, false, undefined, [], note);
                    // get other threads for this id
                    returnedNotes.notes.forEach((/**
                     * @param {?} threadNote
                     * @return {?}
                     */
                    function (threadNote) {
                        if (threadNote.level > 1 && threadNote.threadId === note.thread.id) {
                            // add to the thread
                            noteThread.thread.push(threadNote);
                        }
                    }));
                    threadList.threads.push(noteThread);
                }
            }));
            return threadList;
        })));
    }
    /**
     * @param {?} collectionIds
     * @return {?}
     */
    getNotesForCollections(collectionIds) {
        if (collectionIds) {
            /** @type {?} */
            const url = '/collaboration/v1/notes?$relatedItemCollection=' + collectionIds +
                '&$orderby=createdDate ASC';
            return this.http.get(url)
                .pipe(map((/**
             * @param {?} notes
             * @return {?}
             */
            notes => new NotesList().deserialize(notes))));
        }
    }
    /**
     * @return {?}
     */
    deleteAllNotes() {
    }
    /**
     * @param {?} note
     * @param {?} noteId
     * @return {?}
     */
    updateNote(note, noteId) {
        /** @type {?} */
        const url = '/collaboration/v1/notes/' + noteId;
        /** @type {?} */
        const body = note;
        /** @type {?} */
        const bodyStr = JSON.stringify(body);
        /** @type {?} */
        const headers = new HttpHeaders()
            .set('Content-Type', 'application/json');
        return this.http.put(url, bodyStr, { headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} result
         * @return {?}
         */
        result => new Note().deserialize(result))));
    }
    /**
     * @param {?} relatedItemType
     * @param {?} uiAppSource
     * @param {?} relatedItemId
     * @param {?} notificationLabel
     * @param {?} notificationUrl
     * @param {?} title
     * @param {?} noteText
     * @return {?}
     */
    createNote(relatedItemType, uiAppSource, relatedItemId, notificationLabel, notificationUrl, title, noteText) {
        /** @type {?} */
        const url = '/collaboration/v1/notes';
        /** @type {?} */
        const note = new Note().deserialize({
            attributes: [],
            notificationLabel: notificationLabel,
            notificationUrl: notificationUrl,
            text: noteText,
            title: title
        });
        /** @type {?} */
        const body = {
            note: note,
            relatedItemCollection: [
                (relatedItemType + '_' + relatedItemId)
            ],
            relatedItemId: relatedItemId,
            relatedItemType: uiAppSource,
            roles: undefined
        };
        /** @type {?} */
        const bodyStr = JSON.stringify(body);
        /** @type {?} */
        const headers = new HttpHeaders()
            .set('Content-Type', 'application/json');
        return this.http.post(url, bodyStr, { headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} result
         * @return {?}
         */
        result => Number(result))));
    }
    /**
     * @param {?} noteId
     * @return {?}
     */
    getNote(noteId) {
        /** @type {?} */
        const url = '/collaboration/v1/notes/' + noteId;
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} note
         * @return {?}
         */
        note => new Note().deserialize(note))));
    }
    /**
     * @param {?} relatedItemType
     * @param {?} relatedItemId
     * @param {?} threadId
     * @return {?}
     */
    getThread(relatedItemType, relatedItemId, threadId) {
        /** @type {?} */
        const url = '/collaboration/v1/notes/?$relatedItemType=' + relatedItemType
            + '&relatedItemId=' + relatedItemId
            + '&filter=threadId=' + threadId
            + '&orderby=createdDate ASC';
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} notes
         * @return {?}
         */
        notes => new NotesList().deserialize(notes))));
    }
    /**
     * @param {?} originalNote
     * @param {?} reply
     * @param {?} noteId
     * @return {?}
     */
    createReplyNote(originalNote, reply, noteId) {
        /** @type {?} */
        const url = '/collaboration/v1/notes/' + noteId;
        /** @type {?} */
        const body = {
            notificationLabel: originalNote.notificationLabel,
            notificationUrl: originalNote.notificationUrl,
            text: reply
        };
        /** @type {?} */
        const bodyStr = JSON.stringify(body);
        /** @type {?} */
        const headers = new HttpHeaders()
            .set('Content-Type', 'application/json');
        return this.http.post(url, bodyStr, { headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} value
         * @return {?}
         */
        value => Number(value))));
    }
    /**
     * @param {?} relatedItemType
     * @param {?} relatedTypeId
     * @return {?}
     */
    subscribeToNotes(relatedItemType, relatedTypeId) {
        /** @type {?} */
        const url = '/collaboration/v1/notifications';
        /** @type {?} */
        const body = {
            topicId: undefined,
            threadId: undefined,
            notifyCollection: {
                collectionName: relatedItemType + '_' + relatedTypeId,
                lifecycledWithType: 'RT_CASE',
                lifecycledWithId: true
            }
        };
        /** @type {?} */
        const bodyStr = JSON.stringify(body);
        /** @type {?} */
        const headers = new HttpHeaders()
            .set('Content-Type', 'application/json');
        return this.http.post(url, bodyStr, { headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))));
    }
    /**
     * @param {?} relatedItemType
     * @param {?} relatedTypeId
     * @param {?} userId
     * @return {?}
     */
    unsubscribeToNotes(relatedItemType, relatedTypeId, userId) {
        /** @type {?} */
        let url = '/collaboration/v1/notifications?$filter=collectionName=';
        url = url + '\'' + relatedItemType + '_' + relatedTypeId + '\' and entityId=' + userId;
        return this.http.delete(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))));
    }
    /**
     * @param {?} relatedItemType
     * @param {?} relatedTypeId
     * @param {?} userId
     * @return {?}
     */
    getNotifications(relatedItemType, relatedTypeId, userId) {
        /** @type {?} */
        const url = '/collaboration/v1/notifications?$filter=collectionName=\'' + relatedItemType + '_' + relatedTypeId
            + '\' and entityId=' + userId;
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} value
         * @return {?}
         */
        value => new NotificationList().deserialize(value))));
    }
    /**
     * @param {?} noteId
     * @return {?}
     */
    deleteNote(noteId) {
        /** @type {?} */
        const url = '/collaboration/v1/notes/' + noteId;
        return this.http.delete(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))));
    }
    /* end notes service */
    /**
     * @param {?} sandboxId
     * @param {?} top
     * @param {?} useCache
     * @return {?}
     */
    getGroups(sandboxId, top, useCache) {
        /** @type {?} */
        const url = '/organisation/v1/groups?$sandbox=' + sandboxId + '&$top=' + top;
        /** @type {?} */
        let headers;
        if (useCache) {
            headers = new HttpHeaders().set('cacheResponse', 'true');
        }
        else {
            headers = new HttpHeaders();
        }
        return this.http.get(url, { headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} groups
         * @return {?}
         */
        groups => new Groups().deserialize({ groups: groups }))));
    }
    /**
     * @param {?} sandboxId
     * @param {?} userId
     * @param {?} top
     * @param {?} useCache
     * @return {?}
     */
    getGroupMemberships(sandboxId, userId, top, useCache) {
        /** @type {?} */
        const url = '/organisation/v1/users/' + userId + '/groups' + '?$sandbox=' + sandboxId + '&$top=' + top;
        /** @type {?} */
        let headers;
        if (useCache) {
            headers = new HttpHeaders().set('cacheResponse', 'true');
        }
        else {
            headers = new HttpHeaders();
        }
        return this.http.get(url, { headers })
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} groups
         * @return {?}
         */
        groups => new Groups().deserialize({ groups: groups }))));
    }
}
LiveAppsService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
LiveAppsService.ctorParameters = () => [
    { type: HttpClient },
    { type: Location },
    { type: TcSharedStateService }
];
/** @nocollapse */ LiveAppsService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function LiveAppsService_Factory() { return new LiveAppsService(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Location), i0.ɵɵinject(i3.TcSharedStateService)); }, token: LiveAppsService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    LiveAppsService.prototype.claimsCacheMap;
    /**
     * @type {?}
     * @private
     */
    LiveAppsService.prototype.userInfoCacheMap;
    /**
     * @type {?}
     * @private
     */
    LiveAppsService.prototype.caseTypesCacheMap;
    /**
     * @type {?}
     * @private
     */
    LiveAppsService.prototype.iconSVGTextCacheMap;
    /**
     * @type {?}
     * @private
     */
    LiveAppsService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    LiveAppsService.prototype.location;
    /**
     * @type {?}
     * @private
     */
    LiveAppsService.prototype.sharedStateService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdGliY28tdGNzdGsvdGMtbGl2ZWFwcHMtbGliLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2xpdmUtYXBwcy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFXLE1BQU0sZUFBZSxDQUFDO0FBRXBELE9BQU8sRUFBdUMsV0FBVyxFQUFjLE1BQU0sc0JBQXNCLENBQUM7QUFDcEcsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFDTCxRQUFRLEVBQ1IsWUFBWSxFQUNaLGFBQWEsRUFDYixrQkFBa0IsRUFFbEIsUUFBUSxFQUNSLFFBQVEsRUFFUixTQUFTLEVBQ1QsSUFBSSxFQUNKLFVBQVUsRUFFVixVQUFVLEVBQ1YsZ0JBQWdCLEVBS2hCLGlCQUFpQixFQUNqQixzQkFBc0IsRUFDdkIsTUFBTSx3QkFBd0IsQ0FBQztBQUVoQyxPQUFPLEVBS0wsa0JBQWtCLEVBQ2xCLG9CQUFvQixFQUVwQixxQkFBcUIsRUFFckIsS0FBSyxFQUVMLFdBQVcsRUFDWixNQUFNLDBCQUEwQixDQUFDO0FBQ2xDLE9BQU8sRUFBQyxNQUFNLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUNoRCxPQUFPLEVBRUwsWUFBWSxFQUNaLG9CQUFvQixFQUNwQixHQUFHLEVBR0gsV0FBVyxFQUNYLFNBQVMsRUFHVCxHQUFHLEVBQ0osTUFBTSxnQkFBZ0IsQ0FBQztBQUd4QixPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0saUJBQWlCLENBQUM7Ozs7O0FBTXpDLE1BQU0sT0FBTyxlQUFlOzs7Ozs7SUFPMUIsWUFDVSxJQUFnQixFQUFVLFFBQWtCLEVBQVUsa0JBQXdDO1FBQTlGLFNBQUksR0FBSixJQUFJLENBQVk7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQVUsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFzQjs7UUFO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OztZQUNsRyxPQUFPO1FBQ1gsSUFBSSxRQUFRLEVBQUU7WUFDWixPQUFPLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQyxHQUFHLENBQUMsZUFBZSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQzFEO2FBQU07WUFDTCxPQUFPLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztTQUM3QjtRQUVELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUM7YUFDbkMsSUFBSSxDQUNILEdBQUc7Ozs7UUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxFQUFDLEVBQzFFLEdBQUc7Ozs7UUFBRSxNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksTUFBTSxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUMsQ0FDN0QsQ0FBQztJQUNOLENBQUM7OztZQTFwQkYsVUFBVSxTQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COzs7O1lBMURRLFVBQVU7WUFzRFgsUUFBUTtZQXhCZCxvQkFBb0I7Ozs7Ozs7O0lBZ0NwQix5Q0FBbUM7Ozs7O0lBQ25DLDJDQUFxQzs7Ozs7SUFDckMsNENBQXNDOzs7OztJQUN0Qyw4Q0FBd0M7Ozs7O0lBR3RDLCtCQUF3Qjs7Ozs7SUFBRSxtQ0FBMEI7Ozs7O0lBQUUsNkNBQWdEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTmdNb2R1bGV9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtmb3JrSm9pbiwgT2JzZXJ2YWJsZSwgb2YsIHRocm93RXJyb3J9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgSHR0cENsaWVudE1vZHVsZSwgSHR0cEVycm9yUmVzcG9uc2UsIEh0dHBIZWFkZXJzLCBIdHRwUGFyYW1zIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7XG4gIENhc2VJbmZvLFxuICBDYXNlSW5mb0xpc3QsXG4gIENhc2VUeXBlc0xpc3QsXG4gIENhc2VUeXBlU3RhdGVzTGlzdCxcbiAgQ2FzZUFjdGlvbnNMaXN0LFxuICBDYXNlTGlzdCxcbiAgVXNlckluZm8sXG4gIEFwaVJlc3BvbnNlVGV4dCxcbiAgTm90ZXNMaXN0LFxuICBOb3RlLFxuICBUaHJlYWRMaXN0LFxuICBUaHJlYWQsXG4gIE5vdGVUaHJlYWQsXG4gIE5vdGlmaWNhdGlvbkxpc3QsXG4gIENhc2VUeXBlLFxuICBDYXJkQ29uZmlnLFxuICBJY29uTWFwLFxuICBNZXRhZGF0YSxcbiAgQ2FzZVNlYXJjaFJlc3VsdHMsXG4gIENhc2VUeXBlU3RhdGVzTGlzdExpc3Rcbn0gZnJvbSAnLi4vbW9kZWxzL2xpdmVhcHBzZGF0YSc7XG5pbXBvcnQgeyAgRG9jdW1lbnRMaXN0LCBEb2N1bWVudH0gZnJvbSAnLi4vbW9kZWxzL3RjLWRvY3VtZW50JztcbmltcG9ydCB7XG4gIEFjY2Vzc1Rva2VuLFxuICBBdXRoSW5mbyxcbiAgU2hhcmVkU3RhdGVMaXN0LFxuICBTaGFyZWRTdGF0ZUVudHJ5LFxuICBTaGFyZWRTdGF0ZUNvbnRlbnQsXG4gIFRjU2hhcmVkU3RhdGVTZXJ2aWNlLFxuICBVaUFwcENvbmZpZyxcbiAgVGNDb3JlQ29tbW9uRnVuY3Rpb25zLFxuICBHcm91cCxcbiAgQ2xhaW0sXG4gIFNhbmRib3gsXG4gIFNhbmRib3hMaXN0XG59IGZyb20gJ0B0aWJjby10Y3N0ay90Yy1jb3JlLWxpYic7XG5pbXBvcnQge0dyb3Vwc30gZnJvbSAnLi4vbW9kZWxzL3RjLWdyb3Vwcy1kYXRhJztcbmltcG9ydCB7XG4gIGNhdGNoRXJyb3IsXG4gIGRlYm91bmNlVGltZSxcbiAgZGlzdGluY3RVbnRpbENoYW5nZWQsXG4gIG1hcCxcbiAgbWVyZ2VNYXAsXG4gIHNoYXJlLFxuICBzaGFyZVJlcGxheSxcbiAgc3dpdGNoTWFwLFxuICB0YWtlLFxuICB0YWtlVW50aWwsXG4gIHRhcFxufSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBEZXNlcmlhbGl6YWJsZX0gZnJvbSAnQHRpYmNvLXRjc3RrL3RjLWNvcmUtbGliJztcbmltcG9ydCB7c3BsaXR9IGZyb20gJ3RzLW5vZGUnO1xuaW1wb3J0IHtMb2NhdGlvbn0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5cbmV4cG9ydCBjbGFzcyBMaXZlQXBwc1NlcnZpY2Uge1xuICAvLyB0aGVzZSBhcmUgJ3BlciBzZXNzaW9uJyBjYWNoZXMuIFRoZXkgd29uJ3QgdGltZSBvdXQgdW5sZXNzIGV4cGxpY2l0bHkgY2xlYXJlZCBvciBicm93c2VyIGlzIHJlZnJlc2hlZFxuICBwcml2YXRlIGNsYWltc0NhY2hlTWFwID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHVzZXJJbmZvQ2FjaGVNYXAgPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgY2FzZVR5cGVzQ2FjaGVNYXAgPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgaWNvblNWR1RleHRDYWNoZU1hcCA9IG5ldyBNYXAoKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsIHByaXZhdGUgbG9jYXRpb246IExvY2F0aW9uLCBwcml2YXRlIHNoYXJlZFN0YXRlU2VydmljZTogVGNTaGFyZWRTdGF0ZVNlcnZpY2UpIHsgfVxuXG4gIHB1YmxpYyBnZXRTYW5kYm94ZXMoKTogT2JzZXJ2YWJsZTxTYW5kYm94TGlzdD4ge1xuICAgIGNvbnN0IHVybCA9ICcvb3JnYW5pc2F0aW9uL3YxL3NhbmRib3hlcyc7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAgKCBzYW5kYm94TGlzdCA9PiBuZXcgU2FuZGJveExpc3QoKS5kZXNlcmlhbGl6ZShzYW5kYm94TGlzdCkpKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRBcHBsaWNhdGlvbnMoc2FuZGJveElkOiBudW1iZXIsIGFwcElkczogc3RyaW5nW10sIHRvcDogbnVtYmVyLCB1c2VDYWNoZTogYm9vbGVhbik6IE9ic2VydmFibGU8Q2FzZVR5cGVzTGlzdD4ge1xuICAgIGNvbnN0IHNlbGVjdCA9ICdiJztcbiAgICBsZXQgdXJsID0gJy9jYXNlL3YxL3R5cGVzPyRzYW5kYm94PScgKyBzYW5kYm94SWQgKyAnJiRzZWxlY3Q9JyArIHNlbGVjdCArICcmJHRvcD0nICsgdG9wO1xuXG4gICAgaWYgKGFwcElkcyAmJiBhcHBJZHMubGVuZ3RoID4gMCkge1xuICAgICAgdXJsID0gdXJsICsgJyYkZmlsdGVyPWFwcGxpY2F0aW9uSWQgaW4oJyArIGFwcElkcy50b1N0cmluZygpICsgJykgYW5kIGlzQ2FzZSBlcSBUUlVFJztcbiAgICB9XG4gICAgLy8gbm90ZTogc2luY2UgdGhpcyBpcyBjYWNoZWQgaXQgd2lsbCByZXF1aXJlIGEgcmVsb2FkIHRvIHNlZSBuZXcgYXBwc1xuICAgIGxldCBoZWFkZXJzO1xuICAgIGlmICh1c2VDYWNoZSkge1xuICAgICAgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpLnNldCgnY2FjaGVSZXNwb25zZScsICd0cnVlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGhlYWRlcnMgPSBuZXcgSHR0cEhlYWRlcnMoKTtcbiAgICB9XG5cblxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCwgeyBoZWFkZXJzIH0pXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcChjYXNldHlwZXMgPT4ge1xuICAgICAgICAgIGlmIChhcHBJZHMgJiYgYXBwSWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIC8vIFRoaXMgaXMgdG8gd29ya2Fyb3VuZCBhIGJ1ZyB3aGVyZSBub24gY2FzZSB0eXBlIHR5cGVzIGFyZSByZXR1cm5lZCB3aGVuID4gMSBhcHBJZFxuICAgICAgICAgICAgY29uc3QgdG1wQ2FzZVR5cGVzID0gbmV3IENhc2VUeXBlc0xpc3QoKS5kZXNlcmlhbGl6ZShjYXNldHlwZXMpO1xuICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRDYXNlVHlwZXMgPSBuZXcgQ2FzZVR5cGVzTGlzdCgpLmRlc2VyaWFsaXplKCB7IGNhc2V0eXBlczogW10gfSk7XG5cbiAgICAgICAgICAgIHRtcENhc2VUeXBlcy5jYXNldHlwZXMuZm9yRWFjaChjdHlwZSA9PiB7XG4gICAgICAgICAgICAgIGlmIChjdHlwZS5pZCA9PT0gJzEnKSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWRDYXNlVHlwZXMuY2FzZXR5cGVzLnB1c2goY3R5cGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBmaWx0ZXJlZENhc2VUeXBlcztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBDYXNlVHlwZXNMaXN0KCkuZGVzZXJpYWxpemUoY2FzZXR5cGVzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRDbGFpbXMoKTogT2JzZXJ2YWJsZTxDbGFpbT4ge1xuICAgIGNvbnN0IHVybCA9ICcvb3JnYW5pc2F0aW9uL3YxL2NsYWltcyc7XG4gICAgY29uc3QgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpLnNldCgnY2FjaGVSZXNwb25zZScsICd0cnVlJyk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsLCB7IGhlYWRlcnM6IGhlYWRlcnMgfSApXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcCAoIGNsYWltID0+IG5ldyBDbGFpbSgpLmRlc2VyaWFsaXplKGNsYWltKSkpO1xuICB9XG5cbiAgcHVibGljIGdldENhc2VzKHNhbmRib3hJZDogbnVtYmVyLCBhcHBJZDogc3RyaW5nLCB0eXBlSWQ6IHN0cmluZywgc2tpcDogbnVtYmVyLCB0b3A6IG51bWJlcik6IE9ic2VydmFibGU8Q2FzZUluZm9MaXN0PiB7XG4gICAgY29uc3QgdXJsID0gJy9jYXNlL3YxL2Nhc2VzJyArICc/JHNhbmRib3g9JyArIHNhbmRib3hJZCArICcmJGZpbHRlcj1hcHBsaWNhdGlvbklkIGVxICdcbiAgICAgICsgYXBwSWQgKyAnIGFuZCB0eXBlSWQgZXEgJyArIHR5cGVJZCArICcmJHNraXA9JyArIHNraXAgKyAnJiR0b3A9JyArIHRvcDtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcChjYXNlaW5mb3MgPT4gbmV3IENhc2VJbmZvTGlzdCgpLmRlc2VyaWFsaXplKGNhc2VpbmZvcykpKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRDYXNlc0NvdW50KHNhbmRib3hJZDogbnVtYmVyLCBhcHBJZDogc3RyaW5nLCB0eXBlSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8c3RyaW5nPiB7XG4gICAgY29uc3QgdXJsID0gJy9jYXNlL3YxL2Nhc2VzJyArICc/JHNhbmRib3g9JyArIHNhbmRib3hJZCArICcmJGZpbHRlcj1hcHBsaWNhdGlvbklkIGVxICdcbiAgICAgICsgYXBwSWQgKyAnIGFuZCB0eXBlSWQgZXEgJyArIHR5cGVJZCArICcmJGNvdW50PXRydWUnO1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAoY2FzZWNvdW50ID0+IGNhc2Vjb3VudC50b1N0cmluZygpKSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0Q2FzZUJ5UmVmKHNhbmRib3hJZCwgY2FzZVJlZjogc3RyaW5nKTogT2JzZXJ2YWJsZTxDYXNlSW5mbz4ge1xuICAgIGNvbnN0IHVybCA9ICcvY2FzZS92MS9jYXNlcy8nICsgY2FzZVJlZlxuICAgICAgKyAnPyRzYW5kYm94PScgKyBzYW5kYm94SWQ7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAoY2FzZWluZm8gPT4gbmV3IENhc2VJbmZvKCkuZGVzZXJpYWxpemUoY2FzZWluZm8pKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRDYXNlKGNhc2VSZWY6IHN0cmluZywgc2FuZGJveElkOiBudW1iZXIsIGFwcElkOiBzdHJpbmcsIHR5cGVJZDogc3RyaW5nICk6IE9ic2VydmFibGU8Q2FzZUluZm8+IHtcbiAgICBjb25zdCB1cmwgPSAnL2Nhc2UvdjEvY2FzZXMvJyArIGNhc2VSZWYgKyAnLycgKyAnPyRzYW5kYm94PScgKyBzYW5kYm94SWQgKyAnJiRmaWx0ZXI9YXBwbGljYXRpb25JZCBlcSAnXG4gICAgICArIGFwcElkICsgJyBhbmQgdHlwZUlkIGVxICcgKyB0eXBlSWQgKyAnJiRzZWxlY3Q9dWMsIG0nO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgbWFwKGNhc2VpbmZvID0+IG5ldyBDYXNlSW5mbygpLmRlc2VyaWFsaXplKGNhc2VpbmZvKSkpO1xuICB9XG5cbiAgcHVibGljIGNhc2VTZWFyY2godGVybXM6IE9ic2VydmFibGU8c3RyaW5nPiwgc2FuZGJveElkOiBudW1iZXIsIGFwcElkOiBzdHJpbmcsIHR5cGVJZDogc3RyaW5nLCBza2lwOiBudW1iZXIsIHRvcDogbnVtYmVyLCBzdGF0ZUlkOiBudW1iZXIpOiBPYnNlcnZhYmxlPENhc2VTZWFyY2hSZXN1bHRzPiB7XG4gICAgcmV0dXJuIHRlcm1zXG4gICAgICAucGlwZShcbiAgICAgICAgZGVib3VuY2VUaW1lKDUwMCksXG4gICAgICAgIGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXG4gICAgICAgIHN3aXRjaE1hcCh0ZXJtID0+IHRoaXMuY2FzZVNlYXJjaEVudHJpZXModGVybSwgc2FuZGJveElkLCBhcHBJZCwgdHlwZUlkLCBmYWxzZSwgc2tpcCwgdG9wLCBzdGF0ZUlkKSlcbiAgICAgICk7XG4gIH1cblxuICBwdWJsaWMgY2FzZVNlYXJjaEVudHJpZXModGVybTogc3RyaW5nLCBzYW5kYm94SWQ6IG51bWJlciwgYXBwSWQ6IHN0cmluZywgdHlwZUlkOiBzdHJpbmcsIGZvcmNlOiBib29sZWFuLCBza2lwOiBudW1iZXIsIHRvcDogbnVtYmVyLCBzdGF0ZUlkOiBudW1iZXIpOiBPYnNlcnZhYmxlPENhc2VTZWFyY2hSZXN1bHRzPiB7XG4gICAgICBsZXQgdXJsID0gJy9jYXNlL3YxL2Nhc2VzJyArICc/JHNhbmRib3g9JyArIHNhbmRib3hJZCArICcmJGZpbHRlcj1hcHBsaWNhdGlvbklkIGVxICdcbiAgICAgICAgKyBhcHBJZCArICcgYW5kIHR5cGVJZCBlcSAnICsgdHlwZUlkO1xuICAgICAgaWYgKHN0YXRlSWQpIHtcbiAgICAgICAgdXJsID0gdXJsICsgJyBhbmQgc3RhdGVJZCBlcSAnICsgc3RhdGVJZDtcbiAgICAgIH1cbiAgICAgIHVybCA9IHVybCArICcmJHNraXA9JyArIHNraXAgKyAnJiR0b3A9JyArIHRvcFxuICAgICAgICArICcmJHNlbGVjdD1jcic7XG4gICAgICBpZiAodGVybSB8fCAoIXRlcm0gJiYgIWZvcmNlKSkge1xuICAgICAgICB1cmwgPSB1cmwgKyAnJiRzZWFyY2g9JyArIHRlcm07XG4gICAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcChjYXNlaW5mb3MgPT4ge1xuICAgICAgICAgIGNvbnN0IGNhc2VyZWZzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICAgICAgY29uc3QgY2FzZWluZm9saXN0ID0gbmV3IENhc2VJbmZvTGlzdCgpLmRlc2VyaWFsaXplKGNhc2VpbmZvcyk7XG4gICAgICAgICAgICBjYXNlaW5mb2xpc3QuY2FzZWluZm9zLmZvckVhY2goY2FzZWluZm8gPT4ge1xuICAgICAgICAgICAgICBjYXNlcmVmcy5wdXNoKGNhc2VpbmZvLmNhc2VSZWZlcmVuY2UpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ2FzZVNlYXJjaFJlc3VsdHMoKS5kZXNlcmlhbGl6ZSh7IGNhc2VyZWZzOiBjYXNlcmVmcywgc2VhcmNoU3RyaW5nOiB0ZXJtIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRDYXNlVHlwZXMoc2FuZGJveElkOiBudW1iZXIsIGFwcElkOiBzdHJpbmcsIHRvcDogbnVtYmVyKTogT2JzZXJ2YWJsZTxDYXNlVHlwZXNMaXN0PiB7XG4gICAgY29uc3Qgc2VsZWN0ID0gJ2IscyxzYSxhJztcbiAgICBsZXQgdXJsID0gJy9jYXNlL3YxL3R5cGVzPyRzYW5kYm94PScgKyBzYW5kYm94SWQgKyAnJiRzZWxlY3Q9JyArIHNlbGVjdCArICcmJHRvcD0nICsgdG9wO1xuICAgIGlmIChhcHBJZCAhPSBudWxsKSB7XG4gICAgICB1cmwgPSB1cmwgKyAnJiRmaWx0ZXI9YXBwbGljYXRpb25JZCBlcSAnICsgYXBwSWQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAoY2FzZXR5cGVzID0+IG5ldyBDYXNlVHlwZXNMaXN0KCkuZGVzZXJpYWxpemUoY2FzZXR5cGVzKSkpO1xuICB9XG5cbiAgcHVibGljIGdldENhc2VUeXBlU2NoZW1hKHNhbmRib3hJZDogbnVtYmVyLCBhcHBJZDogc3RyaW5nLCB0b3A6IG51bWJlcik6IE9ic2VydmFibGU8Q2FzZVR5cGVzTGlzdD4ge1xuICAgIC8vIGh0dHBzOi8vZXUubGl2ZWFwcHMuY2xvdWQudGliY28uY29tL2Nhc2UvdjEvdHlwZXM/JHNhbmRib3g9MjUmJiRmaWx0ZXI9YXBwbGljYXRpb25OYW1lIGVxICdDdXN0b21lciBDb21wbGFpbnQnJiRzZWxlY3Q9YixqcyxjLGFjXG4gICAgY29uc3Qgc2VsZWN0ID0gJ2IsanMsYyxhYyxhJztcbiAgICBsZXQgdXJsID0gJy9jYXNlL3YxL3R5cGVzPyRzYW5kYm94PScgKyBzYW5kYm94SWQgKyAnJiRzZWxlY3Q9JyArIHNlbGVjdCArICcmJHRvcD0nICsgdG9wO1xuICAgIGlmIChhcHBJZCAhPSBudWxsKSB7XG4gICAgICB1cmwgPSB1cmwgKyAnJiRmaWx0ZXI9YXBwbGljYXRpb25JZCBlcSAnICsgYXBwSWQ7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgbWFwKGNhc2V0eXBlcyA9PiBuZXcgQ2FzZVR5cGVzTGlzdCgpLmRlc2VyaWFsaXplKGNhc2V0eXBlcykpKTtcbiAgfVxuXG4gICAgcHVibGljIGdldENhc2VUeXBlU3RhdGVzKHNhbmRib3hJZDogbnVtYmVyLCBhcHBJZDogc3RyaW5nLCB0b3A6IG51bWJlcik6IE9ic2VydmFibGU8Q2FzZVR5cGVTdGF0ZXNMaXN0PiB7XG4gICAgICAgIGNvbnN0IHNlbGVjdCA9ICdzJztcbiAgICAgICAgbGV0IHVybCA9ICcvY2FzZS92MS90eXBlcz8kc2FuZGJveD0nICsgc2FuZGJveElkICsgJyYkc2VsZWN0PScgKyBzZWxlY3QgICsgJyYkdG9wPScgKyB0b3A7XG4gICAgICAgIGlmIChhcHBJZCAhPSBudWxsKSB7XG4gICAgICAgICAgICB1cmwgPSB1cmwgKyAnJiRmaWx0ZXI9YXBwbGljYXRpb25JZCBlcSAnICsgYXBwSWQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpLnNldCgnY2FjaGVSZXNwb25zZScsICd0cnVlJyk7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCwgeyBoZWFkZXJzOiBoZWFkZXJzIH0gKVxuICAgICAgICAvLyByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgICAgICAgICBtYXAoY2FzZXR5cGVzdGF0ZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgLy8gY29uc3QgeCA9IG5ldyBDYXNlVHlwZVN0YXRlc0xpc3QoKS5kZXNlcmlhbGl6ZShjYXNldHlwZXN0YXRlc1swXS5zdGF0ZXMpO1xuICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIHg7XG5cbiAgICAgICAgICAgICAgICAgIGNvbnN0IGNhc2V0eXBlbGlzdCA9IG5ldyBDYXNlVHlwZVN0YXRlc0xpc3RMaXN0KCkuZGVzZXJpYWxpemUoY2FzZXR5cGVzdGF0ZXMpO1xuICAgICAgICAgICAgICAgICAgbGV0IHN0YXRlczogQ2FzZVR5cGVTdGF0ZXNMaXN0O1xuICAgICAgICAgICAgICAgICAgY2FzZXR5cGVsaXN0LmNhc2V0eXBlcy5mb3JFYWNoKChjYXNldHlwZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2FzZXR5cGUuc3RhdGVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICBzdGF0ZXMgPSBuZXcgQ2FzZVR5cGVTdGF0ZXNMaXN0KCkuZGVzZXJpYWxpemUoY2FzZXR5cGUuc3RhdGVzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGVzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0Q2FzZVR5cGVCYXNpY0luZm8oc2FuZGJveElkOiBudW1iZXIsIGFwcElkOiBzdHJpbmcsIHR5cGVJZDogc3RyaW5nLCB0b3A6IG51bWJlcik6IE9ic2VydmFibGU8Q2FzZVR5cGU+IHtcbiAgICAgICAgY29uc3Qgc2VsZWN0ID0gJ2InO1xuICAgICAgbGV0IHVybCA9ICcvY2FzZS92MS90eXBlcz8kc2FuZGJveD0nICsgc2FuZGJveElkICsgJyYkc2VsZWN0PScgKyBzZWxlY3QgKyAnJiR0b3A9JyArIHRvcDtcbiAgICAgIGlmIChhcHBJZCAhPSBudWxsKSB7XG4gICAgICAgIHVybCA9IHVybCArICcmJGZpbHRlcj1hcHBsaWNhdGlvbklkIGVxICcgKyBhcHBJZDtcbiAgICAgIH1cblxuICAgICAgaWYgKCF0aGlzLmNhc2VUeXBlc0NhY2hlTWFwLmdldCh1cmwpKSB7XG4gICAgICAgIGNvbnN0IGNhY2hlRW50cnkkID0gdGhpcy5nZXRDYXNlVHlwZUJhc2ljSW5mb0NhY2hlZCh1cmwsIHR5cGVJZClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIHNoYXJlUmVwbGF5KDEpXG4gICAgICAgICAgKTtcbiAgICAgICAgdGhpcy5jYXNlVHlwZXNDYWNoZU1hcC5zZXQodXJsLCBjYWNoZUVudHJ5JCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5jYXNlVHlwZXNDYWNoZU1hcC5nZXQodXJsKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldENhc2VUeXBlQmFzaWNJbmZvQ2FjaGVkKHVybCwgdHlwZUlkKSB7XG4gICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCkuc2V0KCdjYWNoZVJlc3BvbnNlJywgJ3RydWUnKTtcbiAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCwgeyBoZWFkZXJzOiBoZWFkZXJzIH0gKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgICBtYXAoY2FzZXR5cGVzID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNhc2VUeXBlc0xpc3Q6IENhc2VUeXBlc0xpc3QgPSBuZXcgQ2FzZVR5cGVzTGlzdCgpLmRlc2VyaWFsaXplKGNhc2V0eXBlcyk7XG4gICAgICAgICAgICBsZXQgcmVxdWVzdGVkVHlwZTogQ2FzZVR5cGU7XG4gICAgICAgICAgICBjYXNlVHlwZXNMaXN0LmNhc2V0eXBlcy5mb3JFYWNoKChjYXNldHlwZSkgPT4ge1xuICAgICAgICAgICAgICBpZiAoY2FzZXR5cGUuaWQgPT09IHR5cGVJZCkge1xuICAgICAgICAgICAgICAgIHJlcXVlc3RlZFR5cGUgPSBjYXNldHlwZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdGVkVHlwZTtcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyBjbGVhckZyb21JY29uU1ZHVGV4dENhY2hlKHVybCkge1xuICAgICAgaWYgKHRoaXMuaWNvblNWR1RleHRDYWNoZU1hcC5nZXQodXJsKSkge1xuICAgICAgICB0aGlzLmljb25TVkdUZXh0Q2FjaGVNYXAuZGVsZXRlKHVybCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldEljb25TVkdUZXh0KHVybDogc3RyaW5nKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICAgIC8vIHRvZG86IHJldmlzaXQgdGhlIGJhc2UgaHJlZiBpc3N1ZVxuICAgICAgaWYgKHVybC5zdWJzdHIoMCwgMikgPT09ICcvLycpIHtcbiAgICAgICAgdXJsID0gdXJsLnN1YnN0cigxLCB1cmwubGVuZ3RoIC0gMSk7XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMuaWNvblNWR1RleHRDYWNoZU1hcC5nZXQodXJsKSkge1xuICAgICAgICAvLyBjb25zdCBmaXhlZFVybCA9IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdCAgKyB1cmw7XG4gICAgICAgIGNvbnN0IGNhY2hlRW50cnkkID0gdGhpcy5nZXRJY29uU1ZHVGV4dENhY2hlKHVybClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIHNoYXJlUmVwbGF5KDEpXG4gICAgICAgICAgKTtcbiAgICAgICAgdGhpcy5pY29uU1ZHVGV4dENhY2hlTWFwLnNldCh1cmwsIGNhY2hlRW50cnkkKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmljb25TVkdUZXh0Q2FjaGVNYXAuZ2V0KHVybCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRJY29uU1ZHVGV4dENhY2hlKHVybCkge1xuICAgICAgY29uc3QgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpLnNldCgnY2FjaGVSZXNwb25zZScsICd0cnVlJyk7XG4gICAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwsIHtyZXNwb25zZVR5cGU6ICd0ZXh0JywgaGVhZGVyczogaGVhZGVycyB9IClcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgbWFwKHZhbCA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHN2Z0NvbnRlbnRzID0gdmFsLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgIHJldHVybiBzdmdDb250ZW50cztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfVxuXG4gIHByaXZhdGUgdXBkYXRlQ2FzZXNSZWNvcmQoY2FzZXNDb250ZW50OiBTaGFyZWRTdGF0ZUNvbnRlbnQsIGNhc2VSZWY6IHN0cmluZywgdG9nZ2xlOiBCb29sZWFuKTogU2hhcmVkU3RhdGVDb250ZW50IHtcbiAgICBjb25zdCBzaGFyZWRTdGF0ZUNvbnRlbnQ6IFNoYXJlZFN0YXRlQ29udGVudCA9IG5ldyBTaGFyZWRTdGF0ZUNvbnRlbnQoKS5kZXNlcmlhbGl6ZShjYXNlc0NvbnRlbnQpO1xuICAgIGNvbnN0IGNhc2VzUmVjOiBDYXNlTGlzdCA9IEpTT04ucGFyc2Uoc2hhcmVkU3RhdGVDb250ZW50Lmpzb24pO1xuICAgIGxldCBleGlzdGluZyA9IGZhbHNlO1xuICAgICAgLy8gY2hlY2sgaWYgYWxyZWFkeSBleGlzdHNcblxuICAgIGlmIChjYXNlUmVmID09PSAnLTEnKSB7XG4gICAgICAvLyBjbGVhciBsaXN0XG4gICAgICAgIGNhc2VzUmVjLmNhc2VSZWZzLmxlbmd0aCA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChjYXNlc1JlYy5jYXNlUmVmcy5pbmRleE9mKGNhc2VSZWYpICE9PSAtMSkge1xuICAgICAgICAvLyByZW1vdmUgaXQgaWYgaXQgaXMgYWxyZWFkeSBpbiB0aGUgYXJyYXlcbiAgICAgICAgY2FzZXNSZWMuY2FzZVJlZnMuc3BsaWNlKGNhc2VzUmVjLmNhc2VSZWZzLmluZGV4T2YoY2FzZVJlZiksIDEpO1xuICAgICAgICBleGlzdGluZyA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoIXRvZ2dsZSB8fCBleGlzdGluZyA9PT0gZmFsc2UpIHtcbiAgICAgICAgLy8gb25seSBhZGQgaXQgaWYgd2UgYXJlIG5vdCBpbiB0b2dnbGUgbW9kZSAoZmF2b3JpdGVzKSBvciBpZiB0aGUgY2FzZVJlZiBkaWRudCBhbHJlYWR5IGV4aXN0IGluIHRoZSBsaXN0XG4gICAgICAgIC8vIG5vdyBhZGQgY2FzZSB0byBmcm9udCBvZiBhcnJheVxuICAgICAgICBjYXNlc1JlYy5jYXNlUmVmcy51bnNoaWZ0KGNhc2VSZWYpO1xuICAgICAgICAvLyBjaGVjayBpZiB3ZSBhcmUgPiBtYXggc2l6ZVxuICAgICAgICBpZiAoY2FzZXNSZWMubWF4U2l6ZSAhPT0gLTEgJiYgY2FzZXNSZWMuY2FzZVJlZnMubGVuZ3RoID4gY2FzZXNSZWMubWF4U2l6ZSkge1xuICAgICAgICAgIC8vIHJlbW92ZSBvbGRlc3QgZW50cnlcbiAgICAgICAgICBjYXNlc1JlYy5jYXNlUmVmcy5wb3AoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBzaGFyZWRTdGF0ZUNvbnRlbnQuanNvbiA9IFRjQ29yZUNvbW1vbkZ1bmN0aW9ucy5lc2NhcGVTdHJpbmcoSlNPTi5zdHJpbmdpZnkoY2FzZXNSZWMpKTtcbiAgICByZXR1cm4gc2hhcmVkU3RhdGVDb250ZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBuZXdDYXNlc1JlY29yZChjYXNlUmVmOiBzdHJpbmcsIG1heFNpemU6IG51bWJlcik6IFNoYXJlZFN0YXRlQ29udGVudCB7XG4gICAgY29uc3QgY2FzZXNSZWM6IENhc2VMaXN0ID0gbmV3IENhc2VMaXN0KCk7XG4gICAgY2FzZXNSZWMubWF4U2l6ZSA9IG1heFNpemU7XG4gICAgaWYgKGNhc2VSZWYgPT09ICctMScpIHtcbiAgICAgIGNhc2VzUmVjLmNhc2VSZWZzID0gWyBdO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYXNlc1JlYy5jYXNlUmVmcyA9IFtjYXNlUmVmXTtcbiAgICB9XG4gICAgY2FzZXNSZWMudW5pcXVlS2V5ID0gJ2Nhc2VSZWZlcmVuY2UnO1xuICAgIGNvbnN0IHNoYXJlZFN0YXRlQ29udGVudDogU2hhcmVkU3RhdGVDb250ZW50ID0gbmV3IFNoYXJlZFN0YXRlQ29udGVudCgpO1xuICAgIHNoYXJlZFN0YXRlQ29udGVudC5qc29uID0gVGNDb3JlQ29tbW9uRnVuY3Rpb25zLmVzY2FwZVN0cmluZyhKU09OLnN0cmluZ2lmeShjYXNlc1JlYykpO1xuICAgIHJldHVybiBzaGFyZWRTdGF0ZUNvbnRlbnQ7XG4gIH1cblxuICBwdWJsaWMgZ2V0UmVjZW50Q2FzZXModWlBcHBJZDogc3RyaW5nLCBzYW5kYm94SWQ6IG51bWJlcik6IE9ic2VydmFibGU8Q2FzZUxpc3Q+IHtcbiAgICBjb25zdCBzc05hbWUgPSB1aUFwcElkICsgJy5yZWNlbnRjYXNlcy50aWJjb2xhYnMuY2xpZW50LmNvbnRleHQuUFJJVkFURSc7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U1NDYXNlc0xpc3Qoc3NOYW1lLCBzYW5kYm94SWQpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTU0Nhc2VzTGlzdChzc05hbWU6IHN0cmluZywgc2FuZGJveElkOiBudW1iZXIpOiBPYnNlcnZhYmxlPENhc2VMaXN0PiB7XG4gICAgcmV0dXJuIHRoaXMuc2hhcmVkU3RhdGVTZXJ2aWNlLmdldFNoYXJlZFN0YXRlKHNzTmFtZSwgJ1BSSVZBVEUnLCBmYWxzZSwgZmFsc2UpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcChzaGFyZWRTdGF0ZUxpc3QgPT4ge1xuICAgICAgICAgIGlmIChzaGFyZWRTdGF0ZUxpc3Quc2hhcmVkU3RhdGVFbnRyaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ2FzZUxpc3QoKS5kZXNlcmlhbGl6ZShKU09OLnBhcnNlKHNoYXJlZFN0YXRlTGlzdC5zaGFyZWRTdGF0ZUVudHJpZXNbMF0uY29udGVudC5qc29uKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ2FzZUxpc3QoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyB1bnNldFJlY2VudENhc2UoY2FzZVJlZjogc3RyaW5nLCB1aUFwcElkOiBzdHJpbmcsIHNhbmRib3hJZDogbnVtYmVyKSB7XG4gICAgLy8gTk9URTogVXNlICctMScgYXMgY2FzZVJlZiB0byBjbGVhciByZWNlbnQgY2FzZXMgbGlzdFxuICAgIGNvbnN0IHNzTmFtZSA9IHVpQXBwSWQgKyAnLnJlY2VudGNhc2VzLnRpYmNvbGFicy5jbGllbnQuY29udGV4dC5QUklWQVRFJztcbiAgICB0aGlzLnNldENhc2VzUmVjb3JkKHNzTmFtZSwgY2FzZVJlZiwgdWlBcHBJZCwgc2FuZGJveElkLCAxMCwgdHJ1ZSk7XG4gIH1cblxuICBwdWJsaWMgc2V0UmVjZW50Q2FzZShjYXNlUmVmOiBzdHJpbmcsIHVpQXBwSWQ6IHN0cmluZywgc2FuZGJveElkOiBudW1iZXIpIHtcbiAgICAvLyBOT1RFOiBVc2UgJy0xJyBhcyBjYXNlUmVmIHRvIGNsZWFyIHJlY2VudCBjYXNlcyBsaXN0XG4gICAgY29uc3Qgc3NOYW1lID0gdWlBcHBJZCArICcucmVjZW50Y2FzZXMudGliY29sYWJzLmNsaWVudC5jb250ZXh0LlBSSVZBVEUnO1xuICAgIHRoaXMuc2V0Q2FzZXNSZWNvcmQoc3NOYW1lLCBjYXNlUmVmLCB1aUFwcElkLCBzYW5kYm94SWQsIDEwLCBmYWxzZSk7XG4gIH1cblxuICBwcml2YXRlIHNldENhc2VzUmVjb3JkKHNzTmFtZTogc3RyaW5nLCBjYXNlUmVmOiBzdHJpbmcsIHVpQXBwSWQ6IHN0cmluZywgc2FuZGJveElkOiBudW1iZXIsIG1heFNpemU6IG51bWJlciwgdG9nZ2xlOiBib29sZWFuKSB7XG4gICAgLy8gZ2V0IGNhc2VzIGxpc3QgZnJvbSBzaGFyZWQgc3RhdGUgaWYgYW55XG4gICAgLy8gdXBkYXRlIGNhc2VzIGRhdGEgcmVtb3Zpbmcgb2xkZXN0IGlmID4gbWF4c2l6ZVxuICAgIC8vIHNldCBzaGFyZWQgc3RhdGVcbiAgICBsZXQgY2FzZXNFbnRyeTogU2hhcmVkU3RhdGVFbnRyeTtcbiAgICB0aGlzLnNoYXJlZFN0YXRlU2VydmljZS5nZXRTaGFyZWRTdGF0ZShzc05hbWUsICdQUklWQVRFJywgZmFsc2UsIGZhbHNlKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAoc2hhcmVkU3RhdGVMaXN0ID0+IHtcbiAgICAgICAgICAgIGNhc2VzRW50cnkgPSBzaGFyZWRTdGF0ZUxpc3Quc2hhcmVkU3RhdGVFbnRyaWVzWzBdIHx8IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGxldCBjb250ZW50OiBTaGFyZWRTdGF0ZUNvbnRlbnQ7XG4gICAgICAgICAgICBpZiAoY2FzZXNFbnRyeSkge1xuICAgICAgICAgICAgICBjb250ZW50ID0gdGhpcy51cGRhdGVDYXNlc1JlY29yZChjYXNlc0VudHJ5LmNvbnRlbnQsIGNhc2VSZWYsIHRvZ2dsZSk7XG4gICAgICAgICAgICAgIGNhc2VzRW50cnkuY29udGVudCA9IGNvbnRlbnQ7XG4gICAgICAgICAgICAgIHNoYXJlZFN0YXRlTGlzdC5zaGFyZWRTdGF0ZUVudHJpZXNbMF0gPSBjYXNlc0VudHJ5O1xuICAgICAgICAgICAgICB0aGlzLnNoYXJlZFN0YXRlU2VydmljZS51cGRhdGVTaGFyZWRTdGF0ZShzaGFyZWRTdGF0ZUxpc3Quc2hhcmVkU3RhdGVFbnRyaWVzKS5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnRlbnQgPSB0aGlzLm5ld0Nhc2VzUmVjb3JkKGNhc2VSZWYsIG1heFNpemUpO1xuICAgICAgICAgICAgICB0aGlzLnNoYXJlZFN0YXRlU2VydmljZS5jcmVhdGVTaGFyZWRTdGF0ZShzc05hbWUsICdQUklWQVRFJywgJycsIHNhbmRib3hJZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgY29udGVudCkuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjYXNlc0VudHJ5O1xuICAgICAgICAgIH1cblxuICAgICAgICApXG4gICAgICApLnN1YnNjcmliZShudWxsLCBlcnJvciA9PiBjb25zb2xlLmxvZygnVW5hYmxlIHRvIHNldCByZWNlbnQgY2FzZXM6ICcgKyBlcnJvcikpO1xuICB9XG5cbiAgcHVibGljIGdldEZhdm9yaXRlQ2FzZXModWlBcHBJZDogc3RyaW5nLCBzYW5kYm94SWQ6IG51bWJlcik6IE9ic2VydmFibGU8Q2FzZUxpc3Q+IHtcbiAgICBjb25zdCBzc05hbWUgPSB1aUFwcElkICsgJy5mYXZvcml0ZWNhc2VzLnRpYmNvbGFicy5jbGllbnQuY29udGV4dC5QUklWQVRFJztcbiAgICByZXR1cm4gdGhpcy5zaGFyZWRTdGF0ZVNlcnZpY2UuZ2V0U2hhcmVkU3RhdGUoc3NOYW1lLCAnUFJJVkFURScsIGZhbHNlLCBmYWxzZSlcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgbWFwKHNoYXJlZFN0YXRlTGlzdCA9PiB7XG4gICAgICAgICAgaWYgKHNoYXJlZFN0YXRlTGlzdC5zaGFyZWRTdGF0ZUVudHJpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBDYXNlTGlzdCgpLmRlc2VyaWFsaXplKEpTT04ucGFyc2Uoc2hhcmVkU3RhdGVMaXN0LnNoYXJlZFN0YXRlRW50cmllc1swXS5jb250ZW50Lmpzb24pKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBDYXNlTGlzdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICApXG4gICAgICApO1xuICB9XG5cbiAgcHVibGljIHNldEZhdm9yaXRlQ2FzZShjYXNlUmVmOiBzdHJpbmcsIHVpQXBwSWQ6IHN0cmluZywgc2FuZGJveElkOiBudW1iZXIpIHtcbiAgICAvLyBOT1RFOiBVc2UgJy0xJyBhcyBjYXNlUmVmIHRvIGNsZWFyIHJlY2VudCBjYXNlcyBsaXN0XG4gICAgY29uc3Qgc3NOYW1lID0gdWlBcHBJZCArICcuZmF2b3JpdGVjYXNlcy50aWJjb2xhYnMuY2xpZW50LmNvbnRleHQuUFJJVkFURSc7XG4gICAgdGhpcy5zZXRDYXNlc1JlY29yZChzc05hbWUsIGNhc2VSZWYsIHVpQXBwSWQsIHNhbmRib3hJZCwgLTEsIHRydWUpO1xuICB9XG5cbiAgcHVibGljIGlzRmF2b3JpdGVDYXNlKGNhc2VSZWY6IHN0cmluZywgdWlBcHBJZDogc3RyaW5nLCBzYW5kYm94SWQ6IG51bWJlcik6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHNzTmFtZSA9IHVpQXBwSWQgKyAnLmZhdm9yaXRlY2FzZXMudGliY29sYWJzLmNsaWVudC5jb250ZXh0LlBSSVZBVEUnO1xuICAgIHJldHVybiB0aGlzLmdldFNTQ2FzZXNMaXN0KHNzTmFtZSwgc2FuZGJveElkKVxuICAgICAgLnBpcGUoXG4gICAgICAgIG1hcChjYXNlbGlzdCA9PiB7XG4gICAgICAgICAgcmV0dXJuIGNhc2VsaXN0LmNhc2VSZWZzID8gKGNhc2VsaXN0LmNhc2VSZWZzLmluZGV4T2YoY2FzZVJlZikgIT09IC0xKSA6IGZhbHNlO1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBydW5Qcm9jZXNzKHNhbmRib3hJZDogbnVtYmVyLCBhcHBJZDogc3RyaW5nLCBwcm9jZXNzSWQ6IHN0cmluZywgY2FzZVJlZmVyZW5jZTogc3RyaW5nLCBkYXRhOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGNvbnN0IHVybCA9ICcvcHJvY2Vzcy92MS9wcm9jZXNzZXMnO1xuICAgIC8vIGNvbnZlcnQgZGF0YSB0byBhbiBlc2NhcGVkIEpTT04gc3RyaW5nXG4gICAgbGV0IGRhdGFKc29uO1xuICAgIGlmIChkYXRhKSB7XG4gICAgICBkYXRhSnNvbiA9IFRjQ29yZUNvbW1vbkZ1bmN0aW9ucy5lc2NhcGVTdHJpbmcoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkYXRhSnNvbiA9IFRjQ29yZUNvbW1vbkZ1bmN0aW9ucy5lc2NhcGVTdHJpbmcoSlNPTi5zdHJpbmdpZnkoe30pKTtcbiAgICB9XG4gICAgY29uc3QgYm9keSA9IHtcbiAgICAgICdpZCc6IHByb2Nlc3NJZCxcbiAgICAgICdzYW5kYm94SWQnOiBzYW5kYm94SWQsXG4gICAgICAnYXBwbGljYXRpb25JZCc6IGFwcElkLFxuICAgICAgJ2RhdGEnOiBkYXRhSnNvblxuICAgIH07XG5cbiAgICBpZiAoY2FzZVJlZmVyZW5jZSkge1xuICAgICAgYm9keVsnY2FzZVJlZmVyZW5jZSddID0gY2FzZVJlZmVyZW5jZTtcbiAgICB9XG5cblxuICAgIGNvbnN0IGJvZHlTdHIgPSBKU09OLnN0cmluZ2lmeShib2R5KTtcbiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKClcbiAgICAgIC5zZXQoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KHVybCwgYm9keVN0ciwgeyBoZWFkZXJzIH0pXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcChyZXNwb25zZSA9PiByZXNwb25zZSlcbiAgICAgICk7XG4gIH1cblxuICAvLyBTaW5jZSB3ZSBjYWxsIGdldCB1c2VyaW5mbyBhIGxvdCAtIGFuZCB0aGUgZGF0YSBkb2Vzbid0IHRlbmQgdG8gY2hhbmdlIC0gSSB3aWxsIGNhY2hlIGl0IGZvciB0aGUgc2Vzc2lvblxuICBwdWJsaWMgZ2V0VXNlckluZm8odXNlcklkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFVzZXJJbmZvPiB7XG4gICAgY29uc3QgdXJsID0gICcvb3JnYW5pc2F0aW9uL3YxL3VzZXJzLycgKyB1c2VySWQ7XG4gICAgaWYgKCF0aGlzLnVzZXJJbmZvQ2FjaGVNYXAuZ2V0KHVzZXJJZCkpIHtcbiAgICAgIGNvbnN0IGNhY2hlRW50cnkkID0gdGhpcy5nZXRVc2VyQ2FjaGVkKHVybClcbiAgICAgICAgLnBpcGUoXG4gICAgICAgICAgc2hhcmVSZXBsYXkoMSlcbiAgICAgICAgKTtcbiAgICAgIHRoaXMudXNlckluZm9DYWNoZU1hcC5zZXQodXNlcklkLCBjYWNoZUVudHJ5JCk7XG4gICAgfVxuICAgICAgcmV0dXJuIHRoaXMudXNlckluZm9DYWNoZU1hcC5nZXQodXNlcklkKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VXNlckNhY2hlZCh1cmwpIHtcbiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCkuc2V0KCdjYWNoZVJlc3BvbnNlJywgJ3RydWUnKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwsIHsgaGVhZGVyczogaGVhZGVycyB9IClcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAodXNlcmluZm8gPT4gbmV3IFVzZXJJbmZvKCkuZGVzZXJpYWxpemUodXNlcmluZm8pKVxuICAgICAgKTtcbiAgfVxuXG4gIC8qIG5vdGVzIHNlcnZpY2UgKi9cblxuICBwdWJsaWMgZ2V0VGhyZWFkcyhyZWxhdGVkSXRlbVR5cGU6IHN0cmluZywgaXRlbVR5cGVJZDogc3RyaW5nLCBza2lwOiBudW1iZXIsIHRvcDogbnVtYmVyKTogT2JzZXJ2YWJsZTxUaHJlYWRMaXN0PiB7XG4gICAgLy8gaHR0cHM6Ly9saXZlYXBwcy50ZW5hbnQtaW50ZWdyYXRpb24udGNpZS5wcm8vY29sbGFib3JhdGlvbi9ub3Rlcz8kcmVsYXRlZEl0ZW1Db2xsZWN0aW9uPUNBU0VfQVBQXzE1NDQxJiRvcmRlcmJ5PWNyZWF0ZWREYXRlJTIwQVNDXG4gICAgY29uc3QgdXJsID0gICcvY29sbGFib3JhdGlvbi92MS9ub3Rlcz8kcmVsYXRlZEl0ZW1Db2xsZWN0aW9uPScgKyByZWxhdGVkSXRlbVR5cGUgKyAnXycgKyBpdGVtVHlwZUlkXG4gICAgICArICcmJG9yZGVyYnk9Y3JlYXRlZERhdGUgZGVzYydcbiAgICAgICsgJyYkdG9wPScgKyB0b3AgKyAnJiRza2lwPScgKyBza2lwO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybClcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAobm90ZXMgPT4ge1xuICAgICAgICAgIGNvbnN0IHJldHVybmVkTm90ZXMgPSBuZXcgTm90ZXNMaXN0KCkuZGVzZXJpYWxpemUobm90ZXMpO1xuICAgICAgICAgIGNvbnN0IHRocmVhZExpc3Q6IFRocmVhZExpc3QgPSBuZXcgVGhyZWFkTGlzdCgpO1xuICAgICAgICAgIHRocmVhZExpc3QudGhyZWFkcyA9IFtdO1xuICAgICAgICAgIC8vIGNyZWF0ZSB0aHJlYWRzXG4gICAgICAgICAgcmV0dXJuZWROb3Rlcy5ub3Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vdGUpIHtcbiAgICAgICAgICAgICAgaWYgKG5vdGUubGV2ZWwgPT09IDEpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBub3RlVGhyZWFkID0gbmV3IE5vdGVUaHJlYWQobm90ZS50aHJlYWQuaWQsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIHVuZGVmaW5lZCwgW10sIG5vdGUpO1xuICAgICAgICAgICAgICAgIC8vIGdldCBvdGhlciB0aHJlYWRzIGZvciB0aGlzIGlkXG4gICAgICAgICAgICAgICAgcmV0dXJuZWROb3Rlcy5ub3Rlcy5mb3JFYWNoKGZ1bmN0aW9uICh0aHJlYWROb3RlKSB7XG4gICAgICAgICAgICAgICAgICBpZiAodGhyZWFkTm90ZS5sZXZlbCA+IDEgJiYgdGhyZWFkTm90ZS50aHJlYWRJZCA9PT0gbm90ZS50aHJlYWQuaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHRvIHRoZSB0aHJlYWRcbiAgICAgICAgICAgICAgICAgICAgbm90ZVRocmVhZC50aHJlYWQucHVzaCh0aHJlYWROb3RlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aHJlYWRMaXN0LnRocmVhZHMucHVzaChub3RlVGhyZWFkKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHRocmVhZExpc3Q7XG4gICAgICAgIH0pXG4gICAgICApO1xuICB9XG5cbiAgcHVibGljIGdldE5vdGVzRm9yQ29sbGVjdGlvbnMoY29sbGVjdGlvbklkcyk6IE9ic2VydmFibGU8Tm90ZXNMaXN0PiB7XG4gICAgaWYgKGNvbGxlY3Rpb25JZHMpIHtcbiAgICAgIGNvbnN0IHVybCA9ICcvY29sbGFib3JhdGlvbi92MS9ub3Rlcz8kcmVsYXRlZEl0ZW1Db2xsZWN0aW9uPScgKyBjb2xsZWN0aW9uSWRzICtcbiAgICAgICAgJyYkb3JkZXJieT1jcmVhdGVkRGF0ZSBBU0MnO1xuICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBtYXAobm90ZXMgPT4gbmV3IE5vdGVzTGlzdCgpLmRlc2VyaWFsaXplKG5vdGVzKSlcbiAgICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZGVsZXRlQWxsTm90ZXMoKSB7XG4gIH1cblxuICBwdWJsaWMgdXBkYXRlTm90ZShub3RlOiBOb3RlLCBub3RlSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8Tm90ZT4ge1xuICAgIGNvbnN0IHVybCA9ICcvY29sbGFib3JhdGlvbi92MS9ub3Rlcy8nICsgbm90ZUlkO1xuICAgIGNvbnN0IGJvZHkgPSBub3RlO1xuICAgIGNvbnN0IGJvZHlTdHIgPSBKU09OLnN0cmluZ2lmeShib2R5KTtcbiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKClcbiAgICAgIC5zZXQoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wdXQodXJsLCBib2R5U3RyLCB7IGhlYWRlcnMgfSlcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgbWFwKCByZXN1bHQgPT4gbmV3IE5vdGUoKS5kZXNlcmlhbGl6ZShyZXN1bHQpKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGVOb3RlKHJlbGF0ZWRJdGVtVHlwZTogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICB1aUFwcFNvdXJjZTogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICByZWxhdGVkSXRlbUlkOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbkxhYmVsOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblVybDogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICBub3RlVGV4dDogc3RyaW5nKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcbiAgICBjb25zdCB1cmwgPSAnL2NvbGxhYm9yYXRpb24vdjEvbm90ZXMnO1xuICAgIGNvbnN0IG5vdGUgPSBuZXcgTm90ZSgpLmRlc2VyaWFsaXplKFxuICAgICAge1xuICAgICAgICBhdHRyaWJ1dGVzOiBbXSxcbiAgICAgICAgbm90aWZpY2F0aW9uTGFiZWw6IG5vdGlmaWNhdGlvbkxhYmVsLFxuICAgICAgICBub3RpZmljYXRpb25Vcmw6IG5vdGlmaWNhdGlvblVybCxcbiAgICAgICAgdGV4dDogbm90ZVRleHQsXG4gICAgICAgIHRpdGxlOiB0aXRsZVxuICAgICAgfVxuICAgICk7XG4gICAgY29uc3QgYm9keSA9IHtcbiAgICAgIG5vdGU6IG5vdGUsXG4gICAgICByZWxhdGVkSXRlbUNvbGxlY3Rpb246IFtcbiAgICAgICAgKHJlbGF0ZWRJdGVtVHlwZSArICdfJyArIHJlbGF0ZWRJdGVtSWQpXG4gICAgICBdLFxuICAgICAgcmVsYXRlZEl0ZW1JZDogcmVsYXRlZEl0ZW1JZCxcbiAgICAgIHJlbGF0ZWRJdGVtVHlwZTogdWlBcHBTb3VyY2UsXG4gICAgICByb2xlczogdW5kZWZpbmVkXG4gICAgfTtcbiAgICBjb25zdCBib2R5U3RyID0gSlNPTi5zdHJpbmdpZnkoYm9keSk7XG4gICAgY29uc3QgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpXG4gICAgICAuc2V0KCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdCh1cmwsIGJvZHlTdHIsIHsgaGVhZGVycyB9KVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAocmVzdWx0ID0+IE51bWJlcihyZXN1bHQpKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXROb3RlKG5vdGVJZDogbnVtYmVyKTogT2JzZXJ2YWJsZTxOb3RlPiB7XG4gICAgY29uc3QgdXJsID0gJy9jb2xsYWJvcmF0aW9uL3YxL25vdGVzLycgKyBub3RlSWQ7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpLFxuICAgICAgICBtYXAobm90ZSA9PiBuZXcgTm90ZSgpLmRlc2VyaWFsaXplKG5vdGUpXG4gICAgICAgIClcbiAgICAgICk7XG4gIH1cblxuICBwdWJsaWMgZ2V0VGhyZWFkKHJlbGF0ZWRJdGVtVHlwZTogc3RyaW5nLCByZWxhdGVkSXRlbUlkOiBzdHJpbmcsIHRocmVhZElkOiBudW1iZXIpIHtcbiAgICBjb25zdCB1cmwgPSAnL2NvbGxhYm9yYXRpb24vdjEvbm90ZXMvPyRyZWxhdGVkSXRlbVR5cGU9JyArIHJlbGF0ZWRJdGVtVHlwZVxuICAgICAgKyAnJnJlbGF0ZWRJdGVtSWQ9JyArIHJlbGF0ZWRJdGVtSWRcbiAgICAgICsgJyZmaWx0ZXI9dGhyZWFkSWQ9JyArIHRocmVhZElkXG4gICAgICArICcmb3JkZXJieT1jcmVhdGVkRGF0ZSBBU0MnO1xuICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgICBtYXAobm90ZXMgPT4gbmV3IE5vdGVzTGlzdCgpLmRlc2VyaWFsaXplKG5vdGVzKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGVSZXBseU5vdGUob3JpZ2luYWxOb3RlOiBOb3RlLCByZXBseTogc3RyaW5nLCBub3RlSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8bnVtYmVyPiB7XG4gICAgY29uc3QgdXJsID0gJy9jb2xsYWJvcmF0aW9uL3YxL25vdGVzLycgKyBub3RlSWQ7XG4gICAgY29uc3QgYm9keSA9IHtcbiAgICAgIG5vdGlmaWNhdGlvbkxhYmVsOiBvcmlnaW5hbE5vdGUubm90aWZpY2F0aW9uTGFiZWwsXG4gICAgICBub3RpZmljYXRpb25Vcmw6IG9yaWdpbmFsTm90ZS5ub3RpZmljYXRpb25VcmwsXG4gICAgICB0ZXh0OiByZXBseVxuICAgIH07XG4gICAgY29uc3QgYm9keVN0ciA9IEpTT04uc3RyaW5naWZ5KGJvZHkpO1xuICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSHR0cEhlYWRlcnMoKVxuICAgICAgLnNldCgnQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QodXJsLCBib2R5U3RyLCB7IGhlYWRlcnMgfSlcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgbWFwKHZhbHVlID0+IE51bWJlcih2YWx1ZSkpXG4gICAgICApO1xuICB9XG5cbiAgcHVibGljIHN1YnNjcmliZVRvTm90ZXMocmVsYXRlZEl0ZW1UeXBlLCByZWxhdGVkVHlwZUlkKSB7XG4gICAgY29uc3QgdXJsID0gJy9jb2xsYWJvcmF0aW9uL3YxL25vdGlmaWNhdGlvbnMnO1xuICAgIGNvbnN0IGJvZHkgPSB7XG4gICAgICB0b3BpY0lkOiB1bmRlZmluZWQsXG4gICAgICB0aHJlYWRJZDogdW5kZWZpbmVkLFxuICAgICAgbm90aWZ5Q29sbGVjdGlvbjoge1xuICAgICAgICBjb2xsZWN0aW9uTmFtZTogcmVsYXRlZEl0ZW1UeXBlICsgJ18nICsgcmVsYXRlZFR5cGVJZCxcbiAgICAgICAgbGlmZWN5Y2xlZFdpdGhUeXBlOiAnUlRfQ0FTRScsXG4gICAgICAgIGxpZmVjeWNsZWRXaXRoSWQ6IHRydWVcbiAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGJvZHlTdHIgPSBKU09OLnN0cmluZ2lmeShib2R5KTtcbiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKClcbiAgICAgIC5zZXQoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KHVybCwgYm9keVN0ciwgeyBoZWFkZXJzIH0pXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSlcbiAgICAgICk7XG4gIH1cblxuICBwdWJsaWMgdW5zdWJzY3JpYmVUb05vdGVzKHJlbGF0ZWRJdGVtVHlwZSwgcmVsYXRlZFR5cGVJZCwgdXNlcklkKSB7XG4gICAgbGV0IHVybCA9ICcvY29sbGFib3JhdGlvbi92MS9ub3RpZmljYXRpb25zPyRmaWx0ZXI9Y29sbGVjdGlvbk5hbWU9JztcbiAgICB1cmwgPSB1cmwgKyAnXFwnJyArIHJlbGF0ZWRJdGVtVHlwZSArICdfJyArIHJlbGF0ZWRUeXBlSWQgKyAnXFwnIGFuZCBlbnRpdHlJZD0nICsgdXNlcklkO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZGVsZXRlKHVybClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXROb3RpZmljYXRpb25zKHJlbGF0ZWRJdGVtVHlwZSwgcmVsYXRlZFR5cGVJZCwgdXNlcklkKTogT2JzZXJ2YWJsZTxOb3RpZmljYXRpb25MaXN0PiB7XG4gICAgY29uc3QgdXJsID0gJy9jb2xsYWJvcmF0aW9uL3YxL25vdGlmaWNhdGlvbnM/JGZpbHRlcj1jb2xsZWN0aW9uTmFtZT1cXCcnICsgcmVsYXRlZEl0ZW1UeXBlICsgJ18nICsgcmVsYXRlZFR5cGVJZFxuICAgICAgICAgICAgKyAnXFwnIGFuZCBlbnRpdHlJZD0nICsgdXNlcklkO1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YXAoIHZhbCA9PiBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCd0Y3NUaW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpKSxcbiAgICAgICAgbWFwKHZhbHVlID0+IG5ldyBOb3RpZmljYXRpb25MaXN0KCkuZGVzZXJpYWxpemUodmFsdWUpKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBkZWxldGVOb3RlKG5vdGVJZDogbnVtYmVyKSB7XG4gICAgY29uc3QgdXJsID0gJy9jb2xsYWJvcmF0aW9uL3YxL25vdGVzLycgKyBub3RlSWQ7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5kZWxldGUodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCggdmFsID0+IHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3Rjc1RpbWVzdGFtcCcsIERhdGUubm93KCkudG9TdHJpbmcoKSkpXG4gICAgICApO1xuICB9XG5cbiAgLyogZW5kIG5vdGVzIHNlcnZpY2UgKi9cblxuICBwdWJsaWMgZ2V0R3JvdXBzKHNhbmRib3hJZDogbnVtYmVyLCB0b3A6IG51bWJlciwgdXNlQ2FjaGU6IGJvb2xlYW4pOiBPYnNlcnZhYmxlPEdyb3Vwcz4ge1xuICAgIGNvbnN0IHVybCA9ICcvb3JnYW5pc2F0aW9uL3YxL2dyb3Vwcz8kc2FuZGJveD0nICsgc2FuZGJveElkICsgJyYkdG9wPScgKyB0b3A7XG4gICAgbGV0IGhlYWRlcnM7XG4gICAgaWYgKHVzZUNhY2hlKSB7XG4gICAgICBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCkuc2V0KCdjYWNoZVJlc3BvbnNlJywgJ3RydWUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCwgeyBoZWFkZXJzIH0pXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcCggZ3JvdXBzID0+IG5ldyBHcm91cHMoKS5kZXNlcmlhbGl6ZSh7IGdyb3VwczogZ3JvdXBzIH0pKVxuICAgICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRHcm91cE1lbWJlcnNoaXBzKHNhbmRib3hJZDogbnVtYmVyLCB1c2VySWQ6IHN0cmluZywgdG9wOiBudW1iZXIsIHVzZUNhY2hlOiBib29sZWFuKTogT2JzZXJ2YWJsZTxHcm91cHM+IHtcbiAgICBjb25zdCB1cmwgPSAnL29yZ2FuaXNhdGlvbi92MS91c2Vycy8nICsgdXNlcklkICsgJy9ncm91cHMnICsgJz8kc2FuZGJveD0nICsgc2FuZGJveElkICsgJyYkdG9wPScgKyB0b3A7XG4gICAgbGV0IGhlYWRlcnM7XG4gICAgaWYgKHVzZUNhY2hlKSB7XG4gICAgICBoZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKCkuc2V0KCdjYWNoZVJlc3BvbnNlJywgJ3RydWUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCwgeyBoZWFkZXJzIH0pXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcCggZ3JvdXBzID0+IG5ldyBHcm91cHMoKS5kZXNlcmlhbGl6ZSh7IGdyb3VwczogZ3JvdXBzIH0pKVxuICAgICAgKTtcbiAgfVxuXG5cbn1cbiJdfQ==