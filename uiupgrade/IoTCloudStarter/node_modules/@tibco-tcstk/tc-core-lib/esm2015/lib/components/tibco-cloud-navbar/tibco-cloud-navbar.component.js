/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, ElementRef, Input } from '@angular/core';
import { Location } from '@angular/common';
import { TcCoreCommonFunctions } from '../../common/tc-core-common-functions';
import { MessageTopicService } from '../../common/tc-core-topic-comm';
/**
 * TIBCO Cloud Navigation Bar
 *
 * ![alt-text](../tibco-cloud-navbar.png "Image")
 *
 * \@example <tc-tibco-cloud-navbar appName=""></tc-tibco-cloud-navbar>
 */
export class TibcoCloudNavbarComponent {
    /**
     * single empty Constructor of TIBCO Cloud Navigation Bar
     * @param {?} location
     * @param {?} messageService
     */
    constructor(location, messageService) {
        this.location = location;
        this.messageService = messageService;
        this.ms = messageService;
    }
    /**
     * @ignore
     * @return {?}
     */
    ngOnInit() {
        if (this.docUrl && (this.docUrl.slice(0, 4).toLowerCase() !== 'http')) {
            //      this.docUrl = this.location.prepareExternalUrl(this.docUrl);        // This will work with non hash routing
            this.docUrl = TcCoreCommonFunctions.prepareUrlForStaticResource(this.location, this.docUrl); // This will work with hash routing
        }
        this.navbar = new GlobalNavbar({
            container: '#navbar',
            textAfterLogo: this.appName ? this.appName : undefined,
            iconMenus: {
                search: {
                    visible: false // for versions 0.1.X the propertie is "disabled" instead of "visible".
                },
                download: {
                    visible: false
                },
                help: {
                    visible: true
                },
                notifications: {
                    visible: false
                },
                products: {
                    visible: false
                },
                region: {
                    visible: false
                },
                accountswitcher: {
                    visible: false
                }
            },
            customProfilePanel: {
                account: {
                    visible: false,
                    disabled: true
                },
                subscriptions: {
                    visible: false,
                    disabled: true
                },
                organization: {
                    visible: false
                },
                tenants: {
                    visible: false
                }
            },
            customizedComponents: [
                {
                    name: 'help',
                    template: '#help-template'
                }
            ]
        });
        if (this.logoUrl || this.logoClickTargetUrl || this.rebrandConfig) {
            /** @type {?} */
            const style = {};
            if (this.logoUrl || this.logoClickTargetUrl) {
                style.logo = {
                    'src': this.logoUrl,
                    'url': this.logoClickTargetUrl // If the url is not set then the logo will redirect to TSC.
                };
            }
            if (this.rebrandConfig) {
                if (this.rebrandConfig.backgroundColor) {
                    style.backgroundColor = this.rebrandConfig.backgroundColor;
                }
                if (this.rebrandConfig.fontColor) {
                    style.fontColor = this.rebrandConfig.fontColor;
                }
                if (this.rebrandConfig.fontFamily) {
                    style.fontFamily = this.rebrandConfig.fontFamily;
                }
                if (this.rebrandConfig.iconColor) {
                    style.iconColor = this.rebrandConfig.iconColor;
                }
            }
            this.navbar.refreshRebrandingStyle(style);
        }
        this.navbar.load();
        // console.log('DOC URL: ' + this.docUrl);
        /** @type {?} */
        const initialHelpURL = this.docUrl + '/help.html';
        this.urlExists(initialHelpURL, (/**
         * @param {?} exists
         * @return {?}
         */
        exists => {
            if (exists) {
                this.navbar.customizePanel('help', '<embed src="' + initialHelpURL + '" style="height: 100%; width: 100%">'); // set HTML string
            }
            else {
                this.navbar.customizePanel('help', '<b> No Help Page Found</b>'); // set HTML string
            }
        }));
        this.ms.getMessage('help').subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            // console.log('Got message: ' + data.text);
            this.findHelpFile('assets/help/' + data.text + '/help.html');
        }));
    }
    /**
     * @param {?} helpUrl
     * @return {?}
     */
    findHelpFile(helpUrl) {
        this.urlExists(helpUrl, (/**
         * @param {?} exists
         * @return {?}
         */
        exists => {
            // console.log('RESULT: url=' + helpUrl + ', exists=' + exists);
            if (exists) {
                console.log('Setting help page: ' + helpUrl);
                this.navbar.customizePanel('help', '<embed src="' + helpUrl + '" style="height: 100%; width: 100%">');
            }
            else {
                if (helpUrl.includes('/')) {
                    // Find one step lower
                    // console.log('HelpURL before: |' + helpUrl + '|');
                    helpUrl = helpUrl.substring(0, helpUrl.lastIndexOf('/help.html'));
                    // console.log('HelpURL middle: |' + helpUrl + '|');
                    helpUrl = helpUrl.substring(0, helpUrl.lastIndexOf('/') + 1);
                    // console.log('HelpURL  after: |' + helpUrl + '|');
                    this.findHelpFile(helpUrl + 'help.html');
                }
                else {
                    console.log('No valid help file found...');
                    this.navbar.customizePanel('help', '<b> No Help Page Found</b>'); // set HTML string
                }
            }
        }));
    }
    // The "callback" argument is called with either true or false
    // depending on whether the "url" exists or not.
    /**
     * @param {?} url
     * @param {?} callback
     * @return {?}
     */
    urlExists(url, callback) {
        /** @type {?} */
        const http = new XMLHttpRequest();
        http.open('GET', url, true);
        http.onload = (/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            if (http.readyState === 4) {
                if (http.status === 200) {
                    callback(true);
                }
                else {
                    callback(false);
                }
            }
        });
        http.send();
    }
}
TibcoCloudNavbarComponent.decorators = [
    { type: Component, args: [{
                selector: 'tc-tibco-cloud-navbar',
                template: "<div class=\"tai-navbar\">\n<div id=\"navbar\" class=\"tai-navbar\" #navbar></div>\n</div>\n",
                styles: [""]
            }] }
];
/** @nocollapse */
TibcoCloudNavbarComponent.ctorParameters = () => [
    { type: Location },
    { type: MessageTopicService }
];
TibcoCloudNavbarComponent.propDecorators = {
    navbarRef: [{ type: ViewChild, args: ['navbar', { static: true },] }],
    appName: [{ type: Input }],
    docUrl: [{ type: Input }],
    logoUrl: [{ type: Input }],
    rebrandConfig: [{ type: Input }],
    logoClickTargetUrl: [{ type: Input }]
};
if (false) {
    /**
     * Reference Element
     * @type {?}
     * @private
     */
    TibcoCloudNavbarComponent.prototype.navbarRef;
    /**
     * diaplayed Application Name
     * @type {?}
     */
    TibcoCloudNavbarComponent.prototype.appName;
    /**
     * Documentation URL
     * @type {?}
     */
    TibcoCloudNavbarComponent.prototype.docUrl;
    /**
     * Custom Logo URL
     * @type {?}
     */
    TibcoCloudNavbarComponent.prototype.logoUrl;
    /**
     * rebrand config - example: { "backgroundColor": "#cfcfcf", "fontColor": "#682782", "fontFamily": "Oswald", "iconColor": "red" }
     * @type {?}
     */
    TibcoCloudNavbarComponent.prototype.rebrandConfig;
    /**
     * Where to redirect on click of logo
     * @type {?}
     */
    TibcoCloudNavbarComponent.prototype.logoClickTargetUrl;
    /**
     * @type {?}
     * @private
     */
    TibcoCloudNavbarComponent.prototype.navbar;
    /**
     * @type {?}
     * @private
     */
    TibcoCloudNavbarComponent.prototype.ms;
    /**
     * @type {?}
     * @protected
     */
    TibcoCloudNavbarComponent.prototype.location;
    /**
     * @type {?}
     * @protected
     */
    TibcoCloudNavbarComponent.prototype.messageService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGliY28tY2xvdWQtbmF2YmFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0aWJjby10Y3N0ay90Yy1jb3JlLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RpYmNvLWNsb3VkLW5hdmJhci90aWJjby1jbG91ZC1uYXZiYXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFVLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUF5QixNQUFNLGVBQWUsQ0FBQztBQUN0RyxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDekMsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDOUUsT0FBTyxFQUFDLG1CQUFtQixFQUFDLE1BQU0saUNBQWlDLENBQUM7Ozs7Ozs7O0FBaUJwRSxNQUFNLE9BQU8seUJBQXlCOzs7Ozs7SUF5Q3BDLFlBQXNCLFFBQWtCLEVBQVksY0FBbUM7UUFBakUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFZLG1CQUFjLEdBQWQsY0FBYyxDQUFxQjtRQUNyRixJQUFJLENBQUMsRUFBRSxHQUFHLGNBQWMsQ0FBQztJQUMzQixDQUFDOzs7OztJQUtELFFBQVE7UUFFTixJQUFJLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLEtBQUssTUFBTSxDQUFDLEVBQUU7WUFDM0UsbUhBQW1IO1lBQzdHLElBQUksQ0FBQyxNQUFNLEdBQUcscUJBQXFCLENBQUMsMkJBQTJCLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBUSxtQ0FBbUM7U0FDeEk7UUFFRCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksWUFBWSxDQUFDO1lBQzdCLFNBQVMsRUFBRSxTQUFTO1lB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SUFNcEIsNkNBQTRCOzs7OztJQUFFLG1EQUE2QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgSW5wdXQsIFN5c3RlbUpzTmdNb2R1bGVMb2FkZXJ9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtMb2NhdGlvbn0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IFRjQ29yZUNvbW1vbkZ1bmN0aW9ucyB9IGZyb20gJy4uLy4uL2NvbW1vbi90Yy1jb3JlLWNvbW1vbi1mdW5jdGlvbnMnO1xuaW1wb3J0IHtNZXNzYWdlVG9waWNTZXJ2aWNlfSBmcm9tICcuLi8uLi9jb21tb24vdGMtY29yZS10b3BpYy1jb21tJztcblxuZGVjbGFyZSB2YXIgR2xvYmFsTmF2YmFyOiBhbnk7XG5cblxuLyoqXG4gKiBUSUJDTyBDbG91ZCBOYXZpZ2F0aW9uIEJhclxuICpcbiAqICFbYWx0LXRleHRdKC4uL3RpYmNvLWNsb3VkLW5hdmJhci5wbmcgXCJJbWFnZVwiKVxuICpcbiAqIEBleGFtcGxlIDx0Yy10aWJjby1jbG91ZC1uYXZiYXIgYXBwTmFtZT1cIlwiPjwvdGMtdGliY28tY2xvdWQtbmF2YmFyPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0Yy10aWJjby1jbG91ZC1uYXZiYXInLFxuICB0ZW1wbGF0ZVVybDogJy4vdGliY28tY2xvdWQtbmF2YmFyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vdGliY28tY2xvdWQtbmF2YmFyLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBUaWJjb0Nsb3VkTmF2YmFyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgLyoqXG4gICAqIFJlZmVyZW5jZSBFbGVtZW50XG4gICAqL1xuICBAVmlld0NoaWxkKCduYXZiYXInLCB7IHN0YXRpYzogdHJ1ZSB9KSBwcml2YXRlIG5hdmJhclJlZjogRWxlbWVudFJlZjtcbiAgLyoqXG4gICAqIGRpYXBsYXllZCBBcHBsaWNhdGlvbiBOYW1lXG4gICAqL1xuICBASW5wdXQoKSBhcHBOYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBEb2N1bWVudGF0aW9uIFVSTFxuICAgKi9cbiAgQElucHV0KCkgZG9jVXJsOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEN1c3RvbSBMb2dvIFVSTFxuICAgKi9cblxuICBASW5wdXQoKSBsb2dvVXJsOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIHJlYnJhbmQgY29uZmlnIC0gZXhhbXBsZTogeyBcImJhY2tncm91bmRDb2xvclwiOiBcIiNjZmNmY2ZcIiwgXCJmb250Q29sb3JcIjogXCIjNjgyNzgyXCIsIFwiZm9udEZhbWlseVwiOiBcIk9zd2FsZFwiLCBcImljb25Db2xvclwiOiBcInJlZFwiIH1cbiAgICovXG5cbiAgQElucHV0KCkgcmVicmFuZENvbmZpZzogYW55O1xuXG4gIC8qKlxuICAgKiBXaGVyZSB0byByZWRpcmVjdCBvbiBjbGljayBvZiBsb2dvXG4gICAqL1xuXG4gIEBJbnB1dCgpIGxvZ29DbGlja1RhcmdldFVybDogc3RyaW5nO1xuXG5cbiAgcHJpdmF0ZSBuYXZiYXI7XG5cbiAgcHJpdmF0ZSBtczogTWVzc2FnZVRvcGljU2VydmljZTtcblxuICAvKipcbiAgICogc2luZ2xlIGVtcHR5IENvbnN0cnVjdG9yIG9mIFRJQkNPIENsb3VkIE5hdmlnYXRpb24gQmFyXG4gICAqL1xuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBsb2NhdGlvbjogTG9jYXRpb24sIHByb3RlY3RlZCBtZXNzYWdlU2VydmljZTogTWVzc2FnZVRvcGljU2VydmljZSkge1xuICAgIHRoaXMubXMgPSBtZXNzYWdlU2VydmljZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBuZ09uSW5pdCgpIHtcblxuICAgIGlmICh0aGlzLmRvY1VybCAmJiAodGhpcy5kb2NVcmwuc2xpY2UoMCwgNCkudG9Mb3dlckNhc2UoKSAhPT0gJ2h0dHAnKSkge1xuLy8gICAgICB0aGlzLmRvY1VybCA9IHRoaXMubG9jYXRpb24ucHJlcGFyZUV4dGVybmFsVXJsKHRoaXMuZG9jVXJsKTsgICAgICAgIC8vIFRoaXMgd2lsbCB3b3JrIHdpdGggbm9uIGhhc2ggcm91dGluZ1xuICAgICAgdGhpcy5kb2NVcmwgPSBUY0NvcmVDb21tb25GdW5jdGlvbnMucHJlcGFyZVVybEZvclN0YXRpY1Jlc291cmNlKHRoaXMubG9jYXRpb24sIHRoaXMuZG9jVXJsKTsgICAgICAgIC8vIFRoaXMgd2lsbCB3b3JrIHdpdGggaGFzaCByb3V0aW5nXG4gICAgfVxuXG4gICAgdGhpcy5uYXZiYXIgPSBuZXcgR2xvYmFsTmF2YmFyKHtcbiAgICAgIGNvbnRhaW5lcjogJyNuYXZiYXInLFxuICAgICAgdGV4dEFmdGVyTG9nbzogdGhpcy5hcHBOYW1lID8gdGhpcy5hcHBOYW1lIDogdW5kZWZpbmVkLFxuICAgICAgaWNvbk1lbnVzOiB7XG4gICAgICAgIHNlYXJjaDoge1xuICAgICAgICAgIHZpc2libGU6IGZhbHNlICAvLyBmb3IgdmVyc2lvbnMgMC4xLlggdGhlIHByb3BlcnRpZSBpcyBcImRpc2FibGVkXCIgaW5zdGVhZCBvZiBcInZpc2libGVcIi5cbiAgICAgICAgfSxcbiAgICAgICAgZG93bmxvYWQ6IHtcbiAgICAgICAgICB2aXNpYmxlOiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICBoZWxwOiB7XG4gICAgICAgICAgdmlzaWJsZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBub3RpZmljYXRpb25zOiB7XG4gICAgICAgICAgdmlzaWJsZTogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAgcHJvZHVjdHM6IHtcbiAgICAgICAgICB2aXNpYmxlOiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICByZWdpb246IHtcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIGFjY291bnRzd2l0Y2hlcjoge1xuICAgICAgICAgIHZpc2libGU6IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBjdXN0b21Qcm9maWxlUGFuZWw6IHtcbiAgICAgICAgYWNjb3VudDoge1xuICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgICAgIGRpc2FibGVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHN1YnNjcmlwdGlvbnM6IHtcbiAgICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICBkaXNhYmxlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBvcmdhbml6YXRpb246IHtcbiAgICAgICAgICB2aXNpYmxlOiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICB0ZW5hbnRzOiB7XG4gICAgICAgICAgdmlzaWJsZTogZmFsc2VcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGN1c3RvbWl6ZWRDb21wb25lbnRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnaGVscCcsXG4gICAgICAgICAgdGVtcGxhdGU6ICcjaGVscC10ZW1wbGF0ZSdcbiAgICAgICAgfVxuICAgICAgXVxuICAgIH0pO1xuICAgIGlmICh0aGlzLmxvZ29VcmwgfHwgdGhpcy5sb2dvQ2xpY2tUYXJnZXRVcmwgfHwgdGhpcy5yZWJyYW5kQ29uZmlnKSB7XG4gICAgICBjb25zdCBzdHlsZTogYW55ID0ge307XG4gICAgICBpZiAodGhpcy5sb2dvVXJsIHx8IHRoaXMubG9nb0NsaWNrVGFyZ2V0VXJsKSB7XG4gICAgICAgIHN0eWxlLmxvZ28gPSB7XG4gICAgICAgICAgJ3NyYyc6IHRoaXMubG9nb1VybCxcbiAgICAgICAgICAndXJsJzogdGhpcy5sb2dvQ2xpY2tUYXJnZXRVcmwgLy8gSWYgdGhlIHVybCBpcyBub3Qgc2V0IHRoZW4gdGhlIGxvZ28gd2lsbCByZWRpcmVjdCB0byBUU0MuXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5yZWJyYW5kQ29uZmlnKSB7XG4gICAgICAgIGlmICh0aGlzLnJlYnJhbmRDb25maWcuYmFja2dyb3VuZENvbG9yKSB7XG4gICAgICAgICAgc3R5bGUuYmFja2dyb3VuZENvbG9yID0gdGhpcy5yZWJyYW5kQ29uZmlnLmJhY2tncm91bmRDb2xvcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5yZWJyYW5kQ29uZmlnLmZvbnRDb2xvcikge1xuICAgICAgICAgIHN0eWxlLmZvbnRDb2xvciA9IHRoaXMucmVicmFuZENvbmZpZy5mb250Q29sb3I7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucmVicmFuZENvbmZpZy5mb250RmFtaWx5KSB7XG4gICAgICAgICAgc3R5bGUuZm9udEZhbWlseSA9IHRoaXMucmVicmFuZENvbmZpZy5mb250RmFtaWx5O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnJlYnJhbmRDb25maWcuaWNvbkNvbG9yKSB7XG4gICAgICAgICAgc3R5bGUuaWNvbkNvbG9yID0gdGhpcy5yZWJyYW5kQ29uZmlnLmljb25Db2xvcjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5uYXZiYXIucmVmcmVzaFJlYnJhbmRpbmdTdHlsZShzdHlsZSk7XG4gICAgfVxuICAgIHRoaXMubmF2YmFyLmxvYWQoKTtcbiAgICAvLyBjb25zb2xlLmxvZygnRE9DIFVSTDogJyArIHRoaXMuZG9jVXJsKTtcbiAgICBjb25zdCBpbml0aWFsSGVscFVSTCA9IHRoaXMuZG9jVXJsICsgJy9oZWxwLmh0bWwnO1xuXG4gICAgdGhpcy51cmxFeGlzdHMoaW5pdGlhbEhlbHBVUkwsIGV4aXN0cyA9PiB7XG4gICAgICBpZiAoZXhpc3RzKSB7XG4gICAgICAgIHRoaXMubmF2YmFyLmN1c3RvbWl6ZVBhbmVsKCdoZWxwJywgJzxlbWJlZCBzcmM9XCInICsgaW5pdGlhbEhlbHBVUkwgKyAnXCIgc3R5bGU9XCJoZWlnaHQ6IDEwMCU7IHdpZHRoOiAxMDAlXCI+Jyk7ICAvLyBzZXQgSFRNTCBzdHJpbmdcblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uYXZiYXIuY3VzdG9taXplUGFuZWwoJ2hlbHAnLCAnPGI+IE5vIEhlbHAgUGFnZSBGb3VuZDwvYj4nKTsgIC8vIHNldCBIVE1MIHN0cmluZ1xuXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLm1zLmdldE1lc3NhZ2UoJ2hlbHAnKS5zdWJzY3JpYmUoZGF0YSA9PiB7XG4gICAgICAvLyBjb25zb2xlLmxvZygnR290IG1lc3NhZ2U6ICcgKyBkYXRhLnRleHQpO1xuICAgICAgdGhpcy5maW5kSGVscEZpbGUoJ2Fzc2V0cy9oZWxwLycgKyBkYXRhLnRleHQgKyAnL2hlbHAuaHRtbCcpO1xuICAgIH0pO1xuICB9XG5cbiAgZmluZEhlbHBGaWxlKGhlbHBVcmwpIHtcbiAgICB0aGlzLnVybEV4aXN0cyhoZWxwVXJsLCBleGlzdHMgPT4ge1xuICAgICAgLy8gY29uc29sZS5sb2coJ1JFU1VMVDogdXJsPScgKyBoZWxwVXJsICsgJywgZXhpc3RzPScgKyBleGlzdHMpO1xuICAgICAgaWYgKGV4aXN0cykge1xuICAgICAgICBjb25zb2xlLmxvZygnU2V0dGluZyBoZWxwIHBhZ2U6ICcgKyBoZWxwVXJsKTtcbiAgICAgICAgdGhpcy5uYXZiYXIuY3VzdG9taXplUGFuZWwoJ2hlbHAnLCAnPGVtYmVkIHNyYz1cIicgKyBoZWxwVXJsICsgJ1wiIHN0eWxlPVwiaGVpZ2h0OiAxMDAlOyB3aWR0aDogMTAwJVwiPicpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGhlbHBVcmwuaW5jbHVkZXMoJy8nKSkge1xuICAgICAgICAgIC8vIEZpbmQgb25lIHN0ZXAgbG93ZXJcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnSGVscFVSTCBiZWZvcmU6IHwnICsgaGVscFVybCArICd8Jyk7XG4gICAgICAgICAgaGVscFVybCA9IGhlbHBVcmwuc3Vic3RyaW5nKDAsIGhlbHBVcmwubGFzdEluZGV4T2YoJy9oZWxwLmh0bWwnKSk7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coJ0hlbHBVUkwgbWlkZGxlOiB8JyArIGhlbHBVcmwgKyAnfCcpO1xuICAgICAgICAgIGhlbHBVcmwgPSBoZWxwVXJsLnN1YnN0cmluZygwLCBoZWxwVXJsLmxhc3RJbmRleE9mKCcvJykgKyAxKTtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnSGVscFVSTCAgYWZ0ZXI6IHwnICsgaGVscFVybCArICd8Jyk7XG4gICAgICAgICAgdGhpcy5maW5kSGVscEZpbGUoaGVscFVybCArICdoZWxwLmh0bWwnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnTm8gdmFsaWQgaGVscCBmaWxlIGZvdW5kLi4uJyk7XG4gICAgICAgICAgdGhpcy5uYXZiYXIuY3VzdG9taXplUGFuZWwoJ2hlbHAnLCAnPGI+IE5vIEhlbHAgUGFnZSBGb3VuZDwvYj4nKTsgIC8vIHNldCBIVE1MIHN0cmluZ1xuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIFRoZSBcImNhbGxiYWNrXCIgYXJndW1lbnQgaXMgY2FsbGVkIHdpdGggZWl0aGVyIHRydWUgb3IgZmFsc2Vcbi8vIGRlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSBcInVybFwiIGV4aXN0cyBvciBub3QuXG4gIHVybEV4aXN0cyh1cmwsIGNhbGxiYWNrKSB7XG4gICAgY29uc3QgaHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgIGh0dHAub3BlbignR0VUJywgdXJsLCB0cnVlKTtcbiAgICBodHRwLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoaHR0cC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgIGlmIChodHRwLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgY2FsbGJhY2sodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2FsbGJhY2soZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICBodHRwLnNlbmQoKTtcbiAgfVxufVxuIl19