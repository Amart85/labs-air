/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { LiveAppsApplicationsComponent } from '../live-apps-applications/live-apps-applications.component';
import { map, take, takeUntil } from 'rxjs/operators';
import { MatSelectionList } from '@angular/material';
/**
 * Special rendering of LiveAppsApplicationsComponent
 *
 * \@example <tcla-live-apps-application-list></tcla-live-apps-application-list>
 */
export class LiveAppsApplicationListComponent extends LiveAppsApplicationsComponent {
    constructor() {
        super(...arguments);
        /**
         * The app Ids selected (output)
         */
        this.selectedAppIds = [];
        /**
         * ~event appsSelected : Applications selected in component (CaseType objects)
         * ~payload CaseType[] : Array of CaseType objects of what was selected
         */
        this.appsSelected = new EventEmitter();
        /**
         * ~event appIdsSelected : Applications selected in component (appIds)
         * ~payload string[] : selected App Ids from the application list (used on config)
         */
        this.appIdsSelected = new EventEmitter();
        this.handleAppSelection = (/**
         * @param {?} selectionEvent
         * @return {?}
         */
        (selectionEvent) => {
            this.appsSelected.emit(selectionEvent);
            /** @type {?} */
            const selIds = [];
            selectionEvent.forEach((/**
             * @param {?} selected
             * @return {?}
             */
            (selected) => {
                selIds.push(selected.applicationId);
            }));
            this.appIdsSelected.emit(selIds);
        });
        this.handleSelectAll = (/**
         * @return {?}
         */
        () => {
            this.mySelectedOptions = this.applications.casetypes;
            this.appIdsSelected.emit(this.getAppIds(this.mySelectedOptions));
            this.appsSelected.emit(this.applications.casetypes);
        });
        this.handleDeselectAll = (/**
         * @return {?}
         */
        () => {
            this.mySelectedOptions = [];
            this.appIdsSelected.emit([]);
            this.appsSelected.emit([]);
        });
        this.getAppIds = (/**
         * @param {?} casetypes
         * @return {?}
         */
        (casetypes) => {
            /** @type {?} */
            const selIds = [];
            casetypes.forEach((/**
             * @param {?} selected
             * @return {?}
             */
            (selected) => {
                selIds.push(selected.applicationId);
            }));
            return selIds;
        });
        this.refresh = (/**
         * @param {?} bypassCache
         * @return {?}
         */
        (bypassCache) => {
            this.liveapps.getApplications(this.sandboxId, this.appIds, 100, bypassCache)
                .pipe(take(1), takeUntil(this._destroyed$), map((/**
             * @param {?} applicationList
             * @return {?}
             */
            applicationList => {
                this.applications = applicationList;
                // handle single app selection input
                if (this.selectedApp && this.selectedApp.applicationId) {
                    this.selectedApp = applicationList.casetypes.find((/**
                     * @param {?} casetype
                     * @return {?}
                     */
                    (casetype) => {
                        return casetype.applicationId === this.selectedApp.applicationId;
                    }));
                    // this.selection.emit(this.selectedApp);
                }
                else if (this.selectedAppIds && this.selectedAppIds.length > 0) {
                    // pre select any casetypes that were passed in the selectedAppIds input attribute
                    this.mySelectedOptions = this.applications.casetypes.filter((/**
                     * @param {?} casetype
                     * @return {?}
                     */
                    casetype => {
                        return (this.selectedAppIds.findIndex((/**
                         * @param {?} ct
                         * @return {?}
                         */
                        (ct) => {
                            return ct === casetype.applicationId;
                        })) !== -1);
                    }));
                }
            })))
                .subscribe(null, (/**
             * @param {?} error
             * @return {?}
             */
            error => { this.errorMessage = 'Error retrieving applications: ' + error.error.errorMsg; }));
        });
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        // only interested in initial selection - catching every change would create an infinite loop!
        if (changes.selectedAppIds && (changes.selectedAppIds.firstChange)) {
            this.refresh(false);
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // leave this blank so superclass ngOnInit not called
    }
}
LiveAppsApplicationListComponent.decorators = [
    { type: Component, args: [{
                selector: 'tcla-live-apps-application-list',
                template: "<div fxFlex style=\"padding: 10px;\" fxLayout=\"column\">\n  <div fxLayout=\"row\" class=\"tcs-application-list-buttons\">\n    <button mat-button (click)=\"handleSelectAll()\">\n      <span>Select All</span>\n    </button>\n    <button mat-button (click)=\"handleDeselectAll()\">\n      <span>Deselect All</span>\n    </button>\n  </div>\n  <mat-selection-list class=\"tcs-application-list\" #selectedApps [(ngModel)]=\"mySelectedOptions\" (ngModelChange)=\"handleAppSelection($event)\"\n                      fxLayout=\"column\" fxLayout=\"row wrap\">\n    <mat-list-option class=\"tcs-application-option\" checkboxPosition=\"before\"\n                     *ngFor=\"let casetype of applications.casetypes\"\n                     [value]=\"casetype\">\n      <span>{{casetype.label}}</span>\n    </mat-list-option>\n  </mat-selection-list>\n</div>\n",
                styles: [".tcs-application-option{max-width:320px}.tcs-application-list{overflow:auto}.tcs-application-list-buttons{min-height:40px}"]
            }] }
];
LiveAppsApplicationListComponent.propDecorators = {
    appSelectionList: [{ type: ViewChild, args: [MatSelectionList, { static: false },] }],
    selectedAppIds: [{ type: Input }],
    appsSelected: [{ type: Output }],
    appIdsSelected: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    LiveAppsApplicationListComponent.prototype.appSelectionList;
    /**
     * The app Ids selected (output)
     * @type {?}
     */
    LiveAppsApplicationListComponent.prototype.selectedAppIds;
    /**
     * ~event appsSelected : Applications selected in component (CaseType objects)
     * ~payload CaseType[] : Array of CaseType objects of what was selected
     * @type {?}
     */
    LiveAppsApplicationListComponent.prototype.appsSelected;
    /**
     * ~event appIdsSelected : Applications selected in component (appIds)
     * ~payload string[] : selected App Ids from the application list (used on config)
     * @type {?}
     */
    LiveAppsApplicationListComponent.prototype.appIdsSelected;
    /** @type {?} */
    LiveAppsApplicationListComponent.prototype.mySelectedOptions;
    /** @type {?} */
    LiveAppsApplicationListComponent.prototype.handleAppSelection;
    /** @type {?} */
    LiveAppsApplicationListComponent.prototype.handleSelectAll;
    /** @type {?} */
    LiveAppsApplicationListComponent.prototype.handleDeselectAll;
    /**
     * @type {?}
     * @private
     */
    LiveAppsApplicationListComponent.prototype.getAppIds;
    /** @type {?} */
    LiveAppsApplicationListComponent.prototype.refresh;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLWFwcGxpY2F0aW9uLWxpc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRpYmNvLXRjc3RrL3RjLWxpdmVhcHBzLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2xpdmUtYXBwcy1hcHBsaWNhdGlvbi1saXN0L2xpdmUtYXBwcy1hcHBsaWNhdGlvbi1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFxQixNQUFNLEVBQWlCLFNBQVMsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUVsSCxPQUFPLEVBQUMsNkJBQTZCLEVBQUMsTUFBTSw0REFBNEQsQ0FBQztBQUN6RyxPQUFPLEVBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNwRCxPQUFPLEVBQUMsZ0JBQWdCLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQzs7Ozs7O0FBY25ELE1BQU0sT0FBTyxnQ0FBaUMsU0FBUSw2QkFBNkI7SUFMbkY7Ozs7O1FBV1csbUJBQWMsR0FBYSxFQUFFLENBQUM7Ozs7O1FBTTdCLGlCQUFZLEdBQTZCLElBQUksWUFBWSxFQUFjLENBQUM7Ozs7O1FBTXhFLG1CQUFjLEdBQTJCLElBQUksWUFBWSxFQUFZLENBQUM7UUFLaEYsdUJBQWtCOzs7O1FBQUcsQ0FBQyxjQUEwQixFQUFFLEVBQUU7WUFDbEQsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7O2tCQUNqQyxNQUFNLEdBQUcsRUFBRTtZQUNqQixjQUFjLENBQUMsT0FBTzs7OztZQUFDLENBQUMsUUFBUSxFQUFFLEVBQUU7Z0JBQ2xDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ3RDLENBQUMsRUFBQyxDQUFDO1lBQ0gsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENB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Qyw4RkFBOEY7UUFDOUYsSUFBSSxPQUFPLENBQUMsY0FBYyxJQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsRUFBRTtZQUNsRSxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3JCO0lBQ0gsQ0FBQzs7OztJQUdELFFBQVE7UUFDTixxREFBcUQ7SUFDdkQsQ0FBQzs7O1lBOUZGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsaUNBQWlDO2dCQUMzQyw4MUJBQTBEOzthQUUzRDs7OytCQUVFLFNBQVMsU0FBRSxnQkFBZ0IsRUFBRSxFQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUM7NkJBSzVDLEtBQUs7MkJBTUwsTUFBTTs2QkFNTixNQUFNOzs7O0lBakJQLDREQUFrRjs7Ozs7SUFLbEYsMERBQXVDOzs7Ozs7SUFNdkMsd0RBQWtGOzs7Ozs7SUFNbEYsMERBQWdGOztJQUdoRiw2REFBcUM7O0lBRXJDLDhEQU9DOztJQUVELDJEQUlDOztJQUVELDZEQUlDOzs7OztJQUVELHFEQU1DOztJQUVELG1EQXlCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkNoYW5nZXMsIE9uSW5pdCwgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtDYXNlVHlwZX0gZnJvbSAnLi4vLi4vbW9kZWxzL2xpdmVhcHBzZGF0YSc7XG5pbXBvcnQge0xpdmVBcHBzQXBwbGljYXRpb25zQ29tcG9uZW50fSBmcm9tICcuLi9saXZlLWFwcHMtYXBwbGljYXRpb25zL2xpdmUtYXBwcy1hcHBsaWNhdGlvbnMuY29tcG9uZW50JztcbmltcG9ydCB7bWFwLCB0YWtlLCB0YWtlVW50aWx9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7TWF0U2VsZWN0aW9uTGlzdH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuXG5cbi8qKlxuICogU3BlY2lhbCByZW5kZXJpbmcgb2YgTGl2ZUFwcHNBcHBsaWNhdGlvbnNDb21wb25lbnRcbiAqXG4gKkBleGFtcGxlIDx0Y2xhLWxpdmUtYXBwcy1hcHBsaWNhdGlvbi1saXN0PjwvdGNsYS1saXZlLWFwcHMtYXBwbGljYXRpb24tbGlzdD5cbiAqL1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0Y2xhLWxpdmUtYXBwcy1hcHBsaWNhdGlvbi1saXN0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL2xpdmUtYXBwcy1hcHBsaWNhdGlvbi1saXN0LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbGl2ZS1hcHBzLWFwcGxpY2F0aW9uLWxpc3QuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIExpdmVBcHBzQXBwbGljYXRpb25MaXN0Q29tcG9uZW50IGV4dGVuZHMgTGl2ZUFwcHNBcHBsaWNhdGlvbnNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG4gIEBWaWV3Q2hpbGQgKE1hdFNlbGVjdGlvbkxpc3QsIHtzdGF0aWM6IGZhbHNlfSkgYXBwU2VsZWN0aW9uTGlzdDogTWF0U2VsZWN0aW9uTGlzdDtcblxuICAvKipcbiAgICogVGhlIGFwcCBJZHMgc2VsZWN0ZWQgKG91dHB1dClcbiAgICovXG4gIEBJbnB1dCgpIHNlbGVjdGVkQXBwSWRzOiBzdHJpbmdbXSA9IFtdO1xuXG4gIC8qKlxuICAgKiB+ZXZlbnQgYXBwc1NlbGVjdGVkIDogQXBwbGljYXRpb25zIHNlbGVjdGVkIGluIGNvbXBvbmVudCAoQ2FzZVR5cGUgb2JqZWN0cylcbiAgICogfnBheWxvYWQgQ2FzZVR5cGVbXSA6IEFycmF5IG9mIENhc2VUeXBlIG9iamVjdHMgb2Ygd2hhdCB3YXMgc2VsZWN0ZWRcbiAgICovXG4gIEBPdXRwdXQoKSBhcHBzU2VsZWN0ZWQ6IEV2ZW50RW1pdHRlcjxDYXNlVHlwZVtdPiA9IG5ldyBFdmVudEVtaXR0ZXI8Q2FzZVR5cGVbXT4oKTtcblxuICAvKipcbiAgICogfmV2ZW50IGFwcElkc1NlbGVjdGVkIDogQXBwbGljYXRpb25zIHNlbGVjdGVkIGluIGNvbXBvbmVudCAoYXBwSWRzKVxuICAgKiB+cGF5bG9hZCBzdHJpbmdbXSA6IHNlbGVjdGVkIEFwcCBJZHMgZnJvbSB0aGUgYXBwbGljYXRpb24gbGlzdCAodXNlZCBvbiBjb25maWcpXG4gICAqL1xuICBAT3V0cHV0KCkgYXBwSWRzU2VsZWN0ZWQ6IEV2ZW50RW1pdHRlcjxzdHJpbmdbXT4gPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZ1tdPigpO1xuXG5cbiAgcHVibGljIG15U2VsZWN0ZWRPcHRpb25zOiBDYXNlVHlwZVtdO1xuXG4gIGhhbmRsZUFwcFNlbGVjdGlvbiA9IChzZWxlY3Rpb25FdmVudDogQ2FzZVR5cGVbXSkgPT4ge1xuICAgIHRoaXMuYXBwc1NlbGVjdGVkLmVtaXQoc2VsZWN0aW9uRXZlbnQpO1xuICAgIGNvbnN0IHNlbElkcyA9IFtdO1xuICAgIHNlbGVjdGlvbkV2ZW50LmZvckVhY2goKHNlbGVjdGVkKSA9PiB7XG4gICAgICBzZWxJZHMucHVzaChzZWxlY3RlZC5hcHBsaWNhdGlvbklkKTtcbiAgICB9KTtcbiAgICB0aGlzLmFwcElkc1NlbGVjdGVkLmVtaXQoc2VsSWRzKTtcbiAgfVxuXG4gIGhhbmRsZVNlbGVjdEFsbCA9ICgpID0+IHtcbiAgICB0aGlzLm15U2VsZWN0ZWRPcHRpb25zID0gdGhpcy5hcHBsaWNhdGlvbnMuY2FzZXR5cGVzO1xuICAgIHRoaXMuYXBwSWRzU2VsZWN0ZWQuZW1pdCh0aGlzLmdldEFwcElkcyh0aGlzLm15U2VsZWN0ZWRPcHRpb25zKSk7XG4gICAgdGhpcy5hcHBzU2VsZWN0ZWQuZW1pdCh0aGlzLmFwcGxpY2F0aW9ucy5jYXNldHlwZXMpO1xuICB9XG5cbiAgaGFuZGxlRGVzZWxlY3RBbGwgPSAoKSA9PiB7XG4gICAgdGhpcy5teVNlbGVjdGVkT3B0aW9ucyA9IFtdO1xuICAgIHRoaXMuYXBwSWRzU2VsZWN0ZWQuZW1pdChbXSk7XG4gICAgdGhpcy5hcHBzU2VsZWN0ZWQuZW1pdChbXSk7XG4gIH1cblxuICBwcml2YXRlIGdldEFwcElkcyA9IChjYXNldHlwZXM6IENhc2VUeXBlW10pOiBzdHJpbmdbXSA9PiB7XG4gICAgY29uc3Qgc2VsSWRzID0gW107XG4gICAgY2FzZXR5cGVzLmZvckVhY2goKHNlbGVjdGVkKSA9PiB7XG4gICAgICBzZWxJZHMucHVzaChzZWxlY3RlZC5hcHBsaWNhdGlvbklkKTtcbiAgICB9KTtcbiAgICByZXR1cm4gc2VsSWRzO1xuICB9XG5cbiAgcHVibGljIHJlZnJlc2ggPSAoYnlwYXNzQ2FjaGU6IGJvb2xlYW4pID0+IHtcbiAgICB0aGlzLmxpdmVhcHBzLmdldEFwcGxpY2F0aW9ucyh0aGlzLnNhbmRib3hJZCwgdGhpcy5hcHBJZHMsIDEwMCwgYnlwYXNzQ2FjaGUpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCQpLFxuICAgICAgICBtYXAoYXBwbGljYXRpb25MaXN0ID0+IHtcbiAgICAgICAgICB0aGlzLmFwcGxpY2F0aW9ucyA9IGFwcGxpY2F0aW9uTGlzdDtcbiAgICAgICAgICAvLyBoYW5kbGUgc2luZ2xlIGFwcCBzZWxlY3Rpb24gaW5wdXRcbiAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEFwcCAmJiB0aGlzLnNlbGVjdGVkQXBwLmFwcGxpY2F0aW9uSWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRBcHAgPSBhcHBsaWNhdGlvbkxpc3QuY2FzZXR5cGVzLmZpbmQoKGNhc2V0eXBlKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBjYXNldHlwZS5hcHBsaWNhdGlvbklkID09PSB0aGlzLnNlbGVjdGVkQXBwLmFwcGxpY2F0aW9uSWQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIHRoaXMuc2VsZWN0aW9uLmVtaXQodGhpcy5zZWxlY3RlZEFwcCk7XG4gICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNlbGVjdGVkQXBwSWRzICYmIHRoaXMuc2VsZWN0ZWRBcHBJZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgLy8gcHJlIHNlbGVjdCBhbnkgY2FzZXR5cGVzIHRoYXQgd2VyZSBwYXNzZWQgaW4gdGhlIHNlbGVjdGVkQXBwSWRzIGlucHV0IGF0dHJpYnV0ZVxuICAgICAgICAgICAgdGhpcy5teVNlbGVjdGVkT3B0aW9ucyA9IHRoaXMuYXBwbGljYXRpb25zLmNhc2V0eXBlcy5maWx0ZXIoY2FzZXR5cGUgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gKHRoaXMuc2VsZWN0ZWRBcHBJZHMuZmluZEluZGV4KChjdCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBjdCA9PT0gY2FzZXR5cGUuYXBwbGljYXRpb25JZDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICApICE9PSAtMSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKG51bGwsIGVycm9yID0+IHsgdGhpcy5lcnJvck1lc3NhZ2UgPSAnRXJyb3IgcmV0cmlldmluZyBhcHBsaWNhdGlvbnM6ICcgKyBlcnJvci5lcnJvci5lcnJvck1zZzsgfSk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgLy8gb25seSBpbnRlcmVzdGVkIGluIGluaXRpYWwgc2VsZWN0aW9uIC0gY2F0Y2hpbmcgZXZlcnkgY2hhbmdlIHdvdWxkIGNyZWF0ZSBhbiBpbmZpbml0ZSBsb29wIVxuICAgIGlmIChjaGFuZ2VzLnNlbGVjdGVkQXBwSWRzICYmIChjaGFuZ2VzLnNlbGVjdGVkQXBwSWRzLmZpcnN0Q2hhbmdlKSkge1xuICAgICAgdGhpcy5yZWZyZXNoKGZhbHNlKTtcbiAgICB9XG4gIH1cblxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIC8vIGxlYXZlIHRoaXMgYmxhbmsgc28gc3VwZXJjbGFzcyBuZ09uSW5pdCBub3QgY2FsbGVkXG4gIH1cbn1cbiJdfQ==