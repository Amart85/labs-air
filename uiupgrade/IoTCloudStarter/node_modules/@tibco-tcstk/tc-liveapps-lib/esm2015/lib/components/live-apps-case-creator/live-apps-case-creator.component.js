/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { LiveAppsComponent } from '../live-apps-component/live-apps-component.component';
import { ProcessId } from '../../models/liveappsdata';
import { LaProcessSelection } from '../../models/tc-case-processes';
import { LiveAppsService } from '../../services/live-apps.service';
import { take, takeUntil } from 'rxjs/operators';
import { CustomFormDefs } from '@tibco-tcstk/tc-forms-lib';
/**
 * Handles rendering of case creator form.
 *
 * \@example <tcla-live-apps-case-creator></tcla-live-apps-case-creator>
 */
export class LiveAppsCaseCreatorComponent extends LiveAppsComponent {
    /**
     * @param {?} liveapps
     */
    constructor(liveapps) {
        super();
        this.liveapps = liveapps;
        /**
         * Enable legacy creators
         */
        this.legacyCreators = this.legacyCreators ? this.legacyCreators : false;
        /**
         * Allow override of forms framework
         * Options: bootstrap-4 or material-design
         */
        this.formsFramework = this.formsFramework ? this.formsFramework : 'material-design';
        /**
         * ~event caseChanged : Case action started (process started)
         * ~payload ProcessId : ProcessId object passed when a case has been updated or created by a process (action/creator)
         */
        this.caseChanged = new EventEmitter();
        this.isCustomForm = false;
        this.handleSubmit = (/**
         * @param {?} data
         * @param {?} caseRef
         * @return {?}
         */
        (data, caseRef) => {
            // if no_process_submit then no need to run process as this was done inside a custom form app
            if (data !== 'NO_PROCESS_SUBMIT') {
                // run the process
                this.liveapps.runProcess(this.sandboxId, this.applicationId, this.process.process.id, caseRef, data)
                    .pipe(take(1), takeUntil(this._destroyed$))
                    .subscribe((/**
                 * @param {?} response
                 * @return {?}
                 */
                response => {
                    if (response) {
                        if (!response.data.errorMsg) {
                            // parse data to object
                            response.data = JSON.parse(response.data);
                            // case created send back response including caseIdentifier if one is present
                            /** @type {?} */
                            let caseIdentifier;
                            /** @type {?} */
                            let caseReference;
                            if (response.caseIdentifier) {
                                caseIdentifier = response.caseIdentifier;
                            }
                            if (response.caseReference) {
                                caseReference = response.caseReference;
                            }
                            /** @type {?} */
                            const processResponse = new ProcessId().deserialize({ 'caseIdentifier': caseIdentifier, 'caseReference': caseReference });
                            this.caseChanged.emit(processResponse);
                            this.schema = undefined;
                            this.data = undefined;
                            this.layout = undefined;
                        }
                        else {
                            console.error('Unable to run case creator');
                            console.error(response.data.errorMsg);
                        }
                    }
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                error => {
                    console.error('Unable to run case creator');
                    console.error(error);
                }));
            }
            else {
                /** @type {?} */
                const processResponse = new ProcessId().deserialize({ 'caseIdentifier': undefined, 'caseReference': undefined });
                this.caseChanged.emit(processResponse);
                this.schema = undefined;
                this.data = undefined;
                this.layout = undefined;
            }
        });
        this.handleLegacyProcessComplete = (/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const processResponse = new ProcessId().deserialize({ 'caseIdentifier': undefined, 'caseReference': undefined });
            this.caseChanged.emit(processResponse);
        });
        this.handleLegacyProcessCancelled = (/**
         * @return {?}
         */
        () => {
            // -1 for caseReference means cancelled
            /** @type {?} */
            const processResponse = new ProcessId().deserialize({ 'caseIdentifier': undefined, 'caseReference': '-1' });
            this.caseChanged.emit(processResponse);
        });
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.options = {
            defaultOptions: {
                'appearance': 'legacy'
            }
        };
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        // handle input param changes
        if (changes.process && changes.process.currentValue && (changes.process.currentValue !== changes.process.previousValue)) {
            if (this.customFormDefs && this.customFormDefs.customForms) {
                this.isCustomForm = (this.customFormDefs.customForms.findIndex((/**
                 * @param {?} form
                 * @return {?}
                 */
                (form) => {
                    return (form === this.process.ref);
                })) !== -1);
            }
            else {
                this.isCustomForm = false;
            }
            if (changes.process.currentValue.process.jsonSchema.$schema === 'NOSCHEMA') {
                this.schema = undefined;
            }
            else {
                this.schema = changes.process.currentValue.process.jsonSchema;
            }
        }
        else if (changes.applicationId && (changes.applicationId.currentValue !== changes.applicationId.previousValue)) {
            // appId has changed: make sure no process selected/form displayed
            this.process = undefined;
        }
        if (changes.layout && (changes.layout.currentValue !== changes.layout.previousValue)) {
            this.layout = changes.layout.currentValue;
        }
        if (changes.dataOverride && (changes.dataOverride.currentValue !== changes.dataOverride.previousValue)) {
            this.data = this.dataOverride;
        }
    }
}
LiveAppsCaseCreatorComponent.decorators = [
    { type: Component, args: [{
                selector: 'tcla-live-apps-case-creator',
                template: "<div fxFill>\n  <tcfrm-rendered-form *ngIf=\"process && (!legacyCreators || isCustomForm)\" style=\"overflow: auto;\" [formsFramework]=\"formsFramework\" [customFormDefs]=customFormDefs [formRef]=\"process.ref\" [appId]=\"applicationId\" [customFormDefs]=\"customFormDefs\" [schema]=\"schema\" [layout]=\"layout\" [data]=\"data\" [options]=\"options\" (formSubmit)=\"handleSubmit($event, undefined)\"></tcfrm-rendered-form>\n  <tcla-live-apps-legacy-process *ngIf=\"process && legacyCreators && !isCustomForm\" [process]=\"process\" [type]=\"'creator'\" [applicationId]=\"applicationId\" [typeId]=\"typeId\" (processCancelled)=\"handleLegacyProcessCancelled()\" (processComplete)=\"handleLegacyProcessComplete()\" class=\"live-apps-widget\" fxFill></tcla-live-apps-legacy-process>\n</div>\n",
                styles: [""]
            }] }
];
/** @nocollapse */
LiveAppsCaseCreatorComponent.ctorParameters = () => [
    { type: LiveAppsService }
];
LiveAppsCaseCreatorComponent.propDecorators = {
    sandboxId: [{ type: Input }],
    applicationId: [{ type: Input }],
    typeId: [{ type: Input }],
    process: [{ type: Input }],
    dataOverride: [{ type: Input }],
    customFormDefs: [{ type: Input }],
    legacyCreators: [{ type: Input }],
    formsFramework: [{ type: Input }],
    caseChanged: [{ type: Output }]
};
if (false) {
    /**
     * sandboxId - this comes from claims resolver
     * @type {?}
     */
    LiveAppsCaseCreatorComponent.prototype.sandboxId;
    /**
     * LA application ID
     * @type {?}
     */
    LiveAppsCaseCreatorComponent.prototype.applicationId;
    /**
     * The LA Application Type Id (generally 1)
     * @type {?}
     */
    LiveAppsCaseCreatorComponent.prototype.typeId;
    /**
     * The process definition of the action or creator to execute
     * @type {?}
     */
    LiveAppsCaseCreatorComponent.prototype.process;
    /**
     * Data object that will be displayed on the form. Allows overriding over form data (eg. when selecting data in spotfire)
     * @type {?}
     */
    LiveAppsCaseCreatorComponent.prototype.dataOverride;
    /**
     * Custom Form configuration file
     * @type {?}
     */
    LiveAppsCaseCreatorComponent.prototype.customFormDefs;
    /**
     * Enable legacy creators
     * @type {?}
     */
    LiveAppsCaseCreatorComponent.prototype.legacyCreators;
    /**
     * Allow override of forms framework
     * Options: bootstrap-4 or material-design
     * @type {?}
     */
    LiveAppsCaseCreatorComponent.prototype.formsFramework;
    /**
     * ~event caseChanged : Case action started (process started)
     * ~payload ProcessId : ProcessId object passed when a case has been updated or created by a process (action/creator)
     * @type {?}
     */
    LiveAppsCaseCreatorComponent.prototype.caseChanged;
    /** @type {?} */
    LiveAppsCaseCreatorComponent.prototype.data;
    /** @type {?} */
    LiveAppsCaseCreatorComponent.prototype.schema;
    /** @type {?} */
    LiveAppsCaseCreatorComponent.prototype.layout;
    /** @type {?} */
    LiveAppsCaseCreatorComponent.prototype.options;
    /** @type {?} */
    LiveAppsCaseCreatorComponent.prototype.isCustomForm;
    /** @type {?} */
    LiveAppsCaseCreatorComponent.prototype.handleSubmit;
    /** @type {?} */
    LiveAppsCaseCreatorComponent.prototype.handleLegacyProcessComplete;
    /** @type {?} */
    LiveAppsCaseCreatorComponent.prototype.handleLegacyProcessCancelled;
    /**
     * @type {?}
     * @protected
     */
    LiveAppsCaseCreatorComponent.prototype.liveapps;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLWNhc2UtY3JlYXRvci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdGliY28tdGNzdGsvdGMtbGl2ZWFwcHMtbGliLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvbGl2ZS1hcHBzLWNhc2UtY3JlYXRvci9saXZlLWFwcHMtY2FzZS1jcmVhdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBc0MsTUFBTSxlQUFlLENBQUM7QUFDbEgsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sc0RBQXNELENBQUM7QUFDdkYsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLDJCQUEyQixDQUFDO0FBQ3BELE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLGdDQUFnQyxDQUFDO0FBQ2xFLE9BQU8sRUFBQyxlQUFlLEVBQUMsTUFBTSxrQ0FBa0MsQ0FBQztBQUNqRSxPQUFPLEVBQU0sSUFBSSxFQUFFLFNBQVMsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBRXBELE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSwyQkFBMkIsQ0FBQzs7Ozs7O0FBWXpELE1BQU0sT0FBTyw0QkFBNkIsU0FBUSxpQkFBaUI7Ozs7SUFnSGpFLFlBQXNCLFFBQXlCO1FBQzdDLEtBQUssRUFBRSxDQUFDO1FBRFksYUFBUSxHQUFSLFFBQVEsQ0FBaUI7Ozs7UUE5RXRDLG1CQUFjLEdBQVksSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDOzs7OztRQU01RSxtQkFBYyxHQUFXLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDOzs7OztRQU10RixnQkFBVyxHQUE0QixJQUFJLFlBQVksRUFBYSxDQUFD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QWM7O0lBQ2QsK0NBQWE7O0lBQ2Isb0RBQXFCOztJQUVyQixvREE2Q0M7O0lBRUQsbUVBR0M7O0lBRUQsb0VBSUM7Ozs7O0lBRVcsZ0RBQW1DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0LCBPbkRlc3Ryb3ksIFNpbXBsZUNoYW5nZXMsIE9uQ2hhbmdlc30gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0xpdmVBcHBzQ29tcG9uZW50fSBmcm9tICcuLi9saXZlLWFwcHMtY29tcG9uZW50L2xpdmUtYXBwcy1jb21wb25lbnQuY29tcG9uZW50JztcbmltcG9ydCB7UHJvY2Vzc0lkfSBmcm9tICcuLi8uLi9tb2RlbHMvbGl2ZWFwcHNkYXRhJztcbmltcG9ydCB7TGFQcm9jZXNzU2VsZWN0aW9ufSBmcm9tICcuLi8uLi9tb2RlbHMvdGMtY2FzZS1wcm9jZXNzZXMnO1xuaW1wb3J0IHtMaXZlQXBwc1NlcnZpY2V9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2xpdmUtYXBwcy5zZXJ2aWNlJztcbmltcG9ydCB7bWFwLCB0YWtlLCB0YWtlVW50aWx9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7U3ViamVjdH0gZnJvbSAncnhqcyc7XG5pbXBvcnQge0N1c3RvbUZvcm1EZWZzfSBmcm9tICdAdGliY28tdGNzdGsvdGMtZm9ybXMtbGliJztcblxuLyoqXG4gKiBIYW5kbGVzIHJlbmRlcmluZyBvZiBjYXNlIGNyZWF0b3IgZm9ybS5cbiAqXG4gKkBleGFtcGxlIDx0Y2xhLWxpdmUtYXBwcy1jYXNlLWNyZWF0b3I+PC90Y2xhLWxpdmUtYXBwcy1jYXNlLWNyZWF0b3I+XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RjbGEtbGl2ZS1hcHBzLWNhc2UtY3JlYXRvcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9saXZlLWFwcHMtY2FzZS1jcmVhdG9yLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbGl2ZS1hcHBzLWNhc2UtY3JlYXRvci5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgTGl2ZUFwcHNDYXNlQ3JlYXRvckNvbXBvbmVudCBleHRlbmRzIExpdmVBcHBzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuICAvKipcbiAgICogc2FuZGJveElkIC0gdGhpcyBjb21lcyBmcm9tIGNsYWltcyByZXNvbHZlclxuICAgKi9cbiAgQElucHV0KCkgc2FuZGJveElkOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIExBIGFwcGxpY2F0aW9uIElEXG4gICAqL1xuICBASW5wdXQoKSBhcHBsaWNhdGlvbklkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBMQSBBcHBsaWNhdGlvbiBUeXBlIElkIChnZW5lcmFsbHkgMSlcbiAgICovXG4gIEBJbnB1dCgpIHR5cGVJZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgcHJvY2VzcyBkZWZpbml0aW9uIG9mIHRoZSBhY3Rpb24gb3IgY3JlYXRvciB0byBleGVjdXRlXG4gICAqL1xuICBASW5wdXQoKSBwcm9jZXNzOiBMYVByb2Nlc3NTZWxlY3Rpb247XG5cbiAgLyoqXG4gICAqIERhdGEgb2JqZWN0IHRoYXQgd2lsbCBiZSBkaXNwbGF5ZWQgb24gdGhlIGZvcm0uIEFsbG93cyBvdmVycmlkaW5nIG92ZXIgZm9ybSBkYXRhIChlZy4gd2hlbiBzZWxlY3RpbmcgZGF0YSBpbiBzcG90ZmlyZSlcbiAgICovXG4gIEBJbnB1dCgpIGRhdGFPdmVycmlkZTogYW55O1xuXG4gIC8qKlxuICAgKiBDdXN0b20gRm9ybSBjb25maWd1cmF0aW9uIGZpbGVcbiAgICovXG4gIEBJbnB1dCgpIGN1c3RvbUZvcm1EZWZzOiBDdXN0b21Gb3JtRGVmcztcblxuICAvKipcbiAgICogRW5hYmxlIGxlZ2FjeSBjcmVhdG9yc1xuICAgKi9cbiAgQElucHV0KCkgbGVnYWN5Q3JlYXRvcnM6IGJvb2xlYW4gPSB0aGlzLmxlZ2FjeUNyZWF0b3JzID8gdGhpcy5sZWdhY3lDcmVhdG9ycyA6IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBBbGxvdyBvdmVycmlkZSBvZiBmb3JtcyBmcmFtZXdvcmtcbiAgICogT3B0aW9uczogYm9vdHN0cmFwLTQgb3IgbWF0ZXJpYWwtZGVzaWduXG4gICAqL1xuICBASW5wdXQoKSBmb3Jtc0ZyYW1ld29yazogc3RyaW5nID0gdGhpcy5mb3Jtc0ZyYW1ld29yayA/IHRoaXMuZm9ybXNGcmFtZXdvcmsgOiAnbWF0ZXJpYWwtZGVzaWduJztcblxuICAvKipcbiAgICogfmV2ZW50IGNhc2VDaGFuZ2VkIDogQ2FzZSBhY3Rpb24gc3RhcnRlZCAocHJvY2VzcyBzdGFydGVkKVxuICAgKiB+cGF5bG9hZCBQcm9jZXNzSWQgOiBQcm9jZXNzSWQgb2JqZWN0IHBhc3NlZCB3aGVuIGEgY2FzZSBoYXMgYmVlbiB1cGRhdGVkIG9yIGNyZWF0ZWQgYnkgYSBwcm9jZXNzIChhY3Rpb24vY3JlYXRvcilcbiAgICovXG4gIEBPdXRwdXQoKSBjYXNlQ2hhbmdlZDogRXZlbnRFbWl0dGVyPFByb2Nlc3NJZD4gPSBuZXcgRXZlbnRFbWl0dGVyPFByb2Nlc3NJZD4oKTtcblxuICBkYXRhOiBhbnk7XG4gIHNjaGVtYTogYW55O1xuICBsYXlvdXQ6IGFueVtdO1xuICBvcHRpb25zOiBhbnk7XG4gIGlzQ3VzdG9tRm9ybSA9IGZhbHNlO1xuXG4gIGhhbmRsZVN1Ym1pdCA9IChkYXRhLCBjYXNlUmVmKSA9PiB7XG4gICAgLy8gaWYgbm9fcHJvY2Vzc19zdWJtaXQgdGhlbiBubyBuZWVkIHRvIHJ1biBwcm9jZXNzIGFzIHRoaXMgd2FzIGRvbmUgaW5zaWRlIGEgY3VzdG9tIGZvcm0gYXBwXG4gICAgaWYgKGRhdGEgIT09ICdOT19QUk9DRVNTX1NVQk1JVCcpIHtcbiAgICAgIC8vIHJ1biB0aGUgcHJvY2Vzc1xuICAgICAgdGhpcy5saXZlYXBwcy5ydW5Qcm9jZXNzKHRoaXMuc2FuZGJveElkLCB0aGlzLmFwcGxpY2F0aW9uSWQsIHRoaXMucHJvY2Vzcy5wcm9jZXNzLmlkLCBjYXNlUmVmLCBkYXRhKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICB0YWtlKDEpLFxuICAgICAgICAgIHRha2VVbnRpbCh0aGlzLl9kZXN0cm95ZWQkKVxuICAgICAgICApXG4gICAgICAgIC5zdWJzY3JpYmUocmVzcG9uc2UgPT4ge1xuICAgICAgICAgIGlmIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5kYXRhLmVycm9yTXNnKSB7XG4gICAgICAgICAgICAgIC8vIHBhcnNlIGRhdGEgdG8gb2JqZWN0XG4gICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEgPSBKU09OLnBhcnNlKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgICAvLyBjYXNlIGNyZWF0ZWQgc2VuZCBiYWNrIHJlc3BvbnNlIGluY2x1ZGluZyBjYXNlSWRlbnRpZmllciBpZiBvbmUgaXMgcHJlc2VudFxuICAgICAgICAgICAgICBsZXQgY2FzZUlkZW50aWZpZXI7XG4gICAgICAgICAgICAgIGxldCBjYXNlUmVmZXJlbmNlO1xuICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuY2FzZUlkZW50aWZpZXIpIHtcbiAgICAgICAgICAgICAgICBjYXNlSWRlbnRpZmllciA9IHJlc3BvbnNlLmNhc2VJZGVudGlmaWVyO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChyZXNwb25zZS5jYXNlUmVmZXJlbmNlKSB7XG4gICAgICAgICAgICAgICAgY2FzZVJlZmVyZW5jZSA9IHJlc3BvbnNlLmNhc2VSZWZlcmVuY2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29uc3QgcHJvY2Vzc1Jlc3BvbnNlID0gbmV3IFByb2Nlc3NJZCgpLmRlc2VyaWFsaXplKHsnY2FzZUlkZW50aWZpZXInOiBjYXNlSWRlbnRpZmllciwgJ2Nhc2VSZWZlcmVuY2UnOiBjYXNlUmVmZXJlbmNlfSk7XG4gICAgICAgICAgICAgIHRoaXMuY2FzZUNoYW5nZWQuZW1pdChwcm9jZXNzUmVzcG9uc2UpO1xuICAgICAgICAgICAgICB0aGlzLnNjaGVtYSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgdGhpcy5kYXRhID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICB0aGlzLmxheW91dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1VuYWJsZSB0byBydW4gY2FzZSBjcmVhdG9yJyk7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IocmVzcG9uc2UuZGF0YS5lcnJvck1zZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdVbmFibGUgdG8gcnVuIGNhc2UgY3JlYXRvcicpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBwcm9jZXNzUmVzcG9uc2UgPSBuZXcgUHJvY2Vzc0lkKCkuZGVzZXJpYWxpemUoeydjYXNlSWRlbnRpZmllcic6IHVuZGVmaW5lZCwgJ2Nhc2VSZWZlcmVuY2UnOiB1bmRlZmluZWR9KTtcbiAgICAgIHRoaXMuY2FzZUNoYW5nZWQuZW1pdChwcm9jZXNzUmVzcG9uc2UpO1xuICAgICAgdGhpcy5zY2hlbWEgPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLmRhdGEgPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLmxheW91dCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVMZWdhY3lQcm9jZXNzQ29tcGxldGUgPSAoKSA9PiB7XG4gICAgY29uc3QgcHJvY2Vzc1Jlc3BvbnNlID0gbmV3IFByb2Nlc3NJZCgpLmRlc2VyaWFsaXplKHsnY2FzZUlkZW50aWZpZXInOiB1bmRlZmluZWQsICdjYXNlUmVmZXJlbmNlJzogdW5kZWZpbmVkfSk7XG4gICAgdGhpcy5jYXNlQ2hhbmdlZC5lbWl0KHByb2Nlc3NSZXNwb25zZSk7XG4gIH1cblxuICBoYW5kbGVMZWdhY3lQcm9jZXNzQ2FuY2VsbGVkID0gKCkgPT4ge1xuICAgIC8vIC0xIGZvciBjYXNlUmVmZXJlbmNlIG1lYW5zIGNhbmNlbGxlZFxuICAgIGNvbnN0IHByb2Nlc3NSZXNwb25zZSA9IG5ldyBQcm9jZXNzSWQoKS5kZXNlcmlhbGl6ZSh7J2Nhc2VJZGVudGlmaWVyJzogdW5kZWZpbmVkLCAnY2FzZVJlZmVyZW5jZSc6ICctMSd9KTtcbiAgICB0aGlzLmNhc2VDaGFuZ2VkLmVtaXQocHJvY2Vzc1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBsaXZlYXBwczogTGl2ZUFwcHNTZXJ2aWNlKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMub3B0aW9ucyA9IHtcbiAgICAgIGRlZmF1bHRPcHRpb25zOiB7XG4gICAgICAgICdhcHBlYXJhbmNlJzogJ2xlZ2FjeSdcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIC8vIGhhbmRsZSBpbnB1dCBwYXJhbSBjaGFuZ2VzXG4gICAgaWYgKGNoYW5nZXMucHJvY2VzcyAmJiBjaGFuZ2VzLnByb2Nlc3MuY3VycmVudFZhbHVlICYmIChjaGFuZ2VzLnByb2Nlc3MuY3VycmVudFZhbHVlICE9PSBjaGFuZ2VzLnByb2Nlc3MucHJldmlvdXNWYWx1ZSkpIHtcbiAgICAgIGlmICh0aGlzLmN1c3RvbUZvcm1EZWZzICYmIHRoaXMuY3VzdG9tRm9ybURlZnMuY3VzdG9tRm9ybXMpIHtcbiAgICAgICAgdGhpcy5pc0N1c3RvbUZvcm0gPSAodGhpcy5jdXN0b21Gb3JtRGVmcy5jdXN0b21Gb3Jtcy5maW5kSW5kZXgoKGZvcm0pID0+IHtcbiAgICAgICAgICByZXR1cm4gKGZvcm0gPT09IHRoaXMucHJvY2Vzcy5yZWYpO1xuICAgICAgICB9KSAhPT0gLTEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5pc0N1c3RvbUZvcm0gPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmIChjaGFuZ2VzLnByb2Nlc3MuY3VycmVudFZhbHVlLnByb2Nlc3MuanNvblNjaGVtYS4kc2NoZW1hID09PSAnTk9TQ0hFTUEnKSB7XG4gICAgICAgIHRoaXMuc2NoZW1hID0gdW5kZWZpbmVkO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zY2hlbWEgPSBjaGFuZ2VzLnByb2Nlc3MuY3VycmVudFZhbHVlLnByb2Nlc3MuanNvblNjaGVtYTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGNoYW5nZXMuYXBwbGljYXRpb25JZCAmJiAoY2hhbmdlcy5hcHBsaWNhdGlvbklkLmN1cnJlbnRWYWx1ZSAhPT0gY2hhbmdlcy5hcHBsaWNhdGlvbklkLnByZXZpb3VzVmFsdWUpKSB7XG4gICAgICAvLyBhcHBJZCBoYXMgY2hhbmdlZDogbWFrZSBzdXJlIG5vIHByb2Nlc3Mgc2VsZWN0ZWQvZm9ybSBkaXNwbGF5ZWRcbiAgICAgIHRoaXMucHJvY2VzcyA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgaWYgKGNoYW5nZXMubGF5b3V0ICYmIChjaGFuZ2VzLmxheW91dC5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXMubGF5b3V0LnByZXZpb3VzVmFsdWUpKSB7XG4gICAgICB0aGlzLmxheW91dCA9IGNoYW5nZXMubGF5b3V0LmN1cnJlbnRWYWx1ZTtcbiAgICB9XG4gICAgaWYgKGNoYW5nZXMuZGF0YU92ZXJyaWRlICYmIChjaGFuZ2VzLmRhdGFPdmVycmlkZS5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXMuZGF0YU92ZXJyaWRlLnByZXZpb3VzVmFsdWUpKSB7XG4gICAgICB0aGlzLmRhdGEgPSB0aGlzLmRhdGFPdmVycmlkZTtcbiAgICB9XG4gIH1cblxufVxuIl19