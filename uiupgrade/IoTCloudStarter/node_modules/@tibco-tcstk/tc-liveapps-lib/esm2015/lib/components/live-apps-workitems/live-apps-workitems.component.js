/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { take, takeUntil } from 'rxjs/operators';
import { LiveAppsComponent } from '../live-apps-component/live-apps-component.component';
import { TcCoreCommonFunctions } from '@tibco-tcstk/tc-core-lib';
import { TcWorkitemsService } from '../../services/tc-workitems.service';
/**
 * Workitems widget, this Component lists workitems.
 *
 *
 * ![alt-text](../live-apps-workitems.png "")
 *
 * \@example <tcla-live-apps-workitems></tcla-live-apps-workitems>
 */
export class LiveAppsWorkitemsComponent extends LiveAppsComponent {
    /**
     * @param {?} workitemsService
     */
    constructor(workitemsService) {
        super();
        this.workitemsService = workitemsService;
        /**
         * case card format - list, card, miniCard, staticList (no click event)
         */
        this.displayType = this.displayType ? this.displayType : 'wiMiniCard'; // miniCard, card, list
        // miniCard, card, list
        /**
         * Whether to show the header bar in the widget - eg. favorites on home page (contains icon etc) - if off icons still appear without bar
         */
        this.showHeader = this.showHeader ? this.showHeader : true;
        /**
         * ~event clickCase : Case clicked
         * ~payload CaseRoute : CaseRoute object output when case is clicked so calling component can route accordingly - ie. route to case
         */
        this.clickCase = new EventEmitter();
        this.clickWorkitemAction = (/**
         * @param {?} caseRoute
         * @return {?}
         */
        (caseRoute) => {
            this.clickCase.emit(caseRoute);
        });
        this.refresh = (/**
         * @return {?}
         */
        () => {
            this.workitems = [];
            this.workitemsService.getWorkitems(this.sandboxId, this.appIds, this.caseRef, 0, 20)
                .pipe(take(1), takeUntil(this._destroyed$)).subscribe((/**
             * @param {?} next
             * @return {?}
             */
            next => {
                this.workitems = next || [];
            }), (/**
             * @param {?} error
             * @return {?}
             */
            error => { this.errorMessage = 'Error retrieving workitems: ' + error.error.errorMsg; }));
        });
        this.handleDeleted = (/**
         * @param {?} caseRef
         * @param {?} workitemId
         * @return {?}
         */
        (caseRef, workitemId) => {
            this.workitems.splice(this.workitems.findIndex(((/**
             * @param {?} wi
             * @return {?}
             */
            function (wi) {
                console.warn('Workitem: ', workitemId + ' for case: ' + caseRef + ' not shown as case deleted');
                return wi.header.itemContext.caseRef === caseRef;
            }))), 1);
        });
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        super.ngAfterViewInit();
        this.cardWidthPct = TcCoreCommonFunctions.calcSummaryCardPct(this.widget);
        this.containerChanges$.subscribe((/**
         * @param {?} widget
         * @return {?}
         */
        widget => {
            this.cardWidthPct = TcCoreCommonFunctions.calcSummaryCardPct(widget);
        }));
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        super.ngOnInit();
        this.refresh();
    }
}
LiveAppsWorkitemsComponent.decorators = [
    { type: Component, args: [{
                selector: 'tcla-live-apps-workitems',
                template: "<div #componentDiv class=\"tcs-case-recent-box\" fxLayout=\"column\" fxFill>\n  <div *ngIf=\"showHeader\" class=\"tcs-case-recent-header\" fxLayout=\"row\" fxLayoutAlign=\"space-between center\">\n    <div fxLayoutAlign=\"start center\">\n      <mat-icon class=\"tcs-icon tcs-recent-icon\" svgIcon=\"tcs-recent-icon\"></mat-icon>\n      <div class=\"tcs-case-recent-header-text\">Workitems</div>\n    </div>\n  </div>\n  <div *ngIf=\"!showHeader\" fxLayout=\"row\" fxLayoutAlign=\"end center\">\n  </div>\n  <div *ngIf=\"workitems.length > 0\"class=\"tcs-case-recent-flow-list\" fxLayout=\"column\" fxLayout=\"row wrap\">\n    <div class=\"tcs-case-recent-item-box\" *ngFor=\"let workitem of workitems\" [fxFlex]=\"cardWidthPct\">\n      <tcla-live-apps-case-summary [uiAppId]=\"uiAppId\" [typeBar]=\"true\" [borderCard]=\"false\" [displayType]=\"displayType\" [sandboxId]=\"sandboxId\" [caseRef]=\"workitem.header.itemContext.caseRef\" [description]=\"workitem.header.description\" [workitemId]=\"workitem.id\" (clickCase)=\"clickWorkitemAction($event)\" (deleted)=\"handleDeleted($event, workitem.id)\"></tcla-live-apps-case-summary>\n      <div class=\"tcs-case-recent-line\"></div>\n    </div>\n  </div>\n  <div *ngIf=\"!(workitems.length > 0)\" fxLayout=\"row\" fxLayoutAlign=\"center start\" fxLayoutGap=\"10px\" style=\"margin: 20px;\">\n    <mat-icon [svgIcon]=\"'ic-no-cases-icon'\" style=\"height: 48px; width: 48px;\"></mat-icon>\n    <div style=\"height: 100%\" fxLayoutAlign=\"start center\">\n      <span class=\"tcs-no-item-text\">No workitems found</span>\n    </div>\n  </div>\n</div>\n",
                styles: [".tcs-case-recent-box{border-radius:3px;box-shadow:0 2px 8px 0 #dedede;background-color:#fff}.tcs-case-recent-header{min-height:40px;border-radius:3px 3px 0 0;box-shadow:0 1px 2px 0 #dedede;padding-left:20px;padding-right:20px}.tcs-case-recent-header-text{font-family:Source Sans Pro;font-size:18px;font-weight:600;font-style:normal;font-stretch:normal;line-height:1.5;letter-spacing:.3px;text-align:left;color:#000;margin-left:10px}.tcs-case-recent-flow-list{margin:24px;overflow-y:auto}.tcs-case-recent-item-box{padding:2px}.tcs-icon.tcs-icon-active:hover{cursor:pointer}:host ::ng-deep .tcs-icon.tcs-icon-active:hover .svg-content{fill:#0081cb}.tcs-case-recent-line{padding:0;margin:4px 5px 0;border-bottom:1.1px solid #f4f4f4}.tcs-no-item-text{font-family:Source Sans Pro;font-size:16px;font-weight:400;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:normal;color:#b6b6b6}"]
            }] }
];
/** @nocollapse */
LiveAppsWorkitemsComponent.ctorParameters = () => [
    { type: TcWorkitemsService }
];
LiveAppsWorkitemsComponent.propDecorators = {
    sandboxId: [{ type: Input }],
    uiAppId: [{ type: Input }],
    appIds: [{ type: Input }],
    caseRef: [{ type: Input }],
    displayType: [{ type: Input }],
    showHeader: [{ type: Input }],
    clickCase: [{ type: Output }],
    componentDiv: [{ type: ViewChild, args: ['componentDiv', { static: false },] }]
};
if (false) {
    /**
     * sandboxId - this comes from claims resolver
     * @type {?}
     */
    LiveAppsWorkitemsComponent.prototype.sandboxId;
    /**
     * The Application ID of the UI (should ideally be unique as it is shared state key)
     * @type {?}
     */
    LiveAppsWorkitemsComponent.prototype.uiAppId;
    /**
     * The list of LA Application IDs you want to handle
     * @type {?}
     */
    LiveAppsWorkitemsComponent.prototype.appIds;
    /**
     * The caseRef for which to display workitems
     * @type {?}
     */
    LiveAppsWorkitemsComponent.prototype.caseRef;
    /**
     * case card format - list, card, miniCard, staticList (no click event)
     * @type {?}
     */
    LiveAppsWorkitemsComponent.prototype.displayType;
    /**
     * Whether to show the header bar in the widget - eg. favorites on home page (contains icon etc) - if off icons still appear without bar
     * @type {?}
     */
    LiveAppsWorkitemsComponent.prototype.showHeader;
    /**
     * ~event clickCase : Case clicked
     * ~payload CaseRoute : CaseRoute object output when case is clicked so calling component can route accordingly - ie. route to case
     * @type {?}
     */
    LiveAppsWorkitemsComponent.prototype.clickCase;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.componentDiv;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.workitems;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.errorMessage;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.widget;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.cardWidthPct;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.clickWorkitemAction;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.refresh;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.handleDeleted;
    /**
     * @type {?}
     * @protected
     */
    LiveAppsWorkitemsComponent.prototype.workitemsService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLXdvcmtpdGVtcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdGliY28tdGNzdGsvdGMtbGl2ZWFwcHMtbGliLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvbGl2ZS1hcHBzLXdvcmtpdGVtcy9saXZlLWFwcHMtd29ya2l0ZW1zLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEVBQ04sU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQyxJQUFJLEVBQUUsU0FBUyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFFL0MsT0FBTyxFQUFDLGlCQUFpQixFQUFDLE1BQU0sc0RBQXNELENBQUM7QUFDdkYsT0FBTyxFQUFjLHFCQUFxQixFQUFDLE1BQU0sMEJBQTBCLENBQUM7QUFDNUUsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0scUNBQXFDLENBQUM7Ozs7Ozs7OztBQWdCdkUsTUFBTSxPQUFPLDBCQUEyQixTQUFRLGlCQUFpQjs7OztJQW9FL0QsWUFBc0IsZ0JBQW9DO1FBQ3hELEtBQUssRUFBRSxDQUFDO1FBRFkscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFvQjs7OztRQTVDakQsZ0JBQVcsR0FBVyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyx1QkFBdUI7Ozs7O1FBSWpHLGVBQVUsR0FBWSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7Ozs7O1FBUTlELGNBQVMsR0FBNEIsSUFBSSxZQUFZLEVBQWEsQ0FBQztRQVN0RSx3QkFBbUI7Ozs7UUFBRyxDQUFDLFNBQW9CLEVBQUUsRUFBRTtZQUNwRCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNqQyxDQUFDLEVBQUE7UUFFTSxZQUFPOzs7UUFBRyxHQUFHLEVBQUU7WUFDcEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7WUFDcEIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUNqRixJQUFJLENBQ0gsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNQLFNBQVMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQzVCLENBQUMsU0FBUzs7OztZQUNYLElBQUksQ0FBQyxFQUFFO2dCQUNMLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUM5QixDQUFDOzs7O1lBQUUsS0FBSyxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsWUFBWSxHQUFHLDhCQUE4QixHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFDLENBQUM7UUFDaEcsQ0FBQyxFQUFBO1FBRU0sa0JBQWE7Ozs7O1FBQUcsQ0FBQyxPQUFlLEVBQUUsVUFBa0IsRUFBRSxFQUFFO1lBQzdELElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDOzs7O1lBQUMsVUFBUyxFQUFFO2dCQUN2RCxPQUFPLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxVQUFVLEdBQUcsYUFBYSxHQUFHLE9BQU8sR0FBRyw0QkFBNEIsQ0FBQyxDQUFDO2dCQUNoRyxPQUFPLEVBQUUsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLE9BQU8sS0FBSyxPQUFPLENBQUM7WUFDbkQsQ0FBQyxFQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNaLENBQUMsRUFBQTtJQUlELENBQUM7Ozs7SUFFRCxlQUFlO1FBQ2IsS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxZQUFZLEdBQUcscUJBQXFCLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTOzs7O1FBQUMsTUFBTSxDQUFDLEVBQUU7WUFDeEMsSUFBSSxDQUFDLFlBQVksR0FBRyxxQkFBcUIsQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN2RSxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7SUFFRCxRQUFRO1FBQ04sS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNqQixDQUFDOzs7WUF4RkYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSwwQkFBMEI7Z0JBQ3BDLCtrREFBbUQ7O2FBRXBEOzs7O1lBZk8sa0JBQWtCOzs7d0JBb0J2QixLQUFLO3NCQUtMLEtBQUs7cUJBS0wsS0FBSztzQkFLTCxLQUFLOzBCQUtMLEtBQUs7eUJBSUwsS0FBSzt3QkFRTCxNQUFNOzJCQUVOLFNBQVMsU0FBQyxjQUFjLEVBQUUsRUFBQyxNQUFNLEVBQUUsS0FBSyxFQUFDOzs7Ozs7O0lBbEMxQywrQ0FBMkI7Ozs7O0lBSzNCLDZDQUF5Qjs7Ozs7SUFLekIsNENBQTBCOzs7OztJQUsxQiw2Q0FBeUI7Ozs7O0lBS3pCLGlEQUFrRjs7Ozs7SUFJbEYsZ0RBQXdFOzs7Ozs7SUFReEUsK0NBQTZFOztJQUU3RSxrREFBcUU7O0lBRXJFLCtDQUE2Qjs7SUFDN0Isa0RBQTRCOztJQUM1Qiw0Q0FBMkI7O0lBQzNCLGtEQUE0Qjs7SUFFNUIseURBRUM7O0lBRUQsNkNBVUM7O0lBRUQsbURBS0M7Ozs7O0lBRVcsc0RBQThDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgVmlld0NoaWxkXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHt0YWtlLCB0YWtlVW50aWx9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7Q2FzZVJvdXRlfSBmcm9tICcuLi8uLi9tb2RlbHMvbGl2ZWFwcHNkYXRhJztcbmltcG9ydCB7TGl2ZUFwcHNDb21wb25lbnR9IGZyb20gJy4uL2xpdmUtYXBwcy1jb21wb25lbnQvbGl2ZS1hcHBzLWNvbXBvbmVudC5jb21wb25lbnQnO1xuaW1wb3J0IHtUY0NvbXBvbmVudCwgVGNDb3JlQ29tbW9uRnVuY3Rpb25zfSBmcm9tICdAdGliY28tdGNzdGsvdGMtY29yZS1saWInO1xuaW1wb3J0IHtUY1dvcmtpdGVtc1NlcnZpY2V9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3RjLXdvcmtpdGVtcy5zZXJ2aWNlJztcbmltcG9ydCB7V29ya2l0ZW19IGZyb20gJy4uLy4uL21vZGVscy90Yy13b3JraXRlbXMnO1xuXG4vKipcbiAqIFdvcmtpdGVtcyB3aWRnZXQsIHRoaXMgQ29tcG9uZW50IGxpc3RzIHdvcmtpdGVtcy5cbiAqXG4gKlxuICogIVthbHQtdGV4dF0oLi4vbGl2ZS1hcHBzLXdvcmtpdGVtcy5wbmcgXCJcIilcbiAqXG4gKkBleGFtcGxlIDx0Y2xhLWxpdmUtYXBwcy13b3JraXRlbXM+PC90Y2xhLWxpdmUtYXBwcy13b3JraXRlbXM+XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RjbGEtbGl2ZS1hcHBzLXdvcmtpdGVtcycsXG4gIHRlbXBsYXRlVXJsOiAnLi9saXZlLWFwcHMtd29ya2l0ZW1zLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbGl2ZS1hcHBzLXdvcmtpdGVtcy5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgTGl2ZUFwcHNXb3JraXRlbXNDb21wb25lbnQgZXh0ZW5kcyBMaXZlQXBwc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XG4gIC8qKlxuICAgKiBzYW5kYm94SWQgLSB0aGlzIGNvbWVzIGZyb20gY2xhaW1zIHJlc29sdmVyXG4gICAqL1xuICBASW5wdXQoKSBzYW5kYm94SWQ6IG51bWJlcjtcblxuICAvKipcbiAgICogVGhlIEFwcGxpY2F0aW9uIElEIG9mIHRoZSBVSSAoc2hvdWxkIGlkZWFsbHkgYmUgdW5pcXVlIGFzIGl0IGlzIHNoYXJlZCBzdGF0ZSBrZXkpXG4gICAqL1xuICBASW5wdXQoKSB1aUFwcElkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBsaXN0IG9mIExBIEFwcGxpY2F0aW9uIElEcyB5b3Ugd2FudCB0byBoYW5kbGVcbiAgICovXG4gIEBJbnB1dCgpIGFwcElkczogc3RyaW5nW107XG5cbiAgLyoqXG4gICAqIFRoZSBjYXNlUmVmIGZvciB3aGljaCB0byBkaXNwbGF5IHdvcmtpdGVtc1xuICAgKi9cbiAgQElucHV0KCkgY2FzZVJlZjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBjYXNlIGNhcmQgZm9ybWF0IC0gbGlzdCwgY2FyZCwgbWluaUNhcmQsIHN0YXRpY0xpc3QgKG5vIGNsaWNrIGV2ZW50KVxuICAgKi9cbiAgQElucHV0KCkgZGlzcGxheVR5cGU6IHN0cmluZyA9IHRoaXMuZGlzcGxheVR5cGUgPyB0aGlzLmRpc3BsYXlUeXBlIDogJ3dpTWluaUNhcmQnOyAvLyBtaW5pQ2FyZCwgY2FyZCwgbGlzdFxuICAvKipcbiAgICogV2hldGhlciB0byBzaG93IHRoZSBoZWFkZXIgYmFyIGluIHRoZSB3aWRnZXQgLSBlZy4gZmF2b3JpdGVzIG9uIGhvbWUgcGFnZSAoY29udGFpbnMgaWNvbiBldGMpIC0gaWYgb2ZmIGljb25zIHN0aWxsIGFwcGVhciB3aXRob3V0IGJhclxuICAgKi9cbiAgQElucHV0KCkgc2hvd0hlYWRlcjogYm9vbGVhbiA9IHRoaXMuc2hvd0hlYWRlciA/IHRoaXMuc2hvd0hlYWRlciA6IHRydWU7XG5cblxuXG4gIC8qKlxuICAgKiB+ZXZlbnQgY2xpY2tDYXNlIDogQ2FzZSBjbGlja2VkXG4gICAqIH5wYXlsb2FkIENhc2VSb3V0ZSA6IENhc2VSb3V0ZSBvYmplY3Qgb3V0cHV0IHdoZW4gY2FzZSBpcyBjbGlja2VkIHNvIGNhbGxpbmcgY29tcG9uZW50IGNhbiByb3V0ZSBhY2NvcmRpbmdseSAtIGllLiByb3V0ZSB0byBjYXNlXG4gICAqL1xuICBAT3V0cHV0KCkgY2xpY2tDYXNlOiBFdmVudEVtaXR0ZXI8Q2FzZVJvdXRlPiA9IG5ldyBFdmVudEVtaXR0ZXI8Q2FzZVJvdXRlPigpO1xuXG4gIEBWaWV3Q2hpbGQoJ2NvbXBvbmVudERpdicsIHtzdGF0aWM6IGZhbHNlfSkgY29tcG9uZW50RGl2OiBFbGVtZW50UmVmO1xuXG4gIHB1YmxpYyB3b3JraXRlbXM6IFdvcmtpdGVtW107XG4gIHB1YmxpYyBlcnJvck1lc3NhZ2U6IHN0cmluZztcbiAgcHVibGljIHdpZGdldDogVGNDb21wb25lbnQ7XG4gIHB1YmxpYyBjYXJkV2lkdGhQY3Q6IE51bWJlcjtcblxuICBwdWJsaWMgY2xpY2tXb3JraXRlbUFjdGlvbiA9IChjYXNlUm91dGU6IENhc2VSb3V0ZSkgPT4ge1xuICAgIHRoaXMuY2xpY2tDYXNlLmVtaXQoY2FzZVJvdXRlKTtcbiAgfVxuXG4gIHB1YmxpYyByZWZyZXNoID0gKCkgPT4ge1xuICAgIHRoaXMud29ya2l0ZW1zID0gW107XG4gICAgdGhpcy53b3JraXRlbXNTZXJ2aWNlLmdldFdvcmtpdGVtcyh0aGlzLnNhbmRib3hJZCwgdGhpcy5hcHBJZHMsIHRoaXMuY2FzZVJlZiwgMCwgMjApXG4gICAgICAucGlwZShcbiAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCQpXG4gICAgICApLnN1YnNjcmliZShcbiAgICAgIG5leHQgPT4ge1xuICAgICAgICB0aGlzLndvcmtpdGVtcyA9IG5leHQgfHwgW107XG4gICAgICB9LCBlcnJvciA9PiB7IHRoaXMuZXJyb3JNZXNzYWdlID0gJ0Vycm9yIHJldHJpZXZpbmcgd29ya2l0ZW1zOiAnICsgZXJyb3IuZXJyb3IuZXJyb3JNc2c7IH0pO1xuICB9XG5cbiAgcHVibGljIGhhbmRsZURlbGV0ZWQgPSAoY2FzZVJlZjogc3RyaW5nLCB3b3JraXRlbUlkOiBzdHJpbmcpID0+IHtcbiAgICB0aGlzLndvcmtpdGVtcy5zcGxpY2UodGhpcy53b3JraXRlbXMuZmluZEluZGV4KChmdW5jdGlvbih3aSkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1dvcmtpdGVtOiAnLCB3b3JraXRlbUlkICsgJyBmb3IgY2FzZTogJyArIGNhc2VSZWYgKyAnIG5vdCBzaG93biBhcyBjYXNlIGRlbGV0ZWQnKTtcbiAgICAgICAgcmV0dXJuIHdpLmhlYWRlci5pdGVtQ29udGV4dC5jYXNlUmVmID09PSBjYXNlUmVmO1xuICAgICAgfSkpLCAxKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCB3b3JraXRlbXNTZXJ2aWNlOiBUY1dvcmtpdGVtc1NlcnZpY2UpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHN1cGVyLm5nQWZ0ZXJWaWV3SW5pdCgpO1xuICAgIHRoaXMuY2FyZFdpZHRoUGN0ID0gVGNDb3JlQ29tbW9uRnVuY3Rpb25zLmNhbGNTdW1tYXJ5Q2FyZFBjdCh0aGlzLndpZGdldCk7XG4gICAgdGhpcy5jb250YWluZXJDaGFuZ2VzJC5zdWJzY3JpYmUod2lkZ2V0ID0+IHtcbiAgICAgIHRoaXMuY2FyZFdpZHRoUGN0ID0gVGNDb3JlQ29tbW9uRnVuY3Rpb25zLmNhbGNTdW1tYXJ5Q2FyZFBjdCh3aWRnZXQpO1xuICAgIH0pO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgc3VwZXIubmdPbkluaXQoKTtcbiAgICB0aGlzLnJlZnJlc2goKTtcbiAgfVxuXG59XG4iXX0=