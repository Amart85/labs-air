/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { RouteAccessControlConfig } from '../models/tc-groups-data';
import { TcCoreCommonFunctions, TcSharedStateService, SharedStateContent, SharedStateEntry, SharedStateList } from '@tibco-tcstk/tc-core-lib';
import { HttpClient } from '@angular/common/http';
import { map } from 'rxjs/operators';
import { Location } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@angular/common";
import * as i3 from "@tibco-tcstk/tc-core-lib";
export class TcAccessControlService {
    /**
     * @param {?} http
     * @param {?} location
     * @param {?} sharedStateService
     */
    constructor(http, location, sharedStateService) {
        this.http = http;
        this.location = location;
        this.sharedStateService = sharedStateService;
    }
    /**
     * @param {?} sandboxId
     * @param {?} uiAppId
     * @param {?} accessControlConfig
     * @return {?}
     */
    createLAccessControlConfig(sandboxId, uiAppId, accessControlConfig) {
        /** @type {?} */
        const ssName = uiAppId + '.accesscontrol.config.tibcolabs.client.context.PUBLIC';
        /** @type {?} */
        const content = new SharedStateContent();
        content.json = TcCoreCommonFunctions.escapeString(JSON.stringify(accessControlConfig));
        return this.sharedStateService.createSharedState(ssName, 'PUBLIC', '', sandboxId, undefined, undefined, undefined, content)
            .pipe(map((/**
         * @param {?} value
         * @return {?}
         */
        value => value)));
    }
    /**
     * @param {?} uiAppId
     * @param {?} useCache
     * @param {?} flushCache
     * @return {?}
     */
    getAccessControlConfig(uiAppId, useCache, flushCache) {
        // if useCache is false this will trigger the service to update the cached version with latest
        /** @type {?} */
        const ssName = uiAppId + '.accesscontrol.config.tibcolabs.client.context.PUBLIC';
        return this.sharedStateService.getSharedState(ssName, 'PUBLIC', useCache, flushCache)
            .pipe(map((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            if (value.sharedStateEntries.length > 0) {
                /** @type {?} */
                const ssresult = new RouteAccessControlConfig().deserialize(JSON.parse(value.sharedStateEntries[0].content.json));
                ssresult.id = value.sharedStateEntries[0].id;
                return ssresult;
            }
            else {
                return undefined;
            }
        })));
    }
    /**
     * @param {?} sandboxId
     * @param {?} uiAppId
     * @param {?} accessControlConfig
     * @param {?} id
     * @return {?}
     */
    updateAccessControlConfig(sandboxId, uiAppId, accessControlConfig, id) {
        /** @type {?} */
        const ssName = uiAppId + '.accesscontrol.config.tibcolabs.client.context.PUBLIC';
        /** @type {?} */
        const content = new SharedStateContent();
        content.json = TcCoreCommonFunctions.escapeString(JSON.stringify(accessControlConfig));
        /** @type {?} */
        const entry = new SharedStateEntry();
        entry.content = content;
        entry.sandboxId = sandboxId;
        entry.name = ssName;
        entry.type = 'PUBLIC';
        entry.id = id;
        /** @type {?} */
        const ssList = new SharedStateList();
        ssList.sharedStateEntries = [];
        ssList.sharedStateEntries.push(entry);
        return this.sharedStateService.updateSharedState(ssList.sharedStateEntries)
            .pipe(map((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            // flush the cache
            this.getAccessControlConfig(uiAppId, true, true).subscribe();
            return new RouteAccessControlConfig().deserialize((JSON.parse(value.sharedStateEntries[0].content.json)));
        })));
    }
}
TcAccessControlService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
TcAccessControlService.ctorParameters = () => [
    { type: HttpClient },
    { type: Location },
    { type: TcSharedStateService }
];
/** @nocollapse */ TcAccessControlService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function TcAccessControlService_Factory() { return new TcAccessControlService(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Location), i0.ɵɵinject(i3.TcSharedStateService)); }, token: TcAccessControlService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    TcAccessControlService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    TcAccessControlService.prototype.location;
    /**
     * @type {?}
     * @private
     */
    TcAccessControlService.prototype.sharedStateService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGMtYWNjZXNzLWNvbnRyb2wuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0aWJjby10Y3N0ay90Yy1saXZlYXBwcy1saWIvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvdGMtYWNjZXNzLWNvbnRyb2wuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNwRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsb0JBQW9CLEVBQUUsa0JBQWtCLEVBQUUsZ0JBQWdCLEVBQUUsZUFBZSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDOUksT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRWxELE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7Ozs7O0FBSzNDLE1BQU0sT0FBTyxzQkFBc0I7Ozs7OztJQUUvQixZQUNZLElBQWdCLEVBQ2hCLFFBQWtCLEVBQ2xCLGtCQUF3QztRQUZ4QyxTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2hCLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFzQjtJQUNoRCxDQUFDOzs7Ozs7O0lBRUUsMEJBQTBCLENBQUMsU0FBaUIsRUFBRSxPQUFlLEVBQUUsbUJBQTZDOztjQUN6RyxNQUFNLEdBQUcsT0FBTyxHQUFHLHVEQUF1RDs7Y0FDMUUsT0FBTyxHQUF1QixJQUFJLGtCQUFrQixFQUFFO1FBQzVELE9BQU8sQ0FBQyxJQUFJLEdBQUcscUJBQXFCLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDO1FBRXZGLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFD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QixvREFBZ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSb3V0ZUFjY2Vzc0NvbnRyb2xDb25maWcgfSBmcm9tICcuLi9tb2RlbHMvdGMtZ3JvdXBzLWRhdGEnO1xuaW1wb3J0IHsgVGNDb3JlQ29tbW9uRnVuY3Rpb25zLCBUY1NoYXJlZFN0YXRlU2VydmljZSwgU2hhcmVkU3RhdGVDb250ZW50LCBTaGFyZWRTdGF0ZUVudHJ5LCBTaGFyZWRTdGF0ZUxpc3QgfSBmcm9tICdAdGliY28tdGNzdGsvdGMtY29yZS1saWInO1xuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IExvY2F0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBUY0FjY2Vzc0NvbnRyb2xTZXJ2aWNlIHtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXG4gICAgICAgIHByaXZhdGUgbG9jYXRpb246IExvY2F0aW9uLFxuICAgICAgICBwcml2YXRlIHNoYXJlZFN0YXRlU2VydmljZTogVGNTaGFyZWRTdGF0ZVNlcnZpY2VcbiAgICApIHsgfVxuXG4gICAgcHVibGljIGNyZWF0ZUxBY2Nlc3NDb250cm9sQ29uZmlnKHNhbmRib3hJZDogbnVtYmVyLCB1aUFwcElkOiBzdHJpbmcsIGFjY2Vzc0NvbnRyb2xDb25maWc6IFJvdXRlQWNjZXNzQ29udHJvbENvbmZpZykge1xuICAgICAgICBjb25zdCBzc05hbWUgPSB1aUFwcElkICsgJy5hY2Nlc3Njb250cm9sLmNvbmZpZy50aWJjb2xhYnMuY2xpZW50LmNvbnRleHQuUFVCTElDJztcbiAgICAgICAgY29uc3QgY29udGVudDogU2hhcmVkU3RhdGVDb250ZW50ID0gbmV3IFNoYXJlZFN0YXRlQ29udGVudCgpO1xuICAgICAgICBjb250ZW50Lmpzb24gPSBUY0NvcmVDb21tb25GdW5jdGlvbnMuZXNjYXBlU3RyaW5nKEpTT04uc3RyaW5naWZ5KGFjY2Vzc0NvbnRyb2xDb25maWcpKTtcblxuICAgICAgICByZXR1cm4gdGhpcy5zaGFyZWRTdGF0ZVNlcnZpY2UuY3JlYXRlU2hhcmVkU3RhdGUoc3NOYW1lLCAnUFVCTElDJywgJycsIHNhbmRib3hJZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgY29udGVudClcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIG1hcCh2YWx1ZSA9PiB2YWx1ZSlcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldEFjY2Vzc0NvbnRyb2xDb25maWcodWlBcHBJZDogc3RyaW5nLCB1c2VDYWNoZTogYm9vbGVhbiwgZmx1c2hDYWNoZTogYm9vbGVhbik6IE9ic2VydmFibGU8Um91dGVBY2Nlc3NDb250cm9sQ29uZmlnPiB7XG4gICAgICAgIC8vIGlmIHVzZUNhY2hlIGlzIGZhbHNlIHRoaXMgd2lsbCB0cmlnZ2VyIHRoZSBzZXJ2aWNlIHRvIHVwZGF0ZSB0aGUgY2FjaGVkIHZlcnNpb24gd2l0aCBsYXRlc3RcbiAgICAgICAgY29uc3Qgc3NOYW1lID0gdWlBcHBJZCArICcuYWNjZXNzY29udHJvbC5jb25maWcudGliY29sYWJzLmNsaWVudC5jb250ZXh0LlBVQkxJQyc7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuc2hhcmVkU3RhdGVTZXJ2aWNlLmdldFNoYXJlZFN0YXRlKHNzTmFtZSwgJ1BVQkxJQycsIHVzZUNhY2hlLCBmbHVzaENhY2hlKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKHZhbHVlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnNoYXJlZFN0YXRlRW50cmllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzc3Jlc3VsdCA9IG5ldyBSb3V0ZUFjY2Vzc0NvbnRyb2xDb25maWcoKS5kZXNlcmlhbGl6ZShKU09OLnBhcnNlKHZhbHVlLnNoYXJlZFN0YXRlRW50cmllc1swXS5jb250ZW50Lmpzb24pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNzcmVzdWx0LmlkID0gdmFsdWUuc2hhcmVkU3RhdGVFbnRyaWVzWzBdLmlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNzcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgIH1cblxuICAgIHB1YmxpYyB1cGRhdGVBY2Nlc3NDb250cm9sQ29uZmlnKHNhbmRib3hJZDogbnVtYmVyLCB1aUFwcElkOiBzdHJpbmcsIGFjY2Vzc0NvbnRyb2xDb25maWc6IFJvdXRlQWNjZXNzQ29udHJvbENvbmZpZywgaWQ6IHN0cmluZykge1xuICAgICAgICBjb25zdCBzc05hbWUgPSB1aUFwcElkICsgJy5hY2Nlc3Njb250cm9sLmNvbmZpZy50aWJjb2xhYnMuY2xpZW50LmNvbnRleHQuUFVCTElDJztcbiAgICAgICAgY29uc3QgY29udGVudDogU2hhcmVkU3RhdGVDb250ZW50ID0gbmV3IFNoYXJlZFN0YXRlQ29udGVudCgpO1xuICAgICAgICBjb250ZW50Lmpzb24gPSBUY0NvcmVDb21tb25GdW5jdGlvbnMuZXNjYXBlU3RyaW5nKEpTT04uc3RyaW5naWZ5KGFjY2Vzc0NvbnRyb2xDb25maWcpKTtcbiAgICAgICAgY29uc3QgZW50cnk6IFNoYXJlZFN0YXRlRW50cnkgPSBuZXcgU2hhcmVkU3RhdGVFbnRyeSgpO1xuICAgICAgICBlbnRyeS5jb250ZW50ID0gY29udGVudDtcbiAgICAgICAgZW50cnkuc2FuZGJveElkID0gc2FuZGJveElkO1xuICAgICAgICBlbnRyeS5uYW1lID0gc3NOYW1lO1xuICAgICAgICBlbnRyeS50eXBlID0gJ1BVQkxJQyc7XG4gICAgICAgIGVudHJ5LmlkID0gaWQ7XG4gICAgICAgIGNvbnN0IHNzTGlzdDogU2hhcmVkU3RhdGVMaXN0ID0gbmV3IFNoYXJlZFN0YXRlTGlzdCgpO1xuICAgICAgICBzc0xpc3Quc2hhcmVkU3RhdGVFbnRyaWVzID0gW107XG4gICAgICAgIHNzTGlzdC5zaGFyZWRTdGF0ZUVudHJpZXMucHVzaChlbnRyeSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuc2hhcmVkU3RhdGVTZXJ2aWNlLnVwZGF0ZVNoYXJlZFN0YXRlKHNzTGlzdC5zaGFyZWRTdGF0ZUVudHJpZXMpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBtYXAodmFsdWUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBmbHVzaCB0aGUgY2FjaGVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRBY2Nlc3NDb250cm9sQ29uZmlnKHVpQXBwSWQsIHRydWUsIHRydWUpLnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJvdXRlQWNjZXNzQ29udHJvbENvbmZpZygpLmRlc2VyaWFsaXplKChKU09OLnBhcnNlKHZhbHVlLnNoYXJlZFN0YXRlRW50cmllc1swXS5jb250ZW50Lmpzb24pKSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gICAgfVxufVxuXG4iXX0=