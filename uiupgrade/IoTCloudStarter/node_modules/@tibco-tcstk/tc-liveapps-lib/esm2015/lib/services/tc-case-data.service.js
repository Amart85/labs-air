/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { zip } from 'rxjs';
import { CaseInfo } from '../models/liveappsdata';
import { LiveAppsService } from './live-apps.service';
import { HttpClient } from '@angular/common/http';
import { CaseInfoWithSchema, PurgeResult } from '../models/tc-case-data';
import { map, tap } from 'rxjs/operators';
import { TcCaseCardConfigService } from './tc-case-card-config.service';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "./live-apps.service";
import * as i3 from "./tc-case-card-config.service";
export class TcCaseDataService {
    /**
     * @param {?} http
     * @param {?} liveAppsService
     * @param {?} caseCardConfigService
     */
    constructor(http, liveAppsService, caseCardConfigService) {
        this.http = http;
        this.liveAppsService = liveAppsService;
        this.caseCardConfigService = caseCardConfigService;
    }
    /**
     * @param {?} caseRef
     * @param {?} sandboxId
     * @return {?}
     */
    getCaseState(caseRef, sandboxId) {
        /** @type {?} */
        const url = '/case/v1/cases/' + caseRef + '/' + '?$sandbox=' + sandboxId + '&$select=s';
        return this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} caseinfo
         * @return {?}
         */
        caseinfo => {
            /** @type {?} */
            const caseinf = new CaseInfo().deserialize(caseinfo);
            /** @type {?} */
            const state = caseinf.summaryObj.state;
            return state;
        })));
    }
    /**
     * @param {?} applicationId
     * @param {?} typeId
     * @param {?} sandboxId
     * @return {?}
     */
    purgeAllCases(applicationId, typeId, sandboxId) {
        /** @type {?} */
        const url = '/case/v1/cases/?$sandbox=1930&$filter=applicationId eq 2550 and typeId eq 1 and purgeable eq TRUE';
        return this.http.delete(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} result
         * @return {?}
         */
        result => {
            return new PurgeResult().deserialize(result);
        })));
    }
    /**
     * @param {?} caseRef
     * @param {?} sandboxId
     * @param {?} appId
     * @param {?} typeId
     * @param {?} uiAppId
     * @return {?}
     */
    getCaseWithSchema(caseRef, sandboxId, appId, typeId, uiAppId) {
        /** @type {?} */
        const url = '/case/v1/cases/' + caseRef + '/' + '?$sandbox=' + sandboxId + '&$select=uc, m, s';
        // Make the two required API calls
        /** @type {?} */
        const caseSchema = this.liveAppsService.getCaseTypeSchema(sandboxId, appId, 100).pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} typesList
         * @return {?}
         */
        typesList => {
            // get schema for case type
            /** @type {?} */
            let requestedType;
            typesList.casetypes.forEach((/**
             * @param {?} cType
             * @return {?}
             */
            (cType) => {
                if (cType.id === typeId) {
                    requestedType = cType;
                }
            }));
            return requestedType;
        })));
        /** @type {?} */
        const caseData = this.http.get(url)
            .pipe(tap((/**
         * @param {?} val
         * @return {?}
         */
        val => sessionStorage.setItem('tcsTimestamp', Date.now().toString()))), map((/**
         * @param {?} caseinfo
         * @return {?}
         */
        caseinfo => {
            /** @type {?} */
            const caseinf = new CaseInfo().deserialize(caseinfo);
            this.caseCardConfigService.parseCaseInfo(caseinf, sandboxId, caseinf.metadata.applicationId, caseinf.metadata.typeId, uiAppId);
            return caseinf;
        })));
        // Combine the results of both calls into a single response
        /** @type {?} */
        const test1 = zip(caseSchema, caseData).pipe(map((/**
         * @param {?} caseInfoArray
         * @return {?}
         */
        caseInfoArray => {
            return new CaseInfoWithSchema().deserialize({ caseInfo: caseInfoArray[1], caseSchema: caseInfoArray[0].jsonSchema, applicationName: caseInfoArray[0].applicationName, applicationInternalName: caseInfoArray[0].applicationInternalName, name: caseInfoArray[0].name });
        })));
        return test1;
    }
}
TcCaseDataService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
TcCaseDataService.ctorParameters = () => [
    { type: HttpClient },
    { type: LiveAppsService },
    { type: TcCaseCardConfigService }
];
/** @nocollapse */ TcCaseDataService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function TcCaseDataService_Factory() { return new TcCaseDataService(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.LiveAppsService), i0.ɵɵinject(i3.TcCaseCardConfigService)); }, token: TcCaseDataService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    TcCaseDataService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    TcCaseDataService.prototype.liveAppsService;
    /**
     * @type {?}
     * @private
     */
    TcCaseDataService.prototype.caseCardConfigService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGMtY2FzZS1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdGliY28tdGNzdGsvdGMtbGl2ZWFwcHMtbGliLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL3RjLWNhc2UtZGF0YS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBMkIsR0FBRyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ25ELE9BQU8sRUFBQyxRQUFRLEVBQXVCLE1BQU0sd0JBQXdCLENBQUM7QUFDdEUsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBQ3BELE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxzQkFBc0IsQ0FBQztBQUNoRCxPQUFPLEVBQUMsa0JBQWtCLEVBQUUsV0FBVyxFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFDdkUsT0FBTyxFQUFDLEdBQUcsRUFBWSxHQUFHLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNsRCxPQUFPLEVBQUMsdUJBQXVCLEVBQUMsTUFBTSwrQkFBK0IsQ0FBQzs7Ozs7QUFLdEUsTUFBTSxPQUFPLGlCQUFpQjs7Ozs7O0lBRTVCLFlBQW9CLElBQWdCLEVBQVUsZUFBZ0MsRUFBVSxxQkFBOEM7UUFBbEgsU0FBSSxHQUFKLElBQUksQ0FBWTtRQUFVLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUFVLDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBeUI7SUFBSSxDQUFDOzs7Ozs7SUFFcEksWUFBWSxDQUFDLE9BQWUsRUFBRSxTQUFpQjs7Y0FDOUMsR0FBRyxHQUFHLGlCQUFpQixHQUFHLE9BQU8sR0FBRyxHQUFHLEdBQUcsWUFBWSxHQUFHLFNBQVMsR0FBRyxZQUFZO1FBQ3ZGLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDO2FBQ3RCLElBQUksQ0FDSCxHQUFHOzs7O1FBQUUsR0FB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SUFBSSxrQkFBa0IsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFLFFBQVEsRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDLEVBQUUsVUFBVSxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLEVBQUUsZUFBZSxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxlQUFlLEVBQUUsdUJBQXVCLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLHVCQUF1QixFQUFFLElBQUksRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUMxUSxDQUFDLEVBQUMsQ0FDSDtRQUNELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQzs7O1lBOUVGLFVBQVUsU0FBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQjs7OztZQVBPLFVBQVU7WUFEVixlQUFlO1lBSWYsdUJBQXVCOzs7Ozs7OztJQU9qQixpQ0FBd0I7Ozs7O0lBQUUsNENBQXdDOzs7OztJQUFFLGtEQUFzRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7Zm9ya0pvaW4sIE9ic2VydmFibGUsIG9mLCB6aXB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtDYXNlSW5mbywgQ2FzZVR5cGUsIEpzb25TY2hlbWF9IGZyb20gJy4uL21vZGVscy9saXZlYXBwc2RhdGEnO1xuaW1wb3J0IHtMaXZlQXBwc1NlcnZpY2V9IGZyb20gJy4vbGl2ZS1hcHBzLnNlcnZpY2UnO1xuaW1wb3J0IHtIdHRwQ2xpZW50fSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQge0Nhc2VJbmZvV2l0aFNjaGVtYSwgUHVyZ2VSZXN1bHR9IGZyb20gJy4uL21vZGVscy90Yy1jYXNlLWRhdGEnO1xuaW1wb3J0IHttYXAsIG1lcmdlTWFwLCB0YXB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7VGNDYXNlQ2FyZENvbmZpZ1NlcnZpY2V9IGZyb20gJy4vdGMtY2FzZS1jYXJkLWNvbmZpZy5zZXJ2aWNlJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgVGNDYXNlRGF0YVNlcnZpY2Uge1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cENsaWVudCwgcHJpdmF0ZSBsaXZlQXBwc1NlcnZpY2U6IExpdmVBcHBzU2VydmljZSwgcHJpdmF0ZSBjYXNlQ2FyZENvbmZpZ1NlcnZpY2U6IFRjQ2FzZUNhcmRDb25maWdTZXJ2aWNlKSB7IH1cblxuICBwdWJsaWMgZ2V0Q2FzZVN0YXRlKGNhc2VSZWY6IHN0cmluZywgc2FuZGJveElkOiBudW1iZXIpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xuICAgIGNvbnN0IHVybCA9ICcvY2FzZS92MS9jYXNlcy8nICsgY2FzZVJlZiArICcvJyArICc/JHNhbmRib3g9JyArIHNhbmRib3hJZCArICcmJHNlbGVjdD1zJztcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcChjYXNlaW5mbyA9PiB7XG4gICAgICAgICAgY29uc3QgY2FzZWluZiA9IG5ldyBDYXNlSW5mbygpLmRlc2VyaWFsaXplKGNhc2VpbmZvKTtcbiAgICAgICAgICBjb25zdCBzdGF0ZTogc3RyaW5nID0gY2FzZWluZi5zdW1tYXJ5T2JqLnN0YXRlO1xuICAgICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cblxuXG4gIHB1YmxpYyBwdXJnZUFsbENhc2VzKGFwcGxpY2F0aW9uSWQ6IHN0cmluZywgdHlwZUlkOiBzdHJpbmcsIHNhbmRib3hJZDogbnVtYmVyKTogT2JzZXJ2YWJsZTxQdXJnZVJlc3VsdD4ge1xuICAgIGNvbnN0IHVybCA9ICcvY2FzZS92MS9jYXNlcy8/JHNhbmRib3g9MTkzMCYkZmlsdGVyPWFwcGxpY2F0aW9uSWQgZXEgMjU1MCBhbmQgdHlwZUlkIGVxIDEgYW5kIHB1cmdlYWJsZSBlcSBUUlVFJztcbiAgICByZXR1cm4gdGhpcy5odHRwLmRlbGV0ZSh1cmwpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCB2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcChyZXN1bHQgPT4ge1xuICAgICAgICAgIHJldHVybiBuZXcgUHVyZ2VSZXN1bHQoKS5kZXNlcmlhbGl6ZShyZXN1bHQpO1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgfVxuXG5cblxuXG4gIHB1YmxpYyBnZXRDYXNlV2l0aFNjaGVtYShcbiAgICBjYXNlUmVmOiBzdHJpbmcsIHNhbmRib3hJZDogbnVtYmVyLCBhcHBJZDogc3RyaW5nLCB0eXBlSWQ6IHN0cmluZywgdWlBcHBJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxDYXNlSW5mb1dpdGhTY2hlbWE+IHtcbiAgICBjb25zdCB1cmwgPSAnL2Nhc2UvdjEvY2FzZXMvJyArIGNhc2VSZWYgKyAnLycgKyAnPyRzYW5kYm94PScgKyBzYW5kYm94SWQgKyAnJiRzZWxlY3Q9dWMsIG0sIHMnO1xuXG4gICAgLy8gTWFrZSB0aGUgdHdvIHJlcXVpcmVkIEFQSSBjYWxsc1xuXG4gICAgY29uc3QgY2FzZVNjaGVtYSA9IHRoaXMubGl2ZUFwcHNTZXJ2aWNlLmdldENhc2VUeXBlU2NoZW1hKHNhbmRib3hJZCwgYXBwSWQsIDEwMCkucGlwZShcbiAgICAgIHRhcCh2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICBtYXAodHlwZXNMaXN0ID0+IHtcbiAgICAgICAgLy8gZ2V0IHNjaGVtYSBmb3IgY2FzZSB0eXBlXG4gICAgICAgIGxldCByZXF1ZXN0ZWRUeXBlOiBDYXNlVHlwZTtcbiAgICAgICAgdHlwZXNMaXN0LmNhc2V0eXBlcy5mb3JFYWNoKChjVHlwZSkgPT4ge1xuICAgICAgICAgIGlmIChjVHlwZS5pZCA9PT0gdHlwZUlkKSB7XG4gICAgICAgICAgICByZXF1ZXN0ZWRUeXBlID0gY1R5cGU7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlcXVlc3RlZFR5cGU7XG4gICAgICB9KVxuICAgICk7XG5cbiAgICBjb25zdCBjYXNlRGF0YSA9IHRoaXMuaHR0cC5nZXQodXJsKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcCh2YWwgPT4gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndGNzVGltZXN0YW1wJywgRGF0ZS5ub3coKS50b1N0cmluZygpKSksXG4gICAgICAgIG1hcChjYXNlaW5mbyA9PiB7XG4gICAgICAgICAgY29uc3QgY2FzZWluZiA9IG5ldyBDYXNlSW5mbygpLmRlc2VyaWFsaXplKGNhc2VpbmZvKTtcbiAgICAgICAgICB0aGlzLmNhc2VDYXJkQ29uZmlnU2VydmljZS5wYXJzZUNhc2VJbmZvKFxuICAgICAgICAgICAgY2FzZWluZixcbiAgICAgICAgICAgIHNhbmRib3hJZCxcbiAgICAgICAgICAgIGNhc2VpbmYubWV0YWRhdGEuYXBwbGljYXRpb25JZCxcbiAgICAgICAgICAgIGNhc2VpbmYubWV0YWRhdGEudHlwZUlkLFxuICAgICAgICAgICAgdWlBcHBJZFxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIGNhc2VpbmY7XG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgLy8gQ29tYmluZSB0aGUgcmVzdWx0cyBvZiBib3RoIGNhbGxzIGludG8gYSBzaW5nbGUgcmVzcG9uc2VcbiAgICBjb25zdCB0ZXN0MSA9IHppcChjYXNlU2NoZW1hLCBjYXNlRGF0YSkucGlwZShcbiAgICAgIG1hcChjYXNlSW5mb0FycmF5ID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBDYXNlSW5mb1dpdGhTY2hlbWEoKS5kZXNlcmlhbGl6ZSh7IGNhc2VJbmZvOiBjYXNlSW5mb0FycmF5WzFdLCBjYXNlU2NoZW1hOiBjYXNlSW5mb0FycmF5WzBdLmpzb25TY2hlbWEsIGFwcGxpY2F0aW9uTmFtZTogY2FzZUluZm9BcnJheVswXS5hcHBsaWNhdGlvbk5hbWUsIGFwcGxpY2F0aW9uSW50ZXJuYWxOYW1lOiBjYXNlSW5mb0FycmF5WzBdLmFwcGxpY2F0aW9uSW50ZXJuYWxOYW1lLCBuYW1lOiBjYXNlSW5mb0FycmF5WzBdLm5hbWUgfSk7XG4gICAgICB9KVxuICAgICk7XG4gICAgcmV0dXJuIHRlc3QxO1xuICB9XG59XG4iXX0=