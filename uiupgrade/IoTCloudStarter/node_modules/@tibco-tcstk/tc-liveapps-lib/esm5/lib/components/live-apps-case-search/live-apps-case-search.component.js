/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { Subject } from 'rxjs';
import { LiveAppsService } from '../../services/live-apps.service';
import { CaseSearchResults, CaseType } from '../../models/liveappsdata';
import { LiveAppsComponent } from '../live-apps-component/live-apps-component.component';
import { LiveAppsApplicationsComponent } from '../live-apps-applications/live-apps-applications.component';
/**
 * Selection of app + searching for cases
 *
 *  ![alt-text](../live-apps-case-search.png "Image")
 *
 * \@example <tcla-live-apps-case-search></tcla-live-apps-case-search>
 */
var LiveAppsCaseSearchComponent = /** @class */ (function (_super) {
    tslib_1.__extends(LiveAppsCaseSearchComponent, _super);
    function LiveAppsCaseSearchComponent(liveapps) {
        var _this = _super.call(this) || this;
        _this.liveapps = liveapps;
        /**
         * ~event foundRefs : Search completed (caseRefs returned)
         * ~payload CaseSearchResults : caseRefs matching the search (so parent can display them in case list component)
         */
        _this.foundRefs = new EventEmitter();
        _this.forcedSearch = false;
        // case type selector
        _this.selectedApp = new CaseType();
        _this.refresh = (/**
         * @return {?}
         */
        function () {
            if (_this.applicationsComponent) {
                _this.applicationsComponent.refresh(true);
            }
        });
        _this.setCaseType = (/**
         * @param {?} caseType
         * @return {?}
         */
        function (caseType) {
            _this.selectedApp = caseType;
            _this.doSearch();
            _this.applicationsComponent.changeAppSelection(caseType);
        });
        _this.setSelectedStateId = (/**
         * @param {?} stateId
         * @param {?} stateLabel
         * @return {?}
         */
        function (stateId, stateLabel) {
            _this.selectedStateId = stateId;
            _this.selectedStateLabel = stateLabel;
            // not currently supported to limit search by stateId
            // this.doSearch(stateId);
        });
        // handle search app selection
        _this.handleSearchAppSelection = (/**
         * @param {?} application
         * @return {?}
         */
        function (application) {
            _this.selectedApp = application;
            _this.doSearch();
        });
        // clear search results
        _this.clearResults = (/**
         * @return {?}
         */
        function () {
            _this.searchString = '';
            _this.selectedStateId = undefined;
            _this.selectedStateLabel = undefined;
            _this.doSearch();
        });
        _this.forceSearch = (/**
         * @return {?}
         */
        function () {
            _this.forcedSearch = true;
            _this.liveapps.caseSearchEntries(_this.searchBox.nativeElement.value, _this.sandboxId, _this.selectedApp.applicationId, _this.selectedApp.id, true, 0, 1000, null).subscribe((/**
             * @param {?} results
             * @return {?}
             */
            function (results) {
                _this.foundRefs.emit(results);
            }));
        });
        _this.doSearch = (/**
         * @param {?=} stateId
         * @return {?}
         */
        function (stateId) {
            _this.forcedSearch = false;
            _this.searchBox.nativeElement.value = '';
            /** @type {?} */
            var result = new CaseSearchResults().deserialize({ caserefs: [], searchString: '' });
            _this.foundRefs.emit(result);
            _this.searchTerm$ = new Subject();
            _this.searchTerm$.subscribe((/**
             * @param {?} next
             * @return {?}
             */
            function (next) {
                _this.searchString = next;
                return next;
            }));
            _this.searchValue = _this.searchTerm$.asObservable();
            if (_this.selectedApp.applicationId && _this.selectedApp.id && _this.sandboxId) {
                /** @type {?} */
                var skip = 0;
                /** @type {?} */
                var top_1 = 1000;
                // Note: The API limits searches to 1000 items
                // The service is configured to optimize performance by only returning case references at this stage
                // The case details will only be loaded when the item is rendered (for example in the case-list component)
                // Any case list component should use cdk virtual scroll to ensure 1000 case details are not loaded in one go
                // (from the API or to the DOM)
                _this.liveapps.caseSearch(_this.searchTerm$, _this.sandboxId, _this.selectedApp.applicationId, _this.selectedApp.id, skip, top_1, stateId ? stateId : null)
                    .subscribe((/**
                 * @param {?} results
                 * @return {?}
                 */
                function (results) {
                    _this.foundRefs.emit(results);
                }));
            }
        });
        return _this;
    }
    LiveAppsCaseSearchComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tcla-live-apps-case-search',
                    template: "<div fxLayout=\"row\" fxLayout=\"center center\" style=\"max-width: 700px; width: 100%;\">\n  <div class=\"tcs-search-box\" fxlayout=\"row\" fxLayoutAlign=\"space-around center\" fxFlex>\n    <tcla-live-apps-applications fxLayout=\"row\" fxLayoutAlign=\"start center\" class=\"tcs-search-application-selector\" [appIds]=\"appIds\" [sandboxId]=\"sandboxId\" [selectFirstApp]=\"true\" (selection)=\"handleSearchAppSelection($event)\"></tcla-live-apps-applications>\n    <div class=\"tcs-search-input-container\" fxFlex>\n      <!-- free search by state with state filter currently not supported -->\n      <!--div class=\"tcs-state-filter-marker\" *ngIf=\"selectedStateLabel\" fxLayout=\"row\">[<div class=\"tcs-type-filter-text-highlight\">{{selectedStateLabel}}</div>]&nbsp;</div-->\n      <input #searchBox class=\"tcs-search-input\" placeholder=\"{{ selectedApp.applicationName ? 'Search within ' + selectedApp.applicationName + ' cases' : 'Select a case type to search cases' }}\" (keyup)=\"searchTerm$.next($event.target.value)\" [disabled]=\"!selectedApp.applicationId\" fxFlex>\n      <div fxLayoutAlign=\"center end\">\n        <mat-icon *ngIf=\"forcedSearch || searchString\" class=\"tcs-icon tcs-close-icon\" svgIcon=\"tcs-close-icon\" (click)=\"clearResults()\"></mat-icon>\n        <mat-icon *ngIf=\"!forcedSearch && !searchString\" class=\"tcs-icon tcs-search-icon\" svgIcon=\"tcs-search-icon\" (click)=\"forceSearch()\"></mat-icon>\n      </div>\n    </div>\n  </div>\n</div>\n",
                    styles: [".tcs-search-box{width:100%;height:44px;box-shadow:inset 0 1px 3px 0 rgba(0,0,0,.5);background-color:#fff}.tcs-search-input{height:24px;font-family:Source Sans Pro;font-size:18px;font-weight:600;font-style:normal;font-stretch:normal;line-height:1.5;letter-spacing:.3px;text-align:left;border:none}.tcs-search-input:focus{outline:0}.tcs-search-input::-webkit-input-placeholder{opacity:.38}.tcs-search-input::-moz-placeholder{opacity:.38}.tcs-search-input::-ms-input-placeholder{opacity:.38}.tcs-search-input::placeholder{opacity:.38}.tcs-search-input-container{margin-left:20px;margin-right:20px}.tcs-search-application-selector{width:200px;margin-left:5px;margin-right:5px;background-color:#eee;padding-left:5px;padding-right:5px;padding-top:4px;height:35px}:host ::ng-deep .tcs-search-icon:hover .svg-content{fill:#0081cb}:host ::ng-deep .tcs-close-icon:hover .svg-content{fill:#0081cb}.tcs-close-icon:hover,.tcs-search-icon:hover{cursor:pointer}.tcs-type-filter-text{font-family:Source Sans Pro;font-size:12px;font-weight:600;font-style:normal;font-stretch:normal;line-height:1.5;letter-spacing:.3px;text-align:left;color:#000;margin-left:10px}.tcs-type-filter-text-highlight{color:#ff7800}.tcs-state-filter-marker{margin-top:2px}"]
                }] }
    ];
    /** @nocollapse */
    LiveAppsCaseSearchComponent.ctorParameters = function () { return [
        { type: LiveAppsService }
    ]; };
    LiveAppsCaseSearchComponent.propDecorators = {
        searchBox: [{ type: ViewChild, args: ['searchBox', { static: false },] }],
        sandboxId: [{ type: Input }],
        appIds: [{ type: Input }],
        foundRefs: [{ type: Output }],
        applicationsComponent: [{ type: ViewChild, args: [LiveAppsApplicationsComponent, { static: false },] }]
    };
    return LiveAppsCaseSearchComponent;
}(LiveAppsComponent));
export { LiveAppsCaseSearchComponent };
if (false) {
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.searchBox;
    /**
     * sandboxId - this comes from claims resolver
     * @type {?}
     */
    LiveAppsCaseSearchComponent.prototype.sandboxId;
    /**
     * The list of LA Application IDs you want to handle
     * @type {?}
     */
    LiveAppsCaseSearchComponent.prototype.appIds;
    /**
     * ~event foundRefs : Search completed (caseRefs returned)
     * ~payload CaseSearchResults : caseRefs matching the search (so parent can display them in case list component)
     * @type {?}
     */
    LiveAppsCaseSearchComponent.prototype.foundRefs;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.applicationsComponent;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.searchTerm$;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.searchValue;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.searchString;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.forcedSearch;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.selectedStateId;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.selectedStateLabel;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.selectedApp;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.refresh;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.setCaseType;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.setSelectedStateId;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.handleSearchAppSelection;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.clearResults;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.forceSearch;
    /** @type {?} */
    LiveAppsCaseSearchComponent.prototype.doSearch;
    /**
     * @type {?}
     * @protected
     */
    LiveAppsCaseSearchComponent.prototype.liveapps;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLWNhc2Utc2VhcmNoLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0aWJjby10Y3N0ay90Yy1saXZlYXBwcy1saWIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9saXZlLWFwcHMtY2FzZS1zZWFyY2gvbGl2ZS1hcHBzLWNhc2Utc2VhcmNoLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQXFCLE1BQU0sRUFBRSxTQUFTLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDL0csT0FBTyxFQUFhLE9BQU8sRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUN6QyxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sa0NBQWtDLENBQUM7QUFDakUsT0FBTyxFQUFlLGlCQUFpQixFQUFFLFFBQVEsRUFBQyxNQUFNLDJCQUEyQixDQUFDO0FBQ3BGLE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLHNEQUFzRCxDQUFDO0FBQ3ZGLE9BQU8sRUFBQyw2QkFBNkIsRUFBQyxNQUFNLDREQUE0RCxDQUFDOzs7Ozs7OztBQVV6RztJQU1pRCx1REFBaUI7SUErQmhFLHFDQUFzQixRQUF5QjtRQUEvQyxZQUNFLGlCQUFPLFNBQ1I7UUFGcUIsY0FBUSxHQUFSLFFBQVEsQ0FBaUI7Ozs7O1FBZHJDLGVBQVMsR0FBb0MsSUFBSSxZQUFZLEVBQXFCLENBQUM7UUFPN0Ysa0JBQVksR0FBRyxLQUFLLENBQUM7O1FBS2QsaUJBQVcsR0FBYSxJQUFJLFFBQVEsRUFBRSxDQUFDO1FBTXZDLGFBQU87OztRQUFHO1lBQ2YsSUFBSSxLQUFJLENBQUMscUJBQXFCLEVBQUU7Z0JBQzlCLEtBQUksQ0FBQyxxQkFBcUIsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDMUM7UUFDSCxDQUFDLEVBQUE7UUFHTSxpQkFBVzs7OztRQUFHLFVBQUMsUUFBa0I7WUFD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LElBQUksRUFBRSxLQUFHLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztxQkFDakosU0FBUzs7OztnQkFBQyxVQUFBLE9BQU87b0JBQ2hCLEtBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUMvQixDQUFDLEVBQUMsQ0FBQzthQUNOO1FBQ0gsQ0FBQyxFQUFBOztJQXJFRCxDQUFDOztnQkF2Q0YsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSw0QkFBNEI7b0JBQ3RDLDg5Q0FBcUQ7O2lCQUV0RDs7OztnQkFqQk8sZUFBZTs7OzRCQW9CcEIsU0FBUyxTQUFDLFdBQVcsRUFBRSxFQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUM7NEJBSXRDLEtBQUs7eUJBS0wsS0FBSzs0QkFPTCxNQUFNO3dDQUVOLFNBQVMsU0FBQyw2QkFBNkIsRUFBRSxFQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUM7O0lBcUYzRCxrQ0FBQztDQUFBLEFBOUdELENBTWlELGlCQUFpQixHQXdHakU7U0F4R1ksMkJBQTJCOzs7SUFDdEMsZ0RBQStEOzs7OztJQUkvRCxnREFBMkI7Ozs7O0lBSzNCLDZDQUEwQjs7Ozs7O0lBTzFCLGdEQUE2Rjs7SUFFN0YsNERBQWdIOztJQUVoSCxrREFBNkI7O0lBQzdCLGtEQUFnQzs7SUFDaEMsbURBQXFCOztJQUNyQixtREFBcUI7O0lBQ3JCLHNEQUErQjs7SUFDL0IseURBQWtDOztJQUdsQyxrREFBOEM7O0lBTTlDLDhDQUlDOztJQUdELGtEQUlDOztJQUVELHlEQUtDOztJQUdELCtEQUdDOztJQUdELG1EQUtDOztJQUVELGtEQU9DOztJQUVELCtDQXdCQzs7Ozs7SUF2RVcsK0NBQW1DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBPdXRwdXQsIFZpZXdDaGlsZH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge09ic2VydmFibGUsIFN1YmplY3R9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtMaXZlQXBwc1NlcnZpY2V9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2xpdmUtYXBwcy5zZXJ2aWNlJztcbmltcG9ydCB7Q2FzZUluZm9MaXN0LCBDYXNlU2VhcmNoUmVzdWx0cywgQ2FzZVR5cGV9IGZyb20gJy4uLy4uL21vZGVscy9saXZlYXBwc2RhdGEnO1xuaW1wb3J0IHtMaXZlQXBwc0NvbXBvbmVudH0gZnJvbSAnLi4vbGl2ZS1hcHBzLWNvbXBvbmVudC9saXZlLWFwcHMtY29tcG9uZW50LmNvbXBvbmVudCc7XG5pbXBvcnQge0xpdmVBcHBzQXBwbGljYXRpb25zQ29tcG9uZW50fSBmcm9tICcuLi9saXZlLWFwcHMtYXBwbGljYXRpb25zL2xpdmUtYXBwcy1hcHBsaWNhdGlvbnMuY29tcG9uZW50JztcbmltcG9ydCB7bWFwLCB0YXB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuLyoqXG4gKiBTZWxlY3Rpb24gb2YgYXBwICsgc2VhcmNoaW5nIGZvciBjYXNlc1xuICpcbiAqICAhW2FsdC10ZXh0XSguLi9saXZlLWFwcHMtY2FzZS1zZWFyY2gucG5nIFwiSW1hZ2VcIilcbiAqXG4gKkBleGFtcGxlIDx0Y2xhLWxpdmUtYXBwcy1jYXNlLXNlYXJjaD48L3RjbGEtbGl2ZS1hcHBzLWNhc2Utc2VhcmNoPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0Y2xhLWxpdmUtYXBwcy1jYXNlLXNlYXJjaCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9saXZlLWFwcHMtY2FzZS1zZWFyY2guY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9saXZlLWFwcHMtY2FzZS1zZWFyY2guY29tcG9uZW50LmNzcyddXG59KVxuXG5leHBvcnQgY2xhc3MgTGl2ZUFwcHNDYXNlU2VhcmNoQ29tcG9uZW50IGV4dGVuZHMgTGl2ZUFwcHNDb21wb25lbnQge1xuICBAVmlld0NoaWxkKCdzZWFyY2hCb3gnLCB7c3RhdGljOiBmYWxzZX0pIHNlYXJjaEJveDogRWxlbWVudFJlZjtcbiAgLyoqXG4gICAqIHNhbmRib3hJZCAtIHRoaXMgY29tZXMgZnJvbSBjbGFpbXMgcmVzb2x2ZXJcbiAgICovXG4gIEBJbnB1dCgpIHNhbmRib3hJZDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgbGlzdCBvZiBMQSBBcHBsaWNhdGlvbiBJRHMgeW91IHdhbnQgdG8gaGFuZGxlXG4gICAqL1xuICBASW5wdXQoKSBhcHBJZHM6IHN0cmluZ1tdO1xuXG5cbiAgLyoqXG4gICAqIH5ldmVudCBmb3VuZFJlZnMgOiBTZWFyY2ggY29tcGxldGVkIChjYXNlUmVmcyByZXR1cm5lZClcbiAgICogfnBheWxvYWQgQ2FzZVNlYXJjaFJlc3VsdHMgOiBjYXNlUmVmcyBtYXRjaGluZyB0aGUgc2VhcmNoIChzbyBwYXJlbnQgY2FuIGRpc3BsYXkgdGhlbSBpbiBjYXNlIGxpc3QgY29tcG9uZW50KVxuICAgKi9cbiAgQE91dHB1dCgpIGZvdW5kUmVmczogRXZlbnRFbWl0dGVyPENhc2VTZWFyY2hSZXN1bHRzPiA9IG5ldyBFdmVudEVtaXR0ZXI8Q2FzZVNlYXJjaFJlc3VsdHM+KCk7XG5cbiAgQFZpZXdDaGlsZChMaXZlQXBwc0FwcGxpY2F0aW9uc0NvbXBvbmVudCwge3N0YXRpYzogZmFsc2V9KSBhcHBsaWNhdGlvbnNDb21wb25lbnQ6IExpdmVBcHBzQXBwbGljYXRpb25zQ29tcG9uZW50O1xuXG4gIHNlYXJjaFRlcm0kOiBTdWJqZWN0PHN0cmluZz47XG4gIHNlYXJjaFZhbHVlOiBPYnNlcnZhYmxlPFN0cmluZz47XG4gIHNlYXJjaFN0cmluZzogc3RyaW5nO1xuICBmb3JjZWRTZWFyY2ggPSBmYWxzZTtcbiAgcHVibGljIHNlbGVjdGVkU3RhdGVJZDogbnVtYmVyO1xuICBwdWJsaWMgc2VsZWN0ZWRTdGF0ZUxhYmVsOiBzdHJpbmc7XG5cbiAgLy8gY2FzZSB0eXBlIHNlbGVjdG9yXG4gIHB1YmxpYyBzZWxlY3RlZEFwcDogQ2FzZVR5cGUgPSBuZXcgQ2FzZVR5cGUoKTtcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgbGl2ZWFwcHM6IExpdmVBcHBzU2VydmljZSkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBwdWJsaWMgcmVmcmVzaCA9ICgpID0+IHtcbiAgICBpZiAodGhpcy5hcHBsaWNhdGlvbnNDb21wb25lbnQpIHtcbiAgICAgIHRoaXMuYXBwbGljYXRpb25zQ29tcG9uZW50LnJlZnJlc2godHJ1ZSk7XG4gICAgfVxuICB9XG5cblxuICBwdWJsaWMgc2V0Q2FzZVR5cGUgPSAoY2FzZVR5cGU6IENhc2VUeXBlKSA9PiB7XG4gICAgdGhpcy5zZWxlY3RlZEFwcCA9IGNhc2VUeXBlO1xuICAgIHRoaXMuZG9TZWFyY2goKTtcbiAgICB0aGlzLmFwcGxpY2F0aW9uc0NvbXBvbmVudC5jaGFuZ2VBcHBTZWxlY3Rpb24oY2FzZVR5cGUpO1xuICB9XG5cbiAgcHVibGljIHNldFNlbGVjdGVkU3RhdGVJZCA9IChzdGF0ZUlkOiBudW1iZXIsIHN0YXRlTGFiZWw6IHN0cmluZykgPT4ge1xuICAgIHRoaXMuc2VsZWN0ZWRTdGF0ZUlkID0gc3RhdGVJZDtcbiAgICB0aGlzLnNlbGVjdGVkU3RhdGVMYWJlbCA9IHN0YXRlTGFiZWw7XG4gICAgLy8gbm90IGN1cnJlbnRseSBzdXBwb3J0ZWQgdG8gbGltaXQgc2VhcmNoIGJ5IHN0YXRlSWRcbiAgICAvLyB0aGlzLmRvU2VhcmNoKHN0YXRlSWQpO1xuICB9XG5cbiAgLy8gaGFuZGxlIHNlYXJjaCBhcHAgc2VsZWN0aW9uXG4gIHB1YmxpYyBoYW5kbGVTZWFyY2hBcHBTZWxlY3Rpb24gPSAoYXBwbGljYXRpb246IENhc2VUeXBlKSA9PiB7XG4gICAgdGhpcy5zZWxlY3RlZEFwcCA9IGFwcGxpY2F0aW9uO1xuICAgIHRoaXMuZG9TZWFyY2goKTtcbiAgfVxuXG4gIC8vIGNsZWFyIHNlYXJjaCByZXN1bHRzXG4gIHB1YmxpYyBjbGVhclJlc3VsdHMgPSAoKSA9PiB7XG4gICAgdGhpcy5zZWFyY2hTdHJpbmcgPSAnJztcbiAgICB0aGlzLnNlbGVjdGVkU3RhdGVJZCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNlbGVjdGVkU3RhdGVMYWJlbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmRvU2VhcmNoKCk7XG4gIH1cblxuICBwdWJsaWMgZm9yY2VTZWFyY2ggPSAoKSA9PiB7XG4gICAgdGhpcy5mb3JjZWRTZWFyY2ggPSB0cnVlO1xuICAgIHRoaXMubGl2ZWFwcHMuY2FzZVNlYXJjaEVudHJpZXModGhpcy5zZWFyY2hCb3gubmF0aXZlRWxlbWVudC52YWx1ZSwgdGhpcy5zYW5kYm94SWQsIHRoaXMuc2VsZWN0ZWRBcHAuYXBwbGljYXRpb25JZCwgdGhpcy5zZWxlY3RlZEFwcC5pZCwgdHJ1ZSwgMCwgMTAwMCwgbnVsbCkuc3Vic2NyaWJlKFxuICAgICAgcmVzdWx0cyA9PiB7XG4gICAgICAgIHRoaXMuZm91bmRSZWZzLmVtaXQocmVzdWx0cyk7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBkb1NlYXJjaCA9IChzdGF0ZUlkPzogbnVtYmVyKSA9PiB7XG4gICAgdGhpcy5mb3JjZWRTZWFyY2ggPSBmYWxzZTtcbiAgICB0aGlzLnNlYXJjaEJveC5uYXRpdmVFbGVtZW50LnZhbHVlID0gJyc7XG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IENhc2VTZWFyY2hSZXN1bHRzKCkuZGVzZXJpYWxpemUoeyBjYXNlcmVmczogW10sIHNlYXJjaFN0cmluZzogJycgfSk7XG4gICAgdGhpcy5mb3VuZFJlZnMuZW1pdChyZXN1bHQpO1xuICAgIHRoaXMuc2VhcmNoVGVybSQgPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XG4gICAgdGhpcy5zZWFyY2hUZXJtJC5zdWJzY3JpYmUobmV4dCA9PiB7XG4gICAgICB0aGlzLnNlYXJjaFN0cmluZyA9IG5leHQ7XG4gICAgICByZXR1cm4gbmV4dDtcbiAgICB9KVxuICAgIHRoaXMuc2VhcmNoVmFsdWUgPSB0aGlzLnNlYXJjaFRlcm0kLmFzT2JzZXJ2YWJsZSgpO1xuICAgIGlmICh0aGlzLnNlbGVjdGVkQXBwLmFwcGxpY2F0aW9uSWQgJiYgdGhpcy5zZWxlY3RlZEFwcC5pZCAmJiB0aGlzLnNhbmRib3hJZCkge1xuICAgICAgY29uc3Qgc2tpcCA9IDA7XG4gICAgICBjb25zdCB0b3AgPSAxMDAwO1xuICAgICAgLy8gTm90ZTogVGhlIEFQSSBsaW1pdHMgc2VhcmNoZXMgdG8gMTAwMCBpdGVtc1xuICAgICAgLy8gVGhlIHNlcnZpY2UgaXMgY29uZmlndXJlZCB0byBvcHRpbWl6ZSBwZXJmb3JtYW5jZSBieSBvbmx5IHJldHVybmluZyBjYXNlIHJlZmVyZW5jZXMgYXQgdGhpcyBzdGFnZVxuICAgICAgLy8gVGhlIGNhc2UgZGV0YWlscyB3aWxsIG9ubHkgYmUgbG9hZGVkIHdoZW4gdGhlIGl0ZW0gaXMgcmVuZGVyZWQgKGZvciBleGFtcGxlIGluIHRoZSBjYXNlLWxpc3QgY29tcG9uZW50KVxuICAgICAgLy8gQW55IGNhc2UgbGlzdCBjb21wb25lbnQgc2hvdWxkIHVzZSBjZGsgdmlydHVhbCBzY3JvbGwgdG8gZW5zdXJlIDEwMDAgY2FzZSBkZXRhaWxzIGFyZSBub3QgbG9hZGVkIGluIG9uZSBnb1xuICAgICAgLy8gKGZyb20gdGhlIEFQSSBvciB0byB0aGUgRE9NKVxuICAgICAgdGhpcy5saXZlYXBwcy5jYXNlU2VhcmNoKHRoaXMuc2VhcmNoVGVybSQsIHRoaXMuc2FuZGJveElkLCB0aGlzLnNlbGVjdGVkQXBwLmFwcGxpY2F0aW9uSWQsIHRoaXMuc2VsZWN0ZWRBcHAuaWQsIHNraXAsIHRvcCwgc3RhdGVJZCA/IHN0YXRlSWQgOiBudWxsKVxuICAgICAgICAuc3Vic2NyaWJlKHJlc3VsdHMgPT4ge1xuICAgICAgICAgIHRoaXMuZm91bmRSZWZzLmVtaXQocmVzdWx0cyk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG59XG4iXX0=