/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { take, takeUntil } from 'rxjs/operators';
import { LiveAppsComponent } from '../live-apps-component/live-apps-component.component';
import { TcCoreCommonFunctions } from '@tibco-tcstk/tc-core-lib';
import { TcWorkitemsService } from '../../services/tc-workitems.service';
/**
 * Workitems widget, this Component lists workitems.
 *
 *
 * ![alt-text](../live-apps-workitems.png "")
 *
 * \@example <tcla-live-apps-workitems></tcla-live-apps-workitems>
 */
var LiveAppsWorkitemsComponent = /** @class */ (function (_super) {
    tslib_1.__extends(LiveAppsWorkitemsComponent, _super);
    function LiveAppsWorkitemsComponent(workitemsService) {
        var _this = _super.call(this) || this;
        _this.workitemsService = workitemsService;
        /**
         * case card format - list, card, miniCard, staticList (no click event)
         */
        _this.displayType = _this.displayType ? _this.displayType : 'wiMiniCard'; // miniCard, card, list
        // miniCard, card, list
        /**
         * Whether to show the header bar in the widget - eg. favorites on home page (contains icon etc) - if off icons still appear without bar
         */
        _this.showHeader = _this.showHeader ? _this.showHeader : true;
        /**
         * ~event clickCase : Case clicked
         * ~payload CaseRoute : CaseRoute object output when case is clicked so calling component can route accordingly - ie. route to case
         */
        _this.clickCase = new EventEmitter();
        _this.clickWorkitemAction = (/**
         * @param {?} caseRoute
         * @return {?}
         */
        function (caseRoute) {
            _this.clickCase.emit(caseRoute);
        });
        _this.refresh = (/**
         * @return {?}
         */
        function () {
            _this.workitems = [];
            _this.workitemsService.getWorkitems(_this.sandboxId, _this.appIds, _this.caseRef, 0, 20)
                .pipe(take(1), takeUntil(_this._destroyed$)).subscribe((/**
             * @param {?} next
             * @return {?}
             */
            function (next) {
                _this.workitems = next || [];
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) { _this.errorMessage = 'Error retrieving workitems: ' + error.error.errorMsg; }));
        });
        _this.handleDeleted = (/**
         * @param {?} caseRef
         * @param {?} workitemId
         * @return {?}
         */
        function (caseRef, workitemId) {
            _this.workitems.splice(_this.workitems.findIndex(((/**
             * @param {?} wi
             * @return {?}
             */
            function (wi) {
                console.warn('Workitem: ', workitemId + ' for case: ' + caseRef + ' not shown as case deleted');
                return wi.header.itemContext.caseRef === caseRef;
            }))), 1);
        });
        return _this;
    }
    /**
     * @return {?}
     */
    LiveAppsWorkitemsComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        _super.prototype.ngAfterViewInit.call(this);
        this.cardWidthPct = TcCoreCommonFunctions.calcSummaryCardPct(this.widget);
        this.containerChanges$.subscribe((/**
         * @param {?} widget
         * @return {?}
         */
        function (widget) {
            _this.cardWidthPct = TcCoreCommonFunctions.calcSummaryCardPct(widget);
        }));
    };
    /**
     * @return {?}
     */
    LiveAppsWorkitemsComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        _super.prototype.ngOnInit.call(this);
        this.refresh();
    };
    LiveAppsWorkitemsComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tcla-live-apps-workitems',
                    template: "<div #componentDiv class=\"tcs-case-recent-box\" fxLayout=\"column\" fxFill>\n  <div *ngIf=\"showHeader\" class=\"tcs-case-recent-header\" fxLayout=\"row\" fxLayoutAlign=\"space-between center\">\n    <div fxLayoutAlign=\"start center\">\n      <mat-icon class=\"tcs-icon tcs-recent-icon\" svgIcon=\"tcs-recent-icon\"></mat-icon>\n      <div class=\"tcs-case-recent-header-text\">Workitems</div>\n    </div>\n  </div>\n  <div *ngIf=\"!showHeader\" fxLayout=\"row\" fxLayoutAlign=\"end center\">\n  </div>\n  <div *ngIf=\"workitems.length > 0\"class=\"tcs-case-recent-flow-list\" fxLayout=\"column\" fxLayout=\"row wrap\">\n    <div class=\"tcs-case-recent-item-box\" *ngFor=\"let workitem of workitems\" [fxFlex]=\"cardWidthPct\">\n      <tcla-live-apps-case-summary [uiAppId]=\"uiAppId\" [typeBar]=\"true\" [borderCard]=\"false\" [displayType]=\"displayType\" [sandboxId]=\"sandboxId\" [caseRef]=\"workitem.header.itemContext.caseRef\" [description]=\"workitem.header.description\" [workitemId]=\"workitem.id\" (clickCase)=\"clickWorkitemAction($event)\" (deleted)=\"handleDeleted($event, workitem.id)\"></tcla-live-apps-case-summary>\n      <div class=\"tcs-case-recent-line\"></div>\n    </div>\n  </div>\n  <div *ngIf=\"!(workitems.length > 0)\" fxLayout=\"row\" fxLayoutAlign=\"center start\" fxLayoutGap=\"10px\" style=\"margin: 20px;\">\n    <mat-icon [svgIcon]=\"'ic-no-cases-icon'\" style=\"height: 48px; width: 48px;\"></mat-icon>\n    <div style=\"height: 100%\" fxLayoutAlign=\"start center\">\n      <span class=\"tcs-no-item-text\">No workitems found</span>\n    </div>\n  </div>\n</div>\n",
                    styles: [".tcs-case-recent-box{border-radius:3px;box-shadow:0 2px 8px 0 #dedede;background-color:#fff}.tcs-case-recent-header{min-height:40px;border-radius:3px 3px 0 0;box-shadow:0 1px 2px 0 #dedede;padding-left:20px;padding-right:20px}.tcs-case-recent-header-text{font-family:Source Sans Pro;font-size:18px;font-weight:600;font-style:normal;font-stretch:normal;line-height:1.5;letter-spacing:.3px;text-align:left;color:#000;margin-left:10px}.tcs-case-recent-flow-list{margin:24px;overflow-y:auto}.tcs-case-recent-item-box{padding:2px}.tcs-icon.tcs-icon-active:hover{cursor:pointer}:host ::ng-deep .tcs-icon.tcs-icon-active:hover .svg-content{fill:#0081cb}.tcs-case-recent-line{padding:0;margin:4px 5px 0;border-bottom:1.1px solid #f4f4f4}.tcs-no-item-text{font-family:Source Sans Pro;font-size:16px;font-weight:400;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:normal;color:#b6b6b6}"]
                }] }
    ];
    /** @nocollapse */
    LiveAppsWorkitemsComponent.ctorParameters = function () { return [
        { type: TcWorkitemsService }
    ]; };
    LiveAppsWorkitemsComponent.propDecorators = {
        sandboxId: [{ type: Input }],
        uiAppId: [{ type: Input }],
        appIds: [{ type: Input }],
        caseRef: [{ type: Input }],
        displayType: [{ type: Input }],
        showHeader: [{ type: Input }],
        clickCase: [{ type: Output }],
        componentDiv: [{ type: ViewChild, args: ['componentDiv', { static: false },] }]
    };
    return LiveAppsWorkitemsComponent;
}(LiveAppsComponent));
export { LiveAppsWorkitemsComponent };
if (false) {
    /**
     * sandboxId - this comes from claims resolver
     * @type {?}
     */
    LiveAppsWorkitemsComponent.prototype.sandboxId;
    /**
     * The Application ID of the UI (should ideally be unique as it is shared state key)
     * @type {?}
     */
    LiveAppsWorkitemsComponent.prototype.uiAppId;
    /**
     * The list of LA Application IDs you want to handle
     * @type {?}
     */
    LiveAppsWorkitemsComponent.prototype.appIds;
    /**
     * The caseRef for which to display workitems
     * @type {?}
     */
    LiveAppsWorkitemsComponent.prototype.caseRef;
    /**
     * case card format - list, card, miniCard, staticList (no click event)
     * @type {?}
     */
    LiveAppsWorkitemsComponent.prototype.displayType;
    /**
     * Whether to show the header bar in the widget - eg. favorites on home page (contains icon etc) - if off icons still appear without bar
     * @type {?}
     */
    LiveAppsWorkitemsComponent.prototype.showHeader;
    /**
     * ~event clickCase : Case clicked
     * ~payload CaseRoute : CaseRoute object output when case is clicked so calling component can route accordingly - ie. route to case
     * @type {?}
     */
    LiveAppsWorkitemsComponent.prototype.clickCase;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.componentDiv;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.workitems;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.errorMessage;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.widget;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.cardWidthPct;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.clickWorkitemAction;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.refresh;
    /** @type {?} */
    LiveAppsWorkitemsComponent.prototype.handleDeleted;
    /**
     * @type {?}
     * @protected
     */
    LiveAppsWorkitemsComponent.prototype.workitemsService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLXdvcmtpdGVtcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdGliY28tdGNzdGsvdGMtbGl2ZWFwcHMtbGliLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvbGl2ZS1hcHBzLXdvcmtpdGVtcy9saXZlLWFwcHMtd29ya2l0ZW1zLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFFTCxTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixLQUFLLEVBRUwsTUFBTSxFQUNOLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUMsSUFBSSxFQUFFLFNBQVMsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBRS9DLE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLHNEQUFzRCxDQUFDO0FBQ3ZGLE9BQU8sRUFBYyxxQkFBcUIsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBQzVFLE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLHFDQUFxQyxDQUFDOzs7Ozs7Ozs7QUFXdkU7SUFLZ0Qsc0RBQWlCO0lBb0UvRCxvQ0FBc0IsZ0JBQW9DO1FBQTFELFlBQ0UsaUJBQU8sU0FDUjtRQUZxQixzQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQW9COzs7O1FBNUNqRCxpQkFBVyxHQUFXLEtBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEtBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLHVCQUF1Qjs7Ozs7UUFJakcsZ0JBQVUsR0FBWSxLQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxLQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7Ozs7O1FBUTlELGVBQVMsR0FBNEIsSUFBSSxZQUFZLEVBQWEsQ0FBQztRQVN0RSx5QkFBbUI7Ozs7UUFBRyxVQUFDLFNBQW9CO1lBQ2hELEtBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ2pDLENBQUMsRUFBQTtRQUVNLGFBQU87OztRQUFHO1lBQ2YsS0FBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7WUFDcEIsS0FBSSxDQUFDLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxLQUFJLENBQUMsU0FBUyxFQUFFLEtBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUNqRixJQUFJLENBQ0gsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNQLFNBQVMsQ0FBQyxLQUFJLENBQUMsV0FBVyxDQUFDLENBQzVCLENBQUMsU0FBUzs7OztZQUNYLFVBQUEsSUFBSTtnQkFDRixLQUFJLENBQUMsU0FBUyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7WUFDOUIsQ0FBQzs7OztZQUFFLFVBQUEsS0FBSyxJQUFNLEtBQUksQ0FBQyxZQUFZLEdBQUcsOEJBQThCLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQztRQUNoRyxDQUFDLEVBQUE7UUFFTSxtQkFBYTs7Ozs7UUFBRyxVQUFDLE9BQWUsRUFBRSxVQUFrQjtZQUN6RCxLQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxLQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQzs7OztZQUFDLFVBQVMsRUFBRTtnQkFDdkQsT0FBTyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsVUFBVSxHQUFHLGFBQWEsR0FBRyxPQUFPLEdBQUcsNEJBQTRCLENBQUMsQ0FBQztnQkFDaEcsT0FBTyxFQUFFLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxPQUFPLEtBQUssT0FBTyxDQUFDO1lBQ25ELENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDWixDQUFDLEVBQUE7O0lBSUQsQ0FBQzs7OztJQUVELG9EQUFlOzs7SUFBZjtRQUFBLGlCQU1DO1FBTEMsaUJBQU0sZUFBZSxXQUFFLENBQUM7UUFDeEIsSUFBSSxDQUFDLFlBQVksR0FBRyxxQkFBcUIsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDMUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFNBQVM7Ozs7UUFBQyxVQUFBLE1BQU07WUFDckMsS0FBSSxDQUFDLFlBQVksR0FBRyxxQkFBcUIsQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN2RSxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7SUFFRCw2Q0FBUTs7O0lBQVI7UUFDRSxpQkFBTSxRQUFRLFdBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDakIsQ0FBQzs7Z0JBeEZGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsMEJBQTBCO29CQUNwQywra0RBQW1EOztpQkFFcEQ7Ozs7Z0JBZk8sa0JBQWtCOzs7NEJBb0J2QixLQUFLOzBCQUtMLEtBQUs7eUJBS0wsS0FBSzswQkFLTCxLQUFLOzhCQUtMLEtBQUs7NkJBSUwsS0FBSzs0QkFRTCxNQUFNOytCQUVOLFNBQVMsU0FBQyxjQUFjLEVBQUUsRUFBQyxNQUFNLEVBQUUsS0FBSyxFQUFDOztJQStDNUMsaUNBQUM7Q0FBQSxBQTFGRCxDQUtnRCxpQkFBaUIsR0FxRmhFO1NBckZZLDBCQUEwQjs7Ozs7O0lBSXJDLCtDQUEyQjs7Ozs7SUFLM0IsNkNBQXlCOzs7OztJQUt6Qiw0Q0FBMEI7Ozs7O0lBSzFCLDZDQUF5Qjs7Ozs7SUFLekIsaURBQWtGOzs7OztJQUlsRixnREFBd0U7Ozs7OztJQVF4RSwrQ0FBNkU7O0lBRTdFLGtEQUFxRTs7SUFFckUsK0NBQTZCOztJQUM3QixrREFBNEI7O0lBQzVCLDRDQUEyQjs7SUFDM0Isa0RBQTRCOztJQUU1Qix5REFFQzs7SUFFRCw2Q0FVQzs7SUFFRCxtREFLQzs7Ozs7SUFFVyxzREFBOEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBWaWV3Q2hpbGRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge3Rha2UsIHRha2VVbnRpbH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtDYXNlUm91dGV9IGZyb20gJy4uLy4uL21vZGVscy9saXZlYXBwc2RhdGEnO1xuaW1wb3J0IHtMaXZlQXBwc0NvbXBvbmVudH0gZnJvbSAnLi4vbGl2ZS1hcHBzLWNvbXBvbmVudC9saXZlLWFwcHMtY29tcG9uZW50LmNvbXBvbmVudCc7XG5pbXBvcnQge1RjQ29tcG9uZW50LCBUY0NvcmVDb21tb25GdW5jdGlvbnN9IGZyb20gJ0B0aWJjby10Y3N0ay90Yy1jb3JlLWxpYic7XG5pbXBvcnQge1RjV29ya2l0ZW1zU2VydmljZX0gZnJvbSAnLi4vLi4vc2VydmljZXMvdGMtd29ya2l0ZW1zLnNlcnZpY2UnO1xuaW1wb3J0IHtXb3JraXRlbX0gZnJvbSAnLi4vLi4vbW9kZWxzL3RjLXdvcmtpdGVtcyc7XG5cbi8qKlxuICogV29ya2l0ZW1zIHdpZGdldCwgdGhpcyBDb21wb25lbnQgbGlzdHMgd29ya2l0ZW1zLlxuICpcbiAqXG4gKiAhW2FsdC10ZXh0XSguLi9saXZlLWFwcHMtd29ya2l0ZW1zLnBuZyBcIlwiKVxuICpcbiAqQGV4YW1wbGUgPHRjbGEtbGl2ZS1hcHBzLXdvcmtpdGVtcz48L3RjbGEtbGl2ZS1hcHBzLXdvcmtpdGVtcz5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGNsYS1saXZlLWFwcHMtd29ya2l0ZW1zJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2xpdmUtYXBwcy13b3JraXRlbXMuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9saXZlLWFwcHMtd29ya2l0ZW1zLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBMaXZlQXBwc1dvcmtpdGVtc0NvbXBvbmVudCBleHRlbmRzIExpdmVBcHBzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcbiAgLyoqXG4gICAqIHNhbmRib3hJZCAtIHRoaXMgY29tZXMgZnJvbSBjbGFpbXMgcmVzb2x2ZXJcbiAgICovXG4gIEBJbnB1dCgpIHNhbmRib3hJZDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgQXBwbGljYXRpb24gSUQgb2YgdGhlIFVJIChzaG91bGQgaWRlYWxseSBiZSB1bmlxdWUgYXMgaXQgaXMgc2hhcmVkIHN0YXRlIGtleSlcbiAgICovXG4gIEBJbnB1dCgpIHVpQXBwSWQ6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGxpc3Qgb2YgTEEgQXBwbGljYXRpb24gSURzIHlvdSB3YW50IHRvIGhhbmRsZVxuICAgKi9cbiAgQElucHV0KCkgYXBwSWRzOiBzdHJpbmdbXTtcblxuICAvKipcbiAgICogVGhlIGNhc2VSZWYgZm9yIHdoaWNoIHRvIGRpc3BsYXkgd29ya2l0ZW1zXG4gICAqL1xuICBASW5wdXQoKSBjYXNlUmVmOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIGNhc2UgY2FyZCBmb3JtYXQgLSBsaXN0LCBjYXJkLCBtaW5pQ2FyZCwgc3RhdGljTGlzdCAobm8gY2xpY2sgZXZlbnQpXG4gICAqL1xuICBASW5wdXQoKSBkaXNwbGF5VHlwZTogc3RyaW5nID0gdGhpcy5kaXNwbGF5VHlwZSA/IHRoaXMuZGlzcGxheVR5cGUgOiAnd2lNaW5pQ2FyZCc7IC8vIG1pbmlDYXJkLCBjYXJkLCBsaXN0XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIHNob3cgdGhlIGhlYWRlciBiYXIgaW4gdGhlIHdpZGdldCAtIGVnLiBmYXZvcml0ZXMgb24gaG9tZSBwYWdlIChjb250YWlucyBpY29uIGV0YykgLSBpZiBvZmYgaWNvbnMgc3RpbGwgYXBwZWFyIHdpdGhvdXQgYmFyXG4gICAqL1xuICBASW5wdXQoKSBzaG93SGVhZGVyOiBib29sZWFuID0gdGhpcy5zaG93SGVhZGVyID8gdGhpcy5zaG93SGVhZGVyIDogdHJ1ZTtcblxuXG5cbiAgLyoqXG4gICAqIH5ldmVudCBjbGlja0Nhc2UgOiBDYXNlIGNsaWNrZWRcbiAgICogfnBheWxvYWQgQ2FzZVJvdXRlIDogQ2FzZVJvdXRlIG9iamVjdCBvdXRwdXQgd2hlbiBjYXNlIGlzIGNsaWNrZWQgc28gY2FsbGluZyBjb21wb25lbnQgY2FuIHJvdXRlIGFjY29yZGluZ2x5IC0gaWUuIHJvdXRlIHRvIGNhc2VcbiAgICovXG4gIEBPdXRwdXQoKSBjbGlja0Nhc2U6IEV2ZW50RW1pdHRlcjxDYXNlUm91dGU+ID0gbmV3IEV2ZW50RW1pdHRlcjxDYXNlUm91dGU+KCk7XG5cbiAgQFZpZXdDaGlsZCgnY29tcG9uZW50RGl2Jywge3N0YXRpYzogZmFsc2V9KSBjb21wb25lbnREaXY6IEVsZW1lbnRSZWY7XG5cbiAgcHVibGljIHdvcmtpdGVtczogV29ya2l0ZW1bXTtcbiAgcHVibGljIGVycm9yTWVzc2FnZTogc3RyaW5nO1xuICBwdWJsaWMgd2lkZ2V0OiBUY0NvbXBvbmVudDtcbiAgcHVibGljIGNhcmRXaWR0aFBjdDogTnVtYmVyO1xuXG4gIHB1YmxpYyBjbGlja1dvcmtpdGVtQWN0aW9uID0gKGNhc2VSb3V0ZTogQ2FzZVJvdXRlKSA9PiB7XG4gICAgdGhpcy5jbGlja0Nhc2UuZW1pdChjYXNlUm91dGUpO1xuICB9XG5cbiAgcHVibGljIHJlZnJlc2ggPSAoKSA9PiB7XG4gICAgdGhpcy53b3JraXRlbXMgPSBbXTtcbiAgICB0aGlzLndvcmtpdGVtc1NlcnZpY2UuZ2V0V29ya2l0ZW1zKHRoaXMuc2FuZGJveElkLCB0aGlzLmFwcElkcywgdGhpcy5jYXNlUmVmLCAwLCAyMClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YWtlKDEpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkJClcbiAgICAgICkuc3Vic2NyaWJlKFxuICAgICAgbmV4dCA9PiB7XG4gICAgICAgIHRoaXMud29ya2l0ZW1zID0gbmV4dCB8fCBbXTtcbiAgICAgIH0sIGVycm9yID0+IHsgdGhpcy5lcnJvck1lc3NhZ2UgPSAnRXJyb3IgcmV0cmlldmluZyB3b3JraXRlbXM6ICcgKyBlcnJvci5lcnJvci5lcnJvck1zZzsgfSk7XG4gIH1cblxuICBwdWJsaWMgaGFuZGxlRGVsZXRlZCA9IChjYXNlUmVmOiBzdHJpbmcsIHdvcmtpdGVtSWQ6IHN0cmluZykgPT4ge1xuICAgIHRoaXMud29ya2l0ZW1zLnNwbGljZSh0aGlzLndvcmtpdGVtcy5maW5kSW5kZXgoKGZ1bmN0aW9uKHdpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignV29ya2l0ZW06ICcsIHdvcmtpdGVtSWQgKyAnIGZvciBjYXNlOiAnICsgY2FzZVJlZiArICcgbm90IHNob3duIGFzIGNhc2UgZGVsZXRlZCcpO1xuICAgICAgICByZXR1cm4gd2kuaGVhZGVyLml0ZW1Db250ZXh0LmNhc2VSZWYgPT09IGNhc2VSZWY7XG4gICAgICB9KSksIDEpO1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIHdvcmtpdGVtc1NlcnZpY2U6IFRjV29ya2l0ZW1zU2VydmljZSkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgc3VwZXIubmdBZnRlclZpZXdJbml0KCk7XG4gICAgdGhpcy5jYXJkV2lkdGhQY3QgPSBUY0NvcmVDb21tb25GdW5jdGlvbnMuY2FsY1N1bW1hcnlDYXJkUGN0KHRoaXMud2lkZ2V0KTtcbiAgICB0aGlzLmNvbnRhaW5lckNoYW5nZXMkLnN1YnNjcmliZSh3aWRnZXQgPT4ge1xuICAgICAgdGhpcy5jYXJkV2lkdGhQY3QgPSBUY0NvcmVDb21tb25GdW5jdGlvbnMuY2FsY1N1bW1hcnlDYXJkUGN0KHdpZGdldCk7XG4gICAgfSk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBzdXBlci5uZ09uSW5pdCgpO1xuICAgIHRoaXMucmVmcmVzaCgpO1xuICB9XG5cbn1cbiJdfQ==