/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
// todo: JS deprecate this since now using private API to allow only listing of enabled creators
import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { LaProcessSelection } from '../../models/tc-case-processes';
import { LiveAppsComponent } from '../live-apps-component/live-apps-component.component';
import { LiveAppsService } from '../../services/live-apps.service';
import { MatSelect } from '@angular/material';
var LiveAppsCreatorSelectorComponent = /** @class */ (function (_super) {
    tslib_1.__extends(LiveAppsCreatorSelectorComponent, _super);
    function LiveAppsCreatorSelectorComponent(liveapps) {
        var _this = _super.call(this) || this;
        _this.liveapps = liveapps;
        /**
         * ~event creatorSelection : Case Creator selected
         * ~payload LaProcessSelection : LaProcessSelection object output when a creator is selected from a drop down
         */
        _this.creatorSelection = new EventEmitter();
        // run when the user clicks on a case creator
        _this.selectProcess = (/**
         * @param {?} process
         * @return {?}
         */
        function (process) {
            _this.creatorSelection.emit(new LaProcessSelection('creator', _this.appSchema, _this.getCaseIDAttributeName(), process, 
            // Format of ref is <applicationName>.<applicationInternalName>.<processType>.<processName>
            (_this.caseType.applicationName + '.' + _this.caseType.applicationInternalName + '.' + 'creator' + '.' + process.name), undefined));
        });
        _this.reset = (/**
         * @return {?}
         */
        function () {
            _this.creatorSelector.value = undefined;
        });
        _this.getCaseIDAttributeName = (/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var caseIdAttrib;
            _this.caseType.attributes.forEach((/**
             * @param {?} attribute
             * @return {?}
             */
            function (attribute) {
                if (attribute.isIdentifier) {
                    caseIdAttrib = attribute;
                }
            }));
            return caseIdAttrib;
        });
        _this.refresh = (/**
         * @return {?}
         */
        function () {
            // retrieve the schema for this case type so we can display case creators and case actions for this case type
            _this.liveapps.getCaseTypeSchema(_this.sandboxId, _this.appId, 100)
                .subscribe((/**
             * @param {?} schema
             * @return {?}
             */
            function (schema) {
                _this.appSchema = schema;
                schema.casetypes.forEach((/**
                 * @param {?} casetype
                 * @return {?}
                 */
                function (casetype) {
                    // the schema will contain definitions for both the 'case' and any defined types in that case.
                    // We want the schema for this 'case'.
                    if (casetype.applicationId === _this.appId && casetype.id === _this.typeId) {
                        if (casetype.jsonSchema !== undefined) {
                            _this.caseType = casetype;
                            _this.caseCreatorList = casetype.creators ? casetype.creators : [];
                            if (_this.caseCreatorList.length === 1) {
                                _this.selectProcess(_this.caseCreatorList[0]);
                            }
                        }
                        else {
                            console.error('No schema returned for this case type: You may need to update/re-deploy the live apps application');
                        }
                    }
                }));
            }));
        });
        return _this;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    LiveAppsCreatorSelectorComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.appId && (changes.appId.currentValue !== changes.appId.previousValue)) {
            this.caseCreatorList = [];
            this.refresh();
        }
    };
    LiveAppsCreatorSelectorComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tcla-live-apps-creator-selector',
                    template: "<div *ngIf=\"caseCreatorList && caseCreatorList.length > 1\" fxFlex style=\"margin-left: 10px;\">\n    <span class=\"tcs-case-creation-dialog-instruction\">Select a case creator</span>\n    <mat-select #creatorSelector class=\"tcs-creator-selector-option\" [disableOptionCentering]=\"true\"\n                placeholder=\"Case Creators\" (selectionChange)=\"selectProcess($event.value)\">\n      <mat-option *ngFor=\"let creator of caseCreatorList\" [value]=\"creator\">\n        <span>{{creator.name}}</span>\n      </mat-option>\n    </mat-select>\n</div>\n",
                    styles: [":host ::ng-deep .tcs-creator-selector-option .mat-select-value span{font-family:Source Sans Pro;font-size:16px;font-weight:400;font-style:normal;font-stretch:normal;line-height:1.5;letter-spacing:.3px;color:#0081cb}:host ::ng-deep .tcs-creator-selector-option .mat-select-arrow-wrapper div{color:#0081cb}:host ::ng-deep .mat-select-value{min-width:100px;max-width:100%;width:auto}.tcs-creators-box{width:200px;height:44px;box-shadow:inset 0 1px 3px 0 rgba(0,0,0,.5);background-color:#fff}tcs-creator-selector-option{width:170px;margin-left:5px;margin-right:5px;background-color:#eee;padding-left:20px;padding-right:20px;height:35px}.tcs-case-creation-dialog-instruction{font-family:Source Sans Pro;font-size:16px;font-weight:600;font-style:normal;font-stretch:normal;line-height:normal;letter-spacing:normal;color:#727272}"]
                }] }
    ];
    /** @nocollapse */
    LiveAppsCreatorSelectorComponent.ctorParameters = function () { return [
        { type: LiveAppsService }
    ]; };
    LiveAppsCreatorSelectorComponent.propDecorators = {
        creatorSelector: [{ type: ViewChild, args: ['creatorSelector', { static: false },] }],
        sandboxId: [{ type: Input }],
        appId: [{ type: Input }],
        typeId: [{ type: Input }],
        creatorSelection: [{ type: Output }]
    };
    return LiveAppsCreatorSelectorComponent;
}(LiveAppsComponent));
export { LiveAppsCreatorSelectorComponent };
if (false) {
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.creatorSelector;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.sandboxId;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.appId;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.typeId;
    /**
     * ~event creatorSelection : Case Creator selected
     * ~payload LaProcessSelection : LaProcessSelection object output when a creator is selected from a drop down
     * @type {?}
     */
    LiveAppsCreatorSelectorComponent.prototype.creatorSelection;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.appSchema;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.caseType;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.caseCreatorList;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.selectProcess;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.reset;
    /**
     * @type {?}
     * @private
     */
    LiveAppsCreatorSelectorComponent.prototype.getCaseIDAttributeName;
    /** @type {?} */
    LiveAppsCreatorSelectorComponent.prototype.refresh;
    /**
     * @type {?}
     * @protected
     */
    LiveAppsCreatorSelectorComponent.prototype.liveapps;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1hcHBzLWNyZWF0b3Itc2VsZWN0b3IuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRpYmNvLXRjc3RrL3RjLWxpdmVhcHBzLWxpYi8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2xpdmUtYXBwcy1jcmVhdG9yLXNlbGVjdG9yL2xpdmUtYXBwcy1jcmVhdG9yLXNlbGVjdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQSxPQUFPLEVBQUMsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQXFCLE1BQU0sRUFBaUIsU0FBUyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRWxILE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLGdDQUFnQyxDQUFDO0FBQ2xFLE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLHNEQUFzRCxDQUFDO0FBQ3ZGLE9BQU8sRUFBQyxlQUFlLEVBQUMsTUFBTSxrQ0FBa0MsQ0FBQztBQUdqRSxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sbUJBQW1CLENBQUM7QUFFNUM7SUFLc0QsNERBQWlCO0lBaUVyRSwwQ0FBc0IsUUFBeUI7UUFBL0MsWUFDRSxpQkFBTyxTQUNSO1FBRnFCLGNBQVEsR0FBUixRQUFRLENBQWlCOzs7OztRQXZEckMsc0JBQWdCLEdBQUcsSUFBSSxZQUFZLEVBQXNCLENBQUM7O1FBTzdELG1CQUFhOzs7O1FBQUcsVUFBQyxPQUFPO1lBQzdCLEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxrQkFBa0IsQ0FBQyxTQUFTLEVBQUUsS0FBSSxDQUFDLFNBQVMsRUFBRSxLQUFJLENBQUMsc0JBQXNCLEVBQUUsRUFBRSxPQUFPO1lBQ2pILDJGQUEyRjtZQUMzRixDQUFDLEtBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxHQUFHLEdBQUcsR0FBRyxLQUFJLENBQUMsUUFBUSxDQUFDLHVCQUF1QixHQUFHLEdBQUcsR0FBRyxTQUFTLEdBQUcsR0FBRyxHQUFH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dCI6WyIvLyB0b2RvOiBKUyBkZXByZWNhdGUgdGhpcyBzaW5jZSBub3cgdXNpbmcgcHJpdmF0ZSBBUEkgdG8gYWxsb3cgb25seSBsaXN0aW5nIG9mIGVuYWJsZWQgY3JlYXRvcnNcblxuaW1wb3J0IHtDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBPdXRwdXQsIFNpbXBsZUNoYW5nZXMsIFZpZXdDaGlsZH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0Nhc2VUeXBlLCBDYXNlVHlwZXNMaXN0LCBQcm9jZXNzfSBmcm9tICcuLi8uLi9tb2RlbHMvbGl2ZWFwcHNkYXRhJztcbmltcG9ydCB7TGFQcm9jZXNzU2VsZWN0aW9ufSBmcm9tICcuLi8uLi9tb2RlbHMvdGMtY2FzZS1wcm9jZXNzZXMnO1xuaW1wb3J0IHtMaXZlQXBwc0NvbXBvbmVudH0gZnJvbSAnLi4vbGl2ZS1hcHBzLWNvbXBvbmVudC9saXZlLWFwcHMtY29tcG9uZW50LmNvbXBvbmVudCc7XG5pbXBvcnQge0xpdmVBcHBzU2VydmljZX0gZnJvbSAnLi4vLi4vc2VydmljZXMvbGl2ZS1hcHBzLnNlcnZpY2UnO1xuaW1wb3J0IHttYXB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7TGl2ZUFwcHNTdGF0ZUljb25Db21wb25lbnR9IGZyb20gJy4uL2xpdmUtYXBwcy1zdGF0ZS1pY29uL2xpdmUtYXBwcy1zdGF0ZS1pY29uLmNvbXBvbmVudCc7XG5pbXBvcnQge01hdFNlbGVjdH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0Y2xhLWxpdmUtYXBwcy1jcmVhdG9yLXNlbGVjdG9yJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2xpdmUtYXBwcy1jcmVhdG9yLXNlbGVjdG9yLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbGl2ZS1hcHBzLWNyZWF0b3Itc2VsZWN0b3IuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIExpdmVBcHBzQ3JlYXRvclNlbGVjdG9yQ29tcG9uZW50IGV4dGVuZHMgTGl2ZUFwcHNDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuICBAVmlld0NoaWxkKCdjcmVhdG9yU2VsZWN0b3InLCB7c3RhdGljOiBmYWxzZX0pIGNyZWF0b3JTZWxlY3RvcjogTWF0U2VsZWN0O1xuICBASW5wdXQoKSBzYW5kYm94SWQ6IG51bWJlcjtcbiAgQElucHV0KCkgYXBwSWQ6IHN0cmluZztcbiAgQElucHV0KCkgdHlwZUlkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiB+ZXZlbnQgY3JlYXRvclNlbGVjdGlvbiA6IENhc2UgQ3JlYXRvciBzZWxlY3RlZFxuICAgKiB+cGF5bG9hZCBMYVByb2Nlc3NTZWxlY3Rpb24gOiBMYVByb2Nlc3NTZWxlY3Rpb24gb2JqZWN0IG91dHB1dCB3aGVuIGEgY3JlYXRvciBpcyBzZWxlY3RlZCBmcm9tIGEgZHJvcCBkb3duXG4gICAqL1xuXG4gIEBPdXRwdXQoKSBjcmVhdG9yU2VsZWN0aW9uID0gbmV3IEV2ZW50RW1pdHRlcjxMYVByb2Nlc3NTZWxlY3Rpb24+KCk7XG5cbiAgYXBwU2NoZW1hOiBDYXNlVHlwZXNMaXN0O1xuICBjYXNlVHlwZTogQ2FzZVR5cGU7XG4gIGNhc2VDcmVhdG9yTGlzdDogUHJvY2Vzc1tdO1xuXG4gIC8vIHJ1biB3aGVuIHRoZSB1c2VyIGNsaWNrcyBvbiBhIGNhc2UgY3JlYXRvclxuICBwdWJsaWMgc2VsZWN0UHJvY2VzcyA9IChwcm9jZXNzKSA9PiB7XG4gICAgdGhpcy5jcmVhdG9yU2VsZWN0aW9uLmVtaXQobmV3IExhUHJvY2Vzc1NlbGVjdGlvbignY3JlYXRvcicsIHRoaXMuYXBwU2NoZW1hLCB0aGlzLmdldENhc2VJREF0dHJpYnV0ZU5hbWUoKSwgcHJvY2VzcyxcbiAgICAgIC8vIEZvcm1hdCBvZiByZWYgaXMgPGFwcGxpY2F0aW9uTmFtZT4uPGFwcGxpY2F0aW9uSW50ZXJuYWxOYW1lPi48cHJvY2Vzc1R5cGU+Ljxwcm9jZXNzTmFtZT5cbiAgICAgICh0aGlzLmNhc2VUeXBlLmFwcGxpY2F0aW9uTmFtZSArICcuJyArIHRoaXMuY2FzZVR5cGUuYXBwbGljYXRpb25JbnRlcm5hbE5hbWUgKyAnLicgKyAnY3JlYXRvcicgKyAnLicgKyBwcm9jZXNzLm5hbWUpLFxuICAgICAgdW5kZWZpbmVkXG4gICAgKSk7XG4gIH1cblxuICBwdWJsaWMgcmVzZXQgPSAoKSA9PiB7XG4gICAgdGhpcy5jcmVhdG9yU2VsZWN0b3IudmFsdWUgPSB1bmRlZmluZWQ7XG4gIH1cblxuICBwcml2YXRlIGdldENhc2VJREF0dHJpYnV0ZU5hbWUgPSAoKSA9PiB7XG4gICAgbGV0IGNhc2VJZEF0dHJpYjogYW55O1xuICAgIHRoaXMuY2FzZVR5cGUuYXR0cmlidXRlcy5mb3JFYWNoKChhdHRyaWJ1dGUpID0+IHtcbiAgICAgIGlmIChhdHRyaWJ1dGUuaXNJZGVudGlmaWVyKSB7XG4gICAgICAgIGNhc2VJZEF0dHJpYiA9IGF0dHJpYnV0ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gY2FzZUlkQXR0cmliO1xuICB9XG5cbiAgcHVibGljIHJlZnJlc2ggPSAoKSA9PiB7XG4gICAgLy8gcmV0cmlldmUgdGhlIHNjaGVtYSBmb3IgdGhpcyBjYXNlIHR5cGUgc28gd2UgY2FuIGRpc3BsYXkgY2FzZSBjcmVhdG9ycyBhbmQgY2FzZSBhY3Rpb25zIGZvciB0aGlzIGNhc2UgdHlwZVxuICAgIHRoaXMubGl2ZWFwcHMuZ2V0Q2FzZVR5cGVTY2hlbWEodGhpcy5zYW5kYm94SWQsIHRoaXMuYXBwSWQsIDEwMClcbiAgICAuc3Vic2NyaWJlKHNjaGVtYSA9PiB7XG4gICAgICB0aGlzLmFwcFNjaGVtYSA9IHNjaGVtYTtcbiAgICAgIHNjaGVtYS5jYXNldHlwZXMuZm9yRWFjaCgoY2FzZXR5cGUpID0+IHtcbiAgICAgICAgICAvLyB0aGUgc2NoZW1hIHdpbGwgY29udGFpbiBkZWZpbml0aW9ucyBmb3IgYm90aCB0aGUgJ2Nhc2UnIGFuZCBhbnkgZGVmaW5lZCB0eXBlcyBpbiB0aGF0IGNhc2UuXG4gICAgICAgICAgLy8gV2Ugd2FudCB0aGUgc2NoZW1hIGZvciB0aGlzICdjYXNlJy5cbiAgICAgICAgICBpZiAoY2FzZXR5cGUuYXBwbGljYXRpb25JZCA9PT0gdGhpcy5hcHBJZCAmJiBjYXNldHlwZS5pZCA9PT0gdGhpcy50eXBlSWQpIHtcbiAgICAgICAgICAgIGlmIChjYXNldHlwZS5qc29uU2NoZW1hICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgdGhpcy5jYXNlVHlwZSA9IGNhc2V0eXBlO1xuICAgICAgICAgICAgICB0aGlzLmNhc2VDcmVhdG9yTGlzdCA9IGNhc2V0eXBlLmNyZWF0b3JzID8gY2FzZXR5cGUuY3JlYXRvcnMgOiBbXTtcbiAgICAgICAgICAgICAgaWYgKHRoaXMuY2FzZUNyZWF0b3JMaXN0Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0UHJvY2Vzcyh0aGlzLmNhc2VDcmVhdG9yTGlzdFswXSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ05vIHNjaGVtYSByZXR1cm5lZCBmb3IgdGhpcyBjYXNlIHR5cGU6IFlvdSBtYXkgbmVlZCB0byB1cGRhdGUvcmUtZGVwbG95IHRoZSBsaXZlIGFwcHMgYXBwbGljYXRpb24nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfVxuICAgICk7XG4gIH1cblxuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBsaXZlYXBwczogTGl2ZUFwcHNTZXJ2aWNlKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBpZiAoY2hhbmdlcy5hcHBJZCAmJiAoY2hhbmdlcy5hcHBJZC5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXMuYXBwSWQucHJldmlvdXNWYWx1ZSkpIHtcbiAgICAgICAgdGhpcy5jYXNlQ3JlYXRvckxpc3QgPSBbXTtcbiAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgIH1cbiAgfVxufVxuIl19