/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * @ngdoc component
 * @name RenderedFormComponent
 *
 * @description
 * `<tcfrm-rendered-form>` is a component providing the ability to reneder a form using the third party angular6-json-form library.
 *
 * @usage
 *
 * This component is used by tc--liveapps-lib to render forms based on a JSON schema that is supplied by the liveapps API
 *
 * It is located into this dedicated library to make it easier to plug in an alternative form rendering library
 *
 */
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import { CustomFormDefs } from '../../models/tc-custom-forms';
var RenderedFormComponent = /** @class */ (function () {
    function RenderedFormComponent(route) {
        var _this = this;
        this.route = route;
        this.schema = {};
        this.layout = [];
        this.data = {};
        this.formsFramework = this.formsFramework ? this.formsFramework : 'material-design';
        /**
         * ~event formSubmit : form submitted
         * ~payload any : data submitted from the form on submit (type=any)
         */
        this.formSubmit = new EventEmitter();
        this.formData = {};
        this.submitForm = (/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            console.warn('*** Forms: Submitting form with payload: ', data);
            console.warn('*** Forms: JSON: ', JSON.stringify(data));
            _this.formSubmit.emit(data);
        });
        this.handleLayoutOutput = (/**
         * @param {?} layout
         * @return {?}
         */
        function (layout) {
            console.log('Layout:');
            console.log(JSON.stringify(layout));
        });
        this.onChanges = (/**
         * @param {?} $event
         * @return {?}
         */
        function ($event) {
            _this.data = $event;
        });
    }
    /**
     * @return {?}
     */
    RenderedFormComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    RenderedFormComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        // handle input param changes
        if (this.customFormDefs && changes.formRef && changes.formRef.currentValue && (changes.formRef.currentValue !== changes.formRef.previousValue)) {
            // check if this is a custom form
            if (this.customFormDefs && this.customFormDefs.customForms) {
                this.useCustomForm = (this.customFormDefs.customForms.findIndex((/**
                 * @param {?} form
                 * @return {?}
                 */
                function (form) {
                    return (form === changes.formRef.currentValue);
                })) !== -1);
            }
            console.warn('*** Forms: Custom Form configuration (customForm.json): ', this.customFormDefs);
            if (this.useCustomForm) {
                console.warn('*** Forms: > Using custom form (formRef):', this.formRef);
            }
            else {
                console.warn('*** Forms: > Using auto-rendered form (formRef):', this.formRef);
            }
        }
        if (changes.schema && changes.schema.currentValue && (changes.schema.currentValue !== changes.schema.previousValue)) {
            /** @type {?} */
            var tmpSchema = changes.schema.currentValue;
            // json-schema-form doesnt like the $schema and wont parse the schema if it is present. So remove it.
            if (changes.schema.currentValue.$schema) {
                delete tmpSchema.$schema;
            }
            this.formSchema = tmpSchema;
            console.warn('*** Forms: Form Schema: ', JSON.stringify(this.formSchema));
        }
        if (changes.data && changes.data.currentValue && (changes.data.currentValue !== changes.data.previousValue)) {
            this.formData = this.data;
            console.warn('*** Forms: Initial Form Data:', this.formData);
            console.warn('*** Forms: Initial Form Data (JSON):', JSON.stringify(this.formData));
        }
        if (changes.layout && changes.layout.currentValue && (changes.layout.currentValue !== changes.layout.previousValue)) {
            this.formLayout = this.layout;
        }
    };
    RenderedFormComponent.decorators = [
        { type: Component, args: [{
                    selector: 'tcfrm-rendered-form',
                    template: "<div fxFill fxLayout=\"row\" fxLayoutAlign = \"center start\">\n  <div class=\"tcs-rendered-form\">\n    <json-schema-form #renderedForm *ngIf=\"!useCustomForm && formSchema\"\n      loadExternalAssets=\"false\"\n      [framework]=\"formsFramework\"\n      [schema]=\"formSchema\"\n      [layout]=\"formLayout\"\n      [data]=\"formData\"\n      [options]=\"options\"\n      (onChanges)=\"onChanges($event)\"\n      (onSubmit)=\"submitForm($event)\"\n      (formLayout)=\"handleLayoutOutput($event)\"\n    >\n    </json-schema-form>\n\n    <!-- form-app=\"''\" - this is to work around an issue where the element doesnt display the form properly unless we pass in an additional input - angular bug? -->\n    <custom-form *ngIf=\"useCustomForm && formRef && formData && appId\" form-app=\"''\" [formRef]=\"formRef\" [caseRef]=\"caseRef\" [appId]=\"appId\" [data]=\"formData\" (formSubmitted)=\"submitForm($event.detail)\"></custom-form>\n    <span *ngIf=\"!formSchema && !useCustomForm\">A form cannot be generated as no schema is available. Use a supported form or register a custom form app.</span>\n  </div>\n</div>\n",
                    styles: [".tcs-rendered-form{box-shadow:0 2px 8px 0 #dedede;background-color:#fff;width:100%;padding:20px}"]
                }] }
    ];
    /** @nocollapse */
    RenderedFormComponent.ctorParameters = function () { return [
        { type: ActivatedRoute }
    ]; };
    RenderedFormComponent.propDecorators = {
        schema: [{ type: Input }],
        layout: [{ type: Input }],
        data: [{ type: Input }],
        options: [{ type: Input }],
        formRef: [{ type: Input }],
        caseRef: [{ type: Input }],
        appId: [{ type: Input }],
        formsFramework: [{ type: Input }],
        customFormDefs: [{ type: Input }],
        formSubmit: [{ type: Output }]
    };
    return RenderedFormComponent;
}());
export { RenderedFormComponent };
if (false) {
    /** @type {?} */
    RenderedFormComponent.prototype.schema;
    /** @type {?} */
    RenderedFormComponent.prototype.layout;
    /** @type {?} */
    RenderedFormComponent.prototype.data;
    /** @type {?} */
    RenderedFormComponent.prototype.options;
    /** @type {?} */
    RenderedFormComponent.prototype.formRef;
    /** @type {?} */
    RenderedFormComponent.prototype.caseRef;
    /** @type {?} */
    RenderedFormComponent.prototype.appId;
    /** @type {?} */
    RenderedFormComponent.prototype.formsFramework;
    /** @type {?} */
    RenderedFormComponent.prototype.customFormDefs;
    /**
     * ~event formSubmit : form submitted
     * ~payload any : data submitted from the form on submit (type=any)
     * @type {?}
     */
    RenderedFormComponent.prototype.formSubmit;
    /** @type {?} */
    RenderedFormComponent.prototype.formSchema;
    /** @type {?} */
    RenderedFormComponent.prototype.formLayout;
    /** @type {?} */
    RenderedFormComponent.prototype.formData;
    /** @type {?} */
    RenderedFormComponent.prototype.test;
    /** @type {?} */
    RenderedFormComponent.prototype.useCustomForm;
    /** @type {?} */
    RenderedFormComponent.prototype.submitForm;
    /** @type {?} */
    RenderedFormComponent.prototype.handleLayoutOutput;
    /** @type {?} */
    RenderedFormComponent.prototype.onChanges;
    /**
     * @type {?}
     * @protected
     */
    RenderedFormComponent.prototype.route;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyZWQtZm9ybS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdGliY28tdGNzdGsvdGMtZm9ybXMtbGliLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcmVuZGVyZWQtZm9ybS9yZW5kZXJlZC1mb3JtLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFlQSxPQUFPLEVBQUMsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQXFCLE1BQU0sRUFBZ0IsTUFBTSxlQUFlLENBQUM7QUFFdkcsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw4QkFBOEIsQ0FBQztBQUU1RDtJQXNDRSwrQkFBc0IsS0FBcUI7UUFBM0MsaUJBQWdEO1FBQTFCLFVBQUssR0FBTCxLQUFLLENBQWdCO1FBaENsQyxXQUFNLEdBQVEsRUFBRSxDQUFDO1FBQ2pCLFdBQU0sR0FBVSxFQUFFLENBQUM7UUFDbkIsU0FBSSxHQUFRLEVBQUUsQ0FBQztRQUtmLG1CQUFjLEdBQVcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUM7Ozs7O1FBTXRGLGVBQVUsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUlsRSxhQUFRLEdBQVEsRUFBRSxDQUFDO1FBSW5CLGVBQVU7Ozs7UUFBRyxVQUFDLElBQVM7WUFDckIsT0FBTyxDQUFDLElBQUksQ0FBQywyQ0FBMkMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNoRSxPQUFPLENBQUMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUN4RCxLQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM3QixDQUFDLEVBQUE7UUFFRCx1QkFB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LFlBQVksS0FBSyxPQUFPLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxFQUFFO1lBQ25ILElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztTQUMvQjtJQUNILENBQUM7O2dCQTVFRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLHFCQUFxQjtvQkFDL0IsMm1DQUE2Qzs7aUJBRTlDOzs7O2dCQVBPLGNBQWM7Ozt5QkFTbkIsS0FBSzt5QkFDTCxLQUFLO3VCQUNMLEtBQUs7MEJBQ0wsS0FBSzswQkFDTCxLQUFLOzBCQUNMLEtBQUs7d0JBQ0wsS0FBSztpQ0FDTCxLQUFLO2lDQUNMLEtBQUs7NkJBS0wsTUFBTTs7SUFnRVQsNEJBQUM7Q0FBQSxBQW5GRCxJQW1GQztTQTlFWSxxQkFBcUI7OztJQUNoQyx1Q0FBMEI7O0lBQzFCLHVDQUE0Qjs7SUFDNUIscUNBQXdCOztJQUN4Qix3Q0FBd0I7O0lBQ3hCLHdDQUF5Qjs7SUFDekIsd0NBQXlCOztJQUN6QixzQ0FBdUI7O0lBQ3ZCLCtDQUFnRzs7SUFDaEcsK0NBQXdDOzs7Ozs7SUFLeEMsMkNBQWtFOztJQUVsRSwyQ0FBZ0I7O0lBQ2hCLDJDQUFrQjs7SUFDbEIseUNBQW1COztJQUNuQixxQ0FBYTs7SUFDYiw4Q0FBdUI7O0lBRXZCLDJDQUlDOztJQUVELG1EQUdDOztJQTBDRCwwQ0FFQzs7Ozs7SUExQ1csc0NBQStCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbmdkb2MgY29tcG9uZW50XG4gKiBAbmFtZSBSZW5kZXJlZEZvcm1Db21wb25lbnRcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIGA8dGNmcm0tcmVuZGVyZWQtZm9ybT5gIGlzIGEgY29tcG9uZW50IHByb3ZpZGluZyB0aGUgYWJpbGl0eSB0byByZW5lZGVyIGEgZm9ybSB1c2luZyB0aGUgdGhpcmQgcGFydHkgYW5ndWxhcjYtanNvbi1mb3JtIGxpYnJhcnkuXG4gKlxuICogQHVzYWdlXG4gKlxuICogVGhpcyBjb21wb25lbnQgaXMgdXNlZCBieSB0Yy0tbGl2ZWFwcHMtbGliIHRvIHJlbmRlciBmb3JtcyBiYXNlZCBvbiBhIEpTT04gc2NoZW1hIHRoYXQgaXMgc3VwcGxpZWQgYnkgdGhlIGxpdmVhcHBzIEFQSVxuICpcbiAqIEl0IGlzIGxvY2F0ZWQgaW50byB0aGlzIGRlZGljYXRlZCBsaWJyYXJ5IHRvIG1ha2UgaXQgZWFzaWVyIHRvIHBsdWcgaW4gYW4gYWx0ZXJuYXRpdmUgZm9ybSByZW5kZXJpbmcgbGlicmFyeVxuICpcbiAqL1xuXG5pbXBvcnQge0NvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQsIE91dHB1dCwgU2ltcGxlQ2hhbmdlc30gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0pzb25TY2hlbWFGb3JtQ29tcG9uZW50LCBNYXRlcmlhbERlc2lnbkZyYW1ld29ya01vZHVsZX0gZnJvbSAnYW5ndWxhcjYtanNvbi1zY2hlbWEtZm9ybSc7XG5pbXBvcnQge0FjdGl2YXRlZFJvdXRlfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHtDdXN0b21Gb3JtRGVmc30gZnJvbSAnLi4vLi4vbW9kZWxzL3RjLWN1c3RvbS1mb3Jtcyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RjZnJtLXJlbmRlcmVkLWZvcm0nLFxuICB0ZW1wbGF0ZVVybDogJy4vcmVuZGVyZWQtZm9ybS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3JlbmRlcmVkLWZvcm0uY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIFJlbmRlcmVkRm9ybUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgQElucHV0KCkgc2NoZW1hOiBhbnkgPSB7fTtcbiAgQElucHV0KCkgbGF5b3V0OiBhbnlbXSA9IFtdO1xuICBASW5wdXQoKSBkYXRhOiBhbnkgPSB7fTtcbiAgQElucHV0KCkgb3B0aW9uczogYW55W107XG4gIEBJbnB1dCgpIGZvcm1SZWY6IHN0cmluZztcbiAgQElucHV0KCkgY2FzZVJlZjogc3RyaW5nO1xuICBASW5wdXQoKSBhcHBJZDogc3RyaW5nO1xuICBASW5wdXQoKSBmb3Jtc0ZyYW1ld29yazogc3RyaW5nID0gdGhpcy5mb3Jtc0ZyYW1ld29yayA/IHRoaXMuZm9ybXNGcmFtZXdvcmsgOiAnbWF0ZXJpYWwtZGVzaWduJztcbiAgQElucHV0KCkgY3VzdG9tRm9ybURlZnM6IEN1c3RvbUZvcm1EZWZzO1xuICAvKipcbiAgICogfmV2ZW50IGZvcm1TdWJtaXQgOiBmb3JtIHN1Ym1pdHRlZFxuICAgKiB+cGF5bG9hZCBhbnkgOiBkYXRhIHN1Ym1pdHRlZCBmcm9tIHRoZSBmb3JtIG9uIHN1Ym1pdCAodHlwZT1hbnkpXG4gICAqL1xuICBAT3V0cHV0KCkgZm9ybVN1Ym1pdDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBmb3JtU2NoZW1hOiBhbnk7XG4gIGZvcm1MYXlvdXQ6IGFueVtdO1xuICBmb3JtRGF0YTogYW55ID0ge307XG4gIHRlc3Q6IHN0cmluZztcbiAgdXNlQ3VzdG9tRm9ybTogYm9vbGVhbjtcblxuICBzdWJtaXRGb3JtID0gKGRhdGE6IGFueSkgPT4ge1xuICAgIGNvbnNvbGUud2FybignKioqIEZvcm1zOiBTdWJtaXR0aW5nIGZvcm0gd2l0aCBwYXlsb2FkOiAnLCBkYXRhKTtcbiAgICBjb25zb2xlLndhcm4oJyoqKiBGb3JtczogSlNPTjogJywgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgIHRoaXMuZm9ybVN1Ym1pdC5lbWl0KGRhdGEpO1xuICB9XG5cbiAgaGFuZGxlTGF5b3V0T3V0cHV0ID0gKGxheW91dDogYW55KSA9PiB7XG4gICAgY29uc29sZS5sb2coJ0xheW91dDonKTtcbiAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShsYXlvdXQpKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCByb3V0ZTogQWN0aXZhdGVkUm91dGUpIHsgfVxuXG4gIG5nT25Jbml0KCkge1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIC8vIGhhbmRsZSBpbnB1dCBwYXJhbSBjaGFuZ2VzXG4gICAgaWYgKHRoaXMuY3VzdG9tRm9ybURlZnMgJiYgY2hhbmdlcy5mb3JtUmVmICYmIGNoYW5nZXMuZm9ybVJlZi5jdXJyZW50VmFsdWUgJiYgKGNoYW5nZXMuZm9ybVJlZi5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXMuZm9ybVJlZi5wcmV2aW91c1ZhbHVlKSkge1xuICAgICAgLy8gY2hlY2sgaWYgdGhpcyBpcyBhIGN1c3RvbSBmb3JtXG4gICAgICBpZiAodGhpcy5jdXN0b21Gb3JtRGVmcyAmJiB0aGlzLmN1c3RvbUZvcm1EZWZzLmN1c3RvbUZvcm1zKSB7XG4gICAgICAgIHRoaXMudXNlQ3VzdG9tRm9ybSA9ICh0aGlzLmN1c3RvbUZvcm1EZWZzLmN1c3RvbUZvcm1zLmZpbmRJbmRleCgoZm9ybSkgPT4ge1xuICAgICAgICAgIHJldHVybiAoZm9ybSA9PT0gY2hhbmdlcy5mb3JtUmVmLmN1cnJlbnRWYWx1ZSk7XG4gICAgICAgIH0pICE9PSAtMSk7XG4gICAgICB9XG4gICAgICBjb25zb2xlLndhcm4oJyoqKiBGb3JtczogQ3VzdG9tIEZvcm0gY29uZmlndXJhdGlvbiAoY3VzdG9tRm9ybS5qc29uKTogJywgdGhpcy5jdXN0b21Gb3JtRGVmcyk7XG4gICAgICBpZiAodGhpcy51c2VDdXN0b21Gb3JtKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignKioqIEZvcm1zOiA+IFVzaW5nIGN1c3RvbSBmb3JtIChmb3JtUmVmKTonLCB0aGlzLmZvcm1SZWYpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS53YXJuKCcqKiogRm9ybXM6ID4gVXNpbmcgYXV0by1yZW5kZXJlZCBmb3JtIChmb3JtUmVmKTonLCB0aGlzLmZvcm1SZWYpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoY2hhbmdlcy5zY2hlbWEgJiYgY2hhbmdlcy5zY2hlbWEuY3VycmVudFZhbHVlICYmIChjaGFuZ2VzLnNjaGVtYS5jdXJyZW50VmFsdWUgIT09IGNoYW5nZXMuc2NoZW1hLnByZXZpb3VzVmFsdWUpKSB7XG4gICAgICBjb25zdCB0bXBTY2hlbWEgPSBjaGFuZ2VzLnNjaGVtYS5jdXJyZW50VmFsdWU7XG4gICAgICAvLyBqc29uLXNjaGVtYS1mb3JtIGRvZXNudCBsaWtlIHRoZSAkc2NoZW1hIGFuZCB3b250IHBhcnNlIHRoZSBzY2hlbWEgaWYgaXQgaXMgcHJlc2VudC4gU28gcmVtb3ZlIGl0LlxuICAgICAgaWYgKGNoYW5nZXMuc2NoZW1hLmN1cnJlbnRWYWx1ZS4kc2NoZW1hKSB7XG4gICAgICAgIGRlbGV0ZSB0bXBTY2hlbWEuJHNjaGVtYTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZm9ybVNjaGVtYSA9IHRtcFNjaGVtYTtcbiAgICAgIGNvbnNvbGUud2FybignKioqIEZvcm1zOiBGb3JtIFNjaGVtYTogJywgSlNPTi5zdHJpbmdpZnkodGhpcy5mb3JtU2NoZW1hKSk7XG4gICAgfVxuICAgIGlmIChjaGFuZ2VzLmRhdGEgJiYgY2hhbmdlcy5kYXRhLmN1cnJlbnRWYWx1ZSAmJiAoY2hhbmdlcy5kYXRhLmN1cnJlbnRWYWx1ZSAhPT0gY2hhbmdlcy5kYXRhLnByZXZpb3VzVmFsdWUpKSB7XG4gICAgICB0aGlzLmZvcm1EYXRhID0gdGhpcy5kYXRhO1xuICAgICAgY29uc29sZS53YXJuKCcqKiogRm9ybXM6IEluaXRpYWwgRm9ybSBEYXRhOicsIHRoaXMuZm9ybURhdGEpO1xuICAgICAgY29uc29sZS53YXJuKCcqKiogRm9ybXM6IEluaXRpYWwgRm9ybSBEYXRhIChKU09OKTonLCBKU09OLnN0cmluZ2lmeSh0aGlzLmZvcm1EYXRhKSk7XG4gICAgfVxuICAgIGlmIChjaGFuZ2VzLmxheW91dCAmJiBjaGFuZ2VzLmxheW91dC5jdXJyZW50VmFsdWUgJiYgKGNoYW5nZXMubGF5b3V0LmN1cnJlbnRWYWx1ZSAhPT0gY2hhbmdlcy5sYXlvdXQucHJldmlvdXNWYWx1ZSkpIHtcbiAgICAgIHRoaXMuZm9ybUxheW91dCA9IHRoaXMubGF5b3V0O1xuICAgIH1cbiAgfVxuXG4gIG9uQ2hhbmdlcyA9ICgkZXZlbnQpID0+IHtcbiAgICB0aGlzLmRhdGEgPSAkZXZlbnQ7XG4gIH1cblxuXG59XG4iXX0=