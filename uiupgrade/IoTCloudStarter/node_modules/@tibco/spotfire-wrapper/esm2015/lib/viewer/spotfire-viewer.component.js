/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// Copyright (c) 2018-2018. TIBCO Software Inc. All Rights Reserved. Confidential & Proprietary.
import { Component, Input, EventEmitter, ViewChild, ElementRef, Output, ViewEncapsulation } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { tap } from 'rxjs/operators';
import { SpotfireCustomization, SpotfireFilter } from '../spotfire-customization';
import { DocMetadata, SpotfireParameters } from '../spotfire-webplayer';
import { DocumentService } from '../document.service';
export class SpotfireViewerComponent {
    /**
     * @param {?} docSvc
     */
    constructor(docSvc) {
        this.docSvc = docSvc;
        /**
         * \@description
         * print debug logs to JS console. Default to false
         */
        this.debug = false;
        this.maxRows = 10;
        this.spotParams = new SpotfireParameters();
        this.errorMessages = [];
        this.edit = false;
        /* Filtering observables, emitter and subject*/
        this.filterSubject = new BehaviorSubject([]);
        this.filter$ = this.filterSubject.asObservable();
        /**
         * \@description
         * Optional. emit filters set by user in dashboard
         */
        this.filteringEvent = new EventEmitter(false);
        /* Marking observables, emitter and subject*/
        this.markerSubject = new BehaviorSubject({});
        this.marker$ = this.markerSubject.asObservable();
        /**
         * \@description
         * Optional. emit marking set by user in dashboard
         */
        this.markingEvent = new EventEmitter(false);
        this.markedRows = {};
        this.longTime = false;
        this.doConsole = (/**
         * @param {...?} args
         * @return {?}
         */
        (...args) => this.debug && console.log('[SPOTFIRE-VIEWER]', ...args));
        this.ngOnChanges = (/**
         * @param {?} changes
         * @return {?}
         */
        (changes) => {
            if (!!changes) {
                this.display(changes);
            }
        });
        this.stopPropagation = (/**
         * @param {?} e
         * @return {?}
         */
        (e) => e.stopPropagation());
        this.isMarkingWiredUp = (/**
         * @return {?}
         */
        () => this.markingEvent.observers.length > 0);
        this.isFiltingWiredUp = (/**
         * @return {?}
         */
        () => this.filteringEvent.observers.length > 0);
        this.displayErrorMessage = (/**
         * @param {?} message
         * @return {?}
         */
        (message) => {
            console.error('ERROR:', message);
            this.errorMessages.push(message);
            if (!this.spotParams.document) {
                // Do not display the info Message when document is running
                this.spot.nativeElement.style.fontFamily = 'monospace';
                this.spot.nativeElement.style.color = '#e82127';
                this.spot.nativeElement.style.textAlign = 'center';
                this.spot.nativeElement.style.padding = '30px';
                this.spot.nativeElement.textContent = this.errorMessages.join('<br>');
            }
        });
        this.displayInfoMessage = (/**
         * @param {?} message
         * @return {?}
         */
        (message) => {
            console.log(message);
            if (!this.spotParams.document && this.debug) {
                // Do not display the info Message when document is running
                this.spot.nativeElement.style.fontFamily = 'monospace';
                this.spot.nativeElement.style.color = 'black';
                this.spot.nativeElement.style.textAlign = 'center';
                this.spot.nativeElement.textContent = message;
            }
        });
        this.afterDisplay = (/**
         * @param {?} doc
         * @return {?}
         */
        (doc) => {
            this.doConsole(`SpotfireViewerComponent openPage(${this.spotParams.page}) returns`, doc);
            this.document = doc;
            if (this.filters && this.document.getFiltering()) {
                /** @type {?} */
                const flt = this.document.getFiltering();
                flt.resetAllFilters();
                /*
                this.doConsole(`SpotfireViewerComponent set Filter(avant)`, this.filters);
                (this.filters as Array<SpotfireFilter>).forEach(t => t.setFilterType(spotfire));
                this.doConsole(`SpotfireViewerComponent set Filter(apres)`, this.filters);
              */
                flt.set(this.filters);
                this.loadFilters();
                this.doConsole('FILTER', this.filters);
            }
            this.doForm(this.document);
            if (this.markingOn) {
                // Clear marking
                this.markerSubject.next({});
                this.document.getData().getTables$()
                    .pipe(tap((/**
                 * @param {?} allTableNames
                 * @return {?}
                 */
                allTableNames => this.doConsole(`All tables and column names:`, allTableNames))))
                    .subscribe((/**
                 * @param {?} allTableNames
                 * @return {?}
                 */
                allTableNames => this.document.getMarking().getMarkingNames$()
                    .pipe(tap((/**
                 * @param {?} markingNames
                 * @return {?}
                 */
                markingNames => this.doConsole(`All marking names:`, markingNames))))
                    .subscribe((/**
                 * @param {?} markingNames
                 * @return {?}
                 */
                markingNames => markingNames.forEach((/**
                 * @param {?} markingName
                 * @return {?}
                 */
                markingName => {
                    /** @type {?} */
                    const tableNames = this.markingOn === '*' ? allTableNames : this.markingOn;
                    Object.keys(tableNames).forEach((/**
                     * @param {?} tName
                     * @return {?}
                     */
                    tName => {
                        /** @type {?} */
                        let columnNames = this.markingOn === '*' ? allTableNames[tName] : tableNames[tName];
                        if (columnNames.length === 1 && columnNames[0] === '*') {
                            columnNames = allTableNames[tName];
                        }
                        this.doConsole(`marking.onChanged(${markingName}, ${tName}, ${JSON.stringify(columnNames)}, ${this.maxRows})`);
                        this.document.getMarking().onChanged$(markingName, tName, columnNames, this.maxRows)
                            .subscribe((/**
                         * @param {?} f
                         * @return {?}
                         */
                        f => this.updateMarking(tName, markingName, f)));
                    }));
                }))))));
            }
            if (this.isFiltingWiredUp()) {
                this.doConsole('we have observers for filtering');
                // Subscribe to filteringEvent and emit the result to the Output if filter panel is displayed
                //
                this.filter$.pipe(tap((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => this.doConsole('Emit filter', f))))
                    .subscribe((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => this.filteringEvent.emit(f)));
            }
            if (this.isMarkingWiredUp()) {
                this.doConsole('we have observers for marking');
                // Subscribe to markingEvent and emit the result to the Output
                //
                this.marker$.pipe(tap((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => this.doConsole('Emit marking', f))))
                    .subscribe((/**
                 * @param {?} f
                 * @return {?}
                 */
                f => this.markingEvent.emit(f)));
            }
            // console.log('YES loadFilters');
            // setInterval(() => this.loadFilters(), 3000);
        });
        /**
         * \@description
         * Callback method played when marking changes are detected.
         *
         * Will gather all marking and emit an event back to caller.
         *
         * @param tName Table name
         * @param mName Maring name
         * @param res marked rows returned by Spotfire
         */
        this.updateMarking = (/**
         * @param {?} tName
         * @param {?} mName
         * @param {?} res
         * @return {?}
         */
        (tName, mName, res) => {
            if (Object.keys(res).length > 0) {
                this.doConsole(`We have marked rows on marking '${mName}' for table '${tName}':`, res);
                // update the marked row if partial selection
                //
                if (!this.markedRows[mName]) {
                    this.markedRows[mName] = {};
                }
                if (!this.markedRows[mName][tName]) {
                    this.markedRows[mName][tName] = res;
                }
                else {
                    this.markedRows[mName][tName] = Object.assign(this.markedRows[mName][tName], res);
                }
                //   this.doConsole('[MARKING] on publie', this.markedRows);
                this.markerSubject.next(this.markedRows);
            }
            else if (this.markedRows[mName] && this.markedRows[mName][tName]) {
                // remove the marked row if no marking
                //
                delete this.markedRows[mName][tName];
                if (Object.keys(this.markedRows[mName]).length === 0) {
                    delete this.markedRows[mName];
                }
                this.markerSubject.next(this.markedRows);
            }
            else {
                //  this.doConsole(`No rows are marked on marking '${mName}' for table '${tName}'`);
            }
            this.loadFilters();
        });
        console.log('SPOTFIRE WRAPPER - 10 juillet - Angular 8');
        this.doConsole('Welcome !');
        setTimeout((/**
         * @return {?}
         */
        () => this.longTime = true), 6000);
    }
    /**
     * \@description
     * Optional. Load parameters for the analysis.
     * @param {?} value
     * @return {?}
     */
    set parameters(value) {
        this._parameters = value;
        this.spotParams._parameters = value;
        if (this.app) {
            this.openPath(this.path);
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.doConsole('OnInit', this.url, this.path);
        this.display();
    }
    /**
     * \@description
     * Redraw the dashboard.
     * Depending on nature of change (url/path/page) the dashboard is fully refreshed or adjusted accordingly
     * @param {?=} changes The list of changes to apply
     * @return {?}
     */
    display(changes) {
        this.doConsole('Display', changes);
        if (typeof this.customization === 'string') {
            this.customization = new SpotfireCustomization(JSON.parse(this.customization));
        }
        else {
            this.customization = new SpotfireCustomization(this.customization);
        }
        if (typeof this.filters === 'string') {
            /** @type {?} */
            const allFilters = [];
            JSON.parse(this.filters).forEach((/**
             * @param {?} m
             * @return {?}
             */
            (m) => allFilters.push(new SpotfireFilter(m))));
            this.filters = allFilters;
        }
        if (typeof this.markingOn === 'string' && this.markingOn !== '*') {
            this.markingOn = JSON.parse(this.markingOn);
        }
        this.doConsole('display', changes, this.url, this.path, 'PAGE=', this.page, this.customization, this.maxRows, this.app, this.markingOn);
        if (!changes || changes.url) {
            this.openWebPlayer(this.url, this.path, this.customization);
        }
        else if (this.app && changes.page) {
            this.openPage(this.page);
        }
        else {
            this.doConsole(`The Url attribute is not provided, flip the dashboard and display form!`);
            this.edit = true;
            this.metadata = new DocMetadata();
        }
    }
    /**
     * \@description
     * Get Spotfire JavaScript API (webPlayer) from url
     *
     * When a componenet is initiated or url is updated, it lazy loads the library
     * Once loaded it opens the path.
     *
     * @protected
     * @param {?} url the webPlayer server url
     * @param {?} path the path to the page
     * @param {?} customization
     * @return {?}
     */
    openWebPlayer(url, path, customization) {
        this.edit = false;
        this.url = url;
        this.path = path;
        this.customization = customization;
        this.doConsole(`SpotfireViewerComponent openWebPlayer(${url})`);
        this.displayInfoMessage(`${this.url}...`);
        // Create a Unique ID for this Spotfire dashboard
        //
        this.spot.nativeElement.id = this.sid ? this.sid : new Date().getTime();
        this.spotParams = Object.assign({}, this.spotParams, { path, url, customization, domid: this.spot.nativeElement.id, page: this.page });
        this.docSvc.openWebPlayer$(this.spotParams).subscribe((/**
         * @param {?} doc
         * @return {?}
         */
        doc => this.afterDisplay(doc)), (/**
         * @param {?} err
         * @return {?}
         */
        err => this.displayErrorMessage(err)));
    }
    /**
     * \@description
     * Open the path using JavaScript API (spotfire.webPlayer.createApplication)
     *
     * @protected
     * @param {?} path the absolute analysis path
     * @return {?}
     */
    openPath(path) {
        this.path = path;
        this.displayInfoMessage(`${this.url}/${path}...`);
        this.doConsole(`SpotfireViewerComponent openPath(${path})`, this.sid);
        this.spotParams = Object.assign({}, this.spotParams, { path, domid: this.spot.nativeElement.id });
        this.docSvc.openPath$(this.spotParams).subscribe((/**
         * @param {?} doc
         * @return {?}
         */
        doc => this.afterDisplay(doc)), (/**
         * @param {?} err
         * @return {?}
         */
        err => this.displayErrorMessage(err)));
    }
    /**
     * @protected
     * @param {?} doc
     * @return {?}
     */
    doForm(doc) { }
    /**
     * \@description
     * Open the Document page
     *
     * @param {?} page the document page that will be displayed
     * @return {?}
     */
    openPage(page) {
        this.displayInfoMessage(`${this.url}/${this.path}/${page ? page : ''}...`);
        this.doConsole(`SpotfireViewerComponent openPage(${page})`);
        this.page = page;
        this.spotParams = Object.assign({}, this.spotParams, { page });
        /** @type {?} */
        const p = this.spotParams;
        this.docSvc.openPage$(p).subscribe((/**
         * @param {?} doc
         * @return {?}
         */
        doc => this.afterDisplay(doc)));
    }
    /**
     * \@description
     * Emit to caller the filters
     * @private
     * @return {?}
     */
    loadFilters() {
        //  console.log('AA Nicolas loadFilters BLOUP ! (19 juin 2019)');
        if (this.isFiltingWiredUp()) {
            this.document.getFiltering().getAllModifiedFilterColumns()
                .subscribe((/**
             * @param {?} fs
             * @return {?}
             */
            fs => this.filterSubject.next(fs)));
        }
        //    this.document.getFiltering().getAllModifiedFilterColumns()
        //      .subscribe(fs => console.log('les FILTERS:', fs));
    }
}
SpotfireViewerComponent.decorators = [
    { type: Component, args: [{
                selector: 'spotfire-viewer',
                exportAs: 'spotfireViewer',
                template: "<div style='height:100%; border:2px dashed green; border-radius:8px' #spot></div>",
                encapsulation: ViewEncapsulation.None
            }] }
];
/** @nocollapse */
SpotfireViewerComponent.ctorParameters = () => [
    { type: DocumentService }
];
SpotfireViewerComponent.propDecorators = {
    debug: [{ type: Input }],
    url: [{ type: Input }],
    path: [{ type: Input }],
    page: [{ type: Input }],
    sid: [{ type: Input }],
    customization: [{ type: Input }],
    filters: [{ type: Input }],
    markingOn: [{ type: Input }],
    maxRows: [{ type: Input }],
    parameters: [{ type: Input }],
    spot: [{ type: ViewChild, args: ['spot', { static: true, read: ElementRef },] }],
    filteringEvent: [{ type: Output }],
    markingEvent: [{ type: Output }]
};
if (false) {
    /**
     * \@description
     * print debug logs to JS console. Default to false
     * @type {?}
     */
    SpotfireViewerComponent.prototype.debug;
    /**
     * \@description
     * The URL to the Web Player server
     * @type {?}
     */
    SpotfireViewerComponent.prototype.url;
    /**
     * \@description
     * The path in the library to the analysis to open.
     * @type {?}
     */
    SpotfireViewerComponent.prototype.path;
    /**
     * \@description
     * Optional initial page. The page can either be expressed
     * as an integer (0-based page index) or as a string (page name).
     * @type {?}
     */
    SpotfireViewerComponent.prototype.page;
    /**
     * \@description
     * Optional unique id to read/write settings from local storage
     * @type {?}
     */
    SpotfireViewerComponent.prototype.sid;
    /**
     * \@description
     * Optional instance of a Customization instance.
     * If set, this will override the customizationInfo instance held by the application.
     * @type {?}
     */
    SpotfireViewerComponent.prototype.customization;
    /**
     * \@description
     * Optional. Array of filters that will be applied once page is loaded.
     * @type {?}
     */
    SpotfireViewerComponent.prototype.filters;
    /** @type {?} */
    SpotfireViewerComponent.prototype.markingOn;
    /** @type {?} */
    SpotfireViewerComponent.prototype.maxRows;
    /**
     * @type {?}
     * @protected
     */
    SpotfireViewerComponent.prototype.spotParams;
    /**
     * @type {?}
     * @private
     */
    SpotfireViewerComponent.prototype._parameters;
    /** @type {?} */
    SpotfireViewerComponent.prototype.spot;
    /** @type {?} */
    SpotfireViewerComponent.prototype.errorMessages;
    /** @type {?} */
    SpotfireViewerComponent.prototype.metadata;
    /** @type {?} */
    SpotfireViewerComponent.prototype.edit;
    /**
     * @type {?}
     * @private
     */
    SpotfireViewerComponent.prototype.document;
    /**
     * @type {?}
     * @private
     */
    SpotfireViewerComponent.prototype.app;
    /**
     * @type {?}
     * @private
     */
    SpotfireViewerComponent.prototype.filterSubject;
    /** @type {?} */
    SpotfireViewerComponent.prototype.filter$;
    /**
     * \@description
     * Optional. emit filters set by user in dashboard
     * @type {?}
     */
    SpotfireViewerComponent.prototype.filteringEvent;
    /**
     * @type {?}
     * @private
     */
    SpotfireViewerComponent.prototype.markerSubject;
    /** @type {?} */
    SpotfireViewerComponent.prototype.marker$;
    /**
     * \@description
     * Optional. emit marking set by user in dashboard
     * @type {?}
     */
    SpotfireViewerComponent.prototype.markingEvent;
    /**
     * @type {?}
     * @private
     */
    SpotfireViewerComponent.prototype.markedRows;
    /** @type {?} */
    SpotfireViewerComponent.prototype.view;
    /** @type {?} */
    SpotfireViewerComponent.prototype.longTime;
    /** @type {?} */
    SpotfireViewerComponent.prototype.doConsole;
    /** @type {?} */
    SpotfireViewerComponent.prototype.ngOnChanges;
    /** @type {?} */
    SpotfireViewerComponent.prototype.stopPropagation;
    /**
     * @type {?}
     * @private
     */
    SpotfireViewerComponent.prototype.isMarkingWiredUp;
    /**
     * @type {?}
     * @private
     */
    SpotfireViewerComponent.prototype.isFiltingWiredUp;
    /**
     * @type {?}
     * @private
     */
    SpotfireViewerComponent.prototype.displayErrorMessage;
    /**
     * @type {?}
     * @private
     */
    SpotfireViewerComponent.prototype.displayInfoMessage;
    /**
     * @type {?}
     * @private
     */
    SpotfireViewerComponent.prototype.afterDisplay;
    /**
     * \@description
     * Callback method played when marking changes are detected.
     *
     * Will gather all marking and emit an event back to caller.
     *
     * \@param tName Table name
     * \@param mName Maring name
     * \@param res marked rows returned by Spotfire
     * @type {?}
     * @private
     */
    SpotfireViewerComponent.prototype.updateMarking;
    /** @type {?} */
    SpotfireViewerComponent.prototype.docSvc;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BvdGZpcmUtdmlld2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B0aWJjby9zcG90ZmlyZS13cmFwcGVyLyIsInNvdXJjZXMiOlsibGliL3ZpZXdlci9zcG90ZmlyZS12aWV3ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsT0FBTyxFQUNMLFNBQVMsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFDekMsVUFBVSxFQUFFLE1BQU0sRUFBNEIsaUJBQWlCLEVBQ2hFLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBYyxlQUFlLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDbkQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxjQUFjLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNsRixPQUFPLEVBQUUsV0FBVyxFQUF5QixrQkFBa0IsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQy9GLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQWN0RCxNQUFNLE9BQU8sdUJBQXVCOzs7O0lBNEZsQyxZQUFtQixNQUF1QjtRQUF2QixXQUFNLEdBQU4sTUFBTSxDQUFpQjs7Ozs7UUF2RmpDLFVBQUssR0FBRyxLQUFLLENBQUM7UUF3Q2QsWUFBTyxHQUFHLEVBQUUsQ0FBQztRQUVaLGVBQVUsR0FBdUIsSUFBSSxrQkFBa0IsRUFBRSxDQUFDO1FBZXBFLGtCQUFhLEdBQUcsRUFBRSxDQUFDO1FBSW5CLFNBQUksR0FBRyxLQUFLLENBQUM7O1FBSUwsa0JBQWEsR0FBRyxJQUFJLGVBQWUsQ0FBWSxFQUFFLENBQUMsQ0FBQztRQUNwRCxZQUFPLEdBQTBCLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxFQUFFLENBQUM7Ozs7O1FBTWhFLG1CQUFjLEdBQXNCLElBQUksWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDOztRQUc5RCxr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QUV0Qiw2Q0FBb0U7Ozs7O0lBWXBFLDhDQUE0Qjs7SUFFNUIsdUNBQXdFOztJQUN4RSxnREFBbUI7O0lBR25CLDJDQUFzQjs7SUFDdEIsdUNBQWE7Ozs7O0lBQ2IsMkNBQTJCOzs7OztJQUMzQixzQ0FBeUI7Ozs7O0lBRXpCLGdEQUEyRDs7SUFDM0QsMENBQTBFOzs7Ozs7SUFNMUUsaURBQXNFOzs7OztJQUd0RSxnREFBb0Q7O0lBQ3BELDBDQUFtRTs7Ozs7O0lBS25FLCtDQUFvRTs7Ozs7SUFDcEUsNkNBQXdCOztJQUV4Qix1Q0FBVTs7SUFDViwyQ0FBaUI7O0lBYWpCLDRDQUF3Rjs7SUFxQ3hGLDhDQUlDOztJQUVELGtEQUFvRDs7Ozs7SUFDcEQsbURBQXdFOzs7OztJQUN4RSxtREFBMEU7Ozs7O0lBQzFFLHNEQVdDOzs7OztJQUVELHFEQVNDOzs7OztJQWdFRCwrQ0FzREM7Ozs7Ozs7Ozs7Ozs7SUFZRCxnREEyQkM7O0lBNU9XLHlDQUE4QiIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAxOC0yMDE4LiBUSUJDTyBTb2Z0d2FyZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuIENvbmZpZGVudGlhbCAmIFByb3ByaWV0YXJ5LlxuaW1wb3J0IHtcbiAgQ29tcG9uZW50LCBJbnB1dCwgRXZlbnRFbWl0dGVyLCBWaWV3Q2hpbGQsXG4gIEVsZW1lbnRSZWYsIE91dHB1dCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBWaWV3RW5jYXBzdWxhdGlvbiwgT25Jbml0XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFNwb3RmaXJlQ3VzdG9taXphdGlvbiwgU3BvdGZpcmVGaWx0ZXIgfSBmcm9tICcuLi9zcG90ZmlyZS1jdXN0b21pemF0aW9uJztcbmltcG9ydCB7IERvY01ldGFkYXRhLCBBcHBsaWNhdGlvbiwgRG9jdW1lbnQsIFNwb3RmaXJlUGFyYW1ldGVycyB9IGZyb20gJy4uL3Nwb3RmaXJlLXdlYnBsYXllcic7XG5pbXBvcnQgeyBEb2N1bWVudFNlcnZpY2UgfSBmcm9tICcuLi9kb2N1bWVudC5zZXJ2aWNlJztcblxuLy8gaHR0cHM6Ly9jb21tdW5pdHkudGliY28uY29tL3dpa2kvdGliY28tc3BvdGZpcmUtamF2YXNjcmlwdC1hcGktb3ZlcnZpZXdcbi8vIGh0dHBzOi8vY29tbXVuaXR5LnRpYmNvLmNvbS93aWtpL21hc2h1cC1leGFtcGxlLW11bHRpcGxlLXZpZXdzLXVzaW5nLXRpYmNvLXNwb3RmaXJlLWphdmFzY3JpcHQtYXBpXG5cbmRlY2xhcmUgbGV0IHNwb3RmaXJlOiBhbnk7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3Nwb3RmaXJlLXZpZXdlcicsXG4gIGV4cG9ydEFzOiAnc3BvdGZpcmVWaWV3ZXInLFxuICB0ZW1wbGF0ZVVybDogJ3Nwb3RmaXJlLXZpZXdlci5jb21wb25lbnQuaHRtbCcsXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5cbmV4cG9ydCBjbGFzcyBTcG90ZmlyZVZpZXdlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgT25Jbml0IHtcbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBwcmludCBkZWJ1ZyBsb2dzIHRvIEpTIGNvbnNvbGUuIERlZmF1bHQgdG8gZmFsc2VcbiAgICovXG4gIEBJbnB1dCgpIGRlYnVnID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBUaGUgVVJMIHRvIHRoZSBXZWIgUGxheWVyIHNlcnZlclxuICAgKi9cbiAgQElucHV0KCkgdXJsOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBUaGUgcGF0aCBpbiB0aGUgbGlicmFyeSB0byB0aGUgYW5hbHlzaXMgdG8gb3Blbi5cbiAgICovXG4gIEBJbnB1dCgpIHBhdGg6IHN0cmluZztcblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIE9wdGlvbmFsIGluaXRpYWwgcGFnZS4gVGhlIHBhZ2UgY2FuIGVpdGhlciBiZSBleHByZXNzZWRcbiAgICogYXMgYW4gaW50ZWdlciAoMC1iYXNlZCBwYWdlIGluZGV4KSBvciBhcyBhIHN0cmluZyAocGFnZSBuYW1lKS5cbiAgICovXG4gIEBJbnB1dCgpIHBhZ2U6IHN0cmluZztcblxuICAvKipcbiAgKiBAZGVzY3JpcHRpb25cbiAgKiBPcHRpb25hbCB1bmlxdWUgaWQgdG8gcmVhZC93cml0ZSBzZXR0aW5ncyBmcm9tIGxvY2FsIHN0b3JhZ2VcbiAgKi9cbiAgQElucHV0KCkgc2lkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICogQGRlc2NyaXB0aW9uXG4gICogT3B0aW9uYWwgaW5zdGFuY2Ugb2YgYSBDdXN0b21pemF0aW9uIGluc3RhbmNlLiBcbiAgKiBJZiBzZXQsIHRoaXMgd2lsbCBvdmVycmlkZSB0aGUgY3VzdG9taXphdGlvbkluZm8gaW5zdGFuY2UgaGVsZCBieSB0aGUgYXBwbGljYXRpb24uXG4gICovXG4gIEBJbnB1dCgpIGN1c3RvbWl6YXRpb246IFNwb3RmaXJlQ3VzdG9taXphdGlvbiB8IHN0cmluZztcblxuICAvKipcbiAgICAqIEBkZXNjcmlwdGlvblxuICAgICogT3B0aW9uYWwuIEFycmF5IG9mIGZpbHRlcnMgdGhhdCB3aWxsIGJlIGFwcGxpZWQgb25jZSBwYWdlIGlzIGxvYWRlZC5cbiAgICAqL1xuICBASW5wdXQoKSBmaWx0ZXJzOiBBcnJheTxTcG90ZmlyZUZpbHRlcj4gfCBzdHJpbmc7XG4gIEBJbnB1dCgpIG1hcmtpbmdPbjoge30gfCBzdHJpbmc7XG4gIEBJbnB1dCgpIG1heFJvd3MgPSAxMDtcblxuICBwcm90ZWN0ZWQgc3BvdFBhcmFtczogU3BvdGZpcmVQYXJhbWV0ZXJzID0gbmV3IFNwb3RmaXJlUGFyYW1ldGVycygpO1xuICAvKipcbiAgICAqIEBkZXNjcmlwdGlvblxuICAgICogT3B0aW9uYWwuIExvYWQgcGFyYW1ldGVycyBmb3IgdGhlIGFuYWx5c2lzLlxuICAgICovXG4gIEBJbnB1dCgpIHNldCBwYXJhbWV0ZXJzKHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9wYXJhbWV0ZXJzID0gdmFsdWU7XG4gICAgdGhpcy5zcG90UGFyYW1zLl9wYXJhbWV0ZXJzID0gdmFsdWU7XG4gICAgaWYgKHRoaXMuYXBwKSB7XG4gICAgICB0aGlzLm9wZW5QYXRoKHRoaXMucGF0aCk7XG4gICAgfVxuICB9XG4gIHByaXZhdGUgX3BhcmFtZXRlcnM6IHN0cmluZztcblxuICBAVmlld0NoaWxkKCdzcG90JywgeyBzdGF0aWM6IHRydWUsIHJlYWQ6IEVsZW1lbnRSZWYgfSkgc3BvdDogRWxlbWVudFJlZjtcbiAgZXJyb3JNZXNzYWdlcyA9IFtdO1xuXG4gIC8qIG1ldGFkYXRhIGNvbnRhaW5zIEluZm9ybWF0aW9uIGFib3V0IHRoZSBTcG90ZmlyZSBhbmFseXNpcyAqL1xuICBtZXRhZGF0YTogRG9jTWV0YWRhdGE7XG4gIGVkaXQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBkb2N1bWVudDogRG9jdW1lbnQ7XG4gIHByaXZhdGUgYXBwOiBBcHBsaWNhdGlvbjtcbiAgLyogRmlsdGVyaW5nIG9ic2VydmFibGVzLCBlbWl0dGVyIGFuZCBzdWJqZWN0Ki9cbiAgcHJpdmF0ZSBmaWx0ZXJTdWJqZWN0ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxBcnJheTx7fT4+KFtdKTtcbiAgcHVibGljIGZpbHRlciQ6IE9ic2VydmFibGU8QXJyYXk8e30+PiA9IHRoaXMuZmlsdGVyU3ViamVjdC5hc09ic2VydmFibGUoKTtcblxuICAvKipcbiAgICAqIEBkZXNjcmlwdGlvblxuICAgICogT3B0aW9uYWwuIGVtaXQgZmlsdGVycyBzZXQgYnkgdXNlciBpbiBkYXNoYm9hcmRcbiAgICAqL1xuICBAT3V0cHV0KCkgZmlsdGVyaW5nRXZlbnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcihmYWxzZSk7XG5cbiAgLyogTWFya2luZyBvYnNlcnZhYmxlcywgZW1pdHRlciBhbmQgc3ViamVjdCovXG4gIHByaXZhdGUgbWFya2VyU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8e30+KHt9KTtcbiAgcHVibGljIG1hcmtlciQ6IE9ic2VydmFibGU8e30+ID0gdGhpcy5tYXJrZXJTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIE9wdGlvbmFsLiBlbWl0IG1hcmtpbmcgc2V0IGJ5IHVzZXIgaW4gZGFzaGJvYXJkXG4gICAqL1xuICBAT3V0cHV0KCkgbWFya2luZ0V2ZW50OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoZmFsc2UpO1xuICBwcml2YXRlIG1hcmtlZFJvd3MgPSB7fTtcblxuICB2aWV3OiBhbnk7XG4gIGxvbmdUaW1lID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IocHVibGljIGRvY1N2YzogRG9jdW1lbnRTZXJ2aWNlKSB7XG4gICAgY29uc29sZS5sb2coJ1NQT1RGSVJFIFdSQVBQRVIgLSAxMCBqdWlsbGV0IC0gQW5ndWxhciA4JylcbiAgICB0aGlzLmRvQ29uc29sZSgnV2VsY29tZSAhJyk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmxvbmdUaW1lID0gdHJ1ZSwgNjAwMCk7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmRvQ29uc29sZSgnT25Jbml0JywgdGhpcy51cmwsIHRoaXMucGF0aCk7XG4gICAgdGhpcy5kaXNwbGF5KCk7XG4gIH1cblxuICBkb0NvbnNvbGUgPSAoLi4uYXJnczogYW55W10pID0+IHRoaXMuZGVidWcgJiYgY29uc29sZS5sb2coJ1tTUE9URklSRS1WSUVXRVJdJywgLi4uYXJncyk7XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBSZWRyYXcgdGhlIGRhc2hib2FyZC5cbiAgICogRGVwZW5kaW5nIG9uIG5hdHVyZSBvZiBjaGFuZ2UgKHVybC9wYXRoL3BhZ2UpIHRoZSBkYXNoYm9hcmQgaXMgZnVsbHkgcmVmcmVzaGVkIG9yIGFkanVzdGVkIGFjY29yZGluZ2x5XG4gICAqIEBwYXJhbSBjaGFuZ2VzIFRoZSBsaXN0IG9mIGNoYW5nZXMgdG8gYXBwbHlcbiAgICovXG5cbiAgZGlzcGxheShjaGFuZ2VzPzogU2ltcGxlQ2hhbmdlcykge1xuICAgIHRoaXMuZG9Db25zb2xlKCdEaXNwbGF5JywgY2hhbmdlcyk7XG4gICAgaWYgKHR5cGVvZiB0aGlzLmN1c3RvbWl6YXRpb24gPT09ICdzdHJpbmcnKSB7XG4gICAgICB0aGlzLmN1c3RvbWl6YXRpb24gPSBuZXcgU3BvdGZpcmVDdXN0b21pemF0aW9uKEpTT04ucGFyc2UodGhpcy5jdXN0b21pemF0aW9uKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY3VzdG9taXphdGlvbiA9IG5ldyBTcG90ZmlyZUN1c3RvbWl6YXRpb24odGhpcy5jdXN0b21pemF0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHRoaXMuZmlsdGVycyA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGNvbnN0IGFsbEZpbHRlcnM6IEFycmF5PFNwb3RmaXJlRmlsdGVyPiA9IFtdO1xuICAgICAgSlNPTi5wYXJzZSh0aGlzLmZpbHRlcnMpLmZvckVhY2goKG06IFNwb3RmaXJlRmlsdGVyKSA9PiBhbGxGaWx0ZXJzLnB1c2gobmV3IFNwb3RmaXJlRmlsdGVyKG0pKSk7XG4gICAgICB0aGlzLmZpbHRlcnMgPSBhbGxGaWx0ZXJzO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHRoaXMubWFya2luZ09uID09PSAnc3RyaW5nJyAmJiB0aGlzLm1hcmtpbmdPbiAhPT0gJyonKSB7XG4gICAgICB0aGlzLm1hcmtpbmdPbiA9IEpTT04ucGFyc2UodGhpcy5tYXJraW5nT24pO1xuICAgIH1cblxuICAgIHRoaXMuZG9Db25zb2xlKCdkaXNwbGF5JywgY2hhbmdlcywgdGhpcy51cmwsIHRoaXMucGF0aCwgJ1BBR0U9JywgdGhpcy5wYWdlLCB0aGlzLmN1c3RvbWl6YXRpb24sIHRoaXMubWF4Um93cywgdGhpcy5hcHAsIHRoaXMubWFya2luZ09uKTtcbiAgICBpZiAoIWNoYW5nZXMgfHwgY2hhbmdlcy51cmwpIHtcbiAgICAgIHRoaXMub3BlbldlYlBsYXllcih0aGlzLnVybCwgdGhpcy5wYXRoLCB0aGlzLmN1c3RvbWl6YXRpb24pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5hcHAgJiYgY2hhbmdlcy5wYWdlKSB7XG4gICAgICB0aGlzLm9wZW5QYWdlKHRoaXMucGFnZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZG9Db25zb2xlKGBUaGUgVXJsIGF0dHJpYnV0ZSBpcyBub3QgcHJvdmlkZWQsIGZsaXAgdGhlIGRhc2hib2FyZCBhbmQgZGlzcGxheSBmb3JtIWApO1xuICAgICAgdGhpcy5lZGl0ID0gdHJ1ZTtcbiAgICAgIHRoaXMubWV0YWRhdGEgPSBuZXcgRG9jTWV0YWRhdGEoKTtcbiAgICB9XG4gIH1cbiAgbmdPbkNoYW5nZXMgPSAoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykgPT4ge1xuICAgIGlmICghIWNoYW5nZXMpIHtcbiAgICAgIHRoaXMuZGlzcGxheShjaGFuZ2VzKTtcbiAgICB9XG4gIH1cblxuICBzdG9wUHJvcGFnYXRpb24gPSAoZTogRXZlbnQpID0+IGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIHByaXZhdGUgaXNNYXJraW5nV2lyZWRVcCA9ICgpID0+IHRoaXMubWFya2luZ0V2ZW50Lm9ic2VydmVycy5sZW5ndGggPiAwO1xuICBwcml2YXRlIGlzRmlsdGluZ1dpcmVkVXAgPSAoKSA9PiB0aGlzLmZpbHRlcmluZ0V2ZW50Lm9ic2VydmVycy5sZW5ndGggPiAwO1xuICBwcml2YXRlIGRpc3BsYXlFcnJvck1lc3NhZ2UgPSAobWVzc2FnZTogc3RyaW5nKSA9PiB7XG4gICAgY29uc29sZS5lcnJvcignRVJST1I6JywgbWVzc2FnZSk7XG4gICAgdGhpcy5lcnJvck1lc3NhZ2VzLnB1c2gobWVzc2FnZSk7XG4gICAgaWYgKCF0aGlzLnNwb3RQYXJhbXMuZG9jdW1lbnQpIHtcbiAgICAgIC8vIERvIG5vdCBkaXNwbGF5IHRoZSBpbmZvIE1lc3NhZ2Ugd2hlbiBkb2N1bWVudCBpcyBydW5uaW5nXG4gICAgICB0aGlzLnNwb3QubmF0aXZlRWxlbWVudC5zdHlsZS5mb250RmFtaWx5ID0gJ21vbm9zcGFjZSc7XG4gICAgICB0aGlzLnNwb3QubmF0aXZlRWxlbWVudC5zdHlsZS5jb2xvciA9ICcjZTgyMTI3JztcbiAgICAgIHRoaXMuc3BvdC5uYXRpdmVFbGVtZW50LnN0eWxlLnRleHRBbGlnbiA9ICdjZW50ZXInO1xuICAgICAgdGhpcy5zcG90Lm5hdGl2ZUVsZW1lbnQuc3R5bGUucGFkZGluZyA9ICczMHB4JztcbiAgICAgIHRoaXMuc3BvdC5uYXRpdmVFbGVtZW50LnRleHRDb250ZW50ID0gdGhpcy5lcnJvck1lc3NhZ2VzLmpvaW4oJzxicj4nKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGRpc3BsYXlJbmZvTWVzc2FnZSA9IChtZXNzYWdlOiBzdHJpbmcpID0+IHtcbiAgICBjb25zb2xlLmxvZyhtZXNzYWdlKTtcbiAgICBpZiAoIXRoaXMuc3BvdFBhcmFtcy5kb2N1bWVudCAmJiB0aGlzLmRlYnVnKSB7XG4gICAgICAvLyBEbyBub3QgZGlzcGxheSB0aGUgaW5mbyBNZXNzYWdlIHdoZW4gZG9jdW1lbnQgaXMgcnVubmluZ1xuICAgICAgdGhpcy5zcG90Lm5hdGl2ZUVsZW1lbnQuc3R5bGUuZm9udEZhbWlseSA9ICdtb25vc3BhY2UnO1xuICAgICAgdGhpcy5zcG90Lm5hdGl2ZUVsZW1lbnQuc3R5bGUuY29sb3IgPSAnYmxhY2snO1xuICAgICAgdGhpcy5zcG90Lm5hdGl2ZUVsZW1lbnQuc3R5bGUudGV4dEFsaWduID0gJ2NlbnRlcic7XG4gICAgICB0aGlzLnNwb3QubmF0aXZlRWxlbWVudC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBHZXQgU3BvdGZpcmUgSmF2YVNjcmlwdCBBUEkgKHdlYlBsYXllcikgZnJvbSB1cmxcbiAgICpcbiAgICogV2hlbiBhIGNvbXBvbmVuZXQgaXMgaW5pdGlhdGVkIG9yIHVybCBpcyB1cGRhdGVkLCBpdCBsYXp5IGxvYWRzIHRoZSBsaWJyYXJ5XG4gICAqIE9uY2UgbG9hZGVkIGl0IG9wZW5zIHRoZSBwYXRoLlxuICAgKlxuICAgKiBAcGFyYW0gdXJsIHRoZSB3ZWJQbGF5ZXIgc2VydmVyIHVybFxuICAgKiBAcGFyYW0gcGF0aCB0aGUgcGF0aCB0byB0aGUgcGFnZVxuICAgKiBAcGFyYW0gY3VzdG8gdGhlIGluaXRpYWwgY3VzdG9taXphdGlvbiBpbmZvXG4gICAqL1xuICBwcm90ZWN0ZWQgb3BlbldlYlBsYXllcih1cmw6IHN0cmluZywgcGF0aDogc3RyaW5nLCBjdXN0b21pemF0aW9uOiBTcG90ZmlyZUN1c3RvbWl6YXRpb24pIHtcbiAgICB0aGlzLmVkaXQgPSBmYWxzZTtcbiAgICB0aGlzLnVybCA9IHVybDtcbiAgICB0aGlzLnBhdGggPSBwYXRoO1xuICAgIHRoaXMuY3VzdG9taXphdGlvbiA9IGN1c3RvbWl6YXRpb247XG4gICAgdGhpcy5kb0NvbnNvbGUoYFNwb3RmaXJlVmlld2VyQ29tcG9uZW50IG9wZW5XZWJQbGF5ZXIoJHt1cmx9KWApO1xuXG4gICAgdGhpcy5kaXNwbGF5SW5mb01lc3NhZ2UoYCR7dGhpcy51cmx9Li4uYCk7XG5cbiAgICAvLyBDcmVhdGUgYSBVbmlxdWUgSUQgZm9yIHRoaXMgU3BvdGZpcmUgZGFzaGJvYXJkXG4gICAgLy9cbiAgICB0aGlzLnNwb3QubmF0aXZlRWxlbWVudC5pZCA9IHRoaXMuc2lkID8gdGhpcy5zaWQgOiBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICB0aGlzLnNwb3RQYXJhbXMgPSB7IC4uLnRoaXMuc3BvdFBhcmFtcywgcGF0aCwgdXJsLCBjdXN0b21pemF0aW9uLCBkb21pZDogdGhpcy5zcG90Lm5hdGl2ZUVsZW1lbnQuaWQsIHBhZ2U6IHRoaXMucGFnZSB9O1xuXG4gICAgdGhpcy5kb2NTdmMub3BlbldlYlBsYXllciQodGhpcy5zcG90UGFyYW1zKS5zdWJzY3JpYmUoXG4gICAgICBkb2MgPT4gdGhpcy5hZnRlckRpc3BsYXkoZG9jKSxcbiAgICAgIGVyciA9PiB0aGlzLmRpc3BsYXlFcnJvck1lc3NhZ2UoZXJyKSk7XG4gIH1cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIE9wZW4gdGhlIHBhdGggdXNpbmcgSmF2YVNjcmlwdCBBUEkgKHNwb3RmaXJlLndlYlBsYXllci5jcmVhdGVBcHBsaWNhdGlvbilcbiAgICpcbiAgICogQHBhcmFtIHBhdGggdGhlIGFic29sdXRlIGFuYWx5c2lzIHBhdGhcbiAgICovXG4gIHByb3RlY3RlZCBvcGVuUGF0aChwYXRoOiBzdHJpbmcpIHtcbiAgICB0aGlzLnBhdGggPSBwYXRoO1xuICAgIHRoaXMuZGlzcGxheUluZm9NZXNzYWdlKGAke3RoaXMudXJsfS8ke3BhdGh9Li4uYCk7XG4gICAgdGhpcy5kb0NvbnNvbGUoYFNwb3RmaXJlVmlld2VyQ29tcG9uZW50IG9wZW5QYXRoKCR7cGF0aH0pYCwgdGhpcy5zaWQpO1xuICAgIHRoaXMuc3BvdFBhcmFtcyA9IHsgLi4udGhpcy5zcG90UGFyYW1zLCBwYXRoLCBkb21pZDogdGhpcy5zcG90Lm5hdGl2ZUVsZW1lbnQuaWQgfTtcbiAgICB0aGlzLmRvY1N2Yy5vcGVuUGF0aCQodGhpcy5zcG90UGFyYW1zKS5zdWJzY3JpYmUoXG4gICAgICBkb2MgPT4gdGhpcy5hZnRlckRpc3BsYXkoZG9jKSxcbiAgICAgIGVyciA9PiB0aGlzLmRpc3BsYXlFcnJvck1lc3NhZ2UoZXJyKSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZG9Gb3JtKGRvYzogRG9jdW1lbnQpIHsgfVxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIE9wZW4gdGhlIERvY3VtZW50IHBhZ2VcbiAgICpcbiAgICogQHBhcmFtIHBhZ2UgdGhlIGRvY3VtZW50IHBhZ2UgdGhhdCB3aWxsIGJlIGRpc3BsYXllZFxuICAgKi9cbiAgcHVibGljIG9wZW5QYWdlKHBhZ2U6IHN0cmluZykge1xuICAgIHRoaXMuZGlzcGxheUluZm9NZXNzYWdlKGAke3RoaXMudXJsfS8ke3RoaXMucGF0aH0vJHtwYWdlID8gcGFnZSA6ICcnfS4uLmApO1xuICAgIHRoaXMuZG9Db25zb2xlKGBTcG90ZmlyZVZpZXdlckNvbXBvbmVudCBvcGVuUGFnZSgke3BhZ2V9KWApO1xuICAgIHRoaXMucGFnZSA9IHBhZ2U7XG4gICAgdGhpcy5zcG90UGFyYW1zID0geyAuLi50aGlzLnNwb3RQYXJhbXMsIHBhZ2UgfTtcbiAgICBjb25zdCBwID0gdGhpcy5zcG90UGFyYW1zO1xuICAgIHRoaXMuZG9jU3ZjLm9wZW5QYWdlJChwKS5zdWJzY3JpYmUoZG9jID0+IHRoaXMuYWZ0ZXJEaXNwbGF5KGRvYykpO1xuICB9XG5cbiAgcHJpdmF0ZSBhZnRlckRpc3BsYXkgPSAoZG9jOiBEb2N1bWVudCkgPT4ge1xuICAgIHRoaXMuZG9Db25zb2xlKGBTcG90ZmlyZVZpZXdlckNvbXBvbmVudCBvcGVuUGFnZSgke3RoaXMuc3BvdFBhcmFtcy5wYWdlfSkgcmV0dXJuc2AsIGRvYyk7XG4gICAgdGhpcy5kb2N1bWVudCA9IGRvYztcbiAgICBpZiAodGhpcy5maWx0ZXJzICYmIHRoaXMuZG9jdW1lbnQuZ2V0RmlsdGVyaW5nKCkpIHtcbiAgICAgIGNvbnN0IGZsdCA9IHRoaXMuZG9jdW1lbnQuZ2V0RmlsdGVyaW5nKCk7XG4gICAgICBmbHQucmVzZXRBbGxGaWx0ZXJzKCk7XG4gICAgICAvKlxuICAgICAgdGhpcy5kb0NvbnNvbGUoYFNwb3RmaXJlVmlld2VyQ29tcG9uZW50IHNldCBGaWx0ZXIoYXZhbnQpYCwgdGhpcy5maWx0ZXJzKTtcbiAgICAgICh0aGlzLmZpbHRlcnMgYXMgQXJyYXk8U3BvdGZpcmVGaWx0ZXI+KS5mb3JFYWNoKHQgPT4gdC5zZXRGaWx0ZXJUeXBlKHNwb3RmaXJlKSk7XG4gICAgICB0aGlzLmRvQ29uc29sZShgU3BvdGZpcmVWaWV3ZXJDb21wb25lbnQgc2V0IEZpbHRlcihhcHJlcylgLCB0aGlzLmZpbHRlcnMpO1xuICAgICovXG4gICAgICBmbHQuc2V0KHRoaXMuZmlsdGVycyk7XG4gICAgICB0aGlzLmxvYWRGaWx0ZXJzKCk7XG4gICAgICB0aGlzLmRvQ29uc29sZSgnRklMVEVSJywgdGhpcy5maWx0ZXJzKTtcbiAgICB9XG5cbiAgICB0aGlzLmRvRm9ybSh0aGlzLmRvY3VtZW50KTtcbiAgICBpZiAodGhpcy5tYXJraW5nT24pIHtcbiAgICAgIC8vIENsZWFyIG1hcmtpbmdcbiAgICAgIHRoaXMubWFya2VyU3ViamVjdC5uZXh0KHt9KTtcbiAgICAgIHRoaXMuZG9jdW1lbnQuZ2V0RGF0YSgpLmdldFRhYmxlcyQoKVxuICAgICAgICAucGlwZSh0YXAoYWxsVGFibGVOYW1lcyA9PiB0aGlzLmRvQ29uc29sZShgQWxsIHRhYmxlcyBhbmQgY29sdW1uIG5hbWVzOmAsIGFsbFRhYmxlTmFtZXMpKSlcbiAgICAgICAgLnN1YnNjcmliZShhbGxUYWJsZU5hbWVzID0+IHRoaXMuZG9jdW1lbnQuZ2V0TWFya2luZygpLmdldE1hcmtpbmdOYW1lcyQoKVxuICAgICAgICAgIC5waXBlKHRhcChtYXJraW5nTmFtZXMgPT4gdGhpcy5kb0NvbnNvbGUoYEFsbCBtYXJraW5nIG5hbWVzOmAsIG1hcmtpbmdOYW1lcykpKVxuICAgICAgICAgIC5zdWJzY3JpYmUobWFya2luZ05hbWVzID0+IG1hcmtpbmdOYW1lcy5mb3JFYWNoKG1hcmtpbmdOYW1lID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRhYmxlTmFtZXMgPSB0aGlzLm1hcmtpbmdPbiA9PT0gJyonID8gYWxsVGFibGVOYW1lcyA6IHRoaXMubWFya2luZ09uO1xuICAgICAgICAgICAgT2JqZWN0LmtleXModGFibGVOYW1lcykuZm9yRWFjaCh0TmFtZSA9PiB7XG4gICAgICAgICAgICAgIGxldCBjb2x1bW5OYW1lczogQXJyYXk8c3RyaW5nPiA9IHRoaXMubWFya2luZ09uID09PSAnKicgPyBhbGxUYWJsZU5hbWVzW3ROYW1lXSA6IHRhYmxlTmFtZXNbdE5hbWVdO1xuICAgICAgICAgICAgICBpZiAoY29sdW1uTmFtZXMubGVuZ3RoID09PSAxICYmIGNvbHVtbk5hbWVzWzBdID09PSAnKicpIHtcbiAgICAgICAgICAgICAgICBjb2x1bW5OYW1lcyA9IGFsbFRhYmxlTmFtZXNbdE5hbWVdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHRoaXMuZG9Db25zb2xlKGBtYXJraW5nLm9uQ2hhbmdlZCgke21hcmtpbmdOYW1lfSwgJHt0TmFtZX0sICR7SlNPTi5zdHJpbmdpZnkoY29sdW1uTmFtZXMpfSwgJHt0aGlzLm1heFJvd3N9KWApO1xuICAgICAgICAgICAgICB0aGlzLmRvY3VtZW50LmdldE1hcmtpbmcoKS5vbkNoYW5nZWQkKG1hcmtpbmdOYW1lLCB0TmFtZSwgY29sdW1uTmFtZXMsIHRoaXMubWF4Um93cylcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKGYgPT4gdGhpcy51cGRhdGVNYXJraW5nKHROYW1lLCBtYXJraW5nTmFtZSwgZikpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSkpKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaXNGaWx0aW5nV2lyZWRVcCgpKSB7XG4gICAgICB0aGlzLmRvQ29uc29sZSgnd2UgaGF2ZSBvYnNlcnZlcnMgZm9yIGZpbHRlcmluZycpO1xuICAgICAgLy8gU3Vic2NyaWJlIHRvIGZpbHRlcmluZ0V2ZW50IGFuZCBlbWl0IHRoZSByZXN1bHQgdG8gdGhlIE91dHB1dCBpZiBmaWx0ZXIgcGFuZWwgaXMgZGlzcGxheWVkXG4gICAgICAvL1xuICAgICAgdGhpcy5maWx0ZXIkLnBpcGUodGFwKGYgPT4gdGhpcy5kb0NvbnNvbGUoJ0VtaXQgZmlsdGVyJywgZikpKVxuICAgICAgICAuc3Vic2NyaWJlKGYgPT4gdGhpcy5maWx0ZXJpbmdFdmVudC5lbWl0KGYpKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc01hcmtpbmdXaXJlZFVwKCkpIHtcbiAgICAgIHRoaXMuZG9Db25zb2xlKCd3ZSBoYXZlIG9ic2VydmVycyBmb3IgbWFya2luZycpO1xuICAgICAgLy8gU3Vic2NyaWJlIHRvIG1hcmtpbmdFdmVudCBhbmQgZW1pdCB0aGUgcmVzdWx0IHRvIHRoZSBPdXRwdXRcbiAgICAgIC8vXG4gICAgICB0aGlzLm1hcmtlciQucGlwZSh0YXAoZiA9PiB0aGlzLmRvQ29uc29sZSgnRW1pdCBtYXJraW5nJywgZikpKVxuICAgICAgICAuc3Vic2NyaWJlKGYgPT4gdGhpcy5tYXJraW5nRXZlbnQuZW1pdChmKSk7XG4gICAgfVxuICAgIC8vIGNvbnNvbGUubG9nKCdZRVMgbG9hZEZpbHRlcnMnKTtcbiAgICAvLyBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzLmxvYWRGaWx0ZXJzKCksIDMwMDApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBDYWxsYmFjayBtZXRob2QgcGxheWVkIHdoZW4gbWFya2luZyBjaGFuZ2VzIGFyZSBkZXRlY3RlZC5cbiAgICpcbiAgICogV2lsbCBnYXRoZXIgYWxsIG1hcmtpbmcgYW5kIGVtaXQgYW4gZXZlbnQgYmFjayB0byBjYWxsZXIuXG4gICAqXG4gICAqIEBwYXJhbSB0TmFtZSBUYWJsZSBuYW1lXG4gICAqIEBwYXJhbSBtTmFtZSBNYXJpbmcgbmFtZVxuICAgKiBAcGFyYW0gcmVzIG1hcmtlZCByb3dzIHJldHVybmVkIGJ5IFNwb3RmaXJlXG4gICAqL1xuICBwcml2YXRlIHVwZGF0ZU1hcmtpbmcgPSAodE5hbWU6IHN0cmluZywgbU5hbWU6IHN0cmluZywgcmVzOiB7fSkgPT4ge1xuICAgIGlmIChPYmplY3Qua2V5cyhyZXMpLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuZG9Db25zb2xlKGBXZSBoYXZlIG1hcmtlZCByb3dzIG9uIG1hcmtpbmcgJyR7bU5hbWV9JyBmb3IgdGFibGUgJyR7dE5hbWV9JzpgLCByZXMpO1xuICAgICAgLy8gdXBkYXRlIHRoZSBtYXJrZWQgcm93IGlmIHBhcnRpYWwgc2VsZWN0aW9uXG4gICAgICAvL1xuICAgICAgaWYgKCF0aGlzLm1hcmtlZFJvd3NbbU5hbWVdKSB7XG4gICAgICAgIHRoaXMubWFya2VkUm93c1ttTmFtZV0gPSB7fTtcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy5tYXJrZWRSb3dzW21OYW1lXVt0TmFtZV0pIHtcbiAgICAgICAgdGhpcy5tYXJrZWRSb3dzW21OYW1lXVt0TmFtZV0gPSByZXM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm1hcmtlZFJvd3NbbU5hbWVdW3ROYW1lXSA9IE9iamVjdC5hc3NpZ24odGhpcy5tYXJrZWRSb3dzW21OYW1lXVt0TmFtZV0sIHJlcyk7XG4gICAgICB9XG4gICAgICAvLyAgIHRoaXMuZG9Db25zb2xlKCdbTUFSS0lOR10gb24gcHVibGllJywgdGhpcy5tYXJrZWRSb3dzKTtcbiAgICAgIHRoaXMubWFya2VyU3ViamVjdC5uZXh0KHRoaXMubWFya2VkUm93cyk7XG4gICAgfSBlbHNlIGlmICh0aGlzLm1hcmtlZFJvd3NbbU5hbWVdICYmIHRoaXMubWFya2VkUm93c1ttTmFtZV1bdE5hbWVdKSB7XG4gICAgICAvLyByZW1vdmUgdGhlIG1hcmtlZCByb3cgaWYgbm8gbWFya2luZ1xuICAgICAgLy9cbiAgICAgIGRlbGV0ZSB0aGlzLm1hcmtlZFJvd3NbbU5hbWVdW3ROYW1lXTtcbiAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLm1hcmtlZFJvd3NbbU5hbWVdKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgZGVsZXRlIHRoaXMubWFya2VkUm93c1ttTmFtZV07XG4gICAgICB9XG4gICAgICB0aGlzLm1hcmtlclN1YmplY3QubmV4dCh0aGlzLm1hcmtlZFJvd3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyAgdGhpcy5kb0NvbnNvbGUoYE5vIHJvd3MgYXJlIG1hcmtlZCBvbiBtYXJraW5nICcke21OYW1lfScgZm9yIHRhYmxlICcke3ROYW1lfSdgKTtcbiAgICB9XG4gICAgdGhpcy5sb2FkRmlsdGVycygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBFbWl0IHRvIGNhbGxlciB0aGUgZmlsdGVyc1xuICAgKi9cbiAgcHJpdmF0ZSBsb2FkRmlsdGVycygpIHtcbiAgICAvLyAgY29uc29sZS5sb2coJ0FBIE5pY29sYXMgbG9hZEZpbHRlcnMgQkxPVVAgISAoMTkganVpbiAyMDE5KScpO1xuICAgIGlmICh0aGlzLmlzRmlsdGluZ1dpcmVkVXAoKSkge1xuICAgICAgdGhpcy5kb2N1bWVudC5nZXRGaWx0ZXJpbmcoKS5nZXRBbGxNb2RpZmllZEZpbHRlckNvbHVtbnMoKVxuICAgICAgICAuc3Vic2NyaWJlKGZzID0+IHRoaXMuZmlsdGVyU3ViamVjdC5uZXh0KGZzKSk7XG4gICAgfVxuICAgIC8vICAgIHRoaXMuZG9jdW1lbnQuZ2V0RmlsdGVyaW5nKCkuZ2V0QWxsTW9kaWZpZWRGaWx0ZXJDb2x1bW5zKClcbiAgICAvLyAgICAgIC5zdWJzY3JpYmUoZnMgPT4gY29uc29sZS5sb2coJ2xlcyBGSUxURVJTOicsIGZzKSk7XG4gIH1cbn1cbiJdfQ==