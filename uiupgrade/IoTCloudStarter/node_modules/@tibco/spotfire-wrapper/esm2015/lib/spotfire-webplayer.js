/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// Copyright (c) 2018-2018. TIBCO Software Inc. All Rights Reserved. Confidential & Proprietary.
import { Observable, forkJoin, of as observableOf, zip, BehaviorSubject, throwError, TimeoutError } from 'rxjs';
import { mergeMap, tap, pluck, map, filter, timeout, catchError } from 'rxjs/operators';
/** @type {?} */
export const CUSTLABELS = {
    showAbout: 'Show the about menu item',
    showAnalysisInformationTool: 'Show the analysis information tool menu item',
    showAuthor: 'Show the button for enabling authoring',
    showClose: 'Show the analysis close menu item',
    showCustomizableHeader: 'Show the customizable header',
    showDodPanel: 'Show the details on demand panel in the visualization.',
    showExportFile: 'Show the export file menu item',
    showFilterPanel: 'Show the filter panel.',
    showHelp: 'Show the help menu item',
    showLogout: 'Show the logout menu item',
    showPageNavigation: 'Show the page navigation controls in the analysis',
    showStatusBar: 'Show status bar in the Web Player',
    showToolBar: 'Show the analysis toolbar and menu',
    showUndoRedo: 'Show the undo/redo menu item'
};
/**
 * @param {...?} args
 * @return {?}
 */
function doConsole(...args) {
    // console.log('[SPOTFIRE-WEBPLAYER]', ...args);
}
class PageState {
}
if (false) {
    /** @type {?} */
    PageState.prototype.index;
    /** @type {?} */
    PageState.prototype.pageTitle;
}
class DataTable {
}
if (false) {
    /** @type {?} */
    DataTable.prototype.dataTableName;
}
class DataColumn {
}
if (false) {
    /** @type {?} */
    DataColumn.prototype.dataColumnName;
    /** @type {?} */
    DataColumn.prototype.dataTableName;
    /** @type {?} */
    DataColumn.prototype.dataType;
    /** @type {?} */
    DataColumn.prototype.values;
}
class DistinctValues {
}
if (false) {
    /** @type {?} */
    DistinctValues.prototype.count;
    /** @type {?} */
    DistinctValues.prototype.values;
}
export class Marking {
    /**
     * @param {?} _marking
     */
    constructor(_marking) {
        this._marking = _marking;
        this.getMarkingNames$ = (/**
         * @return {?}
         */
        () => doCall(this._marking, 'getMarkingNames'));
        this.onChanged$ = (/**
         * @param {?} m
         * @param {?} t
         * @param {?} c
         * @param {?} n
         * @return {?}
         */
        (m, t, c, n) => doCall(this._marking, 'onChanged', m, t, c, n));
    }
}
if (false) {
    /** @type {?} */
    Marking.prototype.getMarkingNames$;
    /** @type {?} */
    Marking.prototype.onChanged$;
    /** @type {?} */
    Marking.prototype._marking;
}
class Filtering {
    /**
     * @param {?} _filtering
     */
    constructor(_filtering) {
        this._filtering = _filtering;
        this.set = (/**
         * @param {?} flts
         * @return {?}
         */
        (flts) => this._filtering.setFilters(flts, spotfire.webPlayer.filteringOperation.REPLACE));
        this.resetAllFilters = (/**
         * @return {?}
         */
        () => this._filtering.resetAllFilters());
        this.getAllModifiedFilterColumns = (/**
         * @return {?}
         */
        () => doCall(this._filtering, 'getAllModifiedFilterColumns', spotfire.webPlayer.includedFilterSettings.ALL_WITH_CHECKED_HIERARCHY_NODES));
    }
}
if (false) {
    /** @type {?} */
    Filtering.prototype.set;
    /** @type {?} */
    Filtering.prototype.resetAllFilters;
    /** @type {?} */
    Filtering.prototype.getAllModifiedFilterColumns;
    /** @type {?} */
    Filtering.prototype._filtering;
}
export class SpotfireParameters {
    /**
     * @param {?=} vars
     */
    constructor(vars) {
        this.version = '7.14';
        this.debug = false;
        this.reloadAnalysisInstance = false;
        console.log('CONSTR SpotfireParameters', vars, this);
        if (vars) {
            Object.keys(vars).forEach((/**
             * @param {?} key
             * @return {?}
             */
            key => this[key] = vars[key]));
        }
        // Create a Unique ID for this Spotfire dashboard
        //
        this.domid = this.domid ? this.domid : this.sid ? `${this.sid}` : `${new Date().getTime()}`;
    }
}
if (false) {
    /** @type {?} */
    SpotfireParameters.prototype.url;
    /** @type {?} */
    SpotfireParameters.prototype.path;
    /** @type {?} */
    SpotfireParameters.prototype.page;
    /** @type {?} */
    SpotfireParameters.prototype.domid;
    /** @type {?} */
    SpotfireParameters.prototype.sid;
    /** @type {?} */
    SpotfireParameters.prototype.customization;
    /** @type {?} */
    SpotfireParameters.prototype.version;
    /** @type {?} */
    SpotfireParameters.prototype.debug;
    /** @type {?} */
    SpotfireParameters.prototype.reloadAnalysisInstance;
    /** @type {?} */
    SpotfireParameters.prototype.document;
    /** @type {?} */
    SpotfireParameters.prototype.app;
    /** @type {?} */
    SpotfireParameters.prototype._parameters;
}
export class Data {
    /**
     * @param {?} _data
     */
    constructor(_data) {
        this._data = _data;
        this.allTables = {};
        // A Spotfire analysis contains one or more data tables, retrieved by the getDataTable,
        // getActiveDataTable and getDataTables methods.
        this.getDataTables$ = (/**
         * @return {?}
         */
        () => doCall(this._data, 'getDataTables'));
        this.getDataTableColNames$ = (/**
         * @param {?} t
         * @return {?}
         */
        (t) => doCall(this._data, 'getDataTable', t)
            .pipe(mergeMap((/**
         * @param {?} f
         * @return {?}
         */
        f => this.getDataColumns$(f))), map((/**
         * @param {?} d
         * @return {?}
         */
        d => ({ [t]: d })))));
        this.getDataTable$ = (/**
         * @param {?} t
         * @return {?}
         */
        (t) => doCall(this._data, 'getDataTable', t)
            .pipe(mergeMap((/**
         * @param {?} f
         * @return {?}
         */
        f => this.getDataColumns$(f)))));
        // Each data table contains one or more data columns, retrieved by the getDataColumn,
        // getDataColumns and searchDataColumns.
        this.getDataColumns$ = (/**
         * @param {?} t
         * @return {?}
         */
        (t) => doCall(t, 'getDataColumns').pipe(mergeMap((/**
         * @param {?} columns
         * @return {?}
         */
        columns => {
            /** @type {?} */
            const obs = [];
            columns.forEach((/**
             * @param {?} col
             * @return {?}
             */
            (col) => obs.push(zip(...[observableOf(col)], (/**
             * @param {?} a
             * @param {?} b
             * @return {?}
             */
            (a, b) => a.dataColumnName)))));
            return forkJoin(obs);
        }))));
        // From the DataColumn class it is possible to retrieve metadata, such as column name and data type.
        // It is also possible to get a list of the unique values in the data column with the getDistinctValues method.
        this.getDistinctValues$ = (/**
         * @param {?} t
         * @return {?}
         */
        (t) => doCall(t, 'getDistinctValues', 0, 20).pipe(tap((/**
         * @param {?} g
         * @return {?}
         */
        g => doConsole('Data.DistinctValues$', t, g, g.count > 0 && g.count < 25))), 
        // filter(g => g.count > 0 && g.count < 25),
        //  tap(g => doConsole('[OBS]', 'DistinctValues filtres', g)),
        pluck('values')));
        this.getTables$ = (/**
         * @return {?}
         */
        () => this.getDataTables$().pipe(mergeMap((/**
         * @param {?} tables
         * @return {?}
         */
        tables => {
            /** @type {?} */
            const obs = [];
            tables.forEach((/**
             * @param {?} table
             * @return {?}
             */
            table => obs.push(this.getDataTableColNames$(table.dataTableName))));
            return forkJoin(obs);
        })), map((/**
         * @param {?} k
         * @return {?}
         */
        k => {
            /** @type {?} */
            let z = {};
            k.forEach((/**
             * @param {?} p
             * @return {?}
             */
            p => z = Object.assign({}, z, p)));
            return z;
        }))));
        this.getAllTables$ = (/**
         * @return {?}
         */
        () => this.getDataTables$().pipe(mergeMap((/**
         * @param {?} tables
         * @return {?}
         */
        tables => {
            /** @type {?} */
            const obs = [];
            tables.forEach((/**
             * @param {?} table
             * @return {?}
             */
            table => obs.push(this.getDataTable$(table.dataTableName))));
            return forkJoin(obs);
        })), map((/**
         * @param {?} tables
         * @return {?}
         */
        tables => {
            /** @type {?} */
            const dataTables = [];
            ((/** @type {?} */ (tables[0]))).forEach((/**
             * @param {?} columns
             * @return {?}
             */
            columns => {
                /** @type {?} */
                const tname = columns['tabName'];
                if (!dataTables[tname]) {
                    dataTables[tname] = {};
                }
                dataTables[tname][columns['colName']] = columns['vals'];
            }));
            return dataTables;
        }))));
    }
}
if (false) {
    /** @type {?} */
    Data.prototype.allTables;
    /**
     * @type {?}
     * @private
     */
    Data.prototype.getDataTables$;
    /**
     * @type {?}
     * @private
     */
    Data.prototype.getDataTableColNames$;
    /**
     * @type {?}
     * @private
     */
    Data.prototype.getDataTable$;
    /**
     * @type {?}
     * @private
     */
    Data.prototype.getDataColumns$;
    /**
     * @type {?}
     * @private
     */
    Data.prototype.getDistinctValues$;
    /** @type {?} */
    Data.prototype.getTables$;
    /** @type {?} */
    Data.prototype.getAllTables$;
    /**
     * @type {?}
     * @private
     */
    Data.prototype._data;
}
export class DocMetadata {
    /**
     * @param {?=} p
     */
    constructor(p) {
        this.sizeUnit = 'B';
        if (p) {
            this.contentSize = parseInt(p['contentSize'], 10);
            if (this.contentSize > (1024 * 1024)) {
                this.size = this.contentSize / (1024 * 1024);
                this.sizeUnit = 'MB';
            }
            else if (this.contentSize > 1024) {
                this.size = this.contentSize / 1024;
                this.sizeUnit = 'KB';
            }
            this.created = new Date(p.created);
            this.lastModified = new Date(p.lastModified);
            this.description = p.description;
            this.path = p.path;
            this.title = p.title;
        }
    }
}
if (false) {
    /** @type {?} */
    DocMetadata.prototype.size;
    /** @type {?} */
    DocMetadata.prototype.sizeUnit;
    /** @type {?} */
    DocMetadata.prototype.contentSize;
    /** @type {?} */
    DocMetadata.prototype.created;
    /** @type {?} */
    DocMetadata.prototype.description;
    /** @type {?} */
    DocMetadata.prototype.lastModified;
    /** @type {?} */
    DocMetadata.prototype.path;
    /** @type {?} */
    DocMetadata.prototype.title;
}
export class Document {
    /**
     * @param {?} app
     * @param {?} id
     * @param {?} page
     * @param {?} custo
     */
    constructor(app, id, page, custo) {
        this.onActivePageChangedCallback = (/**
         * @param {?} pageState
         * @return {?}
         */
        (pageState) => console.log('onActivePageChangedCallback', pageState));
        this.do = (/**
         * @template T
         * @param {?} m
         * @return {?}
         */
        (m) => doCall(this._doc, m));
        this.getDocumentMetadata$ = (/**
         * @return {?}
         */
        () => this.do('getDocumentMetadata').pipe(map((/**
         * @param {?} g
         * @return {?}
         */
        g => new DocMetadata(g)))));
        this.getPages$ = (/**
         * @return {?}
         */
        () => this.do('getPages').pipe(map((/**
         * @param {?} m
         * @return {?}
         */
        m => Object.keys(m).map((/**
         * @param {?} f
         * @return {?}
         */
        f => m[f].pageTitle))))));
        // getDocumentProperties$ = () => this.do('getDocumentProperties');
        // getBookmarks$ = () => this.do('getBookmarks');
        // getBookmarkNames$ = () => this.do('getBookmarkNames');
        // getReports$ = () => this.do('getReports');
        this.getActivePage$ = (/**
         * @return {?}
         */
        () => this.do('getActivePage'));
        this.setActivePage = (/**
         * @param {?} p
         * @return {?}
         */
        (p) => this._doc.setActivePage(p));
        this.getData = (/**
         * @return {?}
         */
        () => this.data);
        this.getMarking = (/**
         * @return {?}
         */
        () => this.marking);
        this.getFiltering = (/**
         * @return {?}
         */
        () => this.filtering);
        this.onDocumentReady$ = (/**
         * @return {?}
         */
        () => doCall(this._doc, 'onDocumentReady'));
        this.close = (/**
         * @return {?}
         */
        () => this._doc ? this._doc.close() : null);
        this.onActivePageChanged$ = (/**
         * @return {?}
         */
        () => doCall(this._doc, 'onActivePageChanged'));
        this._doc = app.openDocument(id, page, custo);
        app.onOpened$().subscribe((/**
         * @param {?} doc
         * @return {?}
         */
        doc => {
            doConsole(`Document.onOpened$: page is now opened:`, doc);
            this._doc = doc;
            // Register event handler for page change events.
            this.onActivePageChanged$().subscribe(this.onActivePageChangedCallback);
            this.marking = new Marking(this._doc.marking);
            this.filtering = new Filtering(this._doc.filtering);
            this.data = new Data(this._doc.data);
        }));
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    Document.prototype._doc;
    /**
     * @type {?}
     * @private
     */
    Document.prototype.marking;
    /**
     * @type {?}
     * @private
     */
    Document.prototype.filtering;
    /**
     * @type {?}
     * @private
     */
    Document.prototype.data;
    /**
     * @type {?}
     * @private
     */
    Document.prototype.onActivePageChangedCallback;
    /**
     * @type {?}
     * @private
     */
    Document.prototype.do;
    /** @type {?} */
    Document.prototype.getDocumentMetadata$;
    /** @type {?} */
    Document.prototype.getPages$;
    /** @type {?} */
    Document.prototype.getActivePage$;
    /** @type {?} */
    Document.prototype.setActivePage;
    /** @type {?} */
    Document.prototype.getData;
    /** @type {?} */
    Document.prototype.getMarking;
    /** @type {?} */
    Document.prototype.getFiltering;
    /** @type {?} */
    Document.prototype.onDocumentReady$;
    /** @type {?} */
    Document.prototype.close;
    /**
     * @type {?}
     * @private
     */
    Document.prototype.onActivePageChanged$;
}
/**
 * \@description
 * Turn async calls into Observables.
 *
 * For methods which name starts with 'on', the observable continues providing data it's received.
 * Otherwise the observable stops sending data at first buffer received.
 * An error is raised when the 50min timeout expires.
 *
 * @template T
 * @param {?} obj the object against we call method
 * @param {?} m the name of method
 * @param {...?} a
 * @return {?} Observable<T> an observable that corresponds to the original callback
 *
 */
function doCall(obj, m, ...a) {
    return new Observable((/**
     * @param {?} observer
     * @return {?}
     */
    observer => {
        /** @type {?} */
        const oneShot = ['onDocumentReady'];
        // doConsole('[OBS]', 'doCall obj=', obj, ', m=', m, ', arg=', args, typeof obj);
        if (typeof obj[m] !== 'function' || !obj) {
            console.error('[OBS]', `function '${m}' does not exist on `, obj);
            observer.error(`function '${m}' does not exist on objet ${JSON.stringify(obj)}`);
        }
        try {
            // doConsole('[OBS]', `Call ${m}(${a.join(',')})`, a.length);
            /** @type {?} */
            const q = (/**
             * @param {?} g
             * @return {?}
             */
            (g) => observer.next(g));
            /** @type {?} */
            const p = (/**
             * @param {?} g
             * @return {?}
             */
            (g) => { observer.next(g); observer.complete(); });
            return m.startsWith('on') && oneShot.indexOf(m) === -1 ? obj[m](...a, q) : obj[m](...a, p);
        }
        catch (err) {
            console.warn('[OBS]', 'doCall erreur: ', err);
            observer.error(err);
        }
    })).pipe(timeout(3001000), catchError((/**
     * @param {?} e
     * @return {?}
     */
    e => {
        if (e instanceof TimeoutError) {
            console.error(`[SPOTFIRE-WEBPLAYER] The call ${m}(${a.join(',')}) does not answer after 3001sec on ${JSON.stringify(obj)}`);
        }
        else {
            console.error('[SPOTFIRE-WEBPLAYER] ERROR on doCall', e);
        }
        return throwError(e);
    })));
}
export class Application {
    /**
     * @param {?} url
     * @param {?} customization
     * @param {?} path
     * @param {?} parameters
     * @param {?} reloadAnalysisInstance
     * @param {?} version
     * @param {?} onCreateLoginElement
     */
    constructor(url, customization, path, parameters, reloadAnalysisInstance, version, onCreateLoginElement) {
        this.url = url;
        this.customization = customization;
        this.path = path;
        this.parameters = parameters;
        this.reloadAnalysisInstance = reloadAnalysisInstance;
        this.version = version;
        this.onCreateLoginElement = onCreateLoginElement;
        this.readySubject = new BehaviorSubject(false);
        this.onApplicationReady$ = this.readySubject.asObservable().pipe(filter((/**
         * @param {?} d
         * @return {?}
         */
        d => d)));
        this.onReadyCallback = (/**
         * @param {?} response
         * @param {?} newApp
         * @return {?}
         */
        (response, newApp) => {
            doConsole('Application.onReadyCallback', response, newApp);
            this._app = newApp;
            // Register an error handler to catch errors.
            this._app.onError(this.onErrorCallback);
            if (response.status === 'OK') {
                // The application is ready, meaning that the api is loaded and that the analysis path
                // is validated for the current session(anonymous or logg ed in user)
                this.readySubject.next(true);
                this.readySubject.complete();
            }
            else {
                /** @type {?} */
                const errMsg = `Status not OK. ${response.status}: ${response.message}`;
                console.error('[SPOTFIRE-WEBPLAYER] Application.onReadyCallback', errMsg, response);
                this.readySubject.error(errMsg);
            }
        });
        // Displays an error message if something goes wrong in the Web Player.
        this.onErrorCallback = (/**
         * @param {?} errCode
         * @param {?} desc
         * @return {?}
         */
        (errCode, desc) => console.error(`[SPOTFIRE-WEBPLAYER] ${errCode}: ${desc}`));
        this.onOpened$ = (/**
         * @return {?}
         */
        () => doCall(this._app, 'onOpened'));
        this.getDocument = (/**
         * @param {?} id
         * @param {?} page
         * @param {?=} custo
         * @return {?}
         */
        (id, page, custo) => new Document(this, id, page, custo ? custo : this.customization));
        this.openDocument = (/**
         * @param {?} id
         * @param {?} page
         * @param {?} custo
         * @return {?}
         */
        (id, page, custo) => this._app.openDocument(id, page, custo));
        this._app = new spotfire.webPlayer.createApplication(this.url, this.customization, this.path, this.parameters, this.reloadAnalysisInstance, this.version, this.onReadyCallback, this.onCreateLoginElement);
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    Application.prototype._app;
    /**
     * @type {?}
     * @private
     */
    Application.prototype.readySubject;
    /** @type {?} */
    Application.prototype.onApplicationReady$;
    /**
     * @type {?}
     * @private
     */
    Application.prototype.onReadyCallback;
    /**
     * @type {?}
     * @private
     */
    Application.prototype.onErrorCallback;
    /** @type {?} */
    Application.prototype.onOpened$;
    /** @type {?} */
    Application.prototype.getDocument;
    /** @type {?} */
    Application.prototype.openDocument;
    /** @type {?} */
    Application.prototype.url;
    /** @type {?} */
    Application.prototype.customization;
    /** @type {?} */
    Application.prototype.path;
    /** @type {?} */
    Application.prototype.parameters;
    /** @type {?} */
    Application.prototype.reloadAnalysisInstance;
    /** @type {?} */
    Application.prototype.version;
    /** @type {?} */
    Application.prototype.onCreateLoginElement;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BvdGZpcmUtd2VicGxheWVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRpYmNvL3Nwb3RmaXJlLXdyYXBwZXIvIiwic291cmNlcyI6WyJsaWIvc3BvdGZpcmUtd2VicGxheWVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBRUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsRUFBRSxJQUFJLFlBQVksRUFBRSxHQUFHLEVBQUUsZUFBZSxFQUFNLFVBQVUsRUFBRSxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFcEgsT0FBTyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDOztBQUl4RixNQUFNLE9BQU8sVUFBVSxHQUFHO0lBQ3hCLFNBQVMsRUFBRSwwQkFBMEI7SUFDckMsMkJBQTJCLEVBQUUsOENBQThDO0lBQzNFLFVBQVUsRUFBRSx3Q0FBd0M7SUFDcEQsU0FBUyxFQUFFLG1DQUFtQztJQUM5QyxzQkFBc0IsRUFBRSw4QkFBOEI7SUFDdEQsWUFBWSxFQUFFLHdEQUF3RDtJQUN0RSxjQUFjLEVBQUUsZ0NBQWdDO0lBQ2hELGVBQWUsRUFBRSx3QkFBd0I7SUFDekMsUUFBUSxFQUFFLHlCQUF5QjtJQUNuQyxVQUFVLEVBQUUsMkJBQTJCO0lBQ3ZDLGtCQUFrQixFQUFFLG1EQUFtRDtJQUN2RSxhQUFhLEVBQUUsbUNBQW1DO0lBQ2xELFdBQVcsRUFBRSxvQ0FBb0M7SUFDakQsWUFBWSxFQUFFLDhCQUE4QjtDQUM3Qzs7Ozs7QUFFRCxTQUFTLFNBQVMsQ0FBQyxHQUFHLElBQVc7SUFDL0IsZ0RBQWdEO0FBQ2xELENBQUM7QUFDRCxNQUFNLFNBQVM7Q0FBc0M7OztJQUFuQywwQkFBYzs7SUFBQyw4QkFBa0I7O0FBQ25ELE1BQU0sU0FBUztDQUEyQjs7O0lBQXhCLGtDQUFzQjs7QUFDeEMsTUFBTSxVQUFVO0NBQWlGOzs7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LFVBQVUsQ0FBQyxFQUFDO1FBQ2hELGdCQUFXOzs7Ozs7UUFBRyxDQUFDLEVBQVUsRUFBRSxJQUFxQixFQUFFLEtBQXFCLEVBQVksRUFBRSxDQUNuRixJQUFJLFFBQVEsQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFBO1FBQ2xFLGlCQUFZOzs7Ozs7UUFBRyxDQUFDLEVBQVUsRUFBRSxJQUFxQixFQUFFLEtBQW9CLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLEVBQUM7UUExQmxILElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxRQUFRLENBQUMsU0FBUyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxHQUFHLEVBQzNELElBQUksQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxzQkFBc0IsRUFDM0UsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0lBQ25FLENBQUM7Q0F3QkY7Ozs7OztJQXZDQywyQkFBa0I7Ozs7O0lBQ2xCLG1DQUEyRDs7SUFDM0QsMENBQW1GOzs7OztJQWVuRixzQ0FlQzs7Ozs7SUFFRCxzQ0FBdUg7O0lBQ3ZILGdDQUFnRDs7SUFDaEQsa0NBQ2tFOztJQUNsRSxtQ0FBb0g7O0lBakNsSCwwQkFBa0I7O0lBQ2xCLG9DQUFtQzs7SUFDbkMsMkJBQW1COztJQUNuQixpQ0FBeUI7O0lBQ3pCLDZDQUFzQzs7SUFDdEMsOEJBQXNCOztJQUN0QiwyQ0FBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJcbi8vIENvcHlyaWdodCAoYykgMjAxOC0yMDE4LiBUSUJDTyBTb2Z0d2FyZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuIENvbmZpZGVudGlhbCAmIFByb3ByaWV0YXJ5LlxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZm9ya0pvaW4sIG9mIGFzIG9ic2VydmFibGVPZiwgemlwLCBCZWhhdmlvclN1YmplY3QsIG9mLCB0aHJvd0Vycm9yLCBUaW1lb3V0RXJyb3IgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFNwb3RmaXJlQ3VzdG9taXphdGlvbiBhcyBDdXN0b21pemF0aW9uLCBTcG90ZmlyZUZpbHRlciB9IGZyb20gJy4vc3BvdGZpcmUtY3VzdG9taXphdGlvbic7XG5pbXBvcnQgeyBtZXJnZU1hcCwgdGFwLCBwbHVjaywgbWFwLCBmaWx0ZXIsIHRpbWVvdXQsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmRlY2xhcmUgbGV0IHNwb3RmaXJlOiBhbnk7XG5cbmV4cG9ydCBjb25zdCBDVVNUTEFCRUxTID0ge1xuICBzaG93QWJvdXQ6ICdTaG93IHRoZSBhYm91dCBtZW51IGl0ZW0nLFxuICBzaG93QW5hbHlzaXNJbmZvcm1hdGlvblRvb2w6ICdTaG93IHRoZSBhbmFseXNpcyBpbmZvcm1hdGlvbiB0b29sIG1lbnUgaXRlbScsXG4gIHNob3dBdXRob3I6ICdTaG93IHRoZSBidXR0b24gZm9yIGVuYWJsaW5nIGF1dGhvcmluZycsXG4gIHNob3dDbG9zZTogJ1Nob3cgdGhlIGFuYWx5c2lzIGNsb3NlIG1lbnUgaXRlbScsXG4gIHNob3dDdXN0b21pemFibGVIZWFkZXI6ICdTaG93IHRoZSBjdXN0b21pemFibGUgaGVhZGVyJyxcbiAgc2hvd0RvZFBhbmVsOiAnU2hvdyB0aGUgZGV0YWlscyBvbiBkZW1hbmQgcGFuZWwgaW4gdGhlIHZpc3VhbGl6YXRpb24uJyxcbiAgc2hvd0V4cG9ydEZpbGU6ICdTaG93IHRoZSBleHBvcnQgZmlsZSBtZW51IGl0ZW0nLFxuICBzaG93RmlsdGVyUGFuZWw6ICdTaG93IHRoZSBmaWx0ZXIgcGFuZWwuJyxcbiAgc2hvd0hlbHA6ICdTaG93IHRoZSBoZWxwIG1lbnUgaXRlbScsXG4gIHNob3dMb2dvdXQ6ICdTaG93IHRoZSBsb2dvdXQgbWVudSBpdGVtJyxcbiAgc2hvd1BhZ2VOYXZpZ2F0aW9uOiAnU2hvdyB0aGUgcGFnZSBuYXZpZ2F0aW9uIGNvbnRyb2xzIGluIHRoZSBhbmFseXNpcycsXG4gIHNob3dTdGF0dXNCYXI6ICdTaG93IHN0YXR1cyBiYXIgaW4gdGhlIFdlYiBQbGF5ZXInLFxuICBzaG93VG9vbEJhcjogJ1Nob3cgdGhlIGFuYWx5c2lzIHRvb2xiYXIgYW5kIG1lbnUnLFxuICBzaG93VW5kb1JlZG86ICdTaG93IHRoZSB1bmRvL3JlZG8gbWVudSBpdGVtJ1xufTtcblxuZnVuY3Rpb24gZG9Db25zb2xlKC4uLmFyZ3M6IGFueVtdKSB7XG4gIC8vIGNvbnNvbGUubG9nKCdbU1BPVEZJUkUtV0VCUExBWUVSXScsIC4uLmFyZ3MpO1xufVxuY2xhc3MgUGFnZVN0YXRlIHsgaW5kZXg6IG51bWJlcjsgcGFnZVRpdGxlOiBzdHJpbmc7IH1cbmNsYXNzIERhdGFUYWJsZSB7IGRhdGFUYWJsZU5hbWU6IHN0cmluZzsgfVxuY2xhc3MgRGF0YUNvbHVtbiB7IGRhdGFDb2x1bW5OYW1lOiBzdHJpbmc7IGRhdGFUYWJsZU5hbWU6IHN0cmluZzsgZGF0YVR5cGU6IHN0cmluZzsgdmFsdWVzOiB7fTsgfVxuY2xhc3MgRGlzdGluY3RWYWx1ZXMgeyBjb3VudDogbnVtYmVyOyB2YWx1ZXM6IEFycmF5PHN0cmluZz47IH1cblxuXG5leHBvcnQgY2xhc3MgTWFya2luZyB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBfbWFya2luZykgeyB9XG4gIGdldE1hcmtpbmdOYW1lcyQgPSAoKSA9PiBkb0NhbGw8c3RyaW5nW10+KHRoaXMuX21hcmtpbmcsICdnZXRNYXJraW5nTmFtZXMnKTtcbiAgb25DaGFuZ2VkJCA9IChtLCB0LCBjLCBuKSA9PiBkb0NhbGwodGhpcy5fbWFya2luZywgJ29uQ2hhbmdlZCcsIG0sIHQsIGMsIG4pO1xufVxuXG5jbGFzcyBGaWx0ZXJpbmcge1xuICBjb25zdHJ1Y3RvcihwdWJsaWMgX2ZpbHRlcmluZykgeyB9XG4gIHNldCA9IChmbHRzKSA9PiB0aGlzLl9maWx0ZXJpbmcuc2V0RmlsdGVycyhmbHRzLCBzcG90ZmlyZS53ZWJQbGF5ZXIuZmlsdGVyaW5nT3BlcmF0aW9uLlJFUExBQ0UpO1xuICByZXNldEFsbEZpbHRlcnMgPSAoKSA9PiB0aGlzLl9maWx0ZXJpbmcucmVzZXRBbGxGaWx0ZXJzKCk7XG4gIGdldEFsbE1vZGlmaWVkRmlsdGVyQ29sdW1ucyA9ICgpID0+IGRvQ2FsbDxTcG90ZmlyZUZpbHRlcltdPihcbiAgICB0aGlzLl9maWx0ZXJpbmcsICdnZXRBbGxNb2RpZmllZEZpbHRlckNvbHVtbnMnLFxuICAgIHNwb3RmaXJlLndlYlBsYXllci5pbmNsdWRlZEZpbHRlclNldHRpbmdzLkFMTF9XSVRIX0NIRUNLRURfSElFUkFSQ0hZX05PREVTXG4gIClcbn1cblxuZXhwb3J0IGNsYXNzIFNwb3RmaXJlUGFyYW1ldGVycyB7XG4gIHVybDogc3RyaW5nO1xuICBwYXRoOiBzdHJpbmc7XG4gIHBhZ2U6IHN0cmluZyB8IG51bWJlcjtcbiAgZG9taWQ6IHN0cmluZztcbiAgc2lkOiBzdHJpbmc7XG4gIGN1c3RvbWl6YXRpb246IEN1c3RvbWl6YXRpb247XG4gIHZlcnNpb24gPSAnNy4xNCc7XG4gIGRlYnVnID0gZmFsc2U7XG4gIHJlbG9hZEFuYWx5c2lzSW5zdGFuY2UgPSBmYWxzZTtcbiAgZG9jdW1lbnQ6IGFueTtcbiAgYXBwOiBhbnk7XG4gIF9wYXJhbWV0ZXJzOiBzdHJpbmc7XG4gIGNvbnN0cnVjdG9yKHZhcnM/OiB7fSkge1xuICAgIGNvbnNvbGUubG9nKCdDT05TVFIgU3BvdGZpcmVQYXJhbWV0ZXJzJywgdmFycywgdGhpcyk7XG4gICAgaWYgKHZhcnMpIHtcbiAgICAgIE9iamVjdC5rZXlzKHZhcnMpLmZvckVhY2goa2V5ID0+IHRoaXNba2V5XSA9IHZhcnNba2V5XSk7XG4gICAgfVxuICAgIC8vIENyZWF0ZSBhIFVuaXF1ZSBJRCBmb3IgdGhpcyBTcG90ZmlyZSBkYXNoYm9hcmRcbiAgICAvL1xuICAgIHRoaXMuZG9taWQgPSB0aGlzLmRvbWlkID8gdGhpcy5kb21pZCA6IHRoaXMuc2lkID8gYCR7dGhpcy5zaWR9YCA6IGAke25ldyBEYXRlKCkuZ2V0VGltZSgpfWA7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIERhdGEge1xuICBhbGxUYWJsZXMgPSB7fTtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBfZGF0YSkgeyB9XG5cbiAgLy8gQSBTcG90ZmlyZSBhbmFseXNpcyBjb250YWlucyBvbmUgb3IgbW9yZSBkYXRhIHRhYmxlcywgcmV0cmlldmVkIGJ5IHRoZSBnZXREYXRhVGFibGUsXG4gIC8vIGdldEFjdGl2ZURhdGFUYWJsZSBhbmQgZ2V0RGF0YVRhYmxlcyBtZXRob2RzLlxuICBwcml2YXRlIGdldERhdGFUYWJsZXMkID0gKCkgPT4gZG9DYWxsPERhdGFUYWJsZVtdPih0aGlzLl9kYXRhLCAnZ2V0RGF0YVRhYmxlcycpO1xuXG4gIHByaXZhdGUgZ2V0RGF0YVRhYmxlQ29sTmFtZXMkID0gKHQpID0+IGRvQ2FsbDxEYXRhVGFibGU+KHRoaXMuX2RhdGEsICdnZXREYXRhVGFibGUnLCB0KVxuICAgIC5waXBlKG1lcmdlTWFwKGYgPT4gdGhpcy5nZXREYXRhQ29sdW1ucyQoZikpLCBtYXAoZCA9PiAoeyBbdF06IGQgfSkpKVxuXG4gIHByaXZhdGUgZ2V0RGF0YVRhYmxlJCA9ICh0KSA9PiBkb0NhbGw8RGF0YVRhYmxlPih0aGlzLl9kYXRhLCAnZ2V0RGF0YVRhYmxlJywgdClcbiAgICAucGlwZShtZXJnZU1hcChmID0+IHRoaXMuZ2V0RGF0YUNvbHVtbnMkKGYpKSlcblxuICAvLyBFYWNoIGRhdGEgdGFibGUgY29udGFpbnMgb25lIG9yIG1vcmUgZGF0YSBjb2x1bW5zLCByZXRyaWV2ZWQgYnkgdGhlIGdldERhdGFDb2x1bW4sXG4gIC8vIGdldERhdGFDb2x1bW5zIGFuZCBzZWFyY2hEYXRhQ29sdW1ucy5cbiAgcHJpdmF0ZSBnZXREYXRhQ29sdW1ucyQgPSAodCkgPT4gZG9DYWxsPERhdGFDb2x1bW5bXT4odCwgJ2dldERhdGFDb2x1bW5zJykucGlwZShcbiAgICBtZXJnZU1hcChjb2x1bW5zID0+IHtcbiAgICAgIGNvbnN0IG9icyA9IFtdO1xuICAgICAgY29sdW1ucy5mb3JFYWNoKChjb2w6IERhdGFDb2x1bW4pID0+IG9icy5wdXNoKHppcCguLi5bb2JzZXJ2YWJsZU9mKGNvbCldLCAoYTogRGF0YUNvbHVtbiwgYikgPT4gYS5kYXRhQ29sdW1uTmFtZSkpKTtcbiAgICAgIHJldHVybiBmb3JrSm9pbihvYnMpO1xuICAgIH0pXG4gIClcblxuXG4gIC8vIEZyb20gdGhlIERhdGFDb2x1bW4gY2xhc3MgaXQgaXMgcG9zc2libGUgdG8gcmV0cmlldmUgbWV0YWRhdGEsIHN1Y2ggYXMgY29sdW1uIG5hbWUgYW5kIGRhdGEgdHlwZS5cbiAgLy8gSXQgaXMgYWxzbyBwb3NzaWJsZSB0byBnZXQgYSBsaXN0IG9mIHRoZSB1bmlxdWUgdmFsdWVzIGluIHRoZSBkYXRhIGNvbHVtbiB3aXRoIHRoZSBnZXREaXN0aW5jdFZhbHVlcyBtZXRob2QuXG4gIHByaXZhdGUgZ2V0RGlzdGluY3RWYWx1ZXMkID0gKHQ6IERhdGFDb2x1bW4pID0+IGRvQ2FsbDxEaXN0aW5jdFZhbHVlcz4odCwgJ2dldERpc3RpbmN0VmFsdWVzJywgMCwgMjApLnBpcGUoXG4gICAgdGFwKGcgPT4gZG9Db25zb2xlKCdEYXRhLkRpc3RpbmN0VmFsdWVzJCcsIHQsIGcsIGcuY291bnQgPiAwICYmIGcuY291bnQgPCAyNSkpLFxuICAgIC8vIGZpbHRlcihnID0+IGcuY291bnQgPiAwICYmIGcuY291bnQgPCAyNSksXG4gICAgLy8gIHRhcChnID0+IGRvQ29uc29sZSgnW09CU10nLCAnRGlzdGluY3RWYWx1ZXMgZmlsdHJlcycsIGcpKSxcbiAgICBwbHVjaygndmFsdWVzJykpXG5cbiAgZ2V0VGFibGVzJCA9ICgpID0+IHRoaXMuZ2V0RGF0YVRhYmxlcyQoKS5waXBlKFxuICAgIG1lcmdlTWFwKHRhYmxlcyA9PiB7XG4gICAgICBjb25zdCBvYnMgPSBbXTtcbiAgICAgIHRhYmxlcy5mb3JFYWNoKHRhYmxlID0+IG9icy5wdXNoKHRoaXMuZ2V0RGF0YVRhYmxlQ29sTmFtZXMkKHRhYmxlLmRhdGFUYWJsZU5hbWUpKSk7XG4gICAgICByZXR1cm4gZm9ya0pvaW4ob2JzKTtcbiAgICB9KSxcbiAgICBtYXAoayA9PiB7XG4gICAgICBsZXQgeiA9IHt9O1xuICAgICAgay5mb3JFYWNoKHAgPT4geiA9IHsgLi4ueiwgLi4ucCB9KTtcbiAgICAgIHJldHVybiB6O1xuICAgIH0pXG4gIClcbiAgZ2V0QWxsVGFibGVzJCA9ICgpID0+IHRoaXMuZ2V0RGF0YVRhYmxlcyQoKS5waXBlKFxuICAgIG1lcmdlTWFwKHRhYmxlcyA9PiB7XG4gICAgICBjb25zdCBvYnMgPSBbXTtcbiAgICAgIHRhYmxlcy5mb3JFYWNoKHRhYmxlID0+IG9icy5wdXNoKHRoaXMuZ2V0RGF0YVRhYmxlJCh0YWJsZS5kYXRhVGFibGVOYW1lKSkpO1xuICAgICAgcmV0dXJuIGZvcmtKb2luKG9icyk7XG4gICAgfSksIG1hcCh0YWJsZXMgPT4ge1xuICAgICAgY29uc3QgZGF0YVRhYmxlcyA9IFtdO1xuICAgICAgKHRhYmxlc1swXSBhcyBbXSkuZm9yRWFjaChjb2x1bW5zID0+IHtcbiAgICAgICAgY29uc3QgdG5hbWUgPSBjb2x1bW5zWyd0YWJOYW1lJ107XG4gICAgICAgIGlmICghZGF0YVRhYmxlc1t0bmFtZV0pIHsgZGF0YVRhYmxlc1t0bmFtZV0gPSB7fTsgfVxuICAgICAgICBkYXRhVGFibGVzW3RuYW1lXVtjb2x1bW5zWydjb2xOYW1lJ11dID0gY29sdW1uc1sndmFscyddO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZGF0YVRhYmxlcztcbiAgICB9KSlcbn1cblxuZXhwb3J0IGNsYXNzIERvY01ldGFkYXRhIHtcbiAgc2l6ZTogbnVtYmVyO1xuICBzaXplVW5pdCA9ICdCJztcbiAgY29udGVudFNpemU6IG51bWJlcjtcbiAgY3JlYXRlZDogRGF0ZTtcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgbGFzdE1vZGlmaWVkOiBEYXRlO1xuICBwYXRoOiBzdHJpbmc7XG4gIHRpdGxlOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IocD8pIHtcbiAgICBpZiAocCkge1xuICAgICAgdGhpcy5jb250ZW50U2l6ZSA9IHBhcnNlSW50KHBbJ2NvbnRlbnRTaXplJ10sIDEwKTtcbiAgICAgIGlmICh0aGlzLmNvbnRlbnRTaXplID4gKDEwMjQgKiAxMDI0KSkge1xuICAgICAgICB0aGlzLnNpemUgPSB0aGlzLmNvbnRlbnRTaXplIC8gKDEwMjQgKiAxMDI0KTtcbiAgICAgICAgdGhpcy5zaXplVW5pdCA9ICdNQic7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuY29udGVudFNpemUgPiAxMDI0KSB7XG4gICAgICAgIHRoaXMuc2l6ZSA9IHRoaXMuY29udGVudFNpemUgLyAxMDI0O1xuICAgICAgICB0aGlzLnNpemVVbml0ID0gJ0tCJztcbiAgICAgIH1cbiAgICAgIHRoaXMuY3JlYXRlZCA9IG5ldyBEYXRlKHAuY3JlYXRlZCk7XG4gICAgICB0aGlzLmxhc3RNb2RpZmllZCA9IG5ldyBEYXRlKHAubGFzdE1vZGlmaWVkKTtcbiAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBwLmRlc2NyaXB0aW9uO1xuICAgICAgdGhpcy5wYXRoID0gcC5wYXRoO1xuICAgICAgdGhpcy50aXRsZSA9IHAudGl0bGU7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBEb2N1bWVudCB7XG4gIHByaXZhdGUgX2RvYztcbiAgcHJpdmF0ZSBtYXJraW5nOiBNYXJraW5nO1xuICBwcml2YXRlIGZpbHRlcmluZzogRmlsdGVyaW5nO1xuICBwcml2YXRlIGRhdGE6IERhdGE7XG4gIGNvbnN0cnVjdG9yKGFwcCwgaWQsIHBhZ2UsIGN1c3RvKSB7XG4gICAgdGhpcy5fZG9jID0gYXBwLm9wZW5Eb2N1bWVudChpZCwgcGFnZSwgY3VzdG8pO1xuICAgIGFwcC5vbk9wZW5lZCQoKS5zdWJzY3JpYmUoZG9jID0+IHtcbiAgICAgIGRvQ29uc29sZShgRG9jdW1lbnQub25PcGVuZWQkOiBwYWdlIGlzIG5vdyBvcGVuZWQ6YCwgZG9jKTtcbiAgICAgIHRoaXMuX2RvYyA9IGRvYztcbiAgICAgIC8vIFJlZ2lzdGVyIGV2ZW50IGhhbmRsZXIgZm9yIHBhZ2UgY2hhbmdlIGV2ZW50cy5cbiAgICAgIHRoaXMub25BY3RpdmVQYWdlQ2hhbmdlZCQoKS5zdWJzY3JpYmUodGhpcy5vbkFjdGl2ZVBhZ2VDaGFuZ2VkQ2FsbGJhY2spO1xuICAgICAgdGhpcy5tYXJraW5nID0gbmV3IE1hcmtpbmcodGhpcy5fZG9jLm1hcmtpbmcpO1xuICAgICAgdGhpcy5maWx0ZXJpbmcgPSBuZXcgRmlsdGVyaW5nKHRoaXMuX2RvYy5maWx0ZXJpbmcpO1xuICAgICAgdGhpcy5kYXRhID0gbmV3IERhdGEodGhpcy5fZG9jLmRhdGEpO1xuICAgIH0pO1xuICB9XG4gIHByaXZhdGUgb25BY3RpdmVQYWdlQ2hhbmdlZENhbGxiYWNrID0gKHBhZ2VTdGF0ZSkgPT4gY29uc29sZS5sb2coJ29uQWN0aXZlUGFnZUNoYW5nZWRDYWxsYmFjaycsIHBhZ2VTdGF0ZSk7XG4gIHByaXZhdGUgZG8gPSA8VD4obTogc3RyaW5nKSA9PiBkb0NhbGw8VD4odGhpcy5fZG9jLCBtKTtcbiAgZ2V0RG9jdW1lbnRNZXRhZGF0YSQgPSAoKTogT2JzZXJ2YWJsZTxEb2NNZXRhZGF0YT4gPT4gdGhpcy5kbzxEb2NNZXRhZGF0YT4oJ2dldERvY3VtZW50TWV0YWRhdGEnKS5waXBlKFxuICAgIG1hcChnID0+IG5ldyBEb2NNZXRhZGF0YShnKSkpXG4gIGdldFBhZ2VzJCA9ICgpID0+IHRoaXMuZG8oJ2dldFBhZ2VzJykucGlwZShtYXAobSA9PiBPYmplY3Qua2V5cyhtKS5tYXAoZiA9PiBtW2ZdLnBhZ2VUaXRsZSkpKTtcbiAgLy8gZ2V0RG9jdW1lbnRQcm9wZXJ0aWVzJCA9ICgpID0+IHRoaXMuZG8oJ2dldERvY3VtZW50UHJvcGVydGllcycpO1xuICAvLyBnZXRCb29rbWFya3MkID0gKCkgPT4gdGhpcy5kbygnZ2V0Qm9va21hcmtzJyk7XG4gIC8vIGdldEJvb2ttYXJrTmFtZXMkID0gKCkgPT4gdGhpcy5kbygnZ2V0Qm9va21hcmtOYW1lcycpO1xuICAvLyBnZXRSZXBvcnRzJCA9ICgpID0+IHRoaXMuZG8oJ2dldFJlcG9ydHMnKTtcbiAgZ2V0QWN0aXZlUGFnZSQgPSAoKSA9PiB0aGlzLmRvPFBhZ2VTdGF0ZT4oJ2dldEFjdGl2ZVBhZ2UnKTtcbiAgc2V0QWN0aXZlUGFnZSA9IChwOiBzdHJpbmcgfCBudW1iZXIpID0+IHRoaXMuX2RvYy5zZXRBY3RpdmVQYWdlKHApO1xuICBnZXREYXRhID0gKCkgPT4gdGhpcy5kYXRhO1xuICBnZXRNYXJraW5nID0gKCkgPT4gdGhpcy5tYXJraW5nO1xuICBnZXRGaWx0ZXJpbmcgPSAoKSA9PiB0aGlzLmZpbHRlcmluZztcbiAgcHVibGljIG9uRG9jdW1lbnRSZWFkeSQgPSAoKSA9PiBkb0NhbGwodGhpcy5fZG9jLCAnb25Eb2N1bWVudFJlYWR5Jyk7XG4gIHB1YmxpYyBjbG9zZSA9ICgpID0+IHRoaXMuX2RvYyA/IHRoaXMuX2RvYy5jbG9zZSgpIDogbnVsbDtcbiAgcHJpdmF0ZSBvbkFjdGl2ZVBhZ2VDaGFuZ2VkJCA9ICgpID0+IGRvQ2FsbCh0aGlzLl9kb2MsICdvbkFjdGl2ZVBhZ2VDaGFuZ2VkJyk7XG59XG5cbi8qKlxuICogQGRlc2NyaXB0aW9uXG4gKiBUdXJuIGFzeW5jIGNhbGxzIGludG8gT2JzZXJ2YWJsZXMuXG4gKlxuICogRm9yIG1ldGhvZHMgd2hpY2ggbmFtZSBzdGFydHMgd2l0aCAnb24nLCB0aGUgb2JzZXJ2YWJsZSBjb250aW51ZXMgcHJvdmlkaW5nIGRhdGEgaXQncyByZWNlaXZlZC5cbiAqIE90aGVyd2lzZSB0aGUgb2JzZXJ2YWJsZSBzdG9wcyBzZW5kaW5nIGRhdGEgYXQgZmlyc3QgYnVmZmVyIHJlY2VpdmVkLlxuICogQW4gZXJyb3IgaXMgcmFpc2VkIHdoZW4gdGhlIDUwbWluIHRpbWVvdXQgZXhwaXJlcy5cbiAqXG4gKiBAcGFyYW0gb2JqIHRoZSBvYmplY3QgYWdhaW5zdCB3ZSBjYWxsIG1ldGhvZFxuICogQHBhcmFtIG0gdGhlIG5hbWUgb2YgbWV0aG9kXG4gKiBAcGFyYW0gLi4uYSBsaXN0IG9mIGFyZ3VtZW50cyB0byBiZSBzZW50IGFsb25nIHdpdGggdGhlIG1ldGhvZFxuICpcbiAqIEByZXR1cm4gT2JzZXJ2YWJsZTxUPiBhbiBvYnNlcnZhYmxlIHRoYXQgY29ycmVzcG9uZHMgdG8gdGhlIG9yaWdpbmFsIGNhbGxiYWNrXG4gKlxuICovXG5mdW5jdGlvbiBkb0NhbGw8VD4ob2JqLCBtOiBzdHJpbmcsIC4uLmE6IGFueVtdKTogT2JzZXJ2YWJsZTxUPiB7XG4gIHJldHVybiBuZXcgT2JzZXJ2YWJsZTxUPihvYnNlcnZlciA9PiB7XG4gICAgY29uc3Qgb25lU2hvdCA9IFsnb25Eb2N1bWVudFJlYWR5J107XG4gICAgLy8gZG9Db25zb2xlKCdbT0JTXScsICdkb0NhbGwgb2JqPScsIG9iaiwgJywgbT0nLCBtLCAnLCBhcmc9JywgYXJncywgdHlwZW9mIG9iaik7XG4gICAgaWYgKHR5cGVvZiBvYmpbbV0gIT09ICdmdW5jdGlvbicgfHwgIW9iaikge1xuICAgICAgY29uc29sZS5lcnJvcignW09CU10nLCBgZnVuY3Rpb24gJyR7bX0nIGRvZXMgbm90IGV4aXN0IG9uIGAsIG9iaik7XG4gICAgICBvYnNlcnZlci5lcnJvcihgZnVuY3Rpb24gJyR7bX0nIGRvZXMgbm90IGV4aXN0IG9uIG9iamV0ICR7SlNPTi5zdHJpbmdpZnkob2JqKX1gKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIC8vIGRvQ29uc29sZSgnW09CU10nLCBgQ2FsbCAke219KCR7YS5qb2luKCcsJyl9KWAsIGEubGVuZ3RoKTtcbiAgICAgIGNvbnN0IHEgPSAoZzogVCkgPT4gb2JzZXJ2ZXIubmV4dChnKTtcbiAgICAgIGNvbnN0IHAgPSAoZzogVCkgPT4geyBvYnNlcnZlci5uZXh0KGcpOyBvYnNlcnZlci5jb21wbGV0ZSgpOyB9O1xuICAgICAgcmV0dXJuIG0uc3RhcnRzV2l0aCgnb24nKSAmJiBvbmVTaG90LmluZGV4T2YobSkgPT09IC0xID8gb2JqW21dKC4uLmEsIHEpIDogb2JqW21dKC4uLmEsIHApO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS53YXJuKCdbT0JTXScsICdkb0NhbGwgZXJyZXVyOiAnLCBlcnIpO1xuICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyKTtcbiAgICB9XG4gIH0pLnBpcGUoXG4gICAgdGltZW91dCgzMDAxMDAwKSxcbiAgICBjYXRjaEVycm9yKGUgPT4ge1xuICAgICAgaWYgKGUgaW5zdGFuY2VvZiBUaW1lb3V0RXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgW1NQT1RGSVJFLVdFQlBMQVlFUl0gVGhlIGNhbGwgJHttfSgke2Euam9pbignLCcpfSkgZG9lcyBub3QgYW5zd2VyIGFmdGVyIDMwMDFzZWMgb24gJHtKU09OLnN0cmluZ2lmeShvYmopfWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW1NQT1RGSVJFLVdFQlBMQVlFUl0gRVJST1Igb24gZG9DYWxsJywgZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhyb3dFcnJvcihlKTtcbiAgICB9KSk7XG59XG5cbmV4cG9ydCBjbGFzcyBBcHBsaWNhdGlvbiB7XG4gIHByaXZhdGUgX2FwcDogYW55O1xuICBwcml2YXRlIHJlYWR5U3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4oZmFsc2UpO1xuICBwdWJsaWMgb25BcHBsaWNhdGlvblJlYWR5JCA9IHRoaXMucmVhZHlTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpLnBpcGUoZmlsdGVyKGQgPT4gZCkpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyB1cmw6IHN0cmluZyxcbiAgICBwdWJsaWMgY3VzdG9taXphdGlvbjogQ3VzdG9taXphdGlvbixcbiAgICBwdWJsaWMgcGF0aDogc3RyaW5nLFxuICAgIHB1YmxpYyBwYXJhbWV0ZXJzOiBzdHJpbmcsXG4gICAgcHVibGljIHJlbG9hZEFuYWx5c2lzSW5zdGFuY2U6IGJvb2xlYW4sXG4gICAgcHVibGljIHZlcnNpb246IHN0cmluZyxcbiAgICBwdWJsaWMgb25DcmVhdGVMb2dpbkVsZW1lbnQpIHtcbiAgICB0aGlzLl9hcHAgPSBuZXcgc3BvdGZpcmUud2ViUGxheWVyLmNyZWF0ZUFwcGxpY2F0aW9uKHRoaXMudXJsLFxuICAgICAgdGhpcy5jdXN0b21pemF0aW9uLCB0aGlzLnBhdGgsIHRoaXMucGFyYW1ldGVycywgdGhpcy5yZWxvYWRBbmFseXNpc0luc3RhbmNlLFxuICAgICAgdGhpcy52ZXJzaW9uLCB0aGlzLm9uUmVhZHlDYWxsYmFjaywgdGhpcy5vbkNyZWF0ZUxvZ2luRWxlbWVudCk7XG4gIH1cblxuICBwcml2YXRlIG9uUmVhZHlDYWxsYmFjayA9IChyZXNwb25zZSwgbmV3QXBwOiBBcHBsaWNhdGlvbikgPT4ge1xuICAgIGRvQ29uc29sZSgnQXBwbGljYXRpb24ub25SZWFkeUNhbGxiYWNrJywgcmVzcG9uc2UsIG5ld0FwcCk7XG4gICAgdGhpcy5fYXBwID0gbmV3QXBwO1xuICAgIC8vIFJlZ2lzdGVyIGFuIGVycm9yIGhhbmRsZXIgdG8gY2F0Y2ggZXJyb3JzLlxuICAgIHRoaXMuX2FwcC5vbkVycm9yKHRoaXMub25FcnJvckNhbGxiYWNrKTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAnT0snKSB7XG4gICAgICAvLyBUaGUgYXBwbGljYXRpb24gaXMgcmVhZHksIG1lYW5pbmcgdGhhdCB0aGUgYXBpIGlzIGxvYWRlZCBhbmQgdGhhdCB0aGUgYW5hbHlzaXMgcGF0aFxuICAgICAgLy8gaXMgdmFsaWRhdGVkIGZvciB0aGUgY3VycmVudCBzZXNzaW9uKGFub255bW91cyBvciBsb2dnIGVkIGluIHVzZXIpXG4gICAgICB0aGlzLnJlYWR5U3ViamVjdC5uZXh0KHRydWUpO1xuICAgICAgdGhpcy5yZWFkeVN1YmplY3QuY29tcGxldGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgZXJyTXNnID0gYFN0YXR1cyBub3QgT0suICR7cmVzcG9uc2Uuc3RhdHVzfTogJHtyZXNwb25zZS5tZXNzYWdlfWA7XG4gICAgICBjb25zb2xlLmVycm9yKCdbU1BPVEZJUkUtV0VCUExBWUVSXSBBcHBsaWNhdGlvbi5vblJlYWR5Q2FsbGJhY2snLCBlcnJNc2csIHJlc3BvbnNlKTtcbiAgICAgIHRoaXMucmVhZHlTdWJqZWN0LmVycm9yKGVyck1zZyk7XG4gICAgfVxuICB9XG4gIC8vIERpc3BsYXlzIGFuIGVycm9yIG1lc3NhZ2UgaWYgc29tZXRoaW5nIGdvZXMgd3JvbmcgaW4gdGhlIFdlYiBQbGF5ZXIuXG4gIHByaXZhdGUgb25FcnJvckNhbGxiYWNrID0gKGVyckNvZGU6IHN0cmluZywgZGVzYzogc3RyaW5nKSA9PiBjb25zb2xlLmVycm9yKGBbU1BPVEZJUkUtV0VCUExBWUVSXSAke2VyckNvZGV9OiAke2Rlc2N9YCk7XG4gIG9uT3BlbmVkJCA9ICgpID0+IGRvQ2FsbCh0aGlzLl9hcHAsICdvbk9wZW5lZCcpO1xuICBnZXREb2N1bWVudCA9IChpZDogc3RyaW5nLCBwYWdlOiBzdHJpbmcgfCBudW1iZXIsIGN1c3RvPzogQ3VzdG9taXphdGlvbik6IERvY3VtZW50ID0+XG4gICAgbmV3IERvY3VtZW50KHRoaXMsIGlkLCBwYWdlLCBjdXN0byA/IGN1c3RvIDogdGhpcy5jdXN0b21pemF0aW9uKVxuICBvcGVuRG9jdW1lbnQgPSAoaWQ6IHN0cmluZywgcGFnZTogc3RyaW5nIHwgbnVtYmVyLCBjdXN0bzogQ3VzdG9taXphdGlvbikgPT4gdGhpcy5fYXBwLm9wZW5Eb2N1bWVudChpZCwgcGFnZSwgY3VzdG8pO1xufVxuIl19